figure(1);
subplot(2,1,1);

load([getfamilydata('Directory','OpsData'), 'rampup_tune_table.mat']);
e = linspace(tune_meas_ramp.energy(1), tune_meas_ramp.energy(end), 300);
tunefilt = interp1(tune_meas_ramp.energy, tune_meas_ramp.tune, e, 'spline', 'extrap');

plot(tune_meas_ramp.energy, tune_meas_ramp.tunefilt, '-');
hold on;
plot(e, tunefilt, 'k');
plot(tune_meas_ramp.energy, tune_meas_ramp.tune, '.');
hold off
legend('Horizontal','Vertical','Spline');
ylabel('Tune');
xlabel('Energy');
title(sprintf('Tune During Slow Energy Ramp Up (%s)', getfamilydata('OperationalMode')));

subplot(2,1,2);

load([getfamilydata('Directory','OpsData'), 'rampdown_tune_table.mat']);
e = linspace(tune_meas_ramp.energy(1), tune_meas_ramp.energy(end), 300);
tunefilt = interp1(tune_meas_ramp.energy, tune_meas_ramp.tune, e, 'spline', 'extrap');

plot(tune_meas_ramp.energy, tune_meas_ramp.tunefilt, '-');
hold on;
plot(e, tunefilt, 'k');
plot(tune_meas_ramp.energy, tune_meas_ramp.tune, '.');
hold off
legend('Horizontal','Vertical','Spline');
ylabel('Tune');
xlabel('Energy');
title(sprintf('Tune During Slow Energy Ramp Down (%s)', getfamilydata('OperationalMode')));


%Goal.Tune = [];
%Goal.Energy = [1.353 1.890861968733420];

a = [
1 1.8909 0.24861 0.20361 41.81
9 1.8855 0.25378 0.20805 41.78
18 1.8795 0.24491 0.20694 41.81
27 1.8735 0.24675 0.21727 41.81
36 1.8675 0.26559 0.22651 41.78
45 1.8615 0.27076 0.22134 41.78
54 1.8555 0.27334 0.22577 41.78
63 1.8495 0.27408 0.21173 41.75
72 1.8435 0.28036 0.21026 41.72
81 1.8375 0.24121 0.17851 41.78
90 1.8315 0.27482 0.21322 41.75
99 1.8255 0.25119 0.18773 41.75
108 1.8195 0.29070 0.18736 41.78
117 1.8135 0.29698 0.18736 41.75
126 1.8074 0.30175 0.18663 41.75
135 1.8014 0.30519 0.26270 41.72
144 1.7954 0.27714 0.26566 41.72
153 1.7894 0.30335 0.17001 41.72
162 1.7834 0.30591 0.16743 41.78
171 1.7774 0.31847 0.28190 41.72
180 1.7714 0.32216 0.28596 41.72
189 1.7654 0.32643 0.28855 41.72
198 1.7594 0.32864 0.18220 41.72
207 1.7534 0.32988 0.29261 41.72
216 1.7474 0.33516 0.29224 41.72
225 1.7414 0.32370 0.28375 41.72
234 1.7354 0.32740 0.29667 41.69
243 1.7294 0.33515 0.28670 41.63
252 1.7234 0.34476 0.28817 38.15
261 1.7174 0.33478 0.29704 21.49
270 1.7114 0.38464 0.26049  0.18
279 1.7053 0.31848 0.26676  0.00
288 1.6993 0.33066 0.18626  0.00
297 1.6933 0.33915 0.18995  0.03
306 1.6873 0.40082 0.21211  0.03
315 1.6813 0.40488 0.24977  0.00
324 1.6753 0.32733 0.24276  0.00
333 1.6693 0.37571 0.29076  0.03
342 1.6633 0.38457 0.29003  0.03
351 1.6573 0.45104 0.30258 -0.03
360 1.6513 0.39676 0.22393  0.00
369 1.6453 0.44070 0.17961  0.00
378 1.6393 0.32955 0.20140  0.00
387 1.6333 0.40747 0.25125  0.03
396 1.6273 0.35503 0.25235 -0.03
405 1.6213 0.43073 0.20805  0.03
414 1.6153 0.44919 0.28780  0.03
423 1.6093 0.33878 0.20030  0.03
432 1.6032 0.32253 0.17334  0.00
441 1.5972 0.40414 0.24313  0.03
450 1.5912 0.34765 0.20435  0.00
459 1.5852 0.43812 0.28226  0.03
468 1.5792 0.32179 0.17260 -0.03
477 1.5732 0.38531 0.29003 -0.06
486 1.5672 0.38494 0.24682 -0.03
495 1.5612 0.42002 0.29261  0.03
504 1.5552 0.39823 0.18515  0.03
513 1.5492 0.36611 0.19549  0.00
522 1.5432 0.45030 0.25790 -0.03
531 1.5372 0.40193 0.22503  0.03
540 1.5312 0.39454 0.19586  0.03
549 1.5252 0.32327 0.24054  0.00
558 1.5192 0.40857 0.22873  0.00
567 1.5132 0.44366 0.22467  0.00
576 1.5072 0.36315 0.28929 -0.03
585 1.5011 0.37349 0.27193 -0.03
594 1.4951 0.37682 0.30369  0.03
603 1.4891 0.39122 0.27120  0.00
612 1.4831 0.34986 0.25310  0.03
621 1.4771 0.31515 0.18736  0.03
630 1.4711 0.31515 0.27230  0.03
639 1.4651 0.40598 0.26049 -0.03
648 1.4591 0.42888 0.29003 -0.06
657 1.4531 0.39122 0.17777 -0.03
666 1.4471 0.44993 0.25162  0.03
675 1.4411 0.44734 0.26602 -0.03
684 1.4351 0.38901 0.18072  0.00
693 1.4291 0.41301 0.16927  0.00
702 1.4231 0.39455 0.24904 -0.03
711 1.4171 0.44255 0.23722 -0.03
720 1.4111 0.34174 0.28929  0.03
729 1.4051 0.35687 0.23759 -0.03
738 1.3990 0.37719 0.27414  0.03
747 1.3930 0.40119 0.20620  0.03
756 1.3870 0.36463 0.18589 -0.06
765 1.3810 0.39934 0.21026  0.00
774 1.3750 0.35281 0.21359  0.03
783 1.3690 0.39159 0.26159 -0.06
792 1.3630 0.32623 0.26122 -0.03
801 1.3570 0.32733 0.18109 -0.03
807 1.3530 0.36241 0.18109  0.00
];



b = [
   1 1.3530 0.30535 0.26863 43.58
   9 1.3583 0.30349 0.26678 43.55
  18 1.3643 0.30091 0.26420 43.52
  27 1.3704 0.29722 0.26124 43.49
  36 1.3764 0.29353 0.25829 43.52
  45 1.3824 0.29054 0.25497 43.52
  54 1.3884 0.28870 0.25238 43.43
  63 1.3944 0.28516 0.24979 43.46
  72 1.4004 0.28295 0.24758 43.46
  81 1.4064 0.27977 0.24537 43.46
  90 1.4124 0.27756 0.24315 43.43
  99 1.4184 0.27498 0.24241 43.46
 108 1.4244 0.27239 0.24057 43.43
 117 1.4304 0.27243 0.23908 43.37
 126 1.4364 0.26873 0.23761 43.40
 135 1.4424 0.26689 0.23613 43.37
 144 1.4484 0.26652 0.23503 43.37
 153 1.4544 0.26412 0.23429 43.34
 162 1.4604 0.26373 0.23281 43.34
 171 1.4664 0.26114 0.23207 43.34
 180 1.4725 0.25993 0.23096 43.34
 189 1.4785 0.25863 0.23133 43.34
 198 1.4845 0.25678 0.23023 43.31
 207 1.4905 0.25678 0.22986 43.28
 216 1.4965 0.25419 0.22949 43.31
 225 1.5025 0.25419 0.22912 43.28
 234 1.5085 0.25272 0.22912 43.28
 243 1.5145 0.25198 0.22875 43.31
 252 1.5205 0.25198 0.22838 43.21
 261 1.5265 0.25125 0.22838 43.28
 270 1.5325 0.25087 0.22875 43.24
 279 1.5385 0.25087 0.22949 43.24
 288 1.5445 0.25020 0.22875 43.21
 297 1.5505 0.24983 0.22949 43.18
 306 1.5565 0.24909 0.22949 43.21
 315 1.5625 0.25057 0.22986 43.18
 324 1.5685 0.24909 0.23023 43.15
 333 1.5746 0.24872 0.23060 43.12
 342 1.5806 0.24909 0.23060 43.15
 351 1.5866 0.24798 0.23170 43.15
 360 1.5926 0.24872 0.23170 43.18
 369 1.5986 0.24872 0.23207 43.09
 378 1.6046 0.24835 0.23207 43.12
 387 1.6106 0.24872 0.23170 43.12
 396 1.6166 0.24827 0.23392 43.12
 405 1.6226 0.24827 0.23392 43.09
 414 1.6286 0.24827 0.23540 43.09
 423 1.6346 0.24790 0.23613 43.12
 432 1.6406 0.24864 0.23613 43.06
 441 1.6466 0.24901 0.23650 43.06
 450 1.6526 0.24938 0.23650 43.09
 459 1.6586 0.24938 0.23650 43.03
 468 1.6646 0.24866 0.23798 43.03
 477 1.6706 0.24939 0.23835 43.03
 486 1.6767 0.24866 0.23909 43.03
 495 1.6827 0.24902 0.23908 43.00
 504 1.6887 0.24902 0.23946 43.03
 513 1.6947 0.24976 0.23946 43.03
 522 1.7007 0.24976 0.23946 42.94
 531 1.7067 0.25013 0.23946 43.06
 540 1.7127 0.24976 0.23983 43.00
 549 1.7187 0.24986 0.23946 42.97
 558 1.7247 0.25032 0.23946 42.94
 567 1.7307 0.25032 0.23946 42.94
 576 1.7367 0.24922 0.23946 42.97
 585 1.7427 0.24995 0.23872 42.94
 594 1.7487 0.24958 0.23872 42.94
 603 1.7547 0.24922 0.23835 42.94
 612 1.7607 0.24949 0.23761 42.94
 621 1.7667 0.24949 0.23650 42.91
 630 1.7727 0.24801 0.23613 42.91
 639 1.7788 0.24838 0.23577 42.91
 648 1.7848 0.24920 0.23466 42.88
 657 1.7908 0.24809 0.23355 42.85
 666 1.7968 0.24809 0.23244 42.88
 675 1.8028 0.24773 0.23170 42.85
 684 1.8088 0.24745 0.23023 42.85
 693 1.8148 0.24771 0.22875 42.85
 702 1.8208 0.24697 0.22727 42.85
 711 1.8268 0.24697 0.22579 42.85
 720 1.8328 0.24632 0.22395 42.88
 729 1.8388 0.24630 0.22211 42.85
 738 1.8448 0.24594 0.21988 42.82
 747 1.8508 0.24557 0.21841 42.82
 756 1.8568 0.24557 0.21620 42.79
 765 1.8628 0.24556 0.21361 42.79
 774 1.8688 0.24557 0.21103 42.85
 783 1.8748 0.24557 0.20881 42.85
 792 1.8809 0.24519 0.20549 42.85
 801 1.8869 0.24525 0.20290 42.76
 807 1.8909 0.24563 0.20069 42.82

   1 1.8909 0.25006 0.20327 42.73
   9 1.8855 0.25375 0.20844 42.73
  18 1.8795 0.25856 0.21508 42.76
  27 1.8735 0.26261 0.22174 42.73
  36 1.8675 0.26699 0.22801 42.73
  45 1.8615 0.27091 0.23355 42.73
  54 1.8555 0.27460 0.23872 42.73
  63 1.8495 0.27835 0.24425 42.70
  72 1.8435 0.28283 0.24943 42.66
  81 1.8375 0.28626 0.25349 42.63
  90 1.8315 0.28958 0.25792 42.57
  99 1.8255 0.29276 0.26198 42.63
 108 1.8195 0.29682 0.26568 42.60
 117 1.8135 0.29888 0.26900 42.60
 126 1.8074 0.30293 0.27232 42.60
 135 1.8014 0.30720 0.27528 42.60
 144 1.7954 0.31127 0.27860 42.51
 153 1.7894 0.31385 0.28119 42.54
 162 1.7834 0.31677 0.28414 42.57
 171 1.7774 0.32086 0.28598 42.51
 180 1.7714 0.32381 0.28820 42.51
 189 1.7654 0.32676 0.29005 42.54
 198 1.7594 0.32919 0.29264 42.54
 207 1.7534 0.33233 0.29374 42.51
 216 1.7474 0.33603 0.29522 42.54
 225 1.7414 0.33898 0.29706 42.51
 234 1.7354 0.34206 0.29817 42.45
 243 1.7294 0.34464 0.29965 42.02
 252 1.7234 0.35277 0.29965 14.16
];
% 261 1.7174 0.40114 0.23724  0.00

figure(2);
plot(b(:,2),[b(:,3) b(:,4)],'.-');
legend('Horizontal','Vertical');
ylabel('Tune');
xlabel('Energy');
title('Tune Shift During Slow Energy Ramp Down');

b=[
   1 1.3530 0.30804 0.27213 38.73
  54 1.3884 0.29056 0.25170 38.73
 108 1.4244 0.27032 0.25195 38.73
 162 1.4604 0.25641 0.21896 38.73
 216 1.4965 0.24609 0.21010 38.70
 270 1.5325 0.23744 0.20542 38.64
 324 1.5685 0.23467 0.20493 38.61
 378 1.6046 0.22992 0.20542 38.64
 432 1.6406 0.22974 0.20812 38.58
 486 1.6767 0.23054 0.21182 38.58
 540 1.7127 0.23227 0.21428 38.58
 594 1.7487 0.23456 0.21650 38.64
 648 1.7848 0.23702 0.21674 38.58
 702 1.8208 0.23994 0.21477 38.58
 756 1.8568 0.24575 0.21059 38.58
 807 1.8909 0.25509 0.20295 38.61]; 
figure(3);
plot(b(:,2),[b(:,3) b(:,4)],'.-');
legend('Horizontal','Vertical');
ylabel('Tune');
xlabel('Energy');
title('Tune Shift During Slow Energy Ramp Up');


b = [
   1 1.8909 0.26027 0.20517 38.48
  54 1.8555 0.25918 0.22782 38.45
 108 1.8195 0.25797 0.24062 38.45
 162 1.7834 0.26082 0.24530 38.39
 216 1.7474 0.26605 0.24555 38.36
 270 1.7114 0.27216 0.24480 38.36
 324 1.6753 0.27714 0.24038 38.30
 378 1.6393 0.28206 0.23791 38.33
 432 1.6032 0.28354 0.23472 38.24
 486 1.5672 0.28699 0.23348 38.21
 540 1.5312 0.28969 0.17956 38.24
 594 1.4951 0.29290 0.23077 38.12
 648 1.4591 0.29560 0.23496 38.15
 702 1.4231 0.29881 0.23668 38.09
 756 1.3870 0.30521 0.17292 38.09
 807 1.3530 0.30925 0.15274 38.03];
figure(4);
plot(b(:,2),[b(:,3) b(:,4)],'.-');
legend('Horizontal','Vertical');
ylabel('Tune');
xlabel('Energy');
title('Tune Shift During Slow Energy Ramp Down');


b = [
   1 1.3530 0.30891 0.27188 37.63
  54 1.3884 0.30518 0.17202 37.57
 108 1.4244 0.29950 0.25745 37.57
 162 1.4604 0.29548 0.25252 37.54
 216 1.4965 0.29207 0.25203 37.57
 270 1.5325 0.29046 0.25154 37.51
 324 1.5685 0.29036 0.25350 37.48
 378 1.6046 0.28962 0.25547 37.45
 432 1.6406 0.28825 0.25695 37.45
 486 1.6767 0.28583 0.25745 37.48
 540 1.7127 0.28288 0.25572 37.45
 594 1.7487 0.27940 0.25154 37.42
 648 1.7848 0.27180 0.24488 37.48
 702 1.8208 0.26598 0.23480 37.39
 756 1.8568 0.25925 0.22051 37.39
 807 1.8909 0.25424 0.20377 37.39];
figure(5);
plot(b(:,2),[b(:,3) b(:,4)],'.-');
legend('Horizontal','Vertical');
ylabel('Tune');
xlabel('Energy');
title('Tune Shift During Slow Energy Ramp Up');


b = [
   1 1.8909 0.25941 0.20550 37.29
  54 1.8555 0.26209 0.22544 37.29
 108 1.8195 0.26348 0.23529 37.26
 162 1.7834 0.26859 0.23799 37.23
 216 1.7474 0.27672 0.23603 37.26
 270 1.7114 0.28479 0.23381 37.17
 324 1.6753 0.29146 0.22790 37.14
 378 1.6393 0.29515 0.22421 37.11
 432 1.6032 0.29836 0.22100 37.11
 486 1.5672 0.30155 0.22052 37.08
 540 1.5312 0.30328 0.21658 37.02
 594 1.4951 0.30426 0.22027 36.99
 648 1.4591 0.30574 0.22593 36.96
 702 1.4231 0.30688 0.23357 36.96
 756 1.3870 0.31033 0.24710 36.90
 807 1.3530 0.30778 0.26827 36.84];
figure(6);
plot(b(:,2),[b(:,3) b(:,4)],'.-');
legend('Horizontal','Vertical');
ylabel('Tune');
xlabel('Energy');
title('Tune Shift During Slow Energy Ramp Down');

   1 1.3530 0.30292 0.26877 34.88
  54 1.3884 0.30060 0.26286 34.91
 108 1.4244 0.29346 0.22421 34.91
 162 1.4604 0.29190 0.25031 34.85
 216 1.4965 0.28973 0.24957 34.85
 270 1.5325 0.29122 0.24957 34.82
 324 1.5685 0.29243 0.25203 34.79
 378 1.6046 0.29488 0.25277 34.79
 432 1.6406 0.29488 0.25499 34.79
 486 1.6767 0.29489 0.25523 34.79
 540 1.7127 0.29316 0.25424 34.76
 594 1.7487 0.29020 0.25031 34.73
 648 1.7848 0.28627 0.24391 34.76
 702 1.8208 0.28070 0.23406 34.70
 756 1.8568 0.27578 0.22028 34.73
 807 1.8909 0.27184 0.20329 34.73
