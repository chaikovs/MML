% Mode transport

% 19 mai 2006
% (Written by Laurent S. Nadolski : issu de test_transport)
% NON TESTÃ© !!!!!!

global THERING
BPMindex = family2atindex('BPMx');
spos = getspos('BPMx');
X00 = [0 0 0 0  -5e-3 0;...
        0 0 0 0  -5e-3+1e-4 0;...
        0 0 0 0  -5e-3-1e-4 0;...
        0 0 0 0  -5e-3+2e-4 0;...
        0 0 0 0  -5e-3-2e-4 0;...
        0 0 0 0  -5e-3+3e-4 0;...
        0 0 0 0  -5e-3-3e-4 0; ... 
        0 0 0 0  -5e-3+4e-4 0;...
        0 0 0 0  -5e-3-4e-4 0;...
        0 0 0 0  -5e-3+5e-4 0;...
        0 0 0 0  -5e-3-5e-4 0;...
        0 0 0 0  -5e-3+6e-4 0;...
        0 0 0 0  -5e-3-6e-4 0;...
        0 0 0 0  -5e-3+8e-4 0;...
        0 0 0 0  -5e-3-8e-4 0;...
        0 0 0 0  -5e-3+10e-4 0;...
        0 0 0 0  -5e-3-10e-4 0;  ...
]';
%X01 = linepass(THERING, X00(:,end), 1:length(THERING)+1);
X01 = linepass(THERING, X00, 1:length(THERING)+1); % premier tour
Ntours = 2;
for k = 2:Ntours
    X01 = linepass(THERING, X01(:,end), 1:length(THERING)+1);
end
X01(1,BPMindex)*1e3
% 
% for nBPM = 1:length(BPMindex)
%             X = [X mean(Xa((nP*(nBPM-1)+1):nP*nBPM))];
%             
% end

h1 = subplot(5,1,[1 2]);
plot(spos,X01(1,BPMindex)*1e3,'.-');
ylabel('X (mm)')

h2 = subplot(5,1,[4 5]);
plot(spos,X01(3,BPMindex)*1e3,'.-');
ylabel('Z (mm)')

h3 = subplot(5,1,3);
drawlattice
xaxis([1 getcircumference]);

linkaxes([h1 h2 h3],'x')
set([h1 h2 h3],'XGrid','On','YGrid','On');
 