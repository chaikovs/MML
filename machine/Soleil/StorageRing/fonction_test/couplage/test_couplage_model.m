switch2sim
refreshthering
%%%%%%%%%%%%%%%%%%%%%%%
% génération d'une graine de défauts répartis
%%%%%%%%%%%%%%%%%%%%%%%
%%
quadalign(0.0000026,0.0000026); % figure(5) ; hold off ;
%x = getx('Model') ; z = getz('Model') ; figure(5) ; plot(x,'r'),hold on ; plot(z,'b')
%title('orbites X et Z')


quadroll(0.001)
%figure(6)
%modeldisp;
modelemit
%figure(51);plot(s(1,:))

%%
%%%%%%%%%%%%%%%%%%%%%%%%
% génération d'une wave de dispersion verticale crée par rotation 1 mrad du premier dipole
%%%%%%%%%%%%%%%%%%%%%%%%
IndexBEND = family2atindex('BEND')
settilt(IndexBEND(1),0.001)
[Dx Dy] = modeldisp;
IndexBPM = family2atindex('BPMx');
figure(6);plot(getspos('BPMx'),Dy(IndexBPM));
DISP = Dy(IndexBPM);

   DISP = [ 0.0014    0.0010    0.0010    0.0010    0.0013    0.0012    0.0013   -0.0007   -0.0010   -0.0012   -0.0008   -0.0004   -0.0002    0.0001    0.0005    0.0008    0.0005    0.0001...
   -0.0001   -0.0008   -0.0014   -0.0012   -0.0010    0.0013    0.0013    0.0014    0.0011    0.0013    0.0009    0.0008   -0.0011   -0.0011   -0.0014   -0.0012   -0.0015   -0.0013...
   -0.0012    0.0011    0.0013    0.0014    0.0008   -0.0000   -0.0004   -0.0007   -0.0010   -0.0002    0.0001    0.0005    0.0005    0.0008    0.0011    0.0008    0.0005   -0.0013...
   -0.0012   -0.0011   -0.0008   -0.0008   -0.0003   -0.0001    0.0015    0.0014    0.0015    0.0011    0.0014    0.0010    0.0008   -0.0013   -0.0013   -0.0012   -0.0006    0.0004...
    0.0010    0.0011    0.0013   -0.0004   -0.0007   -0.0010   -0.0007   -0.0005   -0.0006   -0.0002    0.0001    0.0010    0.0008    0.0006    0.0003    0.0001   -0.0003   -0.0007...
   -0.0017   -0.0013   -0.0012   -0.0008   -0.0010   -0.0005   -0.0002    0.0012    0.0010    0.0008    0.0003   -0.0007   -0.0014   -0.0013   -0.0013    0.0009    0.0011    0.0013...
    0.0008    0.0002   -0.0001   -0.0004   -0.0007   -0.0006   -0.0002    0.0001    0.0002    0.0006    0.0009    0.0013];
%%
couleur = 'r';
IndexBEND = family2atindex('BEND')
for i = 1:2:32
    settilt(IndexBEND(i),0.005)
end
for j = 2:2:32
    settilt(IndexBEND(j),-0.005)
end
[Dx Dy] = modeldisp;
IndexBPM = family2atindex('BPMx');
figure(6);plot(getspos('BPMx'),Dy(IndexBPM),couleur);
Dy_Meas = Dy(IndexBPM);
Dy_Meas = ...
 [ 0.0078    0.0083    0.0123    0.0123    0.0173    0.0155    0.0142   -0.0138   -0.0157   -0.0156   -0.0073    0.0071    0.0159    0.0152...
  0.0138   -0.0138   -0.0156   -0.0154   -0.0071    0.0073    0.0162    0.0153    0.0138   -0.0142   -0.0159   -0.0168   -0.0122   -0.0125...
  -0.0081   -0.0078    0.0078    0.0083    0.0123    0.0123    0.0173    0.0155    0.0142   -0.0138   -0.0157   -0.0156   -0.0073    0.0071...
  0.0159    0.0152    0.0138   -0.0138   -0.0156   -0.0154   -0.0071    0.0073    0.0162    0.0153    0.0138   -0.0142   -0.0159   -0.0169...
 -0.0122   -0.0125   -0.0081   -0.0078    0.0078    0.0083    0.0123    0.0123    0.0173    0.0155    0.0142   -0.0138   -0.0157   -0.0157...
  -0.0073    0.0071    0.0159    0.0152    0.0138   -0.0138   -0.0156   -0.0154   -0.0071    0.0073    0.0162    0.0153    0.0138   -0.0142...
 -0.0159   -0.0169   -0.0122   -0.0125   -0.0081   -0.0078    0.0078    0.0083    0.0123    0.0123    0.0173    0.0155    0.0142   -0.0138...
   -0.0157   -0.0156   -0.0073    0.0071    0.0159    0.0152    0.0138   -0.0138   -0.0156   -0.0154   -0.0071    0.0073    0.0162    0.0153...
 0.0138   -0.0142   -0.0159   -0.0168   -0.0122   -0.0125   -0.0081   -0.0078 ]';

%% graine 9 correction de Dz uniquement
Deltaskew0 = [  0.1544    0.4210    0.0919    0.0896   -0.0250   -0.0965   -0.4197   -0.1662   -0.2983   -0.5648   -0.1086   -0.2312   -0.1991    0.2066    1.4955    0.8674    0.6759    1.3134...
    0.2694   -0.2005   -0.2048   -0.0687   -0.6668   -0.4818    0.1703   -0.0183   -0.1064   -0.0955    0.0685    0.0548    0.5913    0.3136
