<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of locogui</title>
  <meta name="keywords" content="locogui">
  <meta name="description" content="LOCOGUI - Graphical interface for running the LOCO algorithm">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">applications</a> &gt; <a href="index.html">loco</a> &gt; locogui.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for applications/loco&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>locogui
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>LOCOGUI - Graphical interface for running the LOCO algorithm</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = locogui(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">LOCOGUI - Graphical interface for running the LOCO algorithm

  There are a number of inputs when running LOCO.

  I. File menu
  A.  Open -&gt; open a loco data file. The input file can be a .mat file or a .m script.
  B.  Save as -&gt; save file to a different name.
  C.  Save as (one iteration) -&gt; saves only one iteration.
  D.  Print,
  E.  Pop Plot #1 -&gt; copies plot #1 in locogui to a Matlab figure so that it can
                 be modified in any way the user wants.  Locogui has the axes
                 handles hiddlen.  If a user wants to change this issue,
                 set(0,'ShowHiddenHandles','on') (at your own risk).
  E.  Pop Plot #2 -&gt; copies plot #2 in locogui to a Matlab figure.
  F.  Diary -&gt; Starts/Ends a diary file.

  All the information for each iteration is saved in the data file.  Anytime a selection
  is made from the &quot;Start From&quot; popup menu, all the items in the input menu are restored.
  This includes the BPM and CM lists.  One potential awkwardness in this application is
  respect to viewing the BPM and CM lists.  If one edits a BPM or CM list, then the displayed
  list is relative to the &quot;Start From&quot; popup menu and not the &quot;Plot Iteration&quot; popup menu.

  II. Input menu
  A.  Auto-Correct deltas
  LocoFlags.AutoCorrectDelta = 'Yes' or 'No'

  Automatically adjust the delta used to compute the response matrix gradient.
  If AutoCorrectDeltaFlag = 'Yes', then the parameter deltas are adjusted to
  keep the RMS change in the response matrix change equal to 1 micron.
  If the RMS is within a factor of ten, then the delta is corrected but
  the response matrix is not recomputed.  Note: if FitParameters.Deltas = NaN
  and Autocorrect is off, then Fdelta will still be autocorrected once.

  B. Options for selecting the number of singular values
  LocoFlags.SVmethod = 'Rank,' [], threshold, or an index vector

  If SVmethod is a scalar, then all singular values will be greater than Smax * SVmethod.
  If SVmethod is empty, then singular values will be choosen manually (graphically).
  If SVmethod is a vector, then that vector corresponds to the index of singular values.
  If SVmethod is 'Rank', then singular values are removed if a Matlab warning for rank tolerance is exceeded.

  C. Include dispersion as a column of the response matrix
  LocoFlags.Dispersion = 'Yes' or 'No'

  D. Use the fully coupled response matrix
  LocoFlags.Coupling = 'Yes' or 'No'

  E. Normalize the parameter fit response matrix to the same RMS as the model response matrix
  LocoFlags.Normalize = 'Yes' or 'No'
  Note: if the RF frequency is fit, it is always normalized.

  F. Use linear response matrix calculator
  LocoFlags.ResponseMatrixCalculator = 'Linear'

  G. Outlier rejection
  LocoFlags.OutlierFactor = number of sigma

  H.  Output U,S,V, and A matrices to a file
  LocoFlags.SVDDataFileName = Directory\FileName or [] (ignored if empty)

  NOTE
  1. When saving A, S, V, U the outliers have been removed, however,
     the saved response matrix (measured and model) do not.

  See LocoManual.doc, James SaFranek (the LOCO creator), Andrei Terebilo, or Greg Portmann for more information.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="loco.html" class="code" title="function [LocoModel, BPMData, CMData, FitParameters, LocoFlags, RINGData] = loco(LocoMeasData, BPMData, CMData, FitParameters, LocoFlags, RINGData)">loco</a>	LOCO - Main routine for the LOCO algorithm</li><li><a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>	LOCODATA - Extracts data from a LOCO file</li><li><a href="locoeditlist.html" class="code" title="function newList = locoeditlist(List, ListName, CheckList)">locoeditlist</a>	LOCOEDITLIST - Device list editor</li><li><a href="locofilecheck.html" class="code" title="function [BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData] = locofilecheck(FileName)">locofilecheck</a>	LOCOFILECHECK - Consistence check for the LOCO input file</li><li><a href="locomcf.html" class="code" title="function Alpha = locomcf(RINGData)">locomcf</a>	LOCOMCF - Returns the momentum compaction factor</li><li><a href="locoplot.html" class="code" title="function ElementsInput = locoplot(FileName, IterationNumber, PlotString, PlaneString, ElementsInput)">locoplot</a>	LOCOPLOT - Subroutines for plotting LOCO output</li><li><a href="locoplotrms.html" class="code" title="function locoplotrms(FileName, IterationNumber, PlotType)">locoplotrms</a>	LOCOPLOTRMS - Plots the RMS of the LOCO fits</li><li><a href="locoresponsematrix.html" class="code" title="function RM = locoresponsematrix(RINGData, BPMData, CMData, varargin)">locoresponsematrix</a>	LOCORESPONSEMATRIX - Calculate the BPM response matrix and dispersion function</li><li><a href="locosetlatticeparam.html" class="code" title="function RINGData = locosetlatticeparam(RINGData, LocoParams, LocoValues)">locosetlatticeparam</a>	LOCOSETLATTICEPARAM - Set the AT lattice from the LOCO fit parameters</li><li><a href="plotlocochi2.html" class="code" title="function [dchi2quad, chi2_par, chi2_bpm, chi2_cm, chi2_min, chi2_0] = plotlocochi2(varargin)">plotlocochi2</a>	PLOTLOCOCHI2 - Calculate the contribution to chi2 of each fit parameter in LOCO</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function local_CreateFcn(hObject, eventdata, createfcn, appdata)</a></li><li><a href="#_sub2" class="code">function varargout = Start_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub3" class="code">function varargout = PlotIteration_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub4" class="code">function varargout = OpenFile_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub5" class="code">function varargout = SVDDataSave_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub6" class="code">function varargout = Diary_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub7" class="code">function varargout = NewMeasRespMat_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub8" class="code">function varargout = SaveAs_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub9" class="code">function varargout = MenuUserInput_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub10" class="code">function varargout = MenuThreshold_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub11" class="code">function varargout = Outlier_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub12" class="code">function varargout = HorizontalDispersion_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub13" class="code">function varargout = VerticalDispersion_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub14" class="code">function varargout = HBPMIndex_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub15" class="code">function varargout = VBPMIndex_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub16" class="code">function varargout = HCMIndex_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub17" class="code">function varargout = VCMIndex_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub18" class="code">function varargout = StartFrom_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub19" class="code">function setmenuinputs(BPMData, CMData, LocoFlags, FitParameters)</a></li><li><a href="#_sub20" class="code">function varargout = MenuAxes_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub21" class="code">function locoplots(PlotNumber, FieldName)</a></li><li><a href="#_sub22" class="code">function varargout = ContextMenuPlot_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub23" class="code">function varargout = ContextMenuSurfPlot_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub24" class="code">function [Mmodel, Dispersion, ChiSquare] = getmodelresponsematrix(BPMData, CMData, FitParameters, LocoFlags, LocoMeasData, RINGData)</a></li><li><a href="#_sub25" class="code">function varargout = uimenu_plotK_Callback(h, eventdata, handles, varargin)</a></li><li><a href="#_sub26" class="code">function varargout = uimenu_exportK_Callback(h, eventdata, handles, varargin)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = locogui(varargin)</a>
0002 <span class="comment">%LOCOGUI - Graphical interface for running the LOCO algorithm</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  There are a number of inputs when running LOCO.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%  I. File menu</span>
0007 <span class="comment">%  A.  Open -&gt; open a loco data file. The input file can be a .mat file or a .m script.</span>
0008 <span class="comment">%  B.  Save as -&gt; save file to a different name.</span>
0009 <span class="comment">%  C.  Save as (one iteration) -&gt; saves only one iteration.</span>
0010 <span class="comment">%  D.  Print,</span>
0011 <span class="comment">%  E.  Pop Plot #1 -&gt; copies plot #1 in locogui to a Matlab figure so that it can</span>
0012 <span class="comment">%                 be modified in any way the user wants.  Locogui has the axes</span>
0013 <span class="comment">%                 handles hiddlen.  If a user wants to change this issue,</span>
0014 <span class="comment">%                 set(0,'ShowHiddenHandles','on') (at your own risk).</span>
0015 <span class="comment">%  E.  Pop Plot #2 -&gt; copies plot #2 in locogui to a Matlab figure.</span>
0016 <span class="comment">%  F.  Diary -&gt; Starts/Ends a diary file.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%  All the information for each iteration is saved in the data file.  Anytime a selection</span>
0019 <span class="comment">%  is made from the &quot;Start From&quot; popup menu, all the items in the input menu are restored.</span>
0020 <span class="comment">%  This includes the BPM and CM lists.  One potential awkwardness in this application is</span>
0021 <span class="comment">%  respect to viewing the BPM and CM lists.  If one edits a BPM or CM list, then the displayed</span>
0022 <span class="comment">%  list is relative to the &quot;Start From&quot; popup menu and not the &quot;Plot Iteration&quot; popup menu.</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%  II. Input menu</span>
0025 <span class="comment">%  A.  Auto-Correct deltas</span>
0026 <span class="comment">%  LocoFlags.AutoCorrectDelta = 'Yes' or 'No'</span>
0027 <span class="comment">%</span>
0028 <span class="comment">%  Automatically adjust the delta used to compute the response matrix gradient.</span>
0029 <span class="comment">%  If AutoCorrectDeltaFlag = 'Yes', then the parameter deltas are adjusted to</span>
0030 <span class="comment">%  keep the RMS change in the response matrix change equal to 1 micron.</span>
0031 <span class="comment">%  If the RMS is within a factor of ten, then the delta is corrected but</span>
0032 <span class="comment">%  the response matrix is not recomputed.  Note: if FitParameters.Deltas = NaN</span>
0033 <span class="comment">%  and Autocorrect is off, then Fdelta will still be autocorrected once.</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%  B. Options for selecting the number of singular values</span>
0036 <span class="comment">%  LocoFlags.SVmethod = 'Rank,' [], threshold, or an index vector</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%  If SVmethod is a scalar, then all singular values will be greater than Smax * SVmethod.</span>
0039 <span class="comment">%  If SVmethod is empty, then singular values will be choosen manually (graphically).</span>
0040 <span class="comment">%  If SVmethod is a vector, then that vector corresponds to the index of singular values.</span>
0041 <span class="comment">%  If SVmethod is 'Rank', then singular values are removed if a Matlab warning for rank tolerance is exceeded.</span>
0042 <span class="comment">%</span>
0043 <span class="comment">%  C. Include dispersion as a column of the response matrix</span>
0044 <span class="comment">%  LocoFlags.Dispersion = 'Yes' or 'No'</span>
0045 <span class="comment">%</span>
0046 <span class="comment">%  D. Use the fully coupled response matrix</span>
0047 <span class="comment">%  LocoFlags.Coupling = 'Yes' or 'No'</span>
0048 <span class="comment">%</span>
0049 <span class="comment">%  E. Normalize the parameter fit response matrix to the same RMS as the model response matrix</span>
0050 <span class="comment">%  LocoFlags.Normalize = 'Yes' or 'No'</span>
0051 <span class="comment">%  Note: if the RF frequency is fit, it is always normalized.</span>
0052 <span class="comment">%</span>
0053 <span class="comment">%  F. Use linear response matrix calculator</span>
0054 <span class="comment">%  LocoFlags.ResponseMatrixCalculator = 'Linear'</span>
0055 <span class="comment">%</span>
0056 <span class="comment">%  G. Outlier rejection</span>
0057 <span class="comment">%  LocoFlags.OutlierFactor = number of sigma</span>
0058 <span class="comment">%</span>
0059 <span class="comment">%  H.  Output U,S,V, and A matrices to a file</span>
0060 <span class="comment">%  LocoFlags.SVDDataFileName = Directory\FileName or [] (ignored if empty)</span>
0061 <span class="comment">%</span>
0062 <span class="comment">%  NOTE</span>
0063 <span class="comment">%  1. When saving A, S, V, U the outliers have been removed, however,</span>
0064 <span class="comment">%     the saved response matrix (measured and model) do not.</span>
0065 <span class="comment">%</span>
0066 <span class="comment">%  See LocoManual.doc, James SaFranek (the LOCO creator), Andrei Terebilo, or Greg Portmann for more information.</span>
0067 
0068 <span class="comment">%</span>
0069 <span class="comment">%  Writen by Gregory J. Portmann</span>
0070 <span class="comment">%  Modification Laurent S. Nadolski</span>
0071 <span class="comment">%    addons menu added (still machine specific)</span>
0072 
0073 <span class="comment">% LOCOGUI Application M-file for locogui.fig</span>
0074 <span class="comment">%    FIG = LOCOGUI launch locogui GUI.</span>
0075 <span class="comment">%    LOCOGUI('callback_name', ...) invoke the named callback.</span>
0076 
0077 <span class="comment">% Last Modified by GUIDE v2.0 21-Nov-2001 16:26:19</span>
0078 
0079 <span class="keyword">if</span> nargin == 0  <span class="comment">% LAUNCH GUI</span>
0080 
0081     fig = openfig(mfilename,<span class="string">'new'</span>);  <span class="comment">% 'reuse'</span>
0082 
0083     <span class="comment">% Use system color scheme for figure (this seems to create platform dependent problems)</span>
0084     <span class="comment">%set(fig,'Color',get(0,'defaultUicontrolBackgroundColor'));</span>
0085 
0086     <span class="comment">% Generate a structure of handles to pass to callbacks, and store it.</span>
0087     handles = guihandles(fig);
0088     guidata(fig, handles);
0089 
0090     <span class="keyword">if</span> nargout &gt; 0
0091         varargout{1} = fig;
0092     <span class="keyword">end</span>
0093 
0094 
0095     <span class="comment">% Change menu locations</span>
0096     <span class="comment">% set(findobj(fig,'tag','FileName'),'Position',1);</span>
0097     <span class="comment">% set(findobj(fig,'tag','FileName'),'Separator','Off');</span>
0098     <span class="comment">% set(findobj(fig,'tag','FileName'),'Interruptible','Off');</span>
0099     <span class="comment">% set(findobj(fig,'tag','Flags'),'Position',2);</span>
0100     <span class="comment">% set(findobj(fig,'tag','Flags'),'Separator','On');</span>
0101     <span class="comment">% set(findobj(fig,'tag','Flags'),'Interruptible','Off');</span>
0102     <span class="comment">% set(findobj(fig,'tag','Help'),'Interruptible','Off');</span>
0103 
0104     <span class="comment">% set(findobj(gcf,'tag','linear'),'enable','off')</span>
0105     h1 = fig;
0106     
0107     appdata = [];
0108     appdata.lastValidTag = <span class="string">'Untitled_1'</span>;
0109 
0110     h148 = uimenu(<span class="keyword">...</span>
0111         <span class="string">'Parent'</span>,h1,<span class="keyword">...</span>
0112         <span class="string">'Callback'</span>,<span class="string">'%automatic'</span>,<span class="keyword">...</span>
0113         <span class="string">'Label'</span>,<span class="string">'Addons'</span>,<span class="keyword">...</span>
0114         <span class="string">'Tag'</span>,<span class="string">'Untitled_1'</span>,<span class="keyword">...</span>
0115         <span class="string">'CreateFcn'</span>, {@<a href="#_sub1" class="code" title="subfunction local_CreateFcn(hObject, eventdata, createfcn, appdata)">local_CreateFcn</a>, blanks(0), appdata} );
0116 
0117     appdata = [];
0118     appdata.lastValidTag = <span class="string">'uimenu_plotK'</span>;
0119 
0120     h149 = uimenu(<span class="keyword">...</span>
0121         <span class="string">'Parent'</span>,h148,<span class="keyword">...</span>
0122         <span class="string">'Callback'</span>,<span class="string">'locogui(''uimenu_plotK_Callback'',gcbo,[],guidata(gcbo))'</span>,<span class="keyword">...</span>
0123         <span class="string">'Label'</span>,<span class="string">'Plot DK/K'</span>,<span class="keyword">...</span>
0124         <span class="string">'Tag'</span>,<span class="string">'uimenu_plotK'</span>,<span class="keyword">...</span>
0125         <span class="string">'CreateFcn'</span>, {@<a href="#_sub1" class="code" title="subfunction local_CreateFcn(hObject, eventdata, createfcn, appdata)">local_CreateFcn</a>, blanks(0), appdata} );
0126 
0127     appdata = [];
0128     appdata.lastValidTag = <span class="string">'uimenu_exporK'</span>;
0129 
0130     h150 = uimenu(<span class="keyword">...</span>
0131         <span class="string">'Parent'</span>,h148,<span class="keyword">...</span>
0132         <span class="string">'Callback'</span>,<span class="string">'locogui(''uimenu_exportK_Callback'',gcbo,[],guidata(gcbo))'</span>,<span class="keyword">...</span>
0133         <span class="string">'Label'</span>,<span class="string">'Export DK/K'</span>,<span class="keyword">...</span>
0134         <span class="string">'Tag'</span>,<span class="string">'uimenu_exporK'</span>,<span class="keyword">...</span>
0135         <span class="string">'CreateFcn'</span>, {@<a href="#_sub1" class="code" title="subfunction local_CreateFcn(hObject, eventdata, createfcn, appdata)">local_CreateFcn</a>, blanks(0), appdata} );
0136 
0137 
0138 
0139 <span class="keyword">elseif</span> ischar(varargin{1}) <span class="comment">% INVOKE NAMED SUBFUNCTION OR CALLBACK</span>
0140 
0141     <span class="keyword">try</span>
0142         [varargout{1:nargout}] = feval(varargin{:}); <span class="comment">% FEVAL switchyard</span>
0143     <span class="keyword">catch</span>
0144         disp(lasterr);
0145     <span class="keyword">end</span>
0146 
0147 <span class="keyword">end</span>
0148 
0149 <span class="comment">% --- Set application data first then calling the CreateFcn.</span>
0150 <a name="_sub1" href="#_subfunctions" class="code">function local_CreateFcn(hObject, eventdata, createfcn, appdata)</a>
0151 
0152 <span class="keyword">if</span> ~isempty(appdata)
0153    names = fieldnames(appdata);
0154    <span class="keyword">for</span> i=1:length(names)
0155        name = char(names(i));
0156        setappdata(hObject, name, getfield(appdata,name));
0157    <span class="keyword">end</span>
0158 <span class="keyword">end</span>
0159 
0160 <span class="comment">%| ABOUT CALLBACKS:</span>
0161 <span class="comment">%| GUIDE automatically appends subfunction prototypes to this file, and</span>
0162 <span class="comment">%| sets objects' callback properties to call them through the FEVAL</span>
0163 <span class="comment">%| switchyard above. This comment describes that mechanism.</span>
0164 <span class="comment">%|</span>
0165 <span class="comment">%| Each callback subfunction declaration has the following form:</span>
0166 <span class="comment">%| &lt;SUBFUNCTION_NAME&gt;(H, EVENTDATA, HANDLES, VARARGIN)</span>
0167 <span class="comment">%|</span>
0168 <span class="comment">%| The subfunction name is composed using the object's Tag and the</span>
0169 <span class="comment">%| callback type separated by '_', e.g. 'slider2_Callback',</span>
0170 <span class="comment">%| 'figure1_CloseRequestFcn', 'axis1_ButtondownFcn'.</span>
0171 <span class="comment">%|</span>
0172 <span class="comment">%| H is the callback object's handle (obtained using GCBO).</span>
0173 <span class="comment">%|</span>
0174 <span class="comment">%| EVENTDATA is empty, but reserved for future use.</span>
0175 <span class="comment">%|</span>
0176 <span class="comment">%| HANDLES is a structure containing handles of components in GUI using</span>
0177 <span class="comment">%| tags as fieldnames, e.g. handles.figure1, handles.slider2. This</span>
0178 <span class="comment">%| structure is created at GUI startup using GUIHANDLES and stored in</span>
0179 <span class="comment">%| the figure's application data using GUIDATA. A copy of the structure</span>
0180 <span class="comment">%| is passed to each callback.  You can store additional information in</span>
0181 <span class="comment">%| this structure at GUI startup, and you can change the structure</span>
0182 <span class="comment">%| during callbacks.  Call guidata(h, handles) after changing your</span>
0183 <span class="comment">%| copy to replace the stored original so that subsequent callbacks see</span>
0184 <span class="comment">%| the updates. Type &quot;help guihandles&quot; and &quot;help guidata&quot; for more</span>
0185 <span class="comment">%| information.</span>
0186 <span class="comment">%|</span>
0187 <span class="comment">%| VARARGIN contains any extra arguments you have passed to the</span>
0188 <span class="comment">%| callback. Specify the extra arguments by editing the callback</span>
0189 <span class="comment">%| property in the inspector. By default, GUIDE sets the property to:</span>
0190 <span class="comment">%| &lt;MFILENAME&gt;('&lt;SUBFUNCTION_NAME&gt;', gcbo, [], guidata(gcbo))</span>
0191 <span class="comment">%| Add any extra arguments after the last argument, before the final</span>
0192 <span class="comment">%| closing parenthesis.</span>
0193 
0194 
0195 <span class="comment">% --------------------------------------------------------------------</span>
0196 <a name="_sub2" href="#_subfunctions" class="code">function varargout = Start_Callback(h, eventdata, handles, varargin)</a>
0197 
0198 <span class="comment">% Get filename and try to load</span>
0199 FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
0200 <span class="keyword">try</span>
0201     load(FileName);
0202     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);     <span class="comment">% Just in case FileName happens to be saved in the .mat file</span>
0203 <span class="keyword">catch</span>
0204     fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
0205     axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes1'</span>));
0206     set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
0207     axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes2'</span>));
0208     set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
0209     <span class="keyword">return</span>
0210 <span class="keyword">end</span>
0211 
0212 
0213 StartFrom = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>)-1;
0214 Iterations = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Iterations'</span>),<span class="string">'Value'</span>);
0215 
0216 
0217 <span class="comment">% Clear old iterations if they exist</span>
0218 <span class="keyword">if</span> StartFrom+2 &lt;= length(FitParameters)
0219     fprintf(<span class="string">'   Note:  You are writing over previous iterations.\n'</span>);
0220     LocoFlags(StartFrom+2:end) = [];
0221     BPMData(StartFrom+2:end) = [];
0222     CMData(StartFrom+2:end) = [];
0223     FitParameters(StartFrom+2:end) = [];
0224     LocoModel(:,StartFrom+2:end) = [];
0225 <span class="keyword">end</span>
0226 
0227 
0228 <span class="keyword">for</span> i = StartFrom+2:StartFrom+2+Iterations-1
0229     fprintf(<span class="string">'   Iteration #%d\n'</span>, i-1);
0230 
0231     <span class="comment">% Start with the old values</span>
0232     BPMData(i) = BPMData(i-1);
0233     CMData(i) = CMData(i-1);
0234     FitParameters(i) = FitParameters(i-1);
0235 
0236     <span class="comment">% Check for a new (user input) BPM and CM good data lists</span>
0237     <span class="keyword">if</span> ~isempty(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HBPMIndex'</span>), <span class="string">'Userdata'</span>))
0238         <span class="comment">%fprintf('   Horizontal BPM list changed based on user input.\n');</span>
0239         BPMData(i).HBPMGoodDataIndex = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HBPMIndex'</span>), <span class="string">'Userdata'</span>);
0240     <span class="keyword">end</span>
0241     <span class="keyword">if</span> ~isempty(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VBPMIndex'</span>), <span class="string">'Userdata'</span>))
0242         <span class="comment">%fprintf('   Vertical BPM list changed based on user input.\n');</span>
0243         BPMData(i).VBPMGoodDataIndex = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VBPMIndex'</span>), <span class="string">'Userdata'</span>);
0244     <span class="keyword">end</span>
0245     <span class="keyword">if</span> ~isempty(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HCMIndex'</span>), <span class="string">'Userdata'</span>))
0246         <span class="comment">%fprintf('   Horizontal corrector magnet list changed based on user input.\n');</span>
0247         CMData(i).HCMGoodDataIndex = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HCMIndex'</span>), <span class="string">'Userdata'</span>);
0248     <span class="keyword">end</span>
0249     <span class="keyword">if</span> ~isempty(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VCMIndex'</span>), <span class="string">'Userdata'</span>))
0250         <span class="comment">%fprintf('   Vertical corrector magnet list changed based on user input.\n');</span>
0251         CMData(i).VCMGoodDataIndex = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VCMIndex'</span>), <span class="string">'Userdata'</span>);
0252     <span class="keyword">end</span>
0253 
0254 
0255     <span class="comment">% Get flags</span>
0256     <span class="keyword">if</span> strcmpi((get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Rank'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0257         <span class="comment">% Rank method</span>
0258         LocoFlags(i).SVmethod = <span class="string">'Rank'</span>;
0259     <span class="keyword">elseif</span> strcmpi((get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0260         <span class="comment">% Threshold method</span>
0261         LocoFlags(i).SVmethod = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Userdata'</span>);
0262     <span class="keyword">elseif</span> strcmpi((get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Interactive'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0263         <span class="comment">% Interactive method</span>
0264         LocoFlags(i).SVmethod = [];
0265     <span class="keyword">elseif</span> strcmpi((get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'UserInput'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0266         <span class="comment">% User Input method</span>
0267         LocoFlags(i).SVmethod = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'UserInput'</span>),<span class="string">'Userdata'</span>);
0268     <span class="keyword">else</span>
0269         <span class="comment">% Threshold method</span>
0270         LocoFlags(i).SVmethod = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Userdata'</span>);
0271     <span class="keyword">end</span>
0272 
0273     LocoFlags(i).Threshold = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Userdata'</span>);
0274     LocoFlags(i).OutlierFactor = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Outlier'</span>),<span class="string">'Userdata'</span>);
0275     LocoFlags(i).HorizontalDispersionWeight = getappdata(gcbf,<span class="string">'HorizontalDispersionWeight'</span>);
0276     LocoFlags(i).VerticalDispersionWeight = getappdata(gcbf,<span class="string">'VerticalDispersionWeight'</span>);
0277 
0278     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'AutoCorrect'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0279         LocoFlags(i).AutoCorrectDelta = <span class="string">'Yes'</span>;
0280     <span class="keyword">else</span>
0281         LocoFlags(i).AutoCorrectDelta = <span class="string">'No'</span>;
0282     <span class="keyword">end</span>
0283 
0284     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'Coupling'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0285         LocoFlags(i).Coupling = <span class="string">'Yes'</span>;
0286     <span class="keyword">else</span>
0287         LocoFlags(i).Coupling = <span class="string">'No'</span>;
0288     <span class="keyword">end</span>
0289 
0290     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'Normalize'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0291         LocoFlags(i).Normalize = <span class="string">'Yes'</span>;
0292     <span class="keyword">else</span>
0293         LocoFlags(i).Normalize = <span class="string">'No'</span>;
0294     <span class="keyword">end</span>
0295 
0296     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'Dispersion'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0297         LocoFlags(i).Dispersion = <span class="string">'Yes'</span>;
0298     <span class="keyword">else</span>
0299         LocoFlags(i).Dispersion = <span class="string">'No'</span>;
0300     <span class="keyword">end</span>
0301 
0302     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'FitHCMEnergyShift'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0303         CMData(i).FitHCMEnergyShift = <span class="string">'Yes'</span>;
0304     <span class="keyword">else</span>
0305         CMData(i).FitHCMEnergyShift = <span class="string">'No'</span>;
0306     <span class="keyword">end</span>
0307 
0308     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'FitVCMEnergyShift'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0309         CMData(i).FitVCMEnergyShift = <span class="string">'Yes'</span>;
0310     <span class="keyword">else</span>
0311         CMData(i).FitVCMEnergyShift = <span class="string">'No'</span>;
0312     <span class="keyword">end</span>
0313 
0314     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'Linear'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0315         LocoFlags(i).ResponseMatrixCalculator = <span class="string">'Linear'</span>;
0316     <span class="keyword">else</span> <span class="comment">%strcmpi((get(findobj(gcf,'Tag','Full'),'Checked')),'on')</span>
0317         LocoFlags(i).ResponseMatrixCalculator = <span class="string">'Full'</span>;
0318     <span class="keyword">end</span>
0319 
0320     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'CM'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0321         LocoFlags(i).ClosedOrbitType = <span class="string">'FixedMomentum'</span>;
0322     <span class="keyword">else</span> <span class="comment">%strcmpi((get(findobj(gcf,'Tag','CPL'),'Checked')),'on')</span>
0323         LocoFlags(i).ClosedOrbitType = <span class="string">'FixedPathLength'</span>;
0324     <span class="keyword">end</span>
0325 
0326     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'RespMatBiDirectional'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0327         LocoFlags(i).ResponseMatrixMeasurement = <span class="string">'BiDirectional'</span>;
0328     <span class="keyword">else</span> <span class="comment">%strcmpi((get(findobj(gcf,'Tag','RespMatOneWay'),'Checked')),'on')</span>
0329         LocoFlags(i).ResponseMatrixMeasurement = <span class="string">'OneWay'</span>;
0330     <span class="keyword">end</span>
0331 
0332     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'DispBiDirectional'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0333         LocoFlags(i).DispersionMeasurement = <span class="string">'BiDirectional'</span>;
0334     <span class="keyword">else</span> <span class="comment">%strcmpi((get(findobj(gcf,'Tag','DispOneWay'),'Checked')),'on')</span>
0335         LocoFlags(i).DispersionMeasurement = <span class="string">'OneWay'</span>;
0336     <span class="keyword">end</span>
0337 
0338     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'ErrorBars'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0339         LocoFlags(i).CalculateSigma = <span class="string">'Yes'</span>;
0340     <span class="keyword">else</span>
0341         LocoFlags(i).CalculateSigma = <span class="string">'No'</span>;
0342     <span class="keyword">end</span>
0343 
0344     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'SinglePrecision'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0345         LocoFlags(i).SinglePrecision = <span class="string">'Yes'</span>;
0346     <span class="keyword">else</span>
0347         LocoFlags(i).SinglePrecision = <span class="string">'No'</span>;
0348     <span class="keyword">end</span>
0349 
0350     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0351         LocoFlags(i).SVDDataFileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Userdata'</span>);
0352     <span class="keyword">else</span>
0353         LocoFlags(i).SVDDataFileName = <span class="string">''</span>;
0354     <span class="keyword">end</span>
0355 
0356     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'FitRF'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0357         FitParameters(i).FitRFFrequency = <span class="string">'Yes'</span>;
0358     <span class="keyword">else</span>
0359         FitParameters(i).FitRFFrequency = <span class="string">'No'</span>;
0360     <span class="keyword">end</span>
0361 
0362     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'BPMGains'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0363         BPMData(i).FitGains = <span class="string">'Yes'</span>;
0364     <span class="keyword">else</span>
0365         BPMData(i).FitGains = <span class="string">'No'</span>;
0366     <span class="keyword">end</span>
0367 
0368     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'BPMCoupling'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0369         BPMData(i).FitCoupling = <span class="string">'Yes'</span>;
0370     <span class="keyword">else</span>
0371         BPMData(i).FitCoupling = <span class="string">'No'</span>;
0372     <span class="keyword">end</span>
0373 
0374     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'CMKicks'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0375         CMData(i).FitKicks = <span class="string">'Yes'</span>;
0376     <span class="keyword">else</span>
0377         CMData(i).FitKicks = <span class="string">'No'</span>;
0378     <span class="keyword">end</span>
0379 
0380     <span class="keyword">if</span> strcmpi((get(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'CMRolls'</span>),<span class="string">'Checked'</span>)),<span class="string">'on'</span>)
0381         CMData(i).FitCoupling = <span class="string">'Yes'</span>;
0382     <span class="keyword">else</span>
0383         CMData(i).FitCoupling = <span class="string">'No'</span>;
0384     <span class="keyword">end</span>
0385 
0386     <span class="comment">% Run loco</span>
0387     [LocoModel(i), BPMData(i), CMData(i), FitParameters(i), LocoFlags(i), RINGData] = <a href="loco.html" class="code" title="function [LocoModel, BPMData, CMData, FitParameters, LocoFlags, RINGData] = loco(LocoMeasData, BPMData, CMData, FitParameters, LocoFlags, RINGData)">loco</a>(LocoMeasData, BPMData(i), CMData(i), FitParameters(i), LocoFlags(i), RINGData);
0388 
0389     save(FileName, <span class="string">'LocoModel'</span>, <span class="string">'FitParameters'</span>, <span class="string">'BPMData'</span>, <span class="string">'CMData'</span>, <span class="string">'RINGData'</span>, <span class="string">'LocoMeasData'</span>, <span class="string">'LocoFlags'</span>);
0390     setappdata(gcbf, <span class="string">'LocoDataCell'</span>, {BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
0391 
0392     <span class="comment">% Plot</span>
0393     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'String'</span>,num2str((0:i-1)'));
0394     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'Value'</span>, i);
0395     <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu1'</span>));
0396     <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu2'</span>));
0397 
0398     drawnow;
0399 <span class="keyword">end</span>
0400 
0401 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'String'</span>,num2str([0:i-1]'));
0402 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>,i);
0403 
0404 <span class="comment">% Update menu items in case something was changed in loco</span>
0405 <a href="#_sub19" class="code" title="subfunction setmenuinputs(BPMData, CMData, LocoFlags, FitParameters)">setmenuinputs</a>(BPMData(end), CMData(end), LocoFlags(end), FitParameters(end));
0406 
0407 
0408 <span class="comment">% --------------------------------------------------------------------</span>
0409 <a name="_sub3" href="#_subfunctions" class="code">function varargout = PlotIteration_Callback(h, eventdata, handles, varargin)</a>
0410 <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu1'</span>));
0411 <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu2'</span>));
0412 
0413 
0414 <span class="comment">% --------------------------------------------------------------------</span>
0415 <a name="_sub4" href="#_subfunctions" class="code">function varargout = OpenFile_Callback(h, eventdata, handles, varargin)</a>
0416 
0417 <span class="comment">% Get filename and try to load</span>
0418 <span class="comment">%FileName = deblank(get(h,'String'));</span>
0419 [FileName, PathName] = uigetfile({<span class="string">'*.*'</span>}, <span class="string">'Choose the desired loco data file'</span>);
0420 <span class="keyword">if</span> isequal(FileName,0) || isequal(PathName,0)
0421     <span class="keyword">return</span>
0422 <span class="keyword">end</span>
0423 
0424 set(gcbf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
0425 
0426 axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes1'</span>));
0427 cla
0428 set(gca, <span class="string">'UIContextMenu'</span>, []);   <span class="comment">% Clear content menu</span>
0429 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
0430 axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes2'</span>));
0431 cla
0432 set(gca, <span class="string">'UIContextMenu'</span>, []);  <span class="comment">% Clear content menu</span>
0433 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
0434 
0435 <span class="keyword">try</span>
0436     idot = find(FileName==<span class="string">'.'</span>);
0437 
0438     <span class="comment">% If the variable exist as a matlab script file, just read it</span>
0439     <span class="keyword">if</span> strcmp(FileName(idot:end),<span class="string">'.m'</span>)
0440         <span class="comment">% Convert .m file to a .mat file</span>
0441         PresentDirectory = pwd;
0442         cd(PathName);
0443         eval(FileName(1:end-2));
0444         cd(PresentDirectory);
0445         FileName = [PathName,FileName,<span class="string">'at'</span>];   <span class="comment">% Make a mat file</span>
0446         save(FileName, <span class="string">'LocoModel'</span>, <span class="string">'FitParameters'</span>, <span class="string">'BPMData'</span>, <span class="string">'CMData'</span>, <span class="string">'RINGData'</span>, <span class="string">'LocoMeasData'</span>, <span class="string">'LocoFlags'</span>);
0447     <span class="keyword">elseif</span> strcmp(FileName(idot:end),<span class="string">'.mat'</span>)
0448         <span class="comment">% .mat file</span>
0449         FileName = [PathName, FileName];
0450         <span class="comment">%load(FileName);</span>
0451     <span class="keyword">else</span>
0452         fprintf(<span class="string">'   File must be of type .mat or .m.\n'</span>);
0453         error(<span class="string">'  '</span>);
0454     <span class="keyword">end</span>
0455 <span class="keyword">catch</span>
0456     fprintf(<span class="string">'   File open problem\n'</span>);
0457     axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes1'</span>));
0458     cla;
0459     axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes2'</span>));
0460     cla;
0461     set(gcbf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
0462     <span class="keyword">return</span>
0463 <span class="keyword">end</span>
0464 
0465 <span class="comment">% Check the file then reload</span>
0466 <span class="keyword">try</span>
0467     [BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData] = <a href="locofilecheck.html" class="code" title="function [BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData] = locofilecheck(FileName)">locofilecheck</a>(FileName);
0468     <span class="comment">%[BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData] = locofilecheck({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});</span>
0469     <span class="comment">%save(FileName, 'LocoModel', 'FitParameters', 'BPMData', 'CMData', 'RINGData', 'LocoMeasData', 'LocoFlags');</span>
0470     setappdata(gcbf, <span class="string">'LocoDataCell'</span>, {BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
0471 <span class="keyword">catch</span>
0472     fprintf(<span class="string">'   File open problem.\n'</span>);
0473     axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes1'</span>));
0474     cla;
0475     axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes2'</span>));
0476     cla;
0477     fprintf(<span class="string">'%s\n'</span>, lasterr);
0478     set(gcbf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
0479     <span class="keyword">return</span>
0480 <span class="keyword">end</span>
0481 
0482 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>,FileName);
0483 set(gcbf,<span class="string">'Name'</span>,[<span class="string">'LOCO:  '</span>,FileName]);
0484 
0485 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'String'</span>,num2str([0:length(CMData)-1]'));
0486 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'Value'</span>, length(CMData));
0487 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'String'</span>,num2str([0:length(CMData)-1]'));
0488 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>,length(CMData));
0489 
0490 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HBPMIndex'</span>), <span class="string">'Userdata'</span>, []);
0491 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VBPMIndex'</span>), <span class="string">'Userdata'</span>, []);
0492 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HCMIndex'</span>), <span class="string">'Userdata'</span>, []);
0493 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VCMIndex'</span>), <span class="string">'Userdata'</span>, []);
0494 
0495 
0496 <span class="comment">% Force plot #2 and #5 to avoid an error with response matrix plots which cache the filename</span>
0497 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu1'</span>),<span class="string">'Value'</span>, 2);
0498 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu2'</span>),<span class="string">'Value'</span>, 3);
0499 <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu1'</span>), 1);
0500 <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu2'</span>), 1);
0501 
0502 <span class="comment">% Update menu items</span>
0503 <a href="#_sub19" class="code" title="subfunction setmenuinputs(BPMData, CMData, LocoFlags, FitParameters)">setmenuinputs</a>(BPMData(end), CMData(end), LocoFlags(end), FitParameters(end));
0504 
0505 set(gcbf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
0506 
0507 
0508 <span class="comment">% --------------------------------------------------------------------</span>
0509 <a name="_sub5" href="#_subfunctions" class="code">function varargout = SVDDataSave_Callback(h, eventdata, handles, varargin)</a>
0510 
0511 <span class="keyword">if</span> strcmpi((get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Checked'</span>)), <span class="string">'on'</span>)
0512     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0513     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Label'</span>,[<span class="string">'Save A,S,V,U,CovFit to File'</span>]);
0514     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Userdata'</span>,[]);
0515 <span class="keyword">else</span>
0516     [FileName, PathName] = uiputfile(<span class="string">'*.mat'</span>, <span class="string">'SVD data file name'</span>);
0517     <span class="keyword">if</span> isequal(FileName,0) || isequal(PathName,0)
0518         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0519         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Label'</span>,[<span class="string">'Save A,S,V,U,CovFit to File'</span>]);
0520         <span class="keyword">return</span>
0521     <span class="keyword">end</span>
0522     FileName = [PathName,FileName];
0523     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0524     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Label'</span>,[<span class="string">'Save A,S,V,U,CovFit to File: '</span>, FileName]);
0525     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Userdata'</span>,FileName);
0526 <span class="keyword">end</span>
0527 
0528 
0529 <span class="comment">% --------------------------------------------------------------------</span>
0530 <a name="_sub6" href="#_subfunctions" class="code">function varargout = Diary_Callback(h, eventdata, handles, varargin)</a>
0531 
0532 <span class="keyword">if</span> strcmpi((get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Checked'</span>)), <span class="string">'on'</span>)
0533     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0534     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Label'</span>,<span class="string">'Diary'</span>);
0535     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Userdata'</span>,[]);
0536     diary off
0537 <span class="keyword">else</span>
0538     [FileName, PathName] = uiputfile(<span class="string">'*.*'</span>, <span class="string">'Diary file name'</span>);
0539     <span class="keyword">if</span> isequal(FileName,0) || isequal(PathName,0)
0540         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0541         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Label'</span>,<span class="string">'Diary'</span>);
0542         <span class="keyword">return</span>
0543     <span class="keyword">end</span>
0544     FileName = [PathName,FileName];
0545     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0546     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Label'</span>,[<span class="string">'Diary: '</span>, FileName]);
0547     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Diary'</span>),<span class="string">'Userdata'</span>,FileName);
0548     diary(FileName);
0549 <span class="keyword">end</span>
0550 
0551 
0552 <span class="comment">% --------------------------------------------------------------------</span>
0553 <a name="_sub7" href="#_subfunctions" class="code">function varargout = NewMeasRespMat_Callback(h, eventdata, handles, varargin)</a>
0554 FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
0555 <span class="keyword">if</span> isempty(FileName)
0556     fprintf(<span class="string">'   LOCO data file does not exist (use File-&gt;Open).\n'</span>);
0557     <span class="keyword">return</span>
0558 <span class="keyword">end</span>
0559 
0560 <span class="comment">% Get response matrix filename and try to load</span>
0561 fprintf(<span class="string">'\n'</span>);
0562 [FileNameMeas, PathNameMeas] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'New LOCO response mastrix data file name'</span>);
0563 <span class="keyword">if</span> isequal(FileNameMeas,0) || isequal(PathNameMeas,0)
0564     fprintf(<span class="string">'   Measured response data file does not exist.\n\n'</span>);
0565     <span class="keyword">return</span>
0566 <span class="keyword">end</span>
0567 <span class="keyword">try</span>
0568     load(FileNameMeas);
0569     <span class="comment">%if ~exist('LocoMeasData','var')</span>
0570     <span class="comment">%    fprintf('   LocoMeasData variable does not exist.\n');</span>
0571     <span class="comment">%    return</span>
0572     <span class="comment">%end</span>
0573     <span class="keyword">if</span> exist(<span class="string">'LocoMeasData'</span>,<span class="string">'var'</span>)
0574         fprintf(<span class="string">'   LocoMeasData will be replaced\n'</span>);
0575     <span class="keyword">end</span>
0576     <span class="keyword">if</span> exist(<span class="string">'BPMData'</span>,<span class="string">'var'</span>)
0577         fprintf(<span class="string">'   BPMData will be replaced\n'</span>);
0578     <span class="keyword">end</span>
0579     <span class="keyword">if</span> exist(<span class="string">'CMData'</span>,<span class="string">'var'</span>)
0580         fprintf(<span class="string">'   CMData will be replaced\n'</span>);
0581     <span class="keyword">end</span>
0582     <span class="keyword">if</span> exist(<span class="string">'FitParameters'</span>,<span class="string">'var'</span>)
0583         fprintf(<span class="string">'   FitParameters will be replaced\n'</span>);
0584     <span class="keyword">end</span>
0585     <span class="keyword">if</span> exist(<span class="string">'LocoFlags'</span>,<span class="string">'var'</span>)
0586         fprintf(<span class="string">'   LocoFlags will be replaced\n'</span>);
0587     <span class="keyword">end</span>
0588     <span class="keyword">if</span> exist(<span class="string">'RINGData'</span>,<span class="string">'var'</span>)
0589         fprintf(<span class="string">'   RINGData will be replaced\n'</span>);
0590     <span class="keyword">end</span>
0591     <span class="comment">%if exist('LocoModel','var')</span>
0592     <span class="comment">%    fprintf('   LocoModel will be replaced\n');</span>
0593     <span class="comment">%end</span>
0594 <span class="keyword">catch</span>
0595     fprintf(<span class="string">'   Measured response data file does not exist or is not a *.mat file type\n\n'</span>);
0596     <span class="keyword">return</span>
0597 <span class="keyword">end</span>
0598 
0599 AllExistFlag = (exist(<span class="string">'LocoMeasData'</span>,<span class="string">'var'</span>) &amp; exist(<span class="string">'BPMData'</span>,<span class="string">'var'</span>) &amp; exist(<span class="string">'CMData'</span>,<span class="string">'var'</span>) &amp; exist(<span class="string">'LocoModel'</span>,<span class="string">'var'</span>) &amp; exist(<span class="string">'FitParameters'</span>,<span class="string">'var'</span>) &amp; exist(<span class="string">'LocoFlags'</span>,<span class="string">'var'</span>) &amp; exist(<span class="string">'RINGData'</span>,<span class="string">'var'</span>));
0600 NoneExistFlag = (~exist(<span class="string">'LocoMeasData'</span>,<span class="string">'var'</span>) &amp; ~exist(<span class="string">'BPMData'</span>,<span class="string">'var'</span>) &amp; ~exist(<span class="string">'CMData'</span>,<span class="string">'var'</span>) &amp; ~exist(<span class="string">'LocoModel'</span>,<span class="string">'var'</span>) &amp; ~exist(<span class="string">'FitParameters'</span>,<span class="string">'var'</span>) &amp; ~exist(<span class="string">'LocoFlags'</span>,<span class="string">'var'</span>) &amp; ~exist(<span class="string">'RINGData'</span>,<span class="string">'var'</span>));
0601 
0602 <span class="keyword">if</span> NoneExistFlag
0603     fprintf(<span class="string">'   No LOCO variable found in this file\n\n'</span>);
0604     <span class="keyword">return</span>;
0605 <span class="keyword">end</span>
0606 
0607 fprintf(<span class="string">'   LocoModel will be recomputed\n'</span>);
0608 <span class="keyword">if</span> AllExistFlag
0609     <span class="comment">% Replace all variables (just like a OPEN)</span>
0610 <span class="keyword">else</span>
0611     <span class="comment">% Get filename and try to load</span>
0612     <span class="keyword">try</span>
0613         load(FileName);
0614     <span class="keyword">catch</span>
0615         fprintf(<span class="string">'   LOCO file does not exist or is not a *.mat file type\n\n'</span>);
0616         cla;
0617         <span class="keyword">return</span>
0618     <span class="keyword">end</span>
0619 
0620     <span class="comment">% Which iteration do you want to associate the measured response matrix with</span>
0621     <span class="keyword">if</span> length(CMData) &gt; 1
0622         <span class="keyword">for</span> i = 1:length(CMData)
0623             NumList{i} = num2str(i-1);
0624         <span class="keyword">end</span>
0625         IterNum = menu({<span class="string">'Which iteration # do you want the '</span>,<span class="string">'new data associated with?'</span>}, NumList);
0626         <span class="keyword">if</span> IterNum == 0
0627             fprintf(<span class="string">'   No change made to the measured response matrix\n\n'</span>);
0628             <span class="keyword">return</span>
0629         <span class="keyword">end</span>
0630     <span class="keyword">else</span>
0631         IterNum = 1;
0632     <span class="keyword">end</span>
0633 
0634     FitParameters = FitParameters(IterNum);
0635     BPMData = BPMData(IterNum);
0636     CMData = CMData(IterNum);
0637     <span class="comment">%LocoModel = LocoModel(IterNum);</span>
0638     LocoFlags = LocoFlags(IterNum);
0639 <span class="keyword">end</span>
0640 
0641 <span class="comment">% Write over with the new data</span>
0642 load(FileNameMeas);
0643 
0644 
0645 <span class="comment">% Double check length of new variables (should be one if adding new variables)</span>
0646 <span class="keyword">if</span> ~AllExistFlag
0647     <span class="keyword">if</span> length(CMData) &gt; 1
0648         <span class="keyword">for</span> i = 1:length(CMData)
0649             NumList{i} = num2str(i-1);
0650         <span class="keyword">end</span>
0651         IterNum = menu({<span class="string">'New data has more than one iteration #'</span>,<span class="string">'Which iteration do you want to use?'</span>}, NumList);
0652         <span class="keyword">if</span> IterNum == 0
0653             fprintf(<span class="string">'   No change made to the LOCO input file.\n'</span>);
0654             <span class="keyword">return</span>
0655         <span class="keyword">end</span>
0656 
0657         NewFileFlag = questdlg({sprintf(<span class="string">'Only iteration #%d will be saved.'</span>,IterNum-1),<span class="string">'Do you want to change the LOCO file name?'</span>},<span class="string">'New Response Matrix'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'No'</span>);
0658         <span class="keyword">if</span> strcmp(NewFileFlag,<span class="string">'Yes'</span>)
0659             [FileName, PathName] = uiputfile(<span class="string">'*.mat'</span>, <span class="string">'New LOCO data file name'</span>);
0660             <span class="keyword">if</span> isequal(FileName,0) || isequal(PathName,0)
0661                 axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes1'</span>));
0662                 cla;
0663                 axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes2'</span>));
0664                 cla;
0665                 <span class="keyword">return</span>
0666             <span class="keyword">end</span>
0667             FileName = [PathName,FileName];
0668         <span class="keyword">end</span>
0669     <span class="keyword">else</span>
0670         IterNum = 1;
0671     <span class="keyword">end</span>
0672 
0673     FitParameters = FitParameters(IterNum);
0674     BPMData = BPMData(IterNum);
0675     CMData = CMData(IterNum);
0676     <span class="comment">%LocoModel = LocoModel(IterNum);</span>
0677     LocoFlags = LocoFlags(IterNum);
0678 <span class="keyword">end</span>
0679 
0680 <span class="keyword">try</span>
0681     LocoModel = [];   <span class="comment">% Clear the model because the RINGData, BPMData, or CMData may be different</span>
0682     [BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData] = <a href="locofilecheck.html" class="code" title="function [BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData] = locofilecheck(FileName)">locofilecheck</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
0683 <span class="keyword">catch</span>
0684     fprintf(<span class="string">'   There were problems with the input file, so no changes were made.\n'</span>);
0685     <span class="keyword">return</span>
0686 <span class="keyword">end</span>
0687 
0688 fprintf(<span class="string">'\n'</span>);
0689 
0690 save(FileName, <span class="string">'LocoModel'</span>, <span class="string">'FitParameters'</span>, <span class="string">'BPMData'</span>, <span class="string">'CMData'</span>, <span class="string">'RINGData'</span>, <span class="string">'LocoMeasData'</span>, <span class="string">'LocoFlags'</span>);
0691 setappdata(gcbf, <span class="string">'LocoDataCell'</span>, {BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
0692 
0693 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>,FileName);
0694 set(gcbf,<span class="string">'Name'</span>,[<span class="string">'LOCO:  '</span>,FileName]);
0695 
0696 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HBPMIndex'</span>), <span class="string">'Userdata'</span>, []);
0697 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VBPMIndex'</span>), <span class="string">'Userdata'</span>, []);
0698 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HCMIndex'</span>), <span class="string">'Userdata'</span>, []);
0699 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VCMIndex'</span>), <span class="string">'Userdata'</span>, []);
0700 
0701 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'String'</span>,num2str([0:length(CMData)-1]'));
0702 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'Value'</span>, length(CMData));
0703 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'String'</span>,num2str([0:length(CMData)-1]'));
0704 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>,length(CMData));
0705 
0706 <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu1'</span>));
0707 <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu2'</span>));
0708 
0709 
0710 <span class="comment">% --------------------------------------------------------------------</span>
0711 <a name="_sub8" href="#_subfunctions" class="code">function varargout = SaveAs_Callback(h, eventdata, handles, varargin)</a>
0712 
0713 <span class="comment">% Get filename and try to load</span>
0714 FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
0715 <span class="keyword">if</span> isempty(FileName)
0716     fprintf(<span class="string">'   Old data file does not exist.\n'</span>);
0717     <span class="keyword">return</span>
0718 <span class="keyword">end</span>
0719 <span class="keyword">try</span>
0720     load(FileName);
0721 <span class="keyword">catch</span>
0722     fprintf(<span class="string">'   Old data file does not exist or is not a *.mat file type.\n'</span>);
0723     cla;
0724     <span class="keyword">return</span>
0725 <span class="keyword">end</span>
0726 
0727 <span class="keyword">if</span> strcmp(get(h,<span class="string">'Tag'</span>),<span class="string">'SaveAsLastIteration'</span>)
0728     <span class="keyword">if</span> length(CMData) &gt; 1
0729         <span class="keyword">for</span> i = 1:length(CMData)
0730             NumList{i} = num2str(i-1);
0731         <span class="keyword">end</span>
0732 
0733         IterNum = menu(<span class="string">'Which iteration #'</span>, NumList);
0734         <span class="keyword">if</span> IterNum == 0
0735             fprintf(<span class="string">'   Save aborted.\n'</span>);
0736             <span class="keyword">return</span>
0737         <span class="keyword">end</span>
0738 
0739         <span class="comment">% Always keep the first iteration</span>
0740         <span class="keyword">if</span> IterNum ~= 1
0741             IterNum = [1 IterNum];
0742         <span class="keyword">end</span>
0743 
0744         FitParameters = FitParameters(IterNum);
0745         BPMData = BPMData(IterNum);
0746         CMData = CMData(IterNum);
0747         LocoModel = LocoModel(IterNum);
0748         LocoFlags = LocoFlags(IterNum);
0749     <span class="keyword">end</span>
0750 <span class="keyword">end</span>
0751 
0752 [FileName, PathName] = uiputfile(<span class="string">'*.mat'</span>, <span class="string">'Loco data file name'</span>);
0753 <span class="keyword">if</span> isequal(FileName,0) || isequal(PathName,0)
0754     axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes1'</span>));
0755     cla;
0756     axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Axes2'</span>));
0757     cla;
0758     <span class="keyword">return</span>
0759 <span class="keyword">end</span>
0760 FileName = [PathName,FileName];
0761 
0762 save(FileName, <span class="string">'LocoModel'</span>, <span class="string">'FitParameters'</span>, <span class="string">'BPMData'</span>, <span class="string">'CMData'</span>, <span class="string">'RINGData'</span>, <span class="string">'LocoMeasData'</span>, <span class="string">'LocoFlags'</span>);
0763 setappdata(gcbf, <span class="string">'LocoDataCell'</span>, {BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
0764 
0765 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>,FileName);
0766 set(gcbf,<span class="string">'Name'</span>,[<span class="string">'LOCO:  '</span>,FileName]);
0767 
0768 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'String'</span>,num2str([0:length(CMData)-1]'));
0769 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'Value'</span>, length(CMData));
0770 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'String'</span>,num2str([0:length(CMData)-1]'));
0771 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>,length(CMData));
0772 
0773 <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu1'</span>));
0774 <a href="#_sub20" class="code" title="subfunction varargout = MenuAxes_Callback(h, eventdata, handles, varargin)">MenuAxes_Callback</a>(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu2'</span>));
0775 
0776 
0777 <span class="comment">% --------------------------------------------------------------------</span>
0778 <a name="_sub9" href="#_subfunctions" class="code">function varargout = MenuUserInput_Callback(h, eventdata, handles, varargin)</a>
0779 ans=inputdlg({<span class="string">'Which singular values:'</span>},<span class="string">'LOCO'</span>,1,{sprintf(<span class="string">'[%d:1]'</span>,1)});
0780 <span class="keyword">if</span> ~isempty(ans);
0781     Ivec = str2num(ans{1});
0782     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'UserInput'</span>),<span class="string">'Userdata'</span>,Ivec);
0783     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'UserInput'</span>),<span class="string">'Checked'</span>,<span class="string">'on'</span>);
0784     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Rank'</span>),<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0785     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0786     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Interactive'</span>),<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0787 <span class="keyword">end</span>
0788 
0789 <span class="comment">% --------------------------------------------------------------------</span>
0790 <a name="_sub10" href="#_subfunctions" class="code">function varargout = MenuThreshold_Callback(h, eventdata, handles, varargin)</a>
0791 Threshold = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Userdata'</span>);
0792 
0793 ans=inputdlg({<span class="string">'Threshold:'</span>},<span class="string">'LOCO'</span>,1,{num2str(Threshold)});
0794 <span class="keyword">if</span> ~isempty(ans);
0795     Threshold = str2num(ans{1});
0796     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Label'</span>,[<span class="string">'Threshold ('</span>,num2str(Threshold),<span class="string">')'</span>]);
0797     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Userdata'</span>,Threshold);
0798     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'UserInput'</span>),<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0799     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Rank'</span>),<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0800     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Checked'</span>,<span class="string">'on'</span>);
0801     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Interactive'</span>),<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0802 <span class="keyword">end</span>
0803 
0804 <span class="comment">% --------------------------------------------------------------------</span>
0805 <a name="_sub11" href="#_subfunctions" class="code">function varargout = Outlier_Callback(h, eventdata, handles, varargin)</a>
0806 OutlierFactor = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Outlier'</span>),<span class="string">'Userdata'</span>);
0807 
0808 ans=inputdlg({<span class="string">'Outlier Factor: enter the # of sigma'</span>},<span class="string">'LOCO'</span>,1,{num2str(OutlierFactor)});
0809 <span class="keyword">if</span> ~isempty(ans)
0810     OutlierFactor = str2num(ans{1});
0811     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Outlier'</span>),<span class="string">'Label'</span>,[<span class="string">'Outlier Rejection ('</span>,num2str(OutlierFactor),<span class="string">' sigma)'</span>]);
0812     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Outlier'</span>),<span class="string">'Userdata'</span>, OutlierFactor);
0813     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Outlier'</span>),<span class="string">'Checked'</span>, <span class="string">'on'</span>);
0814 <span class="keyword">end</span>
0815 
0816 
0817 <span class="comment">% --------------------------------------------------------------------</span>
0818 <a name="_sub12" href="#_subfunctions" class="code">function varargout = HorizontalDispersion_Callback(h, eventdata, handles, varargin)</a>
0819 HorizontalDispersionWeight = getappdata(gcbf, <span class="string">'HorizontalDispersionWeight'</span>);
0820 
0821 ans = inputdlg({<span class="string">'Horizontal Dispersion Weight'</span>},<span class="string">'LOCO'</span>,1,{num2str(HorizontalDispersionWeight)});
0822 <span class="keyword">if</span> ~isempty(ans)
0823     HorizontalDispersionWeight = abs(str2num(ans{1}));
0824     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HorizontalDispersionWeight'</span>),<span class="string">'Label'</span>, sprintf(<span class="string">'    Weigh for Horizontal Dispersion = %f'</span>, HorizontalDispersionWeight));
0825     setappdata(gcbf,<span class="string">'HorizontalDispersionWeight'</span>, HorizontalDispersionWeight);
0826 <span class="keyword">end</span>
0827 
0828 <span class="comment">% --------------------------------------------------------------------</span>
0829 <a name="_sub13" href="#_subfunctions" class="code">function varargout = VerticalDispersion_Callback(h, eventdata, handles, varargin)</a>
0830 VerticalDispersionWeight = getappdata(gcbf, <span class="string">'VerticalDispersionWeight'</span>);
0831 
0832 ans = inputdlg({<span class="string">'Vertical Dispersion Weight'</span>},<span class="string">'LOCO'</span>,1,{num2str(VerticalDispersionWeight)});
0833 <span class="keyword">if</span> ~isempty(ans)
0834     VerticalDispersionWeight = abs(str2num(ans{1}));
0835     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VerticalDispersionWeight'</span>),<span class="string">'Label'</span>, sprintf(<span class="string">'    Weigh for Vertical     Dispersion = %f'</span>, VerticalDispersionWeight));
0836     setappdata(gcbf,<span class="string">'VerticalDispersionWeight'</span>, VerticalDispersionWeight);
0837 <span class="keyword">end</span>
0838 
0839 
0840 <span class="comment">% --------------------------------------------------------------------</span>
0841 <a name="_sub14" href="#_subfunctions" class="code">function varargout = HBPMIndex_Callback(h, eventdata, handles, varargin)</a>
0842 
0843 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
0844 <span class="keyword">if</span> isempty(LocoDataCell)
0845     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
0846     <span class="keyword">if</span> isempty(FileName)
0847         fprintf(<span class="string">'   File does not exist.\n'</span>);
0848         <span class="keyword">return</span>
0849     <span class="keyword">end</span>
0850     <span class="keyword">try</span>
0851         load(FileName);
0852     <span class="keyword">catch</span>
0853         fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
0854         cla;
0855         <span class="keyword">return</span>
0856     <span class="keyword">end</span>
0857 <span class="keyword">else</span>
0858     BPMData = LocoDataCell{1};
0859 <span class="keyword">end</span>
0860 
0861 StartFrom = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>);
0862 
0863 <span class="keyword">if</span> isempty(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HBPMIndex'</span>), <span class="string">'Userdata'</span>))
0864     Index = BPMData(StartFrom).HBPMGoodDataIndex;
0865 <span class="keyword">else</span>
0866     Index = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HBPMIndex'</span>), <span class="string">'Userdata'</span>);
0867 <span class="keyword">end</span>
0868 
0869 Checked = zeros(size(BPMData(StartFrom).HBPMIndex));
0870 Checked(Index) = 1;
0871 
0872 tmp = BPMData(StartFrom).BPMIndex(BPMData(StartFrom).HBPMIndex);
0873 Index = <a href="locoeditlist.html" class="code" title="function newList = locoeditlist(List, ListName, CheckList)">locoeditlist</a>([(1:length(BPMData(StartFrom).HBPMIndex))' tmp(:)], <span class="string">'BPM'</span>, Checked);
0874 Index = Index(:,1);
0875 
0876 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HBPMIndex'</span>), <span class="string">'Userdata'</span>, Index);
0877 
0878 <span class="comment">% --------------------------------------------------------------------</span>
0879 <a name="_sub15" href="#_subfunctions" class="code">function varargout = VBPMIndex_Callback(h, eventdata, handles, varargin)</a>
0880 
0881 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
0882 <span class="keyword">if</span> isempty(LocoDataCell)
0883     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
0884     <span class="keyword">if</span> isempty(FileName)
0885         fprintf(<span class="string">'   File does not exist.\n'</span>);
0886         <span class="keyword">return</span>
0887     <span class="keyword">end</span>
0888     <span class="keyword">try</span>
0889         load(FileName);
0890     <span class="keyword">catch</span>
0891         fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
0892         cla;
0893         <span class="keyword">return</span>
0894     <span class="keyword">end</span>
0895 <span class="keyword">else</span>
0896     BPMData = LocoDataCell{1};
0897 <span class="keyword">end</span>
0898 
0899 StartFrom = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>);
0900 
0901 <span class="keyword">if</span> isempty(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VBPMIndex'</span>), <span class="string">'Userdata'</span>))
0902     Index = BPMData(StartFrom).VBPMGoodDataIndex;
0903 <span class="keyword">else</span>
0904     Index = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VBPMIndex'</span>), <span class="string">'Userdata'</span>);
0905 <span class="keyword">end</span>
0906 
0907 Checked = zeros(size(BPMData(StartFrom).VBPMIndex));
0908 Checked(Index) = 1;
0909 
0910 tmp = BPMData(StartFrom).BPMIndex(BPMData(StartFrom).VBPMIndex);
0911 Index = <a href="locoeditlist.html" class="code" title="function newList = locoeditlist(List, ListName, CheckList)">locoeditlist</a>([(1:length(BPMData(StartFrom).VBPMIndex))' tmp(:)], <span class="string">'BPM'</span>, Checked);
0912 Index = Index(:,1);
0913 
0914 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VBPMIndex'</span>), <span class="string">'Userdata'</span>, Index);
0915 
0916 
0917 <span class="comment">% --------------------------------------------------------------------</span>
0918 <a name="_sub16" href="#_subfunctions" class="code">function varargout = HCMIndex_Callback(h, eventdata, handles, varargin)</a>
0919 
0920 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
0921 <span class="keyword">if</span> isempty(LocoDataCell)
0922     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
0923     <span class="keyword">if</span> isempty(FileName)
0924         fprintf(<span class="string">'   File does not exist.\n'</span>);
0925         <span class="keyword">return</span>
0926     <span class="keyword">end</span>
0927     <span class="keyword">try</span>
0928         load(FileName);
0929     <span class="keyword">catch</span>
0930         fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
0931         cla;
0932         <span class="keyword">return</span>
0933     <span class="keyword">end</span>
0934 <span class="keyword">else</span>
0935     CMData = LocoDataCell{2};
0936 <span class="keyword">end</span>
0937 
0938 StartFrom = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>);
0939 
0940 <span class="keyword">if</span> isempty(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HCMIndex'</span>), <span class="string">'Userdata'</span>))
0941     Index = CMData(StartFrom).HCMGoodDataIndex;
0942 <span class="keyword">else</span>
0943     Index = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HCMIndex'</span>), <span class="string">'Userdata'</span>);
0944 <span class="keyword">end</span>
0945 
0946 Checked = zeros(size(CMData(StartFrom).HCMIndex));
0947 Checked(Index) = 1;
0948 
0949 Index = <a href="locoeditlist.html" class="code" title="function newList = locoeditlist(List, ListName, CheckList)">locoeditlist</a>([(1:length(CMData(StartFrom).HCMIndex))'  CMData(StartFrom).HCMIndex(:)], <span class="string">'HCM'</span>, Checked);
0950 Index = Index(:,1);
0951 
0952 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HCMIndex'</span>), <span class="string">'Userdata'</span>, Index);
0953 
0954 
0955 <span class="comment">% --------------------------------------------------------------------</span>
0956 <a name="_sub17" href="#_subfunctions" class="code">function varargout = VCMIndex_Callback(h, eventdata, handles, varargin)</a>
0957 
0958 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
0959 <span class="keyword">if</span> isempty(LocoDataCell)
0960     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
0961     <span class="keyword">if</span> isempty(FileName)
0962         fprintf(<span class="string">'   File does not exist.\n'</span>);
0963         <span class="keyword">return</span>
0964     <span class="keyword">end</span>
0965     <span class="keyword">try</span>
0966         load(FileName);
0967     <span class="keyword">catch</span>
0968         fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
0969         cla;
0970         <span class="keyword">return</span>
0971     <span class="keyword">end</span>
0972 <span class="keyword">else</span>
0973     CMData = LocoDataCell{2};
0974 <span class="keyword">end</span>
0975 
0976 StartFrom = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>);
0977 
0978 <span class="keyword">if</span> isempty(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VCMIndex'</span>), <span class="string">'Userdata'</span>))
0979     Index = CMData(StartFrom).VCMGoodDataIndex;
0980 <span class="keyword">else</span>
0981     Index = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VCMIndex'</span>), <span class="string">'Userdata'</span>);
0982 <span class="keyword">end</span>
0983 
0984 Checked = zeros(size(CMData(StartFrom).VCMIndex));
0985 Checked(Index) = 1;
0986 
0987 Index = <a href="locoeditlist.html" class="code" title="function newList = locoeditlist(List, ListName, CheckList)">locoeditlist</a>([(1:length(CMData(StartFrom).VCMIndex))'  CMData(StartFrom).VCMIndex(:)], <span class="string">'VCM'</span>, Checked);
0988 Index = Index(:,1);
0989 
0990 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VCMIndex'</span>), <span class="string">'Userdata'</span>, Index);
0991 
0992 
0993 <span class="comment">% --------------------------------------------------------------------</span>
0994 <a name="_sub18" href="#_subfunctions" class="code">function varargout = StartFrom_Callback(h, eventdata, handles, varargin)</a>
0995 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
0996 <span class="keyword">if</span> isempty(LocoDataCell)
0997     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
0998     <span class="keyword">if</span> isempty(FileName)
0999         fprintf(<span class="string">'   File does not exist.\n'</span>);
1000         <span class="keyword">return</span>
1001     <span class="keyword">end</span>
1002     <span class="keyword">try</span>
1003         load(FileName);
1004     <span class="keyword">catch</span>
1005         fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
1006         cla;
1007         <span class="keyword">return</span>
1008     <span class="keyword">end</span>
1009 <span class="keyword">else</span>
1010     BPMData       = LocoDataCell{1};
1011     CMData        = LocoDataCell{2};
1012     FitParameters = LocoDataCell{5};
1013     LocoFlags     = LocoDataCell{6};
1014 <span class="keyword">end</span>
1015 
1016 StartFrom = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'Value'</span>) + 1;
1017 StartFromSize = size(get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'StartFrom'</span>),<span class="string">'String'</span>),1);
1018 <span class="keyword">if</span> StartFrom &gt; StartFromSize
1019     StartFrom = StartFromSize;
1020 <span class="keyword">end</span>
1021 <a href="#_sub19" class="code" title="subfunction setmenuinputs(BPMData, CMData, LocoFlags, FitParameters)">setmenuinputs</a>(BPMData(StartFrom), CMData(StartFrom), LocoFlags(StartFrom), FitParameters(StartFrom));
1022 
1023 
1024 <span class="comment">% --------------------------------------------------------------------</span>
1025 <a name="_sub19" href="#_subfunctions" class="code">function setmenuinputs(BPMData, CMData, LocoFlags, FitParameters)</a>
1026 
1027 <span class="comment">% Set BPM Indexes</span>
1028 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HBPMIndex'</span>), <span class="string">'Userdata'</span>, BPMData.HBPMGoodDataIndex);
1029 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VBPMIndex'</span>), <span class="string">'Userdata'</span>, BPMData.VBPMGoodDataIndex);
1030 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HCMIndex'</span>),  <span class="string">'Userdata'</span>, CMData.HCMGoodDataIndex);
1031 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VCMIndex'</span>),  <span class="string">'Userdata'</span>, CMData.VCMGoodDataIndex);
1032 
1033 
1034 <span class="comment">% Set flags</span>
1035 
1036 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Rank'</span>),       <span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1037 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),  <span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1038 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Interactive'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1039 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'UserInput'</span>),  <span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1040 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),  <span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1041 <span class="keyword">if</span> strcmpi((LocoFlags.SVmethod),<span class="string">'rank'</span>)
1042     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Rank'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1043 <span class="keyword">elseif</span> length(LocoFlags.SVmethod) &gt; 1
1044     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'UserInput'</span>),<span class="string">'Userdata'</span>,LocoFlags.SVmethod);
1045     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'UserInput'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1046 <span class="keyword">elseif</span>  length(LocoFlags.SVmethod) == 1
1047     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1048 <span class="keyword">elseif</span>  isempty(LocoFlags.SVmethod)
1049     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Interactive'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1050 <span class="keyword">else</span>
1051     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1052 <span class="keyword">end</span>
1053 
1054 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Userdata'</span>, LocoFlags.Threshold);
1055 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Threshold'</span>),<span class="string">'Label'</span>,[<span class="string">'Threshold ('</span>,num2str(LocoFlags.Threshold),<span class="string">')'</span>]);
1056 
1057 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Outlier'</span>),<span class="string">'Userdata'</span>,LocoFlags.OutlierFactor);
1058 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Outlier'</span>),<span class="string">'Label'</span>,[<span class="string">'Outlier Rejection ('</span>,num2str(LocoFlags.OutlierFactor),<span class="string">' sigma)'</span>]);
1059 
1060 setappdata(gcbf,<span class="string">'HorizontalDispersionWeight'</span>, LocoFlags.HorizontalDispersionWeight);
1061 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'HorizontalDispersionWeight'</span>),<span class="string">'Label'</span>, sprintf(<span class="string">'    Weight for Horizontal Dispersion = %f'</span>, LocoFlags.HorizontalDispersionWeight));
1062 
1063 setappdata(gcbf,<span class="string">'VerticalDispersionWeight'</span>, LocoFlags.VerticalDispersionWeight);
1064 set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'VerticalDispersionWeight'</span>),<span class="string">'Label'</span>, sprintf(<span class="string">'    Weight for Vertical     Dispersion = %f'</span>, LocoFlags.VerticalDispersionWeight));
1065 
1066 <span class="keyword">if</span> ischar(LocoFlags.Coupling)
1067     <span class="keyword">if</span> strcmpi((LocoFlags.Coupling),<span class="string">'yes'</span>)
1068         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Coupling'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1069     <span class="keyword">else</span>
1070         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Coupling'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1071     <span class="keyword">end</span>
1072 <span class="keyword">end</span>
1073 
1074 <span class="keyword">if</span> ischar(LocoFlags.AutoCorrectDelta)
1075     <span class="keyword">if</span> strcmpi((LocoFlags.AutoCorrectDelta),<span class="string">'yes'</span>)
1076         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'AutoCorrect'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1077     <span class="keyword">else</span>
1078         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'AutoCorrect'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1079     <span class="keyword">end</span>
1080 <span class="keyword">end</span>
1081 
1082 <span class="keyword">if</span> ischar(LocoFlags.Normalize)
1083     <span class="keyword">if</span> strcmpi((LocoFlags.Normalize),<span class="string">'yes'</span>)
1084         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Normalize'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1085     <span class="keyword">else</span>
1086         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Normalize'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1087     <span class="keyword">end</span>
1088 <span class="keyword">end</span>
1089 
1090 <span class="keyword">if</span> ischar(LocoFlags.Dispersion)
1091     <span class="keyword">if</span> strcmpi((LocoFlags.Dispersion),<span class="string">'yes'</span>)
1092         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Dispersion'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1093     <span class="keyword">else</span>
1094         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Dispersion'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1095     <span class="keyword">end</span>
1096 <span class="keyword">end</span>
1097 
1098 <span class="keyword">if</span> ischar(CMData.FitHCMEnergyShift)
1099     <span class="keyword">if</span> strcmpi((CMData.FitHCMEnergyShift),<span class="string">'yes'</span>)
1100         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FitHCMEnergyShift'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1101     <span class="keyword">else</span>
1102         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FitHCMEnergyShift'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1103     <span class="keyword">end</span>
1104 <span class="keyword">end</span>
1105 
1106 <span class="keyword">if</span> ischar(CMData.FitVCMEnergyShift)
1107     <span class="keyword">if</span> strcmpi((CMData.FitVCMEnergyShift),<span class="string">'yes'</span>)
1108         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FitVCMEnergyShift'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1109     <span class="keyword">else</span>
1110         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FitVCMEnergyShift'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1111     <span class="keyword">end</span>
1112 <span class="keyword">end</span>
1113 
1114 <span class="keyword">if</span> ischar(LocoFlags.ResponseMatrixCalculator)
1115     <span class="keyword">if</span> strcmpi((LocoFlags.ResponseMatrixCalculator),<span class="string">'linear'</span>)
1116         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Linear'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1117         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Full'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1118     <span class="keyword">else</span> <span class="comment">%strcmpi((LocoFlags.ResponseMatrixCalculator),'full')</span>
1119         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Linear'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1120         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'Full'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1121     <span class="keyword">end</span>
1122 <span class="keyword">end</span>
1123 
1124 <span class="keyword">if</span> ischar(LocoFlags.ClosedOrbitType)
1125     <span class="keyword">if</span> strcmpi((LocoFlags.ClosedOrbitType),<span class="string">'fixedmomentum'</span>)
1126         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'CM'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1127         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'CPL'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1128     <span class="keyword">else</span> <span class="comment">%strcmpi((LocoFlags.ClosedOrbitType),'fixedpathlength')</span>
1129         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'CM'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1130         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'CPL'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1131     <span class="keyword">end</span>
1132 <span class="keyword">end</span>
1133 
1134 <span class="keyword">if</span> ischar(LocoFlags.ResponseMatrixMeasurement)
1135     <span class="keyword">if</span> strcmpi((LocoFlags.ResponseMatrixMeasurement),<span class="string">'bidirectional'</span>)
1136         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'RespMatBiDirectional'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1137         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'RespMatOneWay'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1138     <span class="keyword">else</span> <span class="comment">%strcmpi((LocoFlags.ResponseMatrixMeasurement),'oneway')</span>
1139         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'RespMatBiDirectional'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1140         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'RespMatOneWay'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1141     <span class="keyword">end</span>
1142 <span class="keyword">end</span>
1143 
1144 <span class="keyword">if</span> ischar(LocoFlags.DispersionMeasurement)
1145     <span class="keyword">if</span> strcmpi((LocoFlags.DispersionMeasurement),<span class="string">'bidirectional'</span>)
1146         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'DispBiDirectional'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1147         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'DispOneWay'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1148     <span class="keyword">else</span> <span class="comment">%strcmpi((LocoFlags.DispersionMeasurement),'oneway')</span>
1149         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'DispBiDirectional'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1150         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'DispOneWay'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1151     <span class="keyword">end</span>
1152 <span class="keyword">end</span>
1153 
1154 <span class="keyword">if</span> isfield(LocoFlags, <span class="string">'CalculateSigma'</span>)
1155     <span class="keyword">if</span> ischar(LocoFlags.CalculateSigma)
1156         <span class="keyword">if</span> strcmpi(LocoFlags.CalculateSigma, <span class="string">'Yes'</span>)
1157             set(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'ErrorBars'</span>),<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1158         <span class="keyword">else</span>
1159             set(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'ErrorBars'</span>),<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1160         <span class="keyword">end</span>
1161     <span class="keyword">end</span>
1162 <span class="keyword">end</span>
1163 
1164 <span class="keyword">if</span> isfield(LocoFlags, <span class="string">'SinglePrecision'</span>)
1165     <span class="keyword">if</span> ischar(LocoFlags.SinglePrecision)
1166         <span class="keyword">if</span> strcmpi(LocoFlags.SinglePrecision, <span class="string">'Yes'</span>)
1167             set(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'SinglePrecision'</span>),<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1168         <span class="keyword">else</span>
1169             set(findobj(gcf,<span class="string">'Tag'</span>,<span class="string">'SinglePrecision'</span>),<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1170         <span class="keyword">end</span>
1171     <span class="keyword">end</span>
1172 <span class="keyword">end</span>
1173 
1174 <span class="keyword">if</span> ~isempty(LocoFlags.SVDDataFileName) &amp;&amp; ischar(LocoFlags.SVDDataFileName)
1175     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1176     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Userdata'</span>,LocoFlags.SVDDataFileName);
1177     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Label'</span>,[<span class="string">'Save A,S,V,U,CovFit to File: '</span>, LocoFlags.SVDDataFileName]);
1178 <span class="keyword">else</span>
1179     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1180     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Userdata'</span>,[]);
1181     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Label'</span>,[<span class="string">'Save A,S,V,U,CovFit to File: '</span>, LocoFlags.SVDDataFileName]);
1182     set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SVD_FileName'</span>),<span class="string">'Label'</span>,[<span class="string">'Save A,S,V,U,CovFit to File'</span>]);
1183 <span class="keyword">end</span>
1184 
1185 <span class="keyword">if</span> ischar(FitParameters.FitRFFrequency)
1186     <span class="keyword">if</span> strcmpi((FitParameters.FitRFFrequency),<span class="string">'yes'</span>)
1187         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FitRF'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1188     <span class="keyword">else</span>
1189         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FitRF'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1190     <span class="keyword">end</span>
1191 <span class="keyword">end</span>
1192 
1193 <span class="keyword">if</span> ischar(BPMData.FitGains)
1194     <span class="keyword">if</span> strcmpi((BPMData.FitGains),<span class="string">'yes'</span>)
1195         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'BPMGains'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1196     <span class="keyword">else</span>
1197         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'BPMGains'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1198     <span class="keyword">end</span>
1199 <span class="keyword">end</span>
1200 
1201 <span class="keyword">if</span> ischar(BPMData.FitCoupling)
1202     <span class="keyword">if</span> strcmpi((BPMData.FitCoupling),<span class="string">'yes'</span>)
1203         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'BPMCoupling'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1204     <span class="keyword">else</span>
1205         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'BPMCoupling'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1206     <span class="keyword">end</span>
1207 <span class="keyword">end</span>
1208 
1209 <span class="keyword">if</span> ischar(CMData.FitKicks)
1210     <span class="keyword">if</span> strcmpi((CMData.FitKicks),<span class="string">'yes'</span>)
1211         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'CMKicks'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1212     <span class="keyword">else</span>
1213         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'CMKicks'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1214     <span class="keyword">end</span>
1215 <span class="keyword">end</span>
1216 
1217 <span class="keyword">if</span> ischar(CMData.FitCoupling)
1218     <span class="keyword">if</span> strcmpi((CMData.FitCoupling),<span class="string">'yes'</span>)
1219         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'CMRolls'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
1220     <span class="keyword">else</span>
1221         set(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'CMRolls'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
1222     <span class="keyword">end</span>
1223 <span class="keyword">end</span>
1224 
1225 
1226 <span class="comment">% --------------------------------------------------------------------</span>
1227 <a name="_sub20" href="#_subfunctions" class="code">function varargout = MenuAxes_Callback(h, eventdata, handles, varargin)</a>
1228 
1229 <span class="keyword">if</span> nargin &gt; 1
1230     setappdata(gcbf,<span class="string">'OtherParameterPlot1'</span>,[]);
1231     setappdata(gcbf,<span class="string">'OtherParameterPlot2'</span>,[]);
1232 <span class="keyword">end</span>
1233 
1234 TagString = get(h,<span class="string">'Userdata'</span>);            <span class="comment">% Axis tag is storage in the menu pulldown</span>
1235 PlotNumber = get(h,<span class="string">'Value'</span>);
1236 h_axis = findobj(gcbf,<span class="string">'Tag'</span>,TagString);
1237 axes(h_axis);
1238 <a href="#_sub21" class="code" title="subfunction locoplots(PlotNumber, FieldName)">locoplots</a>(PlotNumber);
1239 set(h_axis,<span class="string">'Tag'</span>,TagString);                 <span class="comment">% axes tag is lost if plot function is used</span>
1240 set(h_axis,<span class="string">'HandleVisibility'</span>,<span class="string">'Callback'</span>);   <span class="comment">% So no one else can plot to it.</span>
1241 <span class="comment">%axes(h_axis);</span>
1242 <span class="comment">%legend</span>
1243 <span class="comment">%set(gca,'Tag',TagString);                 % axes tag is lost if plot function is used</span>
1244 <span class="comment">%set(gca,'HandleVisibility','Callback');   % So no one else can plot to it.</span>
1245 
1246 
1247 <span class="comment">% -------------------------------------------------------------------</span>
1248 <a name="_sub21" href="#_subfunctions" class="code">function locoplots(PlotNumber, FieldName)</a>
1249 <span class="keyword">if</span> nargin &lt; 2
1250     FieldName = [];
1251 <span class="keyword">end</span>
1252 
1253 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
1254 <span class="keyword">if</span> isempty(LocoDataCell)
1255     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
1256     <span class="keyword">if</span> isempty(FileName)
1257         fprintf(<span class="string">'   File does not exist.\n'</span>);
1258         <span class="keyword">return</span>
1259     <span class="keyword">end</span>
1260     <span class="keyword">try</span>
1261         load(FileName);
1262     <span class="keyword">catch</span>
1263         fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
1264         cla;
1265         <span class="keyword">return</span>
1266     <span class="keyword">end</span>
1267 <span class="keyword">else</span>
1268     BPMData       = LocoDataCell{1};
1269     CMData        = LocoDataCell{2};
1270     LocoMeasData  = LocoDataCell{3};
1271     LocoModel     = LocoDataCell{4};
1272     FitParameters = LocoDataCell{5};
1273     LocoFlags     = LocoDataCell{6};
1274     RINGData      = LocoDataCell{7};
1275 <span class="keyword">end</span>
1276 
1277 i = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'Value'</span>);  <span class="comment">% The first point in the array is starting point</span>
1278 
1279 <span class="comment">% If the LocoModel does not exist, then compute it</span>
1280 <span class="comment">%if isempty(LocoModel(i).M) | isempty(LocoModel(i).Eta) | isempty(LocoModel(i).ChiSquare)</span>
1281 <span class="keyword">if</span> isempty(LocoModel(i).M) || isempty(LocoModel(i).ChiSquare)
1282     AxesTag = get(gca,<span class="string">'Tag'</span>);
1283     [LocoModel(i).M, LocoModel(i).Eta, LocoModel(i).ChiSquare] = <a href="#_sub24" class="code" title="subfunction [Mmodel, Dispersion, ChiSquare] = getmodelresponsematrix(BPMData, CMData, FitParameters, LocoFlags, LocoMeasData, RINGData)">getmodelresponsematrix</a>(BPMData(i), CMData(i), FitParameters(i), LocoFlags(i), LocoMeasData, RINGData);
1284     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
1285     save(FileName, <span class="string">'LocoModel'</span>, <span class="string">'FitParameters'</span>, <span class="string">'BPMData'</span>, <span class="string">'CMData'</span>, <span class="string">'RINGData'</span>, <span class="string">'LocoMeasData'</span>, <span class="string">'LocoFlags'</span>);
1286     setappdata(gcbf, <span class="string">'LocoDataCell'</span>, {BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
1287     set(gca, <span class="string">'Tag'</span>, AxesTag);
1288 <span class="keyword">end</span>
1289 
1290 <span class="comment">% Patch for a iteration zero bug fixed on 1-29-2004</span>
1291 NHBPM = length(BPMData(i).HBPMGoodDataIndex);
1292 NVBPM = length(BPMData(i).VBPMGoodDataIndex);
1293 NBPM  = NHBPM + NVBPM;
1294 NHCM = length(CMData(i).HCMGoodDataIndex);
1295 NVCM = length(CMData(i).VCMGoodDataIndex);
1296 <span class="keyword">if</span> any(size(LocoModel(i).M) ~= [NBPM NHCM+NVCM])
1297     AxesTag = get(gca,<span class="string">'Tag'</span>);
1298     [LocoModel(i).M, LocoModel(i).Eta, LocoModel(i).ChiSquare] = <a href="#_sub24" class="code" title="subfunction [Mmodel, Dispersion, ChiSquare] = getmodelresponsematrix(BPMData, CMData, FitParameters, LocoFlags, LocoMeasData, RINGData)">getmodelresponsematrix</a>(BPMData(i), CMData(i), FitParameters(i), LocoFlags(i), LocoMeasData, RINGData);
1299     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
1300     save(FileName, <span class="string">'LocoModel'</span>, <span class="string">'FitParameters'</span>, <span class="string">'BPMData'</span>, <span class="string">'CMData'</span>, <span class="string">'RINGData'</span>, <span class="string">'LocoMeasData'</span>, <span class="string">'LocoFlags'</span>);
1301     setappdata(gcbf, <span class="string">'LocoDataCell'</span>, {BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
1302     set(gca, <span class="string">'Tag'</span>, AxesTag);
1303 <span class="keyword">end</span>
1304 
1305 Mmodel = LocoModel(i).M;
1306 
1307 <span class="comment">% Clear content menu</span>
1308 set(gca, <span class="string">'UIContextMenu'</span>, []);
1309 
1310 legend off
1311 
1312 <span class="keyword">try</span>
1313 
1314     <span class="keyword">switch</span> PlotNumber
1315         <span class="keyword">case</span> 1
1316             plot([0 1],[0 1],<span class="string">'w'</span>);
1317             title(<span class="string">'LOCO Input Parameter'</span>);
1318             set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
1319             set(gca,<span class="string">'XTick'</span>,[]);
1320             set(gca,<span class="string">'YTick'</span>,[]);
1321 
1322             N = 1;
1323             <span class="keyword">if</span> exist(<span class="string">'LocoFlags'</span>,<span class="string">'var'</span>)
1324                 <span class="keyword">if</span> ~isempty(LocoFlags)
1325 
1326                     <span class="keyword">if</span> isfield(LocoFlags(i), <span class="string">'SinglePrecision'</span>)
1327                         <span class="keyword">if</span> ischar(LocoFlags(i).SinglePrecision)
1328                             text(2,N,sprintf(<span class="string">'Single Precision = %s'</span>, LocoFlags(i).SinglePrecision),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1329                             N = N + 1;
1330                         <span class="keyword">end</span>
1331                     <span class="keyword">end</span>
1332 
1333                     <span class="keyword">if</span> isfield(LocoFlags(i), <span class="string">'CalculateSigma'</span>)
1334                         <span class="keyword">if</span> ischar(LocoFlags(i).CalculateSigma)
1335                             text(2,N,sprintf(<span class="string">'Calculate Error Bars = %s'</span>, LocoFlags(i).CalculateSigma),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1336                             N = N + 1;
1337                         <span class="keyword">end</span>
1338                     <span class="keyword">end</span>
1339 
1340                     <span class="keyword">if</span> isfield(LocoFlags(i),<span class="string">'Dispersion'</span>)
1341                         text(2,N,sprintf(<span class="string">'Include Dispersion = %s'</span>, LocoFlags(i).Dispersion),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1342                         N = N + 1;
1343                     <span class="keyword">end</span>
1344                     <span class="keyword">if</span> isfield(LocoFlags(i),<span class="string">'AutoCorrectDelta'</span>)
1345                         text(2,N,sprintf(<span class="string">'Auto Correct Deltas = %s'</span>, LocoFlags(i).AutoCorrectDelta),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1346                         N = N + 1;
1347                     <span class="keyword">end</span>
1348                     <span class="keyword">if</span> isfield(LocoFlags(i),<span class="string">'Coupling'</span>)
1349                         text(2,N,sprintf(<span class="string">'Include Off-Diagonal Terms = %s'</span>, LocoFlags(i).Coupling),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1350                         N = N + 1;
1351                     <span class="keyword">end</span>
1352                     <span class="keyword">if</span> isfield(LocoFlags(i),<span class="string">'ResponseMatrixCalculator'</span>)
1353                         text(2,N,sprintf(<span class="string">'Response Matrix Calculator = %s'</span>, LocoFlags(i).ResponseMatrixCalculator),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1354                         N = N + 1;
1355                     <span class="keyword">end</span>
1356                     <span class="keyword">if</span> isfield(LocoFlags(i),<span class="string">'ClosedOrbitType'</span>)
1357                         text(2,N,sprintf(<span class="string">'Response Matrix Closed Orbit = %s'</span>, LocoFlags(i).ClosedOrbitType),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1358                         N = N + 1;
1359                     <span class="keyword">end</span>
1360                     <span class="keyword">if</span> isfield(LocoFlags(i),<span class="string">'SVmethod'</span>)
1361                         <span class="keyword">if</span> isempty(LocoFlags(i))
1362                             text(2,N,sprintf(<span class="string">'Singular Value Selection = '</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1363                         <span class="keyword">elseif</span> isempty(LocoFlags(i).SVmethod)
1364                             text(2,N,sprintf(<span class="string">'Singular Value Selection = Interactive'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1365                         <span class="keyword">elseif</span> strcmpi((LocoFlags(i).SVmethod),<span class="string">'rank'</span>)
1366                             text(2,N,sprintf(<span class="string">'Singular Value Selection = Rank'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1367                         <span class="keyword">elseif</span> length(LocoFlags(i).SVmethod) &gt; 1
1368                             text(2,N,sprintf(<span class="string">'Singular Value Selection = User Input'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1369                         <span class="keyword">else</span>
1370                             text(2,N,sprintf(<span class="string">'Singular Value Selection = Threshold (%f)'</span>,LocoFlags(i).Threshold),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1371                         <span class="keyword">end</span>
1372                         N = N + 1;
1373                     <span class="keyword">end</span>
1374                     <span class="keyword">if</span> isfield(LocoFlags(i),<span class="string">'Normalize'</span>)
1375                         text(2,N,sprintf(<span class="string">'Normalize = %s'</span>, LocoFlags(i).Normalize),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1376                         N = N + 1;
1377                     <span class="keyword">end</span>
1378                 <span class="keyword">end</span>
1379             <span class="keyword">end</span>
1380             <span class="keyword">if</span> isfield(FitParameters(i),<span class="string">'FitRFFrequency'</span>)
1381                 text(2,N,sprintf(<span class="string">'Fit RF Frequency = %s'</span>, FitParameters(i).FitRFFrequency),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1382                 N = N + 1;
1383             <span class="keyword">end</span>
1384             <span class="keyword">if</span> isfield(CMData(i),<span class="string">'FitVCMEnergyShift'</span>)
1385                 text(2,N,sprintf(<span class="string">'Fit Energy Shifts at VCM = %s'</span>, CMData(i).FitVCMEnergyShift),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1386                 N = N + 1;
1387             <span class="keyword">end</span>
1388             <span class="keyword">if</span> isfield(CMData(i),<span class="string">'FitHCMEnergyShift'</span>)
1389                 text(2,N,sprintf(<span class="string">'Fit Energy Shifts at HCM = %s'</span>, CMData(i).FitHCMEnergyShift),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1390                 N = N + 1;
1391             <span class="keyword">end</span>
1392             <span class="keyword">if</span> isfield(CMData(i),<span class="string">'FitKicks'</span>)
1393                 text(2,N,sprintf(<span class="string">'Fit Corrector Magnet Gains = %s'</span>, CMData(i).FitKicks),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1394                 N = N + 1;
1395             <span class="keyword">end</span>
1396             <span class="keyword">if</span> isfield(CMData(i),<span class="string">'FitCoupling'</span>)
1397                 text(2,N,sprintf(<span class="string">'Fit Corrector Magnet Rolls = %s'</span>, CMData(i).FitCoupling),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1398                 N = N + 1;
1399             <span class="keyword">end</span>
1400             <span class="keyword">if</span> isfield(BPMData(i),<span class="string">'FitGains'</span>)
1401                 text(2,N,sprintf(<span class="string">'Fit BPM Gains = %s'</span>, BPMData(i).FitGains),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1402                 N = N + 1;
1403             <span class="keyword">end</span>
1404             <span class="keyword">if</span> isfield(BPMData(i),<span class="string">'FitCoupling'</span>)
1405                 text(2,N,sprintf(<span class="string">'Fit BPM Coupling = %s'</span>, BPMData(i).FitCoupling),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1406                 N = N + 1;
1407             <span class="keyword">end</span>
1408             <span class="keyword">if</span> isfield(CMData(i),<span class="string">'VCMGoodDataIndex'</span>)
1409                 text(2,N,sprintf(<span class="string">'%d horizontal %d vertical CMs'</span>, length(CMData(i).HCMGoodDataIndex), length(CMData(i).VCMGoodDataIndex)),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1410                 N = N + 1;
1411             <span class="keyword">end</span>
1412             <span class="keyword">if</span> isfield(BPMData(i),<span class="string">'HBPMGoodDataIndex'</span>)
1413                 text(2,N,sprintf(<span class="string">'%d horizontal %d vertical BPMs'</span>, length(BPMData(i).HBPMGoodDataIndex), length(BPMData(i).VBPMGoodDataIndex)),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1414                 N = N + 1;
1415             <span class="keyword">end</span>
1416 
1417         <span class="keyword">case</span> 2
1418             x = 1:length(CMData(i).HCMKicks);
1419             <span class="keyword">if</span> isempty(CMData(i).HCMKicksSTD)
1420                 plot(x(CMData(i).HCMGoodDataIndex), CMData(i).HCMKicks(CMData(i).HCMGoodDataIndex));
1421             <span class="keyword">else</span>
1422                 errorbar(x(CMData(i).HCMGoodDataIndex), CMData(i).HCMKicks(CMData(i).HCMGoodDataIndex), CMData(i).HCMKicksSTD(CMData(i).HCMGoodDataIndex));
1423             <span class="keyword">end</span>
1424             title(sprintf(<span class="string">'Corrector Magnet Parameter Fits (%d)'</span>,length(CMData(i).HCMKicks(CMData(i).HCMGoodDataIndex))));
1425             ylabel(<span class="string">'Horizontal Kick [mrad]'</span>);
1426             xlabel(<span class="string">'Horizontal Corrector Number'</span>);
1427             axis tight
1428 
1429         <span class="keyword">case</span> 3
1430             x = 1:length(CMData(i).VCMKicks);
1431             <span class="keyword">if</span> isempty(CMData(i).VCMKicksSTD)
1432                 plot(x(CMData(i).VCMGoodDataIndex), CMData(i).VCMKicks(CMData(i).VCMGoodDataIndex));
1433             <span class="keyword">else</span>
1434                 errorbar(x(CMData(i).VCMGoodDataIndex), CMData(i).VCMKicks(CMData(i).VCMGoodDataIndex), CMData(i).VCMKicksSTD(CMData(i).VCMGoodDataIndex));
1435             <span class="keyword">end</span>
1436             title(sprintf(<span class="string">'Corrector Magnet Parameter Fits (%d)'</span>,length(CMData(i).VCMKicks(CMData(i).VCMGoodDataIndex))));
1437             ylabel(<span class="string">'Vertical Kick [mrad]'</span>);
1438             xlabel(<span class="string">'Vertical Corrector Number'</span>);
1439             axis tight;
1440 
1441         <span class="keyword">case</span> 4
1442             <span class="keyword">if</span> ~isempty(CMData(i).HCMCoupling)
1443                 x = 1:length(CMData(i).HCMCoupling);
1444                 <span class="keyword">if</span> isempty(CMData(i).HCMCouplingSTD)
1445                     plot(x(CMData(i).HCMGoodDataIndex), CMData(i).HCMCoupling(CMData(i).HCMGoodDataIndex));
1446                 <span class="keyword">else</span>
1447                     errorbar(x(CMData(i).HCMGoodDataIndex), CMData(i).HCMCoupling(CMData(i).HCMGoodDataIndex), CMData(i).HCMCouplingSTD(CMData(i).HCMGoodDataIndex));
1448                 <span class="keyword">end</span>
1449                 title(sprintf(<span class="string">'Corrector Magnet Parameter Fits (%d)'</span>,length(CMData(i).HCMCoupling(CMData(i).HCMGoodDataIndex))));
1450                 ylabel(<span class="string">'Horizontal Coupling'</span>);
1451                 xlabel(<span class="string">'Horizontal Corrector Number'</span>);
1452                 axis tight
1453             <span class="keyword">else</span>
1454                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1455             <span class="keyword">end</span>
1456 
1457         <span class="keyword">case</span> 5
1458             <span class="keyword">if</span> ~isempty(CMData(i).VCMCoupling)
1459                 x = 1:length(CMData(i).VCMCoupling);
1460                 <span class="keyword">if</span> isempty(CMData(i).VCMCouplingSTD)
1461                     plot(x(CMData(i).VCMGoodDataIndex), CMData(i).VCMCoupling(CMData(i).VCMGoodDataIndex));
1462                 <span class="keyword">else</span>
1463                     errorbar(x(CMData(i).VCMGoodDataIndex), CMData(i).VCMCoupling(CMData(i).VCMGoodDataIndex), CMData(i).VCMCouplingSTD(CMData(i).VCMGoodDataIndex));
1464                 <span class="keyword">end</span>
1465                 title(sprintf(<span class="string">'Corrector Magnet Parameter Fits (%d)'</span>,length(CMData(i).VCMCoupling(CMData(i).VCMGoodDataIndex))));
1466                 ylabel(<span class="string">'Vertical Coupling'</span>);
1467                 xlabel(<span class="string">'Vertical Corrector Number'</span>);
1468                 axis tight;
1469             <span class="keyword">else</span>
1470                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1471             <span class="keyword">end</span>
1472 
1473         <span class="keyword">case</span> 6
1474             <span class="keyword">if</span> ~isempty(CMData(i).HCMEnergyShift)
1475                 x = 1:length(CMData(i).HCMEnergyShift);
1476                 <span class="keyword">if</span> isempty(CMData(i).HCMEnergyShiftSTD)
1477                     plot(x(CMData(i).HCMGoodDataIndex), CMData(i).HCMEnergyShift(CMData(i).HCMGoodDataIndex));
1478                 <span class="keyword">else</span>
1479                     errorbar(x(CMData(i).HCMGoodDataIndex), CMData(i).HCMEnergyShift(CMData(i).HCMGoodDataIndex), CMData(i).HCMEnergyShiftSTD(CMData(i).HCMGoodDataIndex));
1480                 <span class="keyword">end</span>
1481                 title(sprintf(<span class="string">'Corrector Magnet Parameter Fits (%d)'</span>,length(CMData(i).HCMEnergyShift(CMData(i).HCMGoodDataIndex))));
1482                 ylabel(<span class="string">'Horizontal Energy Shift'</span>);
1483                 xlabel(<span class="string">'Horizontal Corrector Number'</span>);
1484                 axis tight
1485             <span class="keyword">else</span>
1486                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1487             <span class="keyword">end</span>
1488 
1489         <span class="keyword">case</span> 7
1490             <span class="keyword">if</span> ~isempty(CMData(i).VCMEnergyShift)
1491                 x = 1:length(CMData(i).VCMEnergyShift);
1492                 <span class="keyword">if</span> isempty(CMData(i).VCMEnergyShiftSTD)
1493                     plot(x(CMData(i).VCMGoodDataIndex), CMData(i).VCMEnergyShift(CMData(i).VCMGoodDataIndex));
1494                 <span class="keyword">else</span>
1495                     errorbar(x(CMData(i).VCMGoodDataIndex), CMData(i).VCMEnergyShift(CMData(i).VCMGoodDataIndex), CMData(i).VCMEnergyShiftSTD(CMData(i).VCMGoodDataIndex));
1496                 <span class="keyword">end</span>
1497                 title(sprintf(<span class="string">'Corrector Magnet Parameter Fits (%d)'</span>,length(CMData(i).VCMEnergyShift(CMData(i).VCMGoodDataIndex))));
1498                 ylabel(<span class="string">'Vertical Energy Shift'</span>);
1499                 xlabel(<span class="string">'Vertical Corrector Number'</span>);
1500                 axis tight
1501             <span class="keyword">else</span>
1502                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1503             <span class="keyword">end</span>
1504 
1505         <span class="keyword">case</span> 8
1506             x = 1:length(BPMData(i).HBPMGain);
1507             <span class="keyword">if</span> isempty(BPMData(i).HBPMGainSTD)
1508                 plot(x(BPMData(i).HBPMGoodDataIndex), BPMData(i).HBPMGain(BPMData(i).HBPMGoodDataIndex));
1509             <span class="keyword">else</span>
1510                 errorbar(x(BPMData(i).HBPMGoodDataIndex), BPMData(i).HBPMGain(BPMData(i).HBPMGoodDataIndex), BPMData(i).HBPMGainSTD(BPMData(i).HBPMGoodDataIndex));
1511             <span class="keyword">end</span>
1512             title(sprintf(<span class="string">'BPM Parameter Fits (%d)'</span>,length(BPMData(i).HBPMGain(BPMData(i).HBPMGoodDataIndex))));
1513             ylabel(<span class="string">'BPMx Gain'</span>);
1514             xlabel(<span class="string">'Horizontal BPM Number'</span>);
1515             axis tight
1516 
1517         <span class="keyword">case</span> 9
1518             x = 1:length(BPMData(i).VBPMGain);
1519             <span class="keyword">if</span> isempty(BPMData(i).VBPMGainSTD)
1520                 plot(x(BPMData(i).VBPMGoodDataIndex), BPMData(i).VBPMGain(BPMData(i).VBPMGoodDataIndex));
1521             <span class="keyword">else</span>
1522                 errorbar(x(BPMData(i).VBPMGoodDataIndex), BPMData(i).VBPMGain(BPMData(i).VBPMGoodDataIndex), BPMData(i).VBPMGainSTD(BPMData(i).VBPMGoodDataIndex));
1523             <span class="keyword">end</span>
1524             title(sprintf(<span class="string">'BPM Parameter Fits (%d)'</span>,length(BPMData(i).VBPMGain(BPMData(i).VBPMGoodDataIndex))));
1525             ylabel(<span class="string">'BPMy Gain'</span>);
1526             xlabel(<span class="string">'Vertical BPM Number'</span>);
1527             axis tight;
1528 
1529         <span class="keyword">case</span> 10
1530             x = 1:length(BPMData(i).HBPMCoupling);
1531             <span class="keyword">if</span> ~isempty(BPMData(i).HBPMCoupling)
1532                 <span class="keyword">if</span> isempty(BPMData(i).HBPMCouplingSTD)
1533                     plot(x(BPMData(i).HBPMGoodDataIndex), BPMData(i).HBPMCoupling(BPMData(i).HBPMGoodDataIndex));
1534                 <span class="keyword">else</span>
1535                     errorbar(x(BPMData(i).HBPMGoodDataIndex), BPMData(i).HBPMCoupling(BPMData(i).HBPMGoodDataIndex), BPMData(i).HBPMCouplingSTD(BPMData(i).HBPMGoodDataIndex));
1536                 <span class="keyword">end</span>
1537                 title(sprintf(<span class="string">'BPM Parameter Fits (%d)'</span>,length(BPMData(i).HBPMCoupling(BPMData(i).HBPMGoodDataIndex))));
1538                 ylabel(<span class="string">'BPMx Coupling'</span>);
1539                 xlabel(<span class="string">'Horizontal BPM Number'</span>);
1540                 axis tight
1541             <span class="keyword">else</span>
1542                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1543             <span class="keyword">end</span>
1544 
1545         <span class="keyword">case</span> 11
1546             x = 1:length(BPMData(i).VBPMCoupling);
1547             <span class="keyword">if</span> ~isempty(BPMData(i).VBPMCoupling)
1548                 <span class="keyword">if</span> isempty(BPMData(i).VBPMCouplingSTD)
1549                     plot(x(BPMData(i).VBPMGoodDataIndex), BPMData(i).VBPMCoupling(BPMData(i).VBPMGoodDataIndex));
1550                 <span class="keyword">else</span>
1551                     errorbar(x(BPMData(i).VBPMGoodDataIndex), BPMData(i).VBPMCoupling(BPMData(i).VBPMGoodDataIndex), BPMData(i).VBPMCouplingSTD(BPMData(i).VBPMGoodDataIndex));
1552                 <span class="keyword">end</span>
1553                 title(sprintf(<span class="string">'BPM Parameter Fits (%d)'</span>,length(BPMData(i).VBPMCoupling(BPMData(i).VBPMGoodDataIndex))));
1554                 ylabel(<span class="string">'BPMy Coupling'</span>);
1555                 xlabel(<span class="string">'Vertical BPM Number'</span>);
1556                 axis tight;
1557             <span class="keyword">else</span>
1558                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1559             <span class="keyword">end</span>
1560 
1561         <span class="keyword">case</span> 12
1562             <span class="comment">% HBPM Standard Deviations</span>
1563             BPMstd = LocoMeasData.BPMSTD(BPMData(i).HBPMGoodDataIndex);
1564 
1565             <span class="comment">%BPMstd = LocoMeasData.BPMSTD([BPMData(i).HBPMGoodDataIndex length(BPMData(i).HBPMIndex)+BPMData(i).VBPMGoodDataIndex]);</span>
1566             <span class="comment">%if ~isempty(BPMstd)</span>
1567             <span class="comment">%    plot(BPMstd)</span>
1568             <span class="comment">%    ylabel('Standard Deviation [mm]');</span>
1569             <span class="comment">%    axis tight</span>
1570             <span class="comment">%</span>
1571             <span class="comment">%    % Change label to BPM numbers</span>
1572             <span class="comment">%    Nx = length(BPMstd);</span>
1573             <span class="comment">%    Ticks = 1:ceil(Nx/10):Nx;</span>
1574             <span class="comment">%    set(gca, 'XTick', Ticks);</span>
1575             <span class="comment">%    TickNumber = [BPMData(i).HBPMGoodDataIndex BPMData(i).VBPMGoodDataIndex];</span>
1576             <span class="comment">%    TickNumber = TickNumber(Ticks);</span>
1577             <span class="comment">%    set(gca, 'XTickLabel', num2cell(TickNumber));</span>
1578             <span class="comment">%    xlabel('HBPM# and VBPM#');</span>
1579             <span class="comment">%end</span>
1580 
1581             <span class="keyword">if</span> ~isempty(BPMstd)
1582                 plot(BPMstd);
1583                 title(<span class="string">'Horizontal BPM Standard Deviations'</span>);
1584                 ylabel(<span class="string">'Standard Deviation [mm]'</span>);
1585                 xlabel(<span class="string">'BPM Number'</span>);
1586                 axis tight
1587             <span class="keyword">end</span>
1588 
1589         <span class="keyword">case</span> 13
1590             <span class="comment">% VBPM Standard Deviations</span>
1591             BPMstd = LocoMeasData.BPMSTD(length(BPMData(i).HBPMIndex)+BPMData(i).VBPMGoodDataIndex);
1592 
1593             <span class="keyword">if</span> ~isempty(BPMstd)
1594                 plot(BPMstd);
1595                 title(<span class="string">'Vertical BPM Standard Deviations'</span>);
1596                 ylabel(<span class="string">'Standard Deviation [mm]'</span>);
1597                 xlabel(<span class="string">'BPM Number'</span>);
1598                 axis tight
1599             <span class="keyword">end</span>
1600 
1601         <span class="keyword">case</span> 14
1602             <span class="keyword">if</span> isempty(FitParameters(i).DeltaRF)
1603                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1604             <span class="keyword">else</span>
1605                 plot([0 1],[0 1],<span class="string">'w'</span>);
1606                 title(<span class="string">'RF Frequency'</span>);
1607                 set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
1608                 set(gca,<span class="string">'XTick'</span>,[]);
1609                 set(gca,<span class="string">'YTick'</span>,[]);
1610                 text(4,10,sprintf(<span class="string">'Dispersion Measurement'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1611                 text(4,9,sprintf(<span class="string">'RF Frequency Change:'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1612                 text(4,8,sprintf(<span class="string">'%8.3f Hz Measured'</span>,  LocoMeasData.DeltaRF),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1613                 text(4,7,sprintf(<span class="string">'%8.3f Hz Model'</span>, FitParameters(i).DeltaRF),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1614 
1615                 text(4,6,sprintf(<span class="string">'%10.5f Hz \\sigma-Model'</span>, FitParameters(i).DeltaRFSTD),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1616                 <span class="keyword">if</span> isfield(FitParameters(i),<span class="string">'FitRFFrequency'</span>)
1617                     text(4,5,sprintf(<span class="string">'Fit Delta RF Frequency = %s'</span>, FitParameters(i).FitRFFrequency),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1618                 <span class="keyword">end</span>
1619                 <span class="keyword">if</span> isfield(LocoMeasData,<span class="string">'RF'</span>)
1620                     text(4,3,sprintf(<span class="string">'RF Frequency = %.1f Hz (Measured)'</span>, LocoMeasData.RF),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1621                 <span class="keyword">end</span>
1622                 <span class="keyword">if</span> isfield(RINGData,<span class="string">'CavityFrequency'</span>)
1623                     text(4,2,sprintf(<span class="string">'RF Frequency = %.1f Hz (Model)'</span>, RINGData.CavityFrequency'),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1624                 <span class="keyword">end</span>
1625             <span class="keyword">end</span>
1626 
1627         <span class="keyword">case</span> 15
1628             <span class="comment">% Other parameters</span>
1629             <span class="keyword">if</span> isempty(FitParameters(i).Values)
1630                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1631                 <span class="keyword">return</span>;
1632             <span class="keyword">elseif</span> length(FitParameters(i).Values) &gt; 1
1633                 ATFlag = 0;
1634                 <span class="keyword">if</span> iscell(RINGData.Lattice)
1635                     <span class="keyword">if</span> isfield(RINGData.Lattice{1},<span class="string">'FamName'</span>)
1636                         ATFlag = 1;
1637                     <span class="keyword">end</span>
1638                 <span class="keyword">end</span>
1639 
1640                 AxesTag = get(gca,<span class="string">'Tag'</span>);
1641                 <span class="keyword">if</span> strcmp(AxesTag,<span class="string">'Axes1'</span>)
1642                     FieldName = getappdata(gcbf,<span class="string">'OtherParameterPlot1'</span>);
1643                 <span class="keyword">elseif</span> strcmp(AxesTag,<span class="string">'Axes2'</span>)
1644                     FieldName = getappdata(gcbf,<span class="string">'OtherParameterPlot2'</span>);
1645                 <span class="keyword">end</span>
1646 
1647                 <span class="keyword">if</span> isempty(FieldName) || strcmp(FieldName, <span class="string">'All'</span>)
1648                     <span class="keyword">if</span> isempty(FitParameters(i).ValuesSTD)
1649                         plot(1:length(FitParameters(i).Values), FitParameters(i).Values);
1650                     <span class="keyword">else</span>
1651                         errorbar(1:length(FitParameters(i).Values), FitParameters(i).Values, FitParameters(i).ValuesSTD);
1652                     <span class="keyword">end</span>
1653                     title(<span class="string">'LOCO Parameter Fits'</span>);
1654                     ylabel(<span class="string">''</span>);
1655                     xlabel(<span class="string">'Parameter Number'</span>);
1656                     axis tight
1657                     fprintf(<span class="string">'   Right click in the axis to select different parameter plots.\n'</span>);
1658 
1659                 <span class="keyword">else</span>
1660                     Values=[]; ValuesSTD=[];
1661                     <span class="keyword">for</span> j = 1:length(FitParameters(i).Params)
1662                         <span class="keyword">if</span> ATFlag
1663                             Name = RINGData.Lattice{FitParameters(i).Params{j}(1).ElemIndex}.FamName;
1664                         <span class="keyword">else</span>
1665                             Name = FitParameters(i).Params{j}(1).FieldName;
1666                         <span class="keyword">end</span>
1667                         <span class="keyword">if</span> strcmp(Name, FieldName)
1668                             Values = [Values FitParameters(i).Values(j)];
1669                             <span class="keyword">if</span> isempty(FitParameters(i).ValuesSTD)
1670                                 ValuesSTD = [];
1671                             <span class="keyword">else</span>
1672                                 ValuesSTD = [ValuesSTD FitParameters(i).ValuesSTD(j)];
1673                             <span class="keyword">end</span>
1674                         <span class="keyword">end</span>
1675                     <span class="keyword">end</span>
1676                     <span class="keyword">if</span> isempty(ValuesSTD)
1677                         plot(1:length(Values), Values);
1678                     <span class="keyword">else</span>
1679                         errorbar(1:length(Values), Values, ValuesSTD);
1680                     <span class="keyword">end</span>
1681                     title([<span class="string">'LOCO Parameter Fits for Field: '</span>, FieldName]);
1682                     ylabel(<span class="string">''</span>);
1683                     xlabel(<span class="string">'Parameter Number'</span>);
1684                     axis tight
1685                 <span class="keyword">end</span>
1686 
1687                 <span class="comment">% Add a context menu</span>
1688                 hcmenu = uicontextmenu;
1689 
1690                 <span class="comment">% Define the line and associate it with the context menu</span>
1691                 set(gca, <span class="string">'UIContextMenu'</span>, hcmenu);
1692 
1693                 <span class="comment">% Define the context menu items</span>
1694                 cb = <span class="string">'locogui(''ContextMenuPlot_Callback'',gcbo,[],[])'</span>;
1695                 h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'All'</span>, <span class="string">'Callback'</span>, cb);
1696                 set(h,<span class="string">'Userdata'</span>,<span class="string">'All'</span>);
1697                 <span class="keyword">if</span> ATFlag
1698                     <span class="comment">% When using the AT model this will work</span>
1699                     j = 1;
1700                     cb = <span class="string">'locogui(''ContextMenuPlot_Callback'',gcbo,[],[])'</span>;
1701                     NameNew = RINGData.Lattice{FitParameters(i).Params{j}(1).ElemIndex}.FamName;
1702                     h = uimenu(hcmenu, <span class="string">'Label'</span>, NameNew, <span class="string">'Callback'</span>, cb);
1703                     set(h,<span class="string">'Userdata'</span>,NameNew);
1704                     Names{1} = NameNew;
1705                     <span class="keyword">for</span> j = 2:length(FitParameters(i).Params)
1706                         NameNew = RINGData.Lattice{FitParameters(i).Params{j}(1).ElemIndex}.FamName;
1707                         <span class="keyword">if</span> ~any(strcmp(NameNew, Names))
1708                             Names{end+1} = NameNew;
1709                             cb = <span class="string">'locogui(''ContextMenuPlot_Callback'',gcbo,[],[])'</span>;
1710                             h = uimenu(hcmenu, <span class="string">'Label'</span>, NameNew, <span class="string">'Callback'</span>, cb);
1711                             set(h,<span class="string">'Userdata'</span>,NameNew);
1712                         <span class="keyword">end</span>
1713                     <span class="keyword">end</span>
1714                 <span class="keyword">else</span>
1715                     <span class="comment">% Base names on paramgroup</span>
1716                     j = 1;
1717                     cb = <span class="string">'locogui(''ContextMenuPlot_Callback'',gcbo,[],[])'</span>;
1718                     h = uimenu(hcmenu, <span class="string">'Label'</span>, FitParameters(i).Params{1}(1).FieldName, <span class="string">'Callback'</span>, cb);
1719                     set(h,<span class="string">'Userdata'</span>,FitParameters(i).Params{j}(1).FieldName);
1720                     <span class="keyword">for</span> j = 2:length(FitParameters(i).Params)
1721                         <span class="keyword">if</span> ~strcmp(FitParameters(i).Params{j}(1).FieldName, FitParameters(i).Params{j-1}(1).FieldName)
1722                             cb = <span class="string">'locogui(''ContextMenuPlot_Callback'',gcbo,[],[])'</span>;
1723                             h = uimenu(hcmenu, <span class="string">'Label'</span>, FitParameters(i).Params{j}(1).FieldName, <span class="string">'Callback'</span>, cb);
1724                             set(h,<span class="string">'Userdata'</span>,FitParameters(i).Params{j}(1).FieldName);
1725                         <span class="keyword">end</span>
1726                     <span class="keyword">end</span>
1727                 <span class="keyword">end</span>
1728 
1729             <span class="keyword">else</span>
1730                 plot([0 1],[0 1],<span class="string">'w'</span>);
1731                 title(<span class="string">'LOCO Parameter Fits'</span>);
1732                 set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
1733                 set(gca,<span class="string">'XTick'</span>,[]);
1734                 set(gca,<span class="string">'YTick'</span>,[]);
1735                 text(4,6,sprintf(<span class="string">'Parameter Fit #1'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1736                 text(4,5,sprintf(<span class="string">'Value = %f'</span>, FitParameters(i).Values),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1737                 text(4,4,sprintf(<span class="string">'\\sigma = %f'</span>, FitParameters(i).ValuesSTD),<span class="string">'units'</span>,<span class="string">'characters'</span>);
1738                 <span class="comment">%text(.05,.6,sprintf('Parameter Fit #1:  Value = %f, \\sigma = %f', FitParameters(i).Values, FitParameters(i).Values));</span>
1739             <span class="keyword">end</span>
1740 
1741         <span class="keyword">case</span> 16
1742             <span class="comment">% Plot delta chi^2</span>
1743             <a href="plotlocochi2.html" class="code" title="function [dchi2quad, chi2_par, chi2_bpm, chi2_cm, chi2_min, chi2_0] = plotlocochi2(varargin)">plotlocochi2</a>(BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData, i-1, <span class="string">'Display'</span>);
1744 
1745         <span class="keyword">case</span> 17
1746             <span class="keyword">if</span> ~exist(<span class="string">'LocoModel'</span>,<span class="string">'var'</span>)
1747                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1748                 <span class="keyword">return</span>
1749             <span class="keyword">end</span>
1750             <span class="keyword">if</span> ~isempty(LocoModel(i).SValues)
1751                 SValues = LocoModel(i).SValues;
1752                 Ivec = LocoModel(i).SValuesIndex;
1753 
1754                 semilogy(SValues,<span class="string">'b'</span>);
1755                 hold on;
1756                 semilogy(Ivec, SValues(Ivec),<span class="string">'og'</span>,<span class="string">'MarkerSize'</span>,2);
1757                 axis([1 length(SValues) min(SValues) max(SValues)]);
1758 
1759                 x=1:length(SValues);
1760                 x(Ivec)=[];
1761                 SValues(Ivec)=[];
1762                 semilogy(x, SValues,<span class="string">'xr'</span>,<span class="string">'MarkerSize'</span>,4);
1763                 hold off
1764 
1765                 title(<span class="string">'Singular Values'</span>);
1766                 xlabel(<span class="string">'Singular Value Number'</span>);
1767                 ylabel(<span class="string">'Magnitude'</span>);
1768             <span class="keyword">else</span>
1769                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1770             <span class="keyword">end</span>
1771 
1772         <span class="keyword">case</span> 18
1773             <span class="comment">% Response matrix plot</span>
1774 
1775             AxesTag = get(gca,<span class="string">'Tag'</span>);
1776             <span class="keyword">if</span> strcmp(AxesTag,<span class="string">'Axes1'</span>)
1777                 h = findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SurfPlot1'</span>);
1778                 FieldName = get(h,<span class="string">'Userdata'</span>);
1779             <span class="keyword">elseif</span> strcmp(AxesTag,<span class="string">'Axes2'</span>)
1780                 h = findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SurfPlot2'</span>);
1781                 FieldName = get(h,<span class="string">'Userdata'</span>);
1782             <span class="keyword">end</span>
1783 
1784             <span class="keyword">if</span> ~iscell(FieldName)
1785                 FieldName = {<span class="string">'Model'</span>, <span class="string">'All'</span>};
1786                 <span class="comment">%FieldName = {'Measured', 'All'};</span>
1787                 fprintf(<span class="string">'   Right click in the axis to select different plots.\n'</span>);
1788             <span class="keyword">else</span>
1789                 <span class="comment">% Force the field to Model when a new file or one of the pulldown menus is selected</span>
1790                 <span class="comment">%FieldName = {'Model', 'All'};</span>
1791             <span class="keyword">end</span>
1792 
1793 
1794             PlotString  = FieldName{1};
1795             PlaneString = FieldName{2};
1796             <span class="keyword">if</span> length(FieldName) &gt; 2
1797                 ElementsInput = FieldName{3};
1798             <span class="keyword">else</span>
1799                 ElementsInput = [];
1800             <span class="keyword">end</span>
1801 
1802             set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1803             FieldName{3} = <a href="locoplot.html" class="code" title="function ElementsInput = locoplot(FileName, IterationNumber, PlotString, PlaneString, ElementsInput)">locoplot</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, PlotString, PlaneString, ElementsInput);
1804             <span class="comment">% if isempty(Mmodel)</span>
1805             <span class="comment">%     set(gca,'XTick',[]); set(gca,'YTick',[]); cla; title(' '); xlabel(' '); ylabel(' ');</span>
1806             <span class="comment">%     return</span>
1807             <span class="comment">% end</span>
1808             set(h,<span class="string">'Userdata'</span>, FieldName);
1809 
1810 
1811             <span class="comment">% Define the context menu items for surf plot</span>
1812             hcmenu = uicontextmenu(<span class="string">'Tag'</span>,<span class="string">'3dsurfplot'</span>);
1813             set(gca, <span class="string">'UIContextMenu'</span>, hcmenu);
1814 
1815             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 3-D, All'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1816             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'All'</span>});
1817             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 3-D, HBPM vs HCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1818             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'XX'</span>});
1819             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 3-D, HBPM vs VCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1820             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'XY'</span>});
1821             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 3-D, VBPM vs VCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1822             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'YY'</span>});
1823             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 3-D, VBPM vs HCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1824             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'YX'</span>});
1825 
1826             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 2-D, HBPM (Rows)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1827             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'HBPM'</span>});
1828             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 2-D, VBPM (Rows)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1829             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'VBPM'</span>});
1830             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 2-D, HCM (Columns)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1831             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'HCM'</span>});
1832             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model: 2-D, VCM (Columns)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1833             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model'</span>,<span class="string">'VCM'</span>});
1834 
1835             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">' '</span>, <span class="string">'Callback'</span>, <span class="string">''</span>);
1836 
1837             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 3-D, All'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1838             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'All'</span>});
1839             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 3-D, HBPM vs HCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1840             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'XX'</span>});
1841             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 3-D, HBPM vs VCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1842             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'XY'</span>});
1843             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 3-D, VBPM vs VCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1844             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'YY'</span>});
1845             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 3-D, VBPM vs HCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1846             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'YX'</span>});
1847 
1848             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 2-D, HBPM (Rows)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1849             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'HBPM'</span>});
1850             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 2-D, VBPM (Rows)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1851             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'VBPM'</span>});
1852             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 2-D, HCM (Columns)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1853             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'HCM'</span>});
1854             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Measured: 2-D, VCM (Columns)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1855             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Measured'</span>,<span class="string">'VCM'</span>});
1856 
1857             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">' '</span>, <span class="string">'Callback'</span>, <span class="string">''</span>);
1858 
1859             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 3-D, All'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1860             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'All'</span>});
1861             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 3-D, HBPM vs HCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1862             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'XX'</span>});
1863             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 3-D, HBPM vs VCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1864             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'XY'</span>});
1865             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 3-D, VBPM vs VCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1866             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'YY'</span>});
1867             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 3-D, VBPM vs HCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1868             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'YX'</span>});
1869             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 2-D, HBPM (Rows)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1870             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'HBPM'</span>});
1871             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 2-D, VBPM (Rows)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1872             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'VBPM'</span>});
1873             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 2-D, HCM (Columns)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1874             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'HCM'</span>});
1875             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured: 2-D, VCM (Columns)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1876             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured'</span>,<span class="string">'VCM'</span>});
1877 
1878             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">' '</span>, <span class="string">'Callback'</span>, <span class="string">''</span>);
1879 
1880             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 3-D, All'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1881             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'All'</span>});
1882             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 3-D, HBPM vs HCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1883             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'XX'</span>});
1884             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 3-D, HBPM vs VCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1885             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'XY'</span>});
1886             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 3-D, VBPM vs VCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1887             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'YY'</span>});
1888             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 3-D, VBPM vs HCM'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1889             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'YX'</span>});
1890             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 2-D, HBPM (Rows)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1891             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'HBPM'</span>});
1892             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 2-D, VBPM (Rows)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1893             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'VBPM'</span>});
1894             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 2-D, HCM (Columns)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1895             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'HCM'</span>});
1896             h = uimenu(hcmenu, <span class="string">'Label'</span>, <span class="string">'Model-Measured+EnergyShifts: 2-D, VCM (Columns)'</span>, <span class="string">'Callback'</span>, <span class="string">'locogui(''ContextMenuSurfPlot_Callback'',gcbo,[],[])'</span>);
1897             set(h,<span class="string">'Userdata'</span>,{<span class="string">'Model-Measured+EnergyShifts'</span>,<span class="string">'VCM'</span>});
1898 
1899         <span class="keyword">case</span> 19
1900             <span class="comment">% Error function histogram</span>
1901             plot(0,0); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1902 
1903             ErrorFunction = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, <span class="string">'ErrorDistribution'</span>);
1904             <span class="keyword">if</span> ~isempty(ErrorFunction)
1905                 hist(ErrorFunction,2000);
1906                 xlabel(<span class="string">'Error in Units of Standard Deviations'</span>);
1907                 ylabel([<span class="string">'Number of Points ('</span>,num2str(length(ErrorFunction)),<span class="string">' total points)'</span>]);
1908                 <span class="comment">%title(texlabel(['Histogram: (M_meas - M_model)']));</span>
1909                 title(texlabel([<span class="string">'Histogram: (M_meas - M_model) / sigma_bpm'</span>]));
1910                 <span class="comment">%title(texlabel(['Histogram: (M_meas - M_model)^2 / sigma^2_bpm']));</span>
1911 
1912                 a = axis;
1913                 axis([a(1)-(a(2)-a(1))/60 a(2) a(3) a(4)]);
1914                 <span class="comment">%OutlierFactor = LocoFlags(i).OutlierFactor;</span>
1915             <span class="keyword">end</span>
1916 
1917         <span class="keyword">case</span> 20
1918             <span class="comment">% Horizontal dispersion function</span>
1919             plot(0,0); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
1920 
1921             <span class="keyword">if</span> 1
1922                 <span class="comment">% Only plotting horizontal dispersion</span>
1923                 NHBPM = length(BPMData(i).HBPMGoodDataIndex);
1924                 x = 1:length(BPMData(i).HBPMIndex);
1925                 x = x(BPMData(i).HBPMGoodDataIndex);
1926 
1927                 <span class="keyword">if</span> isempty(LocoModel(i).Eta)
1928                     EtaModel = NaN*ones(size(x))';
1929                     fprintf(<span class="string">'   Model dispersion is empty.\n'</span>);
1930                 <span class="keyword">else</span>
1931                     EtaModel = LocoModel(i).Eta(1:NHBPM);
1932                 <span class="keyword">end</span>
1933                 <span class="keyword">if</span> isempty(LocoMeasData.Eta)
1934                     EtaMeas = NaN*ones(size(x))';
1935                     fprintf(<span class="string">'   Measured dispersion is empty.\n'</span>);
1936                 <span class="keyword">else</span>
1937                     EtaMeas = LocoMeasData.Eta(BPMData(i).HBPMGoodDataIndex);
1938                 <span class="keyword">end</span>
1939 
1940                 plot(x, EtaMeas,<span class="string">'-b'</span>);
1941                 hold on;
1942                 plot(x, EtaModel,<span class="string">'--r'</span>);
1943 
1944                 <span class="comment">% Add circles for the outliers</span>
1945                 EtaOutliers = LocoModel(i).EtaOutlierIndex;
1946                 j = find(EtaOutliers &lt;= NHBPM);      <span class="comment">% Only horizontal data</span>
1947                 <span class="keyword">if</span> ~isempty(j)
1948                     plot(x(EtaOutliers(j)),EtaMeas(EtaOutliers(j)),<span class="string">'og'</span>,<span class="string">'MarkerSize'</span>,2);
1949                     legend(<span class="string">'Measured'</span>,<span class="string">'Model'</span>,<span class="string">'Outliers'</span>,0);
1950                 <span class="keyword">else</span>
1951                     legend(<span class="string">'Measured'</span>,<span class="string">'Model'</span>,0);
1952                 <span class="keyword">end</span>
1953 
1954                 hold off
1955                 title(sprintf(<span class="string">'&quot;Dispersion&quot; Function (%d BPMs)'</span>,length(EtaModel)));
1956                 ylabel(<span class="string">'&quot;Dispersion&quot; [mm]'</span>);
1957                 xlabel(<span class="string">'Horizontal BPM Number'</span>);
1958                 axis tight
1959             <span class="keyword">else</span>
1960                 <span class="comment">% Horizontal and vertical dispersion</span>
1961                 NHBPM = length(BPMData(i).HBPMGoodDataIndex);
1962                 NVBPM = length(BPMData(i).VBPMGoodDataIndex);
1963                 NBPM  = NHBPM + NVBPM;
1964                 NHCM = length(CMData(i).HCMGoodDataIndex);
1965                 NVCM = length(CMData(i).VCMGoodDataIndex);
1966 
1967                 <span class="keyword">if</span> isempty(LocoModel(i).Eta)
1968                     EtaModel = NaN;
1969                     fprintf(<span class="string">'   Model dispersion is empty.\n'</span>);
1970                 <span class="keyword">else</span>
1971                     EtaModel = LocoModel(i).Eta;
1972                 <span class="keyword">end</span>
1973                 <span class="keyword">if</span> isempty(LocoMeasData.Eta)
1974                     EtaMeas = NaN;
1975                     fprintf(<span class="string">'   Measured dispersion is empty.\n'</span>);
1976                 <span class="keyword">else</span>
1977                     EtaMeas = LocoMeasData.Eta([BPMData(i).HBPMGoodDataIndex length(BPMData(i).HBPMIndex)+BPMData(i).VBPMGoodDataIndex]);
1978                 <span class="keyword">end</span>
1979 
1980                 plot(EtaMeas,<span class="string">'-b'</span>);
1981                 hold on;
1982                 plot(EtaModel,<span class="string">'--r'</span>);
1983 
1984                 <span class="comment">% Add circles for the outliers</span>
1985                 EtaOutliers = LocoModel(i).EtaOutlierIndex;
1986                 x = 1:length(EtaMeas);
1987                 <span class="keyword">if</span> ~isempty(EtaOutliers)
1988                     plot(x(EtaOutliers),EtaMeas(EtaOutliers),<span class="string">'ob'</span>,<span class="string">'MarkerSize'</span>,2);
1989                     <span class="keyword">if</span> all(isnan(EtaModel))
1990                         fprintf(<span class="string">'   Model dispersion is NaN.\n'</span>);
1991                         legend(<span class="string">'Measured'</span>,<span class="string">'Outliers'</span>,0);
1992                     <span class="keyword">else</span>
1993                         legend(<span class="string">'Measured'</span>,<span class="string">'Model'</span>,<span class="string">'Outliers'</span>,0);
1994                     <span class="keyword">end</span>
1995                 <span class="keyword">else</span>
1996                     <span class="keyword">if</span> all(isnan(EtaModel))
1997                         fprintf(<span class="string">'   Model dispersion is NaN.\n'</span>);
1998                         <span class="comment">%legend off</span>
1999                         legend(<span class="string">'Measured'</span>,0);
2000                     <span class="keyword">else</span>
2001                         legend(<span class="string">'Measured'</span>,<span class="string">'Model'</span>,0);
2002                     <span class="keyword">end</span>
2003                 <span class="keyword">end</span>
2004 
2005                 hold off
2006                 title(sprintf(<span class="string">'&quot;Dispersion&quot; Function (%d BPMs)'</span>,length(EtaModel)));
2007                 ylabel(<span class="string">'&quot;Dispersion&quot; [mm]'</span>);
2008                 xlabel(<span class="string">'BPM Number'</span>);
2009 
2010                 <span class="comment">% Change label to BPM numbers</span>
2011                 Nx = length(EtaMeas);
2012                 Ticks = 1:ceil(Nx/10):Nx;
2013                 set(gca, <span class="string">'XTick'</span>, Ticks);
2014                 TickNumber = [BPMData(i).HBPMGoodDataIndex BPMData(i).VBPMGoodDataIndex];
2015                 TickNumber = TickNumber(Ticks);
2016                 set(gca, <span class="string">'XTickLabel'</span>, num2cell(TickNumber));
2017                 xlabel(<span class="string">'HBPM# and VBPM#'</span>);
2018 
2019                 axis tight
2020             <span class="keyword">end</span>
2021 
2022         <span class="keyword">case</span> 21
2023             <span class="comment">% Vertical dispersion function</span>
2024             plot(0,0); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2025 
2026             <span class="comment">% Only plotting vertical dispersion</span>
2027             NHBPM = length(BPMData(i).HBPMGoodDataIndex);
2028             NVBPM = length(BPMData(i).VBPMGoodDataIndex);
2029             NBPM  = NHBPM + NVBPM;
2030             NHCM = length(CMData(i).HCMGoodDataIndex);
2031             NVCM = length(CMData(i).VCMGoodDataIndex);
2032 
2033             x = 1:length(BPMData(i).VBPMIndex);
2034             x = x(BPMData(i).VBPMGoodDataIndex);
2035 
2036             <span class="keyword">if</span> isempty(LocoModel(i).Eta)
2037                 EtaModel = NaN*ones(size(x))';
2038                 fprintf(<span class="string">'   Model dispersion is empty.\n'</span>);
2039             <span class="keyword">else</span>
2040                 EtaModel = LocoModel(i).Eta(NHBPM+(1:NVBPM));
2041             <span class="keyword">end</span>
2042             <span class="keyword">if</span> isempty(LocoMeasData.Eta)
2043                 EtaMeas = NaN*ones(size(x))';
2044                 fprintf(<span class="string">'   Measured dispersion is empty.\n'</span>);
2045             <span class="keyword">else</span>
2046                 EtaMeas = LocoMeasData.Eta(length(BPMData(i).HBPMIndex)+BPMData(i).VBPMGoodDataIndex);
2047             <span class="keyword">end</span>
2048 
2049             plot(x, EtaMeas,<span class="string">'-b'</span>);
2050             hold on;
2051             plot(x, EtaModel,<span class="string">'--r'</span>);
2052 
2053             <span class="comment">% Add circles for the outliers</span>
2054             EtaOutliers = LocoModel(i).EtaOutlierIndex;
2055             j = find(EtaOutliers &gt; NHBPM);      <span class="comment">% Only vertical data</span>
2056             EtaOutliers = EtaOutliers(j) - NHBPM;
2057             <span class="keyword">if</span> ~isempty(j)
2058                 hold on
2059                 plot(x(EtaOutliers), EtaMeas(EtaOutliers), <span class="string">'og'</span>, <span class="string">'MarkerSize'</span>,2);
2060                 hold off
2061                 legend(<span class="string">'Measured'</span>, <span class="string">'Model'</span>, <span class="string">'Outliers'</span>, 0);
2062             <span class="keyword">else</span>
2063                 legend(<span class="string">'Measured'</span>,<span class="string">'Model'</span>,0);
2064             <span class="keyword">end</span>
2065 
2066             hold off
2067             title(sprintf(<span class="string">'&quot;Dispersion&quot; Function (%d BPMs)'</span>,length(EtaModel)));
2068             ylabel(<span class="string">'&quot;Dispersion&quot; [mm]'</span>);
2069             xlabel(<span class="string">'Vertical BPM Number'</span>);
2070             axis tight
2071 
2072         <span class="keyword">case</span> 22
2073             <span class="comment">% Dispersion function error</span>
2074             plot(0,0); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2075 
2076             <span class="comment">% Horizontal dispersion</span>
2077             <span class="keyword">if</span> 1
2078                 <span class="comment">% Only plot horizontal dispersion</span>
2079                 NHBPM = length(BPMData(i).HBPMGoodDataIndex);
2080                 x = 1:length(BPMData(i).HBPMIndex);
2081                 x = x(BPMData(i).HBPMGoodDataIndex);
2082 
2083                 <span class="keyword">if</span> isempty(LocoModel(i).Eta)
2084                     EtaModel = NaN*ones(size(x))';
2085                     fprintf(<span class="string">'   Model dispersion is empty.\n'</span>);
2086                 <span class="keyword">else</span>
2087                     EtaModel = LocoModel(i).Eta(1:NHBPM);
2088                 <span class="keyword">end</span>
2089                 <span class="keyword">if</span> isempty(LocoMeasData.Eta)
2090                     EtaMeas = NaN*ones(size(x))';
2091                     fprintf(<span class="string">'   Measured dispersion is empty.\n'</span>);
2092                 <span class="keyword">else</span>
2093                     EtaMeas = LocoMeasData.Eta(BPMData(i).HBPMGoodDataIndex);
2094                 <span class="keyword">end</span>
2095 
2096                 plot(x, EtaMeas-EtaModel,<span class="string">'-b'</span>);
2097 
2098                 <span class="comment">% Add circles for the outliers</span>
2099                 EtaOutliers = LocoModel(i).EtaOutlierIndex;
2100                 j = find(EtaOutliers &lt;= NHBPM);      <span class="comment">% Only horizontal data</span>
2101                 <span class="keyword">if</span> ~isempty(j)
2102                     hold on;
2103                     plot(x(EtaOutliers(j)),EtaMeas(EtaOutliers(j))-EtaModel(EtaOutliers(j)),<span class="string">'og'</span>,<span class="string">'MarkerSize'</span>,2);
2104                     hold off;
2105                     legend(<span class="string">'Measured-Model'</span>,<span class="string">'Outliers'</span>,0);
2106                 <span class="keyword">end</span>
2107 
2108                 <span class="keyword">if</span> all(isnan(EtaModel))
2109                     fprintf(<span class="string">'   Model dispersion is NaN.\n'</span>);
2110                     legend off
2111                 <span class="keyword">end</span>
2112 
2113                 hold off
2114                 title(sprintf(<span class="string">'&quot;Dispersion&quot; Function Error (%d BPMs)'</span>,length(EtaModel)));
2115                 ylabel(<span class="string">'&quot;Dispersion&quot; Error [mm]'</span>);
2116                 xlabel(<span class="string">'Horizontal BPM Number'</span>);
2117                 axis tight
2118             <span class="keyword">else</span>
2119                 <span class="comment">% Horizontal and vertical dispersion</span>
2120                 NHBPM = length(BPMData(i).HBPMGoodDataIndex);
2121                 NVBPM = length(BPMData(i).VBPMGoodDataIndex);
2122                 NBPM  = NHBPM + NVBPM;
2123                 NHCM = length(CMData(i).HCMGoodDataIndex);
2124                 NVCM = length(CMData(i).VCMGoodDataIndex);
2125 
2126                 <span class="keyword">if</span> isempty(LocoModel(i).Eta)
2127                     EtaModel = NaN;
2128                     fprintf(<span class="string">'   Model dispersion is empty.\n'</span>);
2129                 <span class="keyword">else</span>
2130                     EtaModel = LocoModel(i).Eta;
2131                 <span class="keyword">end</span>
2132                 <span class="keyword">if</span> isempty(LocoMeasData.Eta)
2133                     EtaMeas = NaN;
2134                     fprintf(<span class="string">'   Measured dispersion is empty.\n'</span>);
2135                 <span class="keyword">else</span>
2136                     EtaMeas = LocoMeasData.Eta([BPMData(i).HBPMGoodDataIndex length(BPMData(i).HBPMIndex)+BPMData(i).VBPMGoodDataIndex]);
2137                 <span class="keyword">end</span>
2138 
2139                 plot(EtaMeas-EtaModel,<span class="string">'-b'</span>);
2140 
2141                 <span class="comment">% Add circles for the outliers</span>
2142                 EtaOutliers = LocoModel(i).EtaOutlierIndex;
2143                 x = 1:length(EtaMeas);
2144                 <span class="keyword">if</span> ~isempty(EtaOutliers)
2145                     hold on;
2146                     plot(x(EtaOutliers),EtaMeas(EtaOutliers)-EtaModel(EtaOutliers),<span class="string">'og'</span>,<span class="string">'MarkerSize'</span>,2);
2147                     hold off;
2148                     legend(<span class="string">'Measured-Model'</span>,<span class="string">'Outliers'</span>,0);
2149                 <span class="keyword">end</span>
2150 
2151                 hold off
2152                 title(sprintf(<span class="string">'&quot;Dispersion&quot; Function Error (%d BPMs)'</span>,length(EtaModel)));
2153                 ylabel(<span class="string">'&quot;Dispersion&quot; Error [mm]'</span>);
2154                 xlabel(<span class="string">'BPM Number'</span>);
2155 
2156                 <span class="comment">% Change label to BPM numbers</span>
2157                 Nx = length(EtaMeas);
2158                 Ticks = 1:ceil(Nx/10):Nx;
2159                 set(gca, <span class="string">'XTick'</span>, Ticks);
2160                 TickNumber = [BPMData(i).HBPMGoodDataIndex BPMData(i).VBPMGoodDataIndex];
2161                 TickNumber = TickNumber(Ticks);
2162                 set(gca, <span class="string">'XTickLabel'</span>, num2cell(TickNumber));
2163                 xlabel(<span class="string">'HBPM# and VBPM#'</span>);
2164 
2165                 axis tight
2166             <span class="keyword">end</span>
2167 
2168         <span class="keyword">case</span> 23
2169             <span class="comment">% Vertical dispersion error function</span>
2170             plot(0,0); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2171 
2172             <span class="comment">% Only plotting vertical dispersion</span>
2173             NHBPM = length(BPMData(i).HBPMGoodDataIndex);
2174             NVBPM = length(BPMData(i).VBPMGoodDataIndex);
2175             NBPM  = NHBPM + NVBPM;
2176             NHCM = length(CMData(i).HCMGoodDataIndex);
2177             NVCM = length(CMData(i).VCMGoodDataIndex);
2178 
2179             x = 1:length(BPMData(i).VBPMIndex);
2180             x = x(BPMData(i).VBPMGoodDataIndex);
2181 
2182             <span class="keyword">if</span> isempty(LocoModel(i).Eta)
2183                 EtaModel = NaN*ones(size(x))';
2184                 fprintf(<span class="string">'   Model dispersion is empty.\n'</span>);
2185             <span class="keyword">else</span>
2186                 EtaModel = LocoModel(i).Eta(NHBPM+(1:NVBPM));
2187             <span class="keyword">end</span>
2188             <span class="keyword">if</span> isempty(LocoMeasData.Eta)
2189                 EtaMeas = NaN*ones(size(x))';
2190                 fprintf(<span class="string">'   Measured dispersion is empty.\n'</span>);
2191             <span class="keyword">else</span>
2192                 EtaMeas = LocoMeasData.Eta(length(BPMData(i).HBPMIndex)+BPMData(i).VBPMGoodDataIndex);
2193             <span class="keyword">end</span>
2194 
2195             plot(x, EtaMeas-EtaModel,<span class="string">'-b'</span>);
2196 
2197             <span class="comment">% Add circles for the outliers</span>
2198             EtaOutliers = LocoModel(i).EtaOutlierIndex;
2199             j = find(EtaOutliers &gt; NHBPM);      <span class="comment">% Only vertical data</span>
2200             EtaOutliers = EtaOutliers(j) - NHBPM;
2201             <span class="keyword">if</span> ~isempty(j)
2202                 hold on
2203                 plot(x(EtaOutliers), EtaMeas(EtaOutliers)-EtaModel(EtaOutliers), <span class="string">'og'</span>, <span class="string">'MarkerSize'</span>,2);
2204                 hold off
2205                 legend(<span class="string">'Measured-Model'</span>,<span class="string">'Outliers'</span>,0);
2206             <span class="keyword">end</span>
2207 
2208             title(sprintf(<span class="string">'&quot;Dispersion&quot; Function Error (%d BPMs)'</span>,length(EtaModel)));
2209             ylabel(<span class="string">'&quot;Dispersion&quot; Error [mm]'</span>);
2210             xlabel(<span class="string">'Vertical BPM Number'</span>);
2211             axis tight
2212 
2213         <span class="keyword">case</span> 24
2214             <span class="comment">% Horizontal Beta</span>
2215             plot([0 1],[0 1],<span class="string">'w'</span>); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2216             set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2217             text(4,11,sprintf(<span class="string">'Please wait ...'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2218             text(4, 9,sprintf(<span class="string">'Computing Beta Functions'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2219             drawnow;
2220 
2221             [Beta1, Tune1] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, <span class="string">'Beta'</span>,[],<span class="string">'Tune'</span>,[]);
2222             <span class="keyword">if</span> ~isempty(Beta1) &amp;&amp; isreal(Beta1)
2223                 plot(Beta1(:,3), Beta1(:,1), <span class="string">'b'</span>);
2224                 xlabel(<span class="string">'Position [meters]'</span>);
2225                 ylabel(<span class="string">'Horizontal Beta Function [meters]'</span>);
2226                 title(texlabel(sprintf(<span class="string">'Model Beta Function (nu_x=%.4f)'</span>,Tune1(1))));
2227                 <span class="keyword">try</span>
2228                     L = findspos(RINGData.Lattice,length(RINGData.Lattice)+1);
2229                     <span class="keyword">if</span> ~isempty(Beta1)
2230                         set(gca, <span class="string">'XLim'</span>, [0 L]);
2231                     <span class="keyword">end</span>
2232                 <span class="keyword">catch</span>
2233                 <span class="keyword">end</span>
2234             <span class="keyword">else</span>
2235                 plot([0 1],[0 1],<span class="string">'w'</span>);
2236                 title(<span class="string">''</span>);
2237                 set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2238                 set(gca,<span class="string">'XTick'</span>,[]);
2239                 set(gca,<span class="string">'YTick'</span>,[]);
2240                 text(4, 9,sprintf(<span class="string">'There was a problem computing the beta function.'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2241                 drawnow;
2242             <span class="keyword">end</span>
2243 
2244         <span class="keyword">case</span> 25
2245             <span class="comment">% Vertical Beta</span>
2246             plot([0 1],[0 1],<span class="string">'w'</span>); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2247             set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2248             text(4,11,sprintf(<span class="string">'Please wait ...'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2249             text(4, 9,sprintf(<span class="string">'Computing Beta Functions'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2250             drawnow;
2251 
2252             [Beta1, Tune1] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, <span class="string">'Beta'</span>,[],<span class="string">'Tune'</span>,[]);
2253             <span class="keyword">if</span> ~isempty(Beta1) &amp;&amp; isreal(Beta1)
2254                 plot(Beta1(:,3), Beta1(:,2), <span class="string">'b'</span>);
2255                 xlabel(<span class="string">'Position [meters]'</span>);
2256                 ylabel(<span class="string">'Vertical Beta Function [meters]'</span>);
2257                 title(texlabel(sprintf(<span class="string">'Model Beta Function (nu_y=%.4f)'</span>, Tune1(2))));
2258                 <span class="keyword">try</span>
2259                     L = findspos(RINGData.Lattice,length(RINGData.Lattice)+1);
2260                     <span class="keyword">if</span> ~isempty(Beta1)
2261                         set(gca, <span class="string">'XLim'</span>, [0 L]);
2262                     <span class="keyword">end</span>
2263                 <span class="keyword">catch</span>
2264                 <span class="keyword">end</span>
2265             <span class="keyword">else</span>
2266                 plot([0 1],[0 1],<span class="string">'w'</span>);
2267                 title(<span class="string">''</span>);
2268                 set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2269                 set(gca,<span class="string">'XTick'</span>,[]);
2270                 set(gca,<span class="string">'YTick'</span>,[]);
2271                 text(4, 9,sprintf(<span class="string">'There was a problem computing the beta function.'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2272                 drawnow;
2273             <span class="keyword">end</span>
2274 
2275         <span class="keyword">case</span> 26
2276             <span class="comment">% Horizontal Beta Beat</span>
2277             plot([0 1],[0 1],<span class="string">'w'</span>); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2278             set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2279             text(4,11,sprintf(<span class="string">'Please wait ...'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2280             text(4, 9,sprintf(<span class="string">'Computing Beta Functions'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2281             drawnow;
2282 
2283             [Beta1, Tune1] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, <span class="string">'Beta'</span>,[],<span class="string">'Tune'</span>,[]);
2284             [Beta0, Tune0] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData},   0, <span class="string">'Beta'</span>,[],<span class="string">'Tune'</span>,[]);
2285             <span class="keyword">if</span> ~isempty(Beta1) &amp;&amp; ~isempty(Beta0) &amp;&amp; isreal(Beta1) &amp;&amp; isreal(Beta0)
2286                 <span class="comment">%plot(Beta1(:,3), Beta1(:,1)-Beta0(:,1), 'b');</span>
2287                 <span class="comment">%ylabel(sprintf('Horizontal Beta(%d)-Beta(0) [meters]',i-1));</span>
2288                 plot(Beta1(:,3), Beta1(:,1)./Beta0(:,1), <span class="string">'b'</span>);
2289                 ylabel(sprintf(<span class="string">'Horizontal Beta(%d)/Beta(0)'</span>,i-1));
2290                 xlabel(<span class="string">'BPM Position [meters]'</span>);
2291                 title(texlabel(sprintf(<span class="string">'Beta Beat (nu_x(%d)=%.4f, nu_x(0)=%.4f)'</span>,i-1, Tune1(1),Tune0(1))));
2292                 <span class="keyword">try</span>
2293                     L = findspos(RINGData.Lattice,length(RINGData.Lattice)+1);
2294                     <span class="keyword">if</span> ~isempty(Beta1)
2295                         set(gca, <span class="string">'XLim'</span>, [0 L]);
2296                     <span class="keyword">end</span>
2297                 <span class="keyword">catch</span>
2298                 <span class="keyword">end</span>
2299             <span class="keyword">else</span>
2300                 plot([0 1],[0 1],<span class="string">'w'</span>);
2301                 title(<span class="string">''</span>);
2302                 set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2303                 set(gca,<span class="string">'XTick'</span>,[]);
2304                 set(gca,<span class="string">'YTick'</span>,[]);
2305                 text(4, 9,sprintf(<span class="string">'There was a problem computing the beta function.'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2306                 drawnow;
2307             <span class="keyword">end</span>
2308 
2309             <span class="comment">%h = uimenu(hcmenu, 'Label', 'Beta Beat', 'Callback', 'locogui(''ContextMenuBetaBeat_Callback'',gcbo,[],[])');</span>
2310             <span class="comment">%set(h,'Userdata',{'Model-Measured','VCM'});</span>
2311 
2312         <span class="keyword">case</span> 27
2313             <span class="comment">% Vertical Beta Beat</span>
2314             plot([0 1],[0 1],<span class="string">'w'</span>); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2315             set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2316             text(4,11,sprintf(<span class="string">'Please wait ...'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2317             text(4, 9,sprintf(<span class="string">'Computing Beta Functions'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2318             drawnow;
2319 
2320             [Beta1, Tune1] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, <span class="string">'Beta'</span>,[],<span class="string">'Tune'</span>,[]);
2321             [Beta0, Tune0] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData},   0, <span class="string">'Beta'</span>,[],<span class="string">'Tune'</span>,[]);
2322             <span class="keyword">if</span> ~isempty(Beta1) &amp;&amp; ~isempty(Beta0) &amp;&amp; isreal(Beta1) &amp;&amp; isreal(Beta0)
2323                 <span class="comment">%plot(Beta1(:,3), Beta1(:,2)-Beta0(:,2), 'b');</span>
2324                 <span class="comment">%ylabel(sprintf('Vertical Beta(%d)-Beta(0) [meters]',i-1));</span>
2325                 plot(Beta1(:,3), Beta1(:,2)./Beta0(:,2), <span class="string">'b'</span>);
2326                 ylabel(sprintf(<span class="string">'Vertical Beta(%d)/Beta(0)'</span>,i-1));
2327                 xlabel(<span class="string">'BPM Position [meters]'</span>);
2328                 title(texlabel(sprintf(<span class="string">'Beta Beat (nu_y(%d)=%.4f, nu_y(0)=%.4f)'</span>,i-1, Tune1(2),Tune0(2))));
2329                 <span class="keyword">try</span>
2330                     L = findspos(RINGData.Lattice,length(RINGData.Lattice)+1);
2331                     <span class="keyword">if</span> ~isempty(Beta1)
2332                         set(gca, <span class="string">'XLim'</span>, [0 L]);
2333                     <span class="keyword">end</span>
2334                 <span class="keyword">catch</span>
2335                 <span class="keyword">end</span>
2336             <span class="keyword">else</span>
2337                 plot([0 1],[0 1],<span class="string">'w'</span>);
2338                 title(<span class="string">''</span>);
2339                 set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2340                 set(gca,<span class="string">'XTick'</span>,[]);
2341                 set(gca,<span class="string">'YTick'</span>,[]);
2342                 text(4, 9,sprintf(<span class="string">'There was a problem computing the beta function.'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2343                 drawnow;
2344             <span class="keyword">end</span>
2345 
2346         <span class="keyword">case</span> 28
2347             <span class="keyword">if</span> isempty(Mmodel)
2348                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2349             <span class="keyword">else</span>
2350                 <a href="locoplotrms.html" class="code" title="function locoplotrms(FileName, IterationNumber, PlotType)">locoplotrms</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, 1);
2351             <span class="keyword">end</span>
2352         <span class="keyword">case</span> 29
2353             <span class="keyword">if</span> isempty(Mmodel)
2354                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2355             <span class="keyword">else</span>
2356                 <a href="locoplotrms.html" class="code" title="function locoplotrms(FileName, IterationNumber, PlotType)">locoplotrms</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, 3);
2357             <span class="keyword">end</span>
2358 
2359         <span class="keyword">case</span> 30
2360             <span class="keyword">if</span> isempty(Mmodel)
2361                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2362             <span class="keyword">else</span>
2363                 <a href="locoplotrms.html" class="code" title="function locoplotrms(FileName, IterationNumber, PlotType)">locoplotrms</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, 2);
2364             <span class="keyword">end</span>
2365         <span class="keyword">case</span> 31
2366             <span class="keyword">if</span> isempty(Mmodel)
2367                 set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2368             <span class="keyword">else</span>
2369                 <a href="locoplotrms.html" class="code" title="function locoplotrms(FileName, IterationNumber, PlotType)">locoplotrms</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData}, i-1, 4);
2370             <span class="keyword">end</span>
2371     <span class="keyword">end</span>
2372 
2373 <span class="keyword">catch</span>
2374     set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2375     fprintf(<span class="string">'Plot failed: %s\n'</span>, lasterr);
2376 <span class="keyword">end</span>
2377 
2378 axes(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'ChiSquare'</span>));
2379 cla;
2380 <span class="keyword">if</span> ~isempty(LocoModel(i).ChiSquare)
2381     <span class="keyword">if</span> LocoModel(i).ChiSquare~=0
2382         text(0,.5,sprintf(<span class="string">'\\fontsize{12}\\chi^{2}_{\\fontsize{8}total} \\fontsize{9}/ D.O.F \\fontsize{10}= %f'</span>, LocoModel(i).ChiSquare));
2383     <span class="keyword">end</span>
2384 <span class="keyword">end</span>
2385 
2386 drawnow;
2387 
2388 
2389 <span class="comment">% % --------------------------------------------------------------------</span>
2390 <span class="comment">% function varargout = ContextMenuBetaBeat_Callback(h, eventdata, handles, varargin)</span>
2391 <span class="comment">% %FieldName = get(h,'Userdata');</span>
2392 <span class="comment">%</span>
2393 <span class="comment">% FileName = get(findobj(gcbf,'Tag','FileName'),'Userdata');</span>
2394 <span class="comment">% if isempty(FileName)</span>
2395 <span class="comment">%     return</span>
2396 <span class="comment">% end</span>
2397 <span class="comment">% try</span>
2398 <span class="comment">%     load(FileName);</span>
2399 <span class="comment">% catch</span>
2400 <span class="comment">%     fprintf('   File does not exist or is not a *.mat file type.\n');</span>
2401 <span class="comment">%     cla;</span>
2402 <span class="comment">%     return</span>
2403 <span class="comment">% end</span>
2404 <span class="comment">%</span>
2405 <span class="comment">% i = get(findobj(gcbf,'Tag','PlotIteration'),'Value');  % The first point in the array is starting point</span>
2406 
2407 
2408 <span class="comment">% --------------------------------------------------------------------</span>
2409 <a name="_sub22" href="#_subfunctions" class="code">function varargout = ContextMenuPlot_Callback(h, eventdata, handles, varargin)</a>
2410 FieldName = get(h,<span class="string">'Userdata'</span>);
2411 
2412 AxesTag = get(gca,<span class="string">'Tag'</span>);
2413 <span class="keyword">if</span> strcmp(AxesTag,<span class="string">'Axes1'</span>)
2414     TagString = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu1'</span>),<span class="string">'Userdata'</span>);   <span class="comment">% Axis tag is storage in the menu pulldown</span>
2415     setappdata(gcbf,<span class="string">'OtherParameterPlot1'</span>,FieldName);
2416 <span class="keyword">elseif</span> strcmp(AxesTag,<span class="string">'Axes2'</span>)
2417     TagString = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu2'</span>),<span class="string">'Userdata'</span>);   <span class="comment">% Axis tag is storage in the menu pulldown</span>
2418     setappdata(gcbf,<span class="string">'OtherParameterPlot2'</span>,FieldName);
2419 <span class="keyword">else</span>
2420     <span class="comment">%error('problem with AxesTag name')</span>
2421 <span class="keyword">end</span>
2422 h_axis = findobj(gcbf,<span class="string">'Tag'</span>,TagString);
2423 axes(h_axis);
2424 <a href="#_sub21" class="code" title="subfunction locoplots(PlotNumber, FieldName)">locoplots</a>(15, FieldName);
2425 
2426 axes(h_axis);
2427 legend
2428 set(gca,<span class="string">'Tag'</span>,TagString);                 <span class="comment">% axes tag is lost if plot function is used</span>
2429 set(gca,<span class="string">'HandleVisibility'</span>,<span class="string">'Callback'</span>);   <span class="comment">% So no one else can plot to it.</span>
2430 
2431 <span class="comment">% --------------------------------------------------------------------</span>
2432 <a name="_sub23" href="#_subfunctions" class="code">function varargout = ContextMenuSurfPlot_Callback(h, eventdata, handles, varargin)</a>
2433 FieldName = get(h,<span class="string">'Userdata'</span>);
2434 
2435 AxesTag = get(gca,<span class="string">'Tag'</span>);
2436 <span class="keyword">if</span> strcmp(AxesTag,<span class="string">'Axes1'</span>)
2437     TagString = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu1'</span>),<span class="string">'Userdata'</span>);   <span class="comment">% Axis tag is storage in the menu pulldown</span>
2438     h1 = findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SurfPlot1'</span>);
2439     set(h1,<span class="string">'Userdata'</span>, FieldName);
2440 <span class="keyword">elseif</span> strcmp(AxesTag,<span class="string">'Axes2'</span>)
2441     TagString = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotMenu2'</span>),<span class="string">'Userdata'</span>);   <span class="comment">% Axis tag is storage in the menu pulldown</span>
2442     h1 = findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'SurfPlot2'</span>);
2443     set(h1,<span class="string">'Userdata'</span>, FieldName);
2444 <span class="keyword">else</span>
2445     <span class="comment">%error('problem with AxesTag name')</span>
2446 <span class="keyword">end</span>
2447 
2448 h_axis = findobj(gcbf,<span class="string">'Tag'</span>,TagString);
2449 axes(h_axis);
2450 
2451 <span class="comment">%FileName = get(findobj(gcbf,'Tag','FileName'),'Userdata');</span>
2452 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
2453 Iteration = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'Value'</span>)-1;
2454 ElementsInput = <a href="locoplot.html" class="code" title="function ElementsInput = locoplot(FileName, IterationNumber, PlotString, PlaneString, ElementsInput)">locoplot</a>(LocoDataCell, Iteration, FieldName{1}, FieldName{2});
2455 
2456 FieldName{3} = ElementsInput;
2457 set(h1,<span class="string">'Userdata'</span>, FieldName);
2458 
2459 set(gca,<span class="string">'Tag'</span>,TagString);                 <span class="comment">% axes tag is lost if plot function is used</span>
2460 set(gca,<span class="string">'HandleVisibility'</span>,<span class="string">'Callback'</span>);   <span class="comment">% So no one else can plot to it.</span>
2461 
2462 
2463 
2464 <a name="_sub24" href="#_subfunctions" class="code">function [Mmodel, Dispersion, ChiSquare] = getmodelresponsematrix(BPMData, CMData, FitParameters, LocoFlags, LocoMeasData, RINGData)</a>
2465 
2466 <span class="comment">% UNITS CONVERSIONS (to be combatible with tracking code)</span>
2467 <span class="comment">% Convert corrector kicks used in the response matrix to radians</span>
2468 CMData.HCMKicks = CMData.HCMKicks(:) / 1000;   <span class="comment">% milliradian to radians (column vector)</span>
2469 CMData.VCMKicks = CMData.VCMKicks(:) / 1000;   <span class="comment">% milliradian to radians (column vector)</span>
2470 
2471 <span class="comment">% Convert the measured response matrix to meters</span>
2472 LocoMeasData.M = LocoMeasData.M / 1000;
2473 
2474 <span class="comment">% Convert the BPMSTD to meters and make the same size as a response matrix</span>
2475 LocoMeasData.BPMSTD = LocoMeasData.BPMSTD / 1000;    <span class="comment">% mm to meters</span>
2476 
2477 <span class="comment">% Convert orbit for &quot;dispersion&quot; in meters in column vector format</span>
2478 LocoMeasData.Eta = LocoMeasData.Eta(:) / 1000;       <span class="comment">% mm to meters</span>
2479 <span class="comment">% END UNITS CONVERTSION</span>
2480 
2481 
2482 <span class="comment">% % Check for a new (user input) BPM and CM good data lists</span>
2483 <span class="comment">% if ~isempty(get(findobj(gcbf,'Tag','HBPMIndex'), 'Userdata'))</span>
2484 <span class="comment">%     BPMData.HBPMGoodDataIndex = get(findobj(gcf,'Tag','HBPMIndex'), 'Userdata');</span>
2485 <span class="comment">% end</span>
2486 <span class="comment">% if ~isempty(get(findobj(gcbf,'Tag','VBPMIndex'), 'Userdata'))</span>
2487 <span class="comment">%     BPMData.VBPMGoodDataIndex = get(findobj(gcf,'Tag','VBPMIndex'), 'Userdata');</span>
2488 <span class="comment">% end</span>
2489 <span class="comment">% if ~isempty(get(findobj(gcbf,'Tag','HCMIndex'), 'Userdata'))</span>
2490 <span class="comment">%     CMData.HCMGoodDataIndex = get(findobj(gcf,'Tag','HCMIndex'), 'Userdata');</span>
2491 <span class="comment">% end</span>
2492 <span class="comment">% if ~isempty(get(findobj(gcbf,'Tag','VCMIndex'), 'Userdata'))</span>
2493 <span class="comment">%     CMData.VCMGoodDataIndex = get(findobj(gcf,'Tag','VCMIndex'), 'Userdata');</span>
2494 <span class="comment">% end</span>
2495 
2496 
2497 <span class="comment">% Limit the correctors to the good ones</span>
2498 CMDataRM.FamName = CMData.FamName;
2499 CMDataRM.HCMIndex = CMData.HCMIndex(CMData.HCMGoodDataIndex);
2500 CMDataRM.VCMIndex = CMData.VCMIndex(CMData.VCMGoodDataIndex);
2501 CMDataRM.HCMKicks = CMData.HCMKicks(CMData.HCMGoodDataIndex);
2502 CMDataRM.VCMKicks = CMData.VCMKicks(CMData.VCMGoodDataIndex);
2503 CMDataRM.HCMCoupling = CMData.HCMCoupling(CMData.HCMGoodDataIndex);
2504 CMDataRM.VCMCoupling = CMData.VCMCoupling(CMData.VCMGoodDataIndex);
2505 CMDataRM.HCMEnergyShift = CMData.HCMEnergyShift(CMData.HCMGoodDataIndex);
2506 CMDataRM.VCMEnergyShift = CMData.VCMEnergyShift(CMData.VCMGoodDataIndex);
2507 
2508 <span class="comment">% Set the lattice model to the starting LocoValues</span>
2509 <span class="keyword">for</span> i = 1:length(FitParameters.Params)
2510     RINGData = <a href="locosetlatticeparam.html" class="code" title="function RINGData = locosetlatticeparam(RINGData, LocoParams, LocoValues)">locosetlatticeparam</a>(RINGData, FitParameters.Params{i}, FitParameters.Values(i));
2511 <span class="keyword">end</span>
2512 
2513 plot([0 1],[0 1],<span class="string">'w'</span>);
2514 title(<span class="string">'RF Frequency'</span>);
2515 set(gca,<span class="string">'box'</span>,<span class="string">'on'</span>);
2516 set(gca,<span class="string">'XTick'</span>,[]);
2517 set(gca,<span class="string">'YTick'</span>,[]);
2518 text(4,11,sprintf(<span class="string">'Please wait ...'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2519 text(4, 9,sprintf(<span class="string">'Computing nominal response matrix'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2520 text(4, 8,sprintf(<span class="string">'                   and dispersion.'</span>),<span class="string">'units'</span>,<span class="string">'characters'</span>);
2521 drawnow;
2522 
2523 <span class="comment">% Find nominal response matrix and dispersion</span>
2524 <span class="keyword">if</span> isempty(FitParameters.DeltaRF)
2525     fprintf(<span class="string">'   Computing nominal response matrix (%s, %s) ... '</span>, LocoFlags.ResponseMatrixCalculator, LocoFlags.ClosedOrbitType); tic
2526     LocoFlags.Dispersion = <span class="string">'no'</span>;
2527     LocoFlags.ClosedOrbitType = <span class="string">'FixedPathLength'</span>;
2528     Mmodel = <a href="locoresponsematrix.html" class="code" title="function RM = locoresponsematrix(RINGData, BPMData, CMData, varargin)">locoresponsematrix</a>(RINGData, BPMData, CMDataRM, LocoFlags);
2529 <span class="keyword">else</span>
2530     fprintf(<span class="string">'   Computing nominal response matrix and dispersion (%s, %s) ... '</span>, LocoFlags.ResponseMatrixCalculator, LocoFlags.ClosedOrbitType); tic
2531     Mmodel = <a href="locoresponsematrix.html" class="code" title="function RM = locoresponsematrix(RINGData, BPMData, CMData, varargin)">locoresponsematrix</a>(RINGData, BPMData, CMDataRM, LocoFlags, <span class="string">'RF'</span>, FitParameters.DeltaRF);
2532 <span class="keyword">end</span>
2533 fprintf(<span class="string">'%f seconds. \n'</span>,toc);
2534 
2535 <span class="keyword">if</span> isempty(LocoMeasData.Eta) || any(isnan(LocoMeasData.Eta))
2536     <span class="comment">% Don't computer Chi^2 for with dispersion if the measured dispersion is emmpty or NaN</span>
2537     LocoFlags.Dispersion = <span class="string">'no'</span>;
2538 <span class="keyword">end</span>
2539 
2540 plot(0,0); set(gca,<span class="string">'XTick'</span>,[]); set(gca,<span class="string">'YTick'</span>,[]); cla; title(<span class="string">' '</span>); xlabel(<span class="string">' '</span>); ylabel(<span class="string">' '</span>);
2541 
2542 <span class="comment">% Rotate Mmodel and remove BPMs not in the measured response matrix</span>
2543 C11 = ones(length(BPMData.BPMIndex),1);
2544 C11(BPMData.HBPMIndex(BPMData.HBPMGoodDataIndex)) = BPMData.HBPMGain(BPMData.HBPMGoodDataIndex);
2545 
2546 C12 = zeros(length(BPMData.BPMIndex),1);
2547 C12(BPMData.HBPMIndex(BPMData.HBPMGoodDataIndex)) = BPMData.HBPMCoupling(BPMData.HBPMGoodDataIndex);
2548 
2549 C21 = zeros(length(BPMData.BPMIndex),1);
2550 C21(BPMData.VBPMIndex(BPMData.VBPMGoodDataIndex)) = BPMData.VBPMCoupling(BPMData.VBPMGoodDataIndex);
2551 
2552 C22 = ones(length(BPMData.BPMIndex),1);
2553 C22(BPMData.VBPMIndex(BPMData.VBPMGoodDataIndex)) = BPMData.VBPMGain(BPMData.VBPMGoodDataIndex);
2554 
2555 C = [diag(C11) diag(C12)
2556     diag(C21) diag(C22)];
2557 
2558 Mmodel = C * Mmodel;
2559 
2560 clear C C11 C12 C21 C22
2561 
2562 <span class="comment">% Remove unwanted BPMs  (Change by James S.  3-17-2006)</span>
2563 <span class="comment">%Mmodel = Mmodel([BPMData.HBPMGoodDataIndex length(BPMData.HBPMIndex)+BPMData.VBPMGoodDataIndex], :);</span>
2564 BPMIndexShortX = BPMData.HBPMIndex(BPMData.HBPMGoodDataIndex);
2565 BPMIndexShortY = BPMData.VBPMIndex(BPMData.VBPMGoodDataIndex) + length(BPMData.BPMIndex);
2566 BPMIndexShort = [BPMIndexShortX(:)' BPMIndexShortY(:)'];
2567 Mmodel = Mmodel(BPMIndexShort,:);
2568 
2569 <span class="keyword">if</span> isempty(FitParameters.DeltaRF)
2570     Dispersion = [];
2571 <span class="keyword">else</span>
2572     Dispersion = Mmodel(:,end);
2573 <span class="keyword">end</span>
2574 
2575 
2576 <span class="comment">% When using the fixed momentum response matrix calculator, the merit function becomes:</span>
2577 <span class="comment">%              Merit = Mmeas_ij - Mmod_ij - Dp/p_j * eta_i</span>
2578 <span class="comment">%              where eta_i is the measured eta (not the model eta)</span>
2579 <span class="comment">% This is done by changing Mmodel to (Mmodel_ij + Dp/p_j * eta_i)</span>
2580 <span class="comment">%if strcmpi((CMData.FitHCMEnergyShift),'yes') | strcmpi((CMData.FitVCMEnergyShift),'yes')</span>
2581 <span class="keyword">if</span> strcmpi((LocoFlags.ClosedOrbitType), <span class="string">'fixedmomentum'</span>)
2582     HCMEnergyShift = CMData.HCMEnergyShift(CMData.HCMGoodDataIndex);
2583     VCMEnergyShift = CMData.VCMEnergyShift(CMData.VCMGoodDataIndex);
2584 
2585     AlphaMCF = <a href="locomcf.html" class="code" title="function Alpha = locomcf(RINGData)">locomcf</a>(RINGData);
2586     EtaXmcf = -AlphaMCF * LocoMeasData.RF * LocoMeasData.Eta(BPMData.HBPMGoodDataIndex) / LocoMeasData.DeltaRF;
2587     EtaYmcf = -AlphaMCF * LocoMeasData.RF * LocoMeasData.Eta(length(BPMData.HBPMIndex)+BPMData.VBPMGoodDataIndex) / LocoMeasData.DeltaRF;
2588 
2589     <span class="keyword">for</span> i = 1:length(HCMEnergyShift)
2590         Mmodel(:,i) = Mmodel(:,i) + HCMEnergyShift(i) * [EtaXmcf; EtaYmcf];
2591     <span class="keyword">end</span>
2592 
2593     NHCM = length(HCMEnergyShift);
2594     <span class="keyword">for</span> i = 1:length(VCMEnergyShift)
2595         Mmodel(:,NHCM+i) = Mmodel(:,NHCM+i) + VCMEnergyShift(i) * [EtaXmcf; EtaYmcf];
2596     <span class="keyword">end</span>
2597 <span class="keyword">end</span>
2598 
2599 
2600 <span class="comment">% Compute chi-squared based on new model</span>
2601 Mmeas = LocoMeasData.M;
2602 Mmeas = Mmeas([BPMData.HBPMGoodDataIndex length(BPMData.HBPMIndex)+BPMData.VBPMGoodDataIndex], [CMData.HCMGoodDataIndex length(CMData.HCMIndex)+CMData.VCMGoodDataIndex]);
2603 
2604 Mstd = LocoMeasData.BPMSTD * ones(1,size(LocoMeasData.M,2));
2605 Mstd = Mstd ([BPMData.HBPMGoodDataIndex length(BPMData.HBPMIndex)+BPMData.VBPMGoodDataIndex], [CMData.HCMGoodDataIndex length(CMData.HCMIndex)+CMData.VCMGoodDataIndex]);
2606 
2607 Xstd = LocoMeasData.BPMSTD(BPMData.HBPMGoodDataIndex);
2608 Ystd = LocoMeasData.BPMSTD(length(BPMData.HBPMIndex)+BPMData.VBPMGoodDataIndex);
2609 
2610 <span class="keyword">if</span> isempty(LocoMeasData.Eta)
2611     EtaX = NaN * ones(length(BPMData.HBPMGoodDataIndex),1);
2612     EtaY = NaN * ones(length(BPMData.VBPMGoodDataIndex),1);
2613 <span class="keyword">else</span>
2614     EtaX = LocoMeasData.Eta(BPMData.HBPMGoodDataIndex);
2615     EtaY = LocoMeasData.Eta(length(BPMData.HBPMIndex)+BPMData.VBPMGoodDataIndex);
2616 <span class="keyword">end</span>
2617 
2618 Mstd  = Mstd(:);
2619 Mmeas = Mmeas(:);
2620 
2621 <span class="keyword">if</span> strcmpi((LocoFlags.Dispersion),<span class="string">'yes'</span>)
2622     Mstd  = [Mstd;  [Xstd; Ystd]];
2623     Mmeas = [Mmeas; [EtaX; EtaY]];
2624 <span class="keyword">else</span>
2625     <span class="comment">% Remove dispersion from the model for ChiSquare</span>
2626     <span class="keyword">if</span> ~isempty(FitParameters.DeltaRF)
2627         Mmodel = Mmodel(:,1:end-1);
2628     <span class="keyword">end</span>
2629 <span class="keyword">end</span>
2630 
2631 <span class="comment">% Without NumberOfParameters (since no fits were done yet, but this is a little confusing to some)</span>
2632 ChiSquare = sum(((Mmeas - Mmodel(:)) ./ Mstd) .^ 2) / length(Mstd);
2633 
2634 
2635 <span class="comment">% Remove the disperion for the output is it has not been already removed</span>
2636 <span class="keyword">if</span> strcmpi((LocoFlags.Dispersion),<span class="string">'yes'</span>)
2637     Mmodel = Mmodel(:,1:end-1);
2638 <span class="keyword">end</span>
2639 
2640 
2641 <span class="comment">% Unit conversions (back to LOCO units)</span>
2642 <span class="comment">%CMData.HCMKicks = 1000*CMData.HCMKicks;        % radian to milliradians</span>
2643 <span class="comment">%CMData.VCMKicks = 1000*CMData.VCMKicks;        % radian to milliradians</span>
2644 Mmodel = 1000*Mmodel;             <span class="comment">% meters to millimeters</span>
2645 Dispersion = 1000*Dispersion;     <span class="comment">% meters to millimeters</span>
2646 
2647 <span class="comment">% Start addon Laurent</span>
2648 <a name="_sub25" href="#_subfunctions" class="code">function varargout = uimenu_plotK_Callback(h, eventdata, handles, varargin)</a>
2649 
2650 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
2651 <span class="keyword">if</span> isempty(LocoDataCell)
2652     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
2653     <span class="keyword">if</span> isempty(FileName)
2654         fprintf(<span class="string">'   File does not exist.\n'</span>);
2655         <span class="keyword">return</span>
2656     <span class="keyword">end</span>
2657     <span class="keyword">try</span>
2658         load(FileName);
2659     <span class="keyword">catch</span>
2660         fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
2661         cla;
2662         <span class="keyword">return</span>
2663     <span class="keyword">end</span>
2664 <span class="keyword">else</span>
2665     BPMData       = LocoDataCell{1};
2666     CMData        = LocoDataCell{2};
2667     LocoMeasData  = LocoDataCell{3};
2668     LocoModel     = LocoDataCell{4};
2669     FitParameters = LocoDataCell{5};
2670     LocoFlags     = LocoDataCell{6};
2671     RINGData      = LocoDataCell{7};
2672 <span class="keyword">end</span>
2673 
2674 i = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'Value'</span>);  <span class="comment">% The first point in the array is starting point</span>
2675 
2676 <span class="comment">% If the LocoModel does not exist, then compute it</span>
2677 <span class="keyword">if</span> isempty(LocoModel(i).M) | isempty(LocoModel(i).Eta) | isempty(LocoModel(i).ChiSquare)
2678     [LocoModel(i).M, LocoModel(i).Eta, LocoModel(i).ChiSquare] = <a href="#_sub24" class="code" title="subfunction [Mmodel, Dispersion, ChiSquare] = getmodelresponsematrix(BPMData, CMData, FitParameters, LocoFlags, LocoMeasData, RINGData)">getmodelresponsematrix</a>(BPMData(i), CMData(i), FitParameters(i), <span class="keyword">...</span>
2679 LocoFlags(i), LocoMeasData, RINGData);
2680     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
2681     save(FileName, <span class="string">'LocoModel'</span>, <span class="string">'FitParameters'</span>, <span class="string">'BPMData'</span>, <span class="string">'CMData'</span>, <span class="string">'RINGData'</span>, <span class="string">'LocoMeasData'</span>, <span class="string">'LocoFlags'</span>);
2682     setappdata(gcbf, <span class="string">'LocoDataCell'</span>, {BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
2683 <span class="keyword">end</span>
2684 
2685 Mmodel = LocoModel(i).M;
2686  
2687 figure
2688 [K1, Tune1] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel,FitParameters, LocoFlags, RINGData}, i-1, <span class="string">'FitValues'</span>,[],<span class="string">'Tune'</span>,[]);
2689 [K0, Tune0] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData},   0, <span class="string">'FitValues'</span>,[],<span class="string">'Tune'</span>,[]);
2690 <span class="keyword">if</span> ~isempty(K1) &amp; ~isempty(K0)
2691     <span class="keyword">if</span> length(K1) &gt; 10 <span class="comment">% individual quads</span>
2692         bar((K1-K0)./K0*100, <span class="string">'b'</span>);
2693         xlabel(<span class="string">'Quadrupole number'</span>);
2694         ylabel(sprintf(<span class="string">'(K(%d)-K(0))/K0 [%%]'</span>,i-1));
2695         title(texlabel(sprintf(<span class="string">'DK (nu_x(%d)=%.4f, nu_x(0)=%.4f) (nu_y(%d)=%.4f, nu_y(0)=%.4f)'</span>, <span class="keyword">...</span>
2696             i-1, Tune1(1),Tune0(1), i-1, Tune1(2),Tune0(2))));
2697         xaxis([0 length(K1)+1]); grid on; hold on;
2698         a = axis;
2699         plot([9 9], [-8 8],<span class="string">'r-.'</span>)
2700         plot([17 17], [-8 8],<span class="string">'r-.'</span>)
2701         plot([25 25], [-8 8],<span class="string">'r-.'</span>)
2702         plot([41 41], [-8 8],<span class="string">'r-.'</span>)
2703         plot([57 57], [-8 8],<span class="string">'r-.'</span>)
2704         plot([81 81], [-8 8],<span class="string">'r-.'</span>)
2705         plot([105 105], [-8 8],<span class="string">'r-.'</span>)
2706         plot([129 129], [-8 8],<span class="string">'r-.'</span>)
2707         plot([145 145], [-8 8],<span class="string">'r-.'</span>)
2708         hold off
2709         axis(a);
2710         
2711         <span class="comment">% quadrupoles sorted in machine order</span>
2712         quadpos = [getspos(<span class="string">'Q1'</span>); getspos(<span class="string">'Q2'</span>) ; getspos(<span class="string">'Q3'</span>) ; getspos(<span class="string">'Q4'</span>); <span class="keyword">...</span>
2713             getspos(<span class="string">'Q5'</span>) ; getspos(<span class="string">'Q6'</span>) ; getspos(<span class="string">'Q7'</span>) ; getspos(<span class="string">'Q8'</span>); <span class="keyword">...</span>
2714             getspos(<span class="string">'Q9'</span>); getspos(<span class="string">'Q10'</span>)];
2715 
2716         [y id] = sort(quadpos);
2717         figure;
2718         DKoK = (K1-K0)./K0*100;
2719         stem(y,DKoK(id));
2720     <span class="keyword">else</span>
2721         bar((K1-K0)./K0*100, <span class="string">'b'</span>);
2722         xlabel(<span class="string">'Quadrupole family number'</span>);
2723         ylabel(sprintf(<span class="string">'(K(%d)-K(0))/K0 [%%]'</span>,i-1));
2724         title(texlabel(sprintf(<span class="string">'DK (nu_x(%d)=%.4f, nu_x(0)=%.4f) (nu_y(%d)=%.4f, nu_y(0)=%.4f)'</span>, <span class="keyword">...</span>
2725             i-1, Tune1(1),Tune0(1), i-1, Tune1(2),Tune0(2))));
2726         xaxis([0 length(K1)+1]); grid on; hold on;
2727     <span class="keyword">end</span>
2728 <span class="keyword">end</span>
2729 
2730 <span class="comment">% exporting data into matlab workspace</span>
2731 <a name="_sub26" href="#_subfunctions" class="code">function varargout = uimenu_exportK_Callback(h, eventdata, handles, varargin)</a>
2732 
2733 LocoDataCell = getappdata(gcbf, <span class="string">'LocoDataCell'</span>);
2734 <span class="keyword">if</span> isempty(LocoDataCell)
2735     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
2736     <span class="keyword">if</span> isempty(FileName)
2737         fprintf(<span class="string">'   File does not exist.\n'</span>);
2738         <span class="keyword">return</span>
2739     <span class="keyword">end</span>
2740     <span class="keyword">try</span>
2741         load(FileName);
2742     <span class="keyword">catch</span>
2743         fprintf(<span class="string">'   File does not exist or is not a *.mat file type.\n'</span>);
2744         cla;
2745         <span class="keyword">return</span>
2746     <span class="keyword">end</span>
2747 <span class="keyword">else</span>
2748     BPMData       = LocoDataCell{1};
2749     CMData        = LocoDataCell{2};
2750     LocoMeasData  = LocoDataCell{3};
2751     LocoModel     = LocoDataCell{4};
2752     FitParameters = LocoDataCell{5};
2753     LocoFlags     = LocoDataCell{6};
2754     RINGData      = LocoDataCell{7};
2755 <span class="keyword">end</span>
2756 
2757 i = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'PlotIteration'</span>),<span class="string">'Value'</span>);  <span class="comment">% The first point in the array is starting point</span>
2758 
2759 <span class="comment">% If the LocoModel does not exist, then compute it</span>
2760 <span class="keyword">if</span> isempty(LocoModel(i).M) | isempty(LocoModel(i).Eta) | isempty(LocoModel(i).ChiSquare)
2761     [LocoModel(i).M, LocoModel(i).Eta, LocoModel(i).ChiSquare] = <a href="#_sub24" class="code" title="subfunction [Mmodel, Dispersion, ChiSquare] = getmodelresponsematrix(BPMData, CMData, FitParameters, LocoFlags, LocoMeasData, RINGData)">getmodelresponsematrix</a>(BPMData(i), CMData(i), FitParameters(i), <span class="keyword">...</span>
2762 LocoFlags(i), LocoMeasData, RINGData);
2763     FileName = get(findobj(gcbf,<span class="string">'Tag'</span>,<span class="string">'FileName'</span>),<span class="string">'Userdata'</span>);
2764     save(FileName, <span class="string">'LocoModel'</span>, <span class="string">'FitParameters'</span>, <span class="string">'BPMData'</span>, <span class="string">'CMData'</span>, <span class="string">'RINGData'</span>, <span class="string">'LocoMeasData'</span>, <span class="string">'LocoFlags'</span>);
2765     setappdata(gcbf, <span class="string">'LocoDataCell'</span>, {BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData});
2766 <span class="keyword">end</span>
2767 
2768 <span class="comment">%global LOCOstruct; % pas beau</span>
2769 
2770 Mmodel = LocoModel(i).M;
2771  
2772 [K1, Tune1] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel,FitParameters, LocoFlags, RINGData}, i-1, <span class="string">'FitValues'</span>,[],<span class="string">'Tune'</span>,[]);
2773 [K0, Tune0] = <a href="locodata.html" class="code" title="function varargout = locodata(FileName, IterationNumber, varargin)">locodata</a>({BPMData, CMData, LocoMeasData, LocoModel, FitParameters, LocoFlags, RINGData},   0, <span class="string">'FitValues'</span>,[],<span class="string">'Tune'</span>,[]);
2774 
2775 <span class="keyword">if</span> ~isempty(K1) &amp; ~isempty(K0)
2776     LOCOstruct.DKoK = (K1-K0)./K0*100;
2777     LOCOstruct.DK = (K1-K0);
2778     LOCOstruct.CreatedBy = <span class="string">'locogui'</span>;
2779     LOCOstruct.TimeStamp = datestr(now)
2780 <span class="keyword">end</span>
2781 
2782 assignin(<span class="string">'base'</span>, <span class="string">'LOCOstruct'</span>, LOCOstruct);
2783 <span class="comment">% End addon Laurent</span></pre></div>
<hr><address>Generated on Mon 21-May-2007 15:32:41 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>