<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of orbgui</title>
  <meta name="keywords" content="orbgui">
  <meta name="description" content="ORBGUI -- Contains routines to set up the main orbit control panel">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">applications</a> &gt; <a href="index.html">orbit</a> &gt; orbgui.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for applications/orbit&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>orbgui
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>ORBGUI -- Contains routines to set up the main orbit control panel</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = orbgui(action, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">ORBGUI -- Contains routines to set up the main orbit control panel
  for the 'orbit' program
 function varargout = orbgui(action, varargin)
  orbgui contains routines to set up the main orbit control panel
  for the 'orbit' program
  routines contained in orbgui switchyard are:

 OrbFig
 BPMAxes
 LatticeAxes
 CorAxes
 MachineParameters
 UpdateParameters
 SVDAxes
 PlotMenu
 BPMChangeUnits
 CORChangeUnits
 LoadRaw2Real
 AlgorithmMenu
 SVDAlgo
 SuperperiodMenu
 BPMMenu
 CORMenu
 EtaMenu
 SYSMenu
 Switch2online
 Switch2sim
 OptMenu
 SimMenu
 Cor2Zero
 Quad2Zero
 QuadOffset
 MakeNewRef
 PlotAlign
 SetTune
 UpdateOptics
 DisplayOpticsEXCEL
 DisplayOptics
 PlotBetaFunctions
 PlotRingElements
 RespMenu
 UIControls
 BPMbox
 CorBox
 SVDBox
 KnobBox
 Plane
 TogglePlane
 RefreshOrbGUI
 Relative
 Abort
 ScaleBPMAxis
 AutoScaleBPMAxis
 AutoScaleCorrAxis
 ScaleCORAxis
 BPMPlotScale
 ProcessBPMScale
 PlotSPosition
 PlotPhase
 BPMScaleType
 CorPlotScale
 CORScaleType
 ProcessCORScale
 LstBox
 LBox
 GetAbscissa
 InitialSaveSet
 SaveSet2Initial
 SaveSet
 MoveSaveSet
 RestoreSaveSet
 UnDrawSaveSet
 ReDrawSaveSet
 DeleteSaveSet
 SelectSaveSet
 LoadSaveSet
 RestoreSystem
 SaveSystem
 SaveBump
 CloseMainFigure</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>	function varargout = bpmgui(action, varargin)</li><li><a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>	CORGUI - controls corrector manipulation and plotting for orbit program</li><li><a href="getringparams.html" class="code" title="function [energy, current, lifetime] = getringparams">getringparams</a>	GETRINGPARAMS - Fonction reading the storage ring current, beamlifetime, energy</li><li><a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>	ORBGUI -- Contains routines to set up the main orbit control panel</li><li><a href="respgui.html" class="code" title="function respgui(action, varargin)">respgui</a>	RESPGUI - Part treating of the response matrice and the correction</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>	function varargout = bpmgui(action, varargin)</li><li><a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>	CORGUI - controls corrector manipulation and plotting for orbit program</li><li><a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>	ORBGUI -- Contains routines to set up the main orbit control panel</li><li><a href="readwrite.html" class="code" title="function readwrite(action, varargin)">readwrite</a>	READWRITE - Multipurpose read/write function for orbit correction applicaiton</li><li><a href="respgui.html" class="code" title="function respgui(action, varargin)">respgui</a>	RESPGUI - Part treating of the response matrice and the correction</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = orbgui(action, varargin)</a>
0002 <span class="comment">%ORBGUI -- Contains routines to set up the main orbit control panel</span>
0003 <span class="comment">%  for the 'orbit' program</span>
0004 <span class="comment">% function varargout = orbgui(action, varargin)</span>
0005 <span class="comment">%  orbgui contains routines to set up the main orbit control panel</span>
0006 <span class="comment">%  for the 'orbit' program</span>
0007 <span class="comment">%  routines contained in orbgui switchyard are:</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% OrbFig</span>
0010 <span class="comment">% BPMAxes</span>
0011 <span class="comment">% LatticeAxes</span>
0012 <span class="comment">% CorAxes</span>
0013 <span class="comment">% MachineParameters</span>
0014 <span class="comment">% UpdateParameters</span>
0015 <span class="comment">% SVDAxes</span>
0016 <span class="comment">% PlotMenu</span>
0017 <span class="comment">% BPMChangeUnits</span>
0018 <span class="comment">% CORChangeUnits</span>
0019 <span class="comment">% LoadRaw2Real</span>
0020 <span class="comment">% AlgorithmMenu</span>
0021 <span class="comment">% SVDAlgo</span>
0022 <span class="comment">% SuperperiodMenu</span>
0023 <span class="comment">% BPMMenu</span>
0024 <span class="comment">% CORMenu</span>
0025 <span class="comment">% EtaMenu</span>
0026 <span class="comment">% SYSMenu</span>
0027 <span class="comment">% Switch2online</span>
0028 <span class="comment">% Switch2sim</span>
0029 <span class="comment">% OptMenu</span>
0030 <span class="comment">% SimMenu</span>
0031 <span class="comment">% Cor2Zero</span>
0032 <span class="comment">% Quad2Zero</span>
0033 <span class="comment">% QuadOffset</span>
0034 <span class="comment">% MakeNewRef</span>
0035 <span class="comment">% PlotAlign</span>
0036 <span class="comment">% SetTune</span>
0037 <span class="comment">% UpdateOptics</span>
0038 <span class="comment">% DisplayOpticsEXCEL</span>
0039 <span class="comment">% DisplayOptics</span>
0040 <span class="comment">% PlotBetaFunctions</span>
0041 <span class="comment">% PlotRingElements</span>
0042 <span class="comment">% RespMenu</span>
0043 <span class="comment">% UIControls</span>
0044 <span class="comment">% BPMbox</span>
0045 <span class="comment">% CorBox</span>
0046 <span class="comment">% SVDBox</span>
0047 <span class="comment">% KnobBox</span>
0048 <span class="comment">% Plane</span>
0049 <span class="comment">% TogglePlane</span>
0050 <span class="comment">% RefreshOrbGUI</span>
0051 <span class="comment">% Relative</span>
0052 <span class="comment">% Abort</span>
0053 <span class="comment">% ScaleBPMAxis</span>
0054 <span class="comment">% AutoScaleBPMAxis</span>
0055 <span class="comment">% AutoScaleCorrAxis</span>
0056 <span class="comment">% ScaleCORAxis</span>
0057 <span class="comment">% BPMPlotScale</span>
0058 <span class="comment">% ProcessBPMScale</span>
0059 <span class="comment">% PlotSPosition</span>
0060 <span class="comment">% PlotPhase</span>
0061 <span class="comment">% BPMScaleType</span>
0062 <span class="comment">% CorPlotScale</span>
0063 <span class="comment">% CORScaleType</span>
0064 <span class="comment">% ProcessCORScale</span>
0065 <span class="comment">% LstBox</span>
0066 <span class="comment">% LBox</span>
0067 <span class="comment">% GetAbscissa</span>
0068 <span class="comment">% InitialSaveSet</span>
0069 <span class="comment">% SaveSet2Initial</span>
0070 <span class="comment">% SaveSet</span>
0071 <span class="comment">% MoveSaveSet</span>
0072 <span class="comment">% RestoreSaveSet</span>
0073 <span class="comment">% UnDrawSaveSet</span>
0074 <span class="comment">% ReDrawSaveSet</span>
0075 <span class="comment">% DeleteSaveSet</span>
0076 <span class="comment">% SelectSaveSet</span>
0077 <span class="comment">% LoadSaveSet</span>
0078 <span class="comment">% RestoreSystem</span>
0079 <span class="comment">% SaveSystem</span>
0080 <span class="comment">% SaveBump</span>
0081 <span class="comment">% CloseMainFigure</span>
0082 <span class="comment">%</span>
0083 
0084 <span class="comment">%</span>
0085 <span class="comment">% Written by J. Corbett</span>
0086 <span class="comment">% Adapted by Laurent S. Nadolski</span>
0087 
0088 <span class="comment">% graphics handles</span>
0089 
0090 <span class="comment">% globals</span>
0091 <span class="keyword">global</span> BPM COR RSP SYS THERING
0092 orbfig = findobj(0,<span class="string">'tag'</span>,<span class="string">'orbfig'</span>);
0093 plane  = SYS.plane; <span class="comment">% 1 for H and 2 for V</span>
0094 
0095 [BPMxFamily, BPMzFamily] = BPM.AOFamily;
0096 [HCORFamily, VCORFamily] = COR.AOFamily;
0097 
0098 <span class="keyword">switch</span> action
0099 
0100     <span class="comment">%==========================================================</span>
0101     <span class="keyword">case</span> <span class="string">'OrbFig'</span>                               <span class="comment">%OrbFig</span>
0102     <span class="comment">%==========================================================</span>
0103         <span class="comment">%orbfig sets up the main figure for the Orbit program.</span>
0104         <span class="comment">%orbit and corrector plots, uicontrols and uimenus fit into orbfig.</span>
0105         <span class="comment">%to print graphics activate menubar</span>
0106         <span class="comment">%PaperPosition sets orientation of figure on print page</span>
0107 
0108         <span class="comment">%screen size call</span>
0109         [screen_wide, screen_high]=screensizecm;
0110 
0111         <span class="comment">%fig_start = [0.13*screen_wide 0.16*screen_high];</span>
0112         fig_start = [0.1*screen_wide 0.1*screen_high];
0113         <span class="comment">%fig_size  = [0.78125*screen_wide 0.78125*screen_high];</span>
0114         fig_size  = [0.8125*screen_wide 0.8*screen_high];
0115         SYS.orbfig = figure(<span class="string">'Visible'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0116             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
0117             <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0118             <span class="string">'Doublebuffer'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0119             <span class="string">'Tag'</span>,<span class="string">'orbfig'</span>,<span class="keyword">...</span>
0120             <span class="string">'Name'</span>,<span class="string">'SOLEIL Storage Ring Orbit Correction Interface v.1'</span>,<span class="keyword">...</span>
0121             <span class="string">'PaperPositionMode'</span>,<span class="string">'Auto'</span>,<span class="keyword">...</span>
0122             <span class="string">'MenuBar'</span>,<span class="string">'None'</span>, <span class="string">'Position'</span>,[fig_start fig_size], <span class="keyword">...</span>
0123             <span class="string">'Resize'</span>,<span class="string">'off'</span>, <span class="string">'CloseRequestFcn'</span>, <span class="keyword">...</span>
0124             <span class="string">'orbgui(''CloseMainFigure'')'</span>);
0125         <span class="comment">%set(SYS.orbfig,'DeleteFcn',['st=fclose(''all'');' 'CloseCAQuery'],'Resize','off');</span>
0126 
0127 <span class="comment">%         %==========================================================</span>
0128 <span class="comment">%     case 'Axes_1'                               %Axes_1</span>
0129 <span class="comment">%         %==========================================================</span>
0130 <span class="comment">%         %Establish top axes</span>
0131 <span class="comment">%</span>
0132 <span class="comment">%         [screen_wide, screen_high] = screensizecm;</span>
0133 <span class="comment">%</span>
0134 <span class="comment">%         x0=0.0478*screen_wide; y0=0.5*screen_high; dx=0.7383*screen_wide; dy=0.2*screen_high;</span>
0135 <span class="comment">%</span>
0136 <span class="comment">%         % axe handle 1 = ah1</span>
0137 <span class="comment">%         SYS.ahbpm = axes('Units','centimeters',...</span>
0138 <span class="comment">%             'Color', [1 1 1], ...</span>
0139 <span class="comment">%             'Box','on',...</span>
0140 <span class="comment">%             'YGrid','on',...</span>
0141 <span class="comment">%             'Position',[x0 y0 dx dy]);</span>
0142 <span class="comment">%</span>
0143 <span class="comment">%         set(SYS.ahbpm,'xticklabelmode','manual');</span>
0144 <span class="comment">%         set(SYS.ahbpm,'xticklabel',[]);</span>
0145 <span class="comment">%         varargout{1} = SYS.ahbpm;</span>
0146 
0147         <span class="comment">%==========================================================</span>
0148     <span class="keyword">case</span> <span class="string">'BPMAxes'</span>                               <span class="comment">%BPMAxes</span>
0149         <span class="comment">%==========================================================</span>
0150         <span class="comment">%BPMAxes is the axes to plot: reference, desired, actual, predicted</span>
0151         <span class="comment">%columns of response matrix and svd orbit eigenvectors (columns of U: R=UWVt)</span>
0152         <span class="comment">%need NextPlot add to prevent PLOT from resetting fields to default (incl tag)</span>
0153         <span class="comment">%DrawMode</span>
0154 
0155         [screen_wide, screen_high] = screensizecm;
0156 
0157         x0=0.0478*screen_wide; y0=0.5*screen_high; 
0158         dx=0.7383*screen_wide; dy=0.2*screen_high;
0159 
0160         <span class="comment">% axe handle 1 = ah1</span>
0161         SYS.ahbpm = axes(<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
0162             <span class="string">'Color'</span>, [1 1 1], <span class="keyword">...</span>
0163             <span class="string">'Box'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0164             <span class="string">'YGrid'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0165             <span class="string">'Position'</span>,[x0 y0 dx dy]);
0166 
0167         set(SYS.ahbpm,<span class="string">'xticklabelmode'</span>,<span class="string">'manual'</span>);
0168         set(SYS.ahbpm,<span class="string">'xticklabel'</span>,[]);
0169 
0170         set(SYS.ahbpm,<span class="string">'NextPlot'</span>,<span class="string">'add'</span>);
0171         set(SYS.ahbpm,<span class="string">'ButtonDownFcn'</span>,<span class="string">'bpmgui(''BPMSelect'')'</span>);
0172         set(SYS.ahbpm,<span class="string">'xticklabelmode'</span>,<span class="string">'manual'</span>);
0173         set(SYS.ahbpm,<span class="string">'xticklabel'</span>,[]);
0174 
0175         label = [<span class="string">'BPM Value  ('</span>,  getfamilydata(BPMxFamily,<span class="string">'Monitor'</span>,<span class="string">'HWUnits'</span>), <span class="string">')'</span>];
0176 
0177         set(get(SYS.ahbpm,<span class="string">'Ylabel'</span>),<span class="string">'string'</span>,label);  <span class="comment">%handle for xlabel</span>
0178 
0179 <span class="comment">%         set(SYS.ahbpm,'NextPlot','add');</span>
0180 <span class="comment">%         set(SYS.ahbpm,'ButtonDownFcn','bpmgui(''BPMSelect'')');</span>
0181 <span class="comment">%         set(SYS.ahbpm,'xticklabelmode','manual');</span>
0182 <span class="comment">%         set(SYS.ahbpm,'xticklabel',[]);</span>
0183 <span class="comment">%</span>
0184 <span class="comment">%         label = ['BPM Value  (',  getfamilydata(BPMxFamily,'Monitor','HWUnits'), ')'];</span>
0185 <span class="comment">%</span>
0186 <span class="comment">%         set(get(SYS.ahbpm,'Ylabel'),'string',label);  %handle for xlabel</span>
0187 
0188        <span class="comment">%==========================================================</span>
0189     <span class="keyword">case</span> <span class="string">'LatticeAxes'</span>                                   <span class="comment">%ZoomAxes</span>
0190         <span class="comment">%==========================================================</span>
0191         <span class="comment">%Position Axes is for slider that controls zoom of display windows</span>
0192 
0193         [screen_wide, screen_high] = screensizecm;
0194 
0195         x0 = 0.0478*screen_wide; y0 = 0.473*screen_high; 
0196         dx = 0.7383*screen_wide; dy = 0.025*screen_high;
0197 
0198         SYS.ahpos = axes(<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
0199             <span class="string">'Color'</span>, [1 1 1],<span class="keyword">...</span>
0200             <span class="string">'Box'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0201             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
0202             <span class="string">'xticklabelmode'</span>,<span class="string">'manual'</span>,<span class="keyword">...</span>
0203             <span class="string">'yticklabelmode'</span>,<span class="string">'manual'</span>,<span class="keyword">...</span>
0204             <span class="string">'xtickmode'</span>,<span class="string">'manual'</span>,<span class="keyword">...</span>
0205             <span class="string">'ytickmode'</span>,<span class="string">'manual'</span>);
0206 
0207         drawlattice;
0208         
0209         set(SYS.ahpos,<span class="string">'XTick'</span>,[],<span class="string">'YTick'</span>,[]); <span class="comment">% to erase tick labels</span>
0210        
0211         setappdata(0,<span class="string">'SYS'</span>,SYS);
0212 
0213         <span class="comment">%==========================================================</span>
0214     <span class="keyword">case</span> <span class="string">'CorAxes'</span>                               <span class="comment">%CorAxes</span>
0215         <span class="comment">%==========================================================</span>
0216         <span class="comment">%CorAxes are the axes to plot: actual, fit correctors</span>
0217         <span class="comment">%and svd corrector eigenvectors (columns of V: R=UWVt)</span>
0218 
0219         [screen_wide, screen_high]=screensizecm;
0220 
0221         x0=0.0478*screen_wide; y0=0.27*screen_high; 
0222         dx=0.7383*screen_wide; dy=0.2*screen_high;
0223 
0224         <span class="comment">%axe handle for correctors</span>
0225         SYS.ahcor = axes(<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
0226             <span class="string">'NextPlot'</span>,<span class="string">'add'</span>,<span class="keyword">...</span>
0227             <span class="string">'Color'</span>, [1 1 1], <span class="keyword">...</span>
0228             <span class="string">'Box'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0229             <span class="string">'YGrid'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
0230             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
0231             <span class="string">'ButtonDownFcn'</span>,<span class="string">'corgui(''CorSelect'')'</span>);
0232 
0233         label=[<span class="string">'Corrector Value  ('</span>,  getfamilydata(HCORFamily,<span class="string">'Setpoint'</span>,<span class="string">'HWUnits'</span>), <span class="string">')'</span>];
0234 
0235         set(get(SYS.ahcor,<span class="string">'Ylabel'</span>),<span class="string">'string'</span>,label);  <span class="comment">%handle for xlabel</span>
0236         set(get(SYS.ahcor,<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,<span class="string">'Position in Storage Ring (m)'</span>);
0237 
0238         setappdata(0,<span class="string">'SYS'</span>,SYS);
0239 
0240         <span class="comment">%==========================================================</span>
0241     <span class="keyword">case</span> <span class="string">'MachineParameters'</span>              <span class="comment">%...MachineParameters</span>
0242         <span class="comment">%==========================================================</span>
0243         <span class="comment">%Create field boxes to display beam energy and current</span>
0244         [screen_wide, screen_high] = screensizecm;
0245 
0246         x0=0.4*screen_wide; y0=0.76*screen_high; dx=0.08*screen_wide; dy=0.02*screen_high;
0247 
0248         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span><span class="comment">                            %Current Text</span>
0249             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0+0*dx y0 dx dy],<span class="keyword">...</span>
0250             <span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>,<span class="keyword">...</span>
0251             <span class="string">'ToolTipString'</span>,<span class="string">'Electron Beam Current (A)'</span>,<span class="keyword">...</span>
0252             <span class="string">'String'</span>,<span class="string">'Current (mA)'</span>);
0253 
0254         SYS.hcurrent=uicontrol(<span class="string">'Style'</span>,<span class="string">'PushButton'</span>,<span class="keyword">...</span><span class="comment">  %Current Display</span>
0255             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0+1.1*dx y0+0.005*screen_high dx/1.5 dy],<span class="keyword">...</span>
0256             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
0257             <span class="string">'ToolTipString'</span>,<span class="string">'Electron Beam Current (A)'</span>,<span class="keyword">...</span>
0258             <span class="string">'CallBack'</span>,<span class="string">'orbgui(''UpdateParameters'')'</span>,<span class="keyword">...</span>
0259             <span class="string">'String'</span>,num2str(SYS.current, <span class="string">'%6.1f'</span>));
0260 
0261         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span><span class="comment">                           %Energy Text</span>
0262             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0+0*dx y0-dy dx dy],<span class="keyword">...</span>
0263             <span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>,<span class="keyword">...</span>
0264             <span class="string">'ToolTipString'</span>,<span class="string">'Electron Beam Energy (GeV)'</span>,<span class="keyword">...</span>
0265             <span class="string">'String'</span>,<span class="string">'Energy (GeV)'</span>);
0266 
0267         SYS.henergy=uicontrol(<span class="string">'Style'</span>,<span class="string">'PushButton'</span>,<span class="keyword">...</span><span class="comment">   %Energy Display</span>
0268             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0+1.1*dx y0-dy+0.005*screen_high dx/1.5 dy],<span class="keyword">...</span>
0269             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
0270             <span class="string">'ToolTipString'</span>,<span class="string">'Electron Beam Energy (GeV)'</span>,<span class="keyword">...</span>
0271             <span class="string">'CallBack'</span>,<span class="string">'orbgui(''UpdateParameters'')'</span>,<span class="keyword">...</span>
0272             <span class="string">'String'</span>,num2str(SYS.energy, <span class="string">'%6.4f'</span>));
0273 
0274         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span><span class="comment">                            %Lifetime Text</span>
0275             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0+1.8*dx y0 dx dy],<span class="keyword">...</span>
0276             <span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>,<span class="keyword">...</span>
0277             <span class="string">'ToolTipString'</span>,<span class="string">'Electron Beam Lifetime (h)'</span>,<span class="keyword">...</span>
0278             <span class="string">'String'</span>,<span class="string">'Lifetime (h)'</span>);
0279 
0280         SYS.hlifetime=uicontrol(<span class="string">'Style'</span>,<span class="string">'PushButton'</span>,<span class="keyword">...</span><span class="comment"> %Lifetime Display</span>
0281             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0+3.0*dx y0+0.005*screen_high dx/1.5 dy],<span class="keyword">...</span>
0282             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
0283             <span class="string">'ToolTipString'</span>,<span class="string">'Electron Beam Lifetime (h)'</span>,<span class="keyword">...</span>
0284             <span class="string">'CallBack'</span>,<span class="string">'orbgui(''UpdateParameters'')'</span>,<span class="keyword">...</span>
0285             <span class="string">'String'</span>,num2str(SYS.lifetime, <span class="string">'%6.1f'</span>));
0286 
0287         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span><span class="comment">                            %Amp-hr Text</span>
0288             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0+1.8*dx y0-dy dx dy],<span class="keyword">...</span>
0289             <span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>,<span class="keyword">...</span>
0290             <span class="string">'ToolTipString'</span>,<span class="string">'Running mode: online or simulator'</span>,<span class="keyword">...</span>
0291             <span class="string">'String'</span>,<span class="string">'Mode'</span>);
0292 
0293         SYS.modecolor = uicontrol(<span class="string">'Style'</span>,<span class="string">'PushButton'</span>,<span class="keyword">...</span><span class="comment">                            %Amp-hr Text</span>
0294             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0 + 3*dx y0 - dy dx/1.5 dy],<span class="keyword">...</span>
0295             <span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>);
0296               
0297 <span class="comment">%         uicontrol('Style','text',...                            %Amp-hr Text</span>
0298 <span class="comment">%             'units', 'centimeters','Position',[x0+1.8*dx y0-dy dx dy],...</span>
0299 <span class="comment">%             'HorizontalAlignment','right',...</span>
0300 <span class="comment">%             'ToolTipString','Electron beam amp-hours',...</span>
0301 <span class="comment">%             'String','Amp-hr:');</span>
0302 <span class="comment">%</span>
0303 <span class="comment">%         SYS.amphr=uicontrol('Style','PushButton',...     %Amp-hr Display</span>
0304 <span class="comment">%             'units', 'centimeters','Position',[x0+3.0*dx y0-dy+0.005*screen_high dx/1.5 dy],...</span>
0305 <span class="comment">%             'BackGroundColor',[0.77 0.91 1.00],...</span>
0306 <span class="comment">%             'ToolTipString','Electron beam amp-hours',...</span>
0307 <span class="comment">%             'CallBack','orbgui(''UpdateParameters'')',...</span>
0308 <span class="comment">%             'String',num2str(SYS.ahr, '%6.1f'));</span>
0309 
0310         setappdata(0,<span class="string">'SYS'</span>,SYS);
0311 
0312         <span class="comment">%==========================================================</span>
0313     <span class="keyword">case</span> <span class="string">'UpdateParameters'</span>              <span class="comment">%...UpdateParameters</span>
0314         <span class="comment">%==========================================================</span>
0315         <span class="comment">%Update field boxes that display machine parameters</span>
0316 
0317         
0318         <span class="keyword">if</span> strcmpi(SYS.machine,<span class="string">'Ring'</span>)
0319             [SYS.energy,SYS.current,SYS.lifetime] = <a href="getringparams.html" class="code" title="function [energy, current, lifetime] = getringparams">getringparams</a>;
0320             setappdata(0,<span class="string">'SYS'</span>,SYS);
0321         <span class="keyword">end</span>
0322         set(SYS.henergy,  <span class="string">'String'</span>,num2str(SYS.energy,  <span class="string">'%6.4f'</span>));
0323         set(SYS.hcurrent, <span class="string">'String'</span>,num2str(SYS.current, <span class="string">'%6.3f'</span>));        
0324         set(SYS.hlifetime,<span class="string">'String'</span>,num2str(SYS.lifetime,<span class="string">'%6.3f'</span>));
0325 
0326         <span class="comment">%==========================================================</span>
0327     <span class="keyword">case</span> <span class="string">'SVDAxes'</span>                               <span class="comment">%SVDAxes</span>
0328         <span class="comment">%==========================================================</span>
0329         <span class="comment">%SVDAxes are the axes to plot singular value spectrum/logarithmic</span>
0330 
0331         <span class="comment">%screen size call</span>
0332         [screen_wide, screen_high]=screensizecm;
0333 
0334         x0=0.6*screen_wide; dx=0.19*screen_wide; 
0335         y0=0.0495*screen_high; dy=0.14*screen_high;
0336 
0337         <span class="comment">% axe handle for SVD</span>
0338         SYS.ahsvd = axes(<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'NextPlot'</span>, <span class="keyword">...</span>
0339             <span class="string">'add'</span>,<span class="string">'Color'</span>, [1 1 1],<span class="string">'Box'</span>,<span class="string">'On'</span>,<span class="string">'Position'</span>,[x0 y0 dx dy], <span class="keyword">...</span>
0340             <span class="string">'XminorTick'</span>,<span class="string">'On'</span>,<span class="string">'YminorTick'</span>,<span class="string">'On'</span>);
0341 
0342         setappdata(0,<span class="string">'SYS'</span>,SYS);
0343 
0344         set(get(SYS.ahsvd,<span class="string">'Ylabel'</span>),<span class="string">'string'</span>,<span class="string">'Singular Value'</span>);
0345         set(get(SYS.ahsvd,<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,<span class="string">'Singular Value Index'</span>);
0346         
0347         <span class="comment">%==========================================================</span>
0348     <span class="keyword">case</span> <span class="string">'PlotMenu'</span>                               <span class="comment">%  PlotMenu</span>
0349         <span class="comment">%==========================================================</span>
0350         <span class="comment">%*** PLOT MENU ***</span>
0351         mh.plot = uimenu(<span class="string">'Label'</span>,<span class="string">'Plot    '</span>);
0352         uimenu(mh.plot,<span class="string">'Label'</span>,<span class="string">'BPM Plot Scale'</span>, <span class="keyword">...</span>
0353             <span class="string">'Callback'</span>,<span class="string">'orbgui(''BPMPlotScale'')'</span>);
0354         uimenu(mh.plot,<span class="string">'Label'</span>,<span class="string">'Corrector Plot Scale'</span>, <span class="keyword">...</span>
0355             <span class="string">'Callback'</span>,<span class="string">'orbgui(''CorPlotScale'')'</span>);
0356         mh.r2=uimenu(mh.plot,<span class="string">'Label'</span>,<span class="string">'BPM Unit Data Display'</span>);
0357         SYS.BPMPhysicsUnits = <span class="keyword">...</span>
0358             uimenu(mh.r2,<span class="string">'Label'</span>,<span class="string">'Physics Units'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0359             <span class="string">'orbgui(''BPMChangeUnits'',''Physics'')'</span>);
0360         SYS.BPMHardwareUnits = <span class="keyword">...</span>
0361             uimenu(mh.r2,<span class="string">'Label'</span>,<span class="string">'Hardware Units'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0362             <span class="string">'orbgui(''BPMChangeUnits'',''Hardware'')'</span>);
0363         SYS.BPM1000HardwareUnits = <span class="keyword">...</span>
0364             uimenu(mh.r2,<span class="string">'Label'</span>,<span class="string">'1000xHardware Units'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0365             <span class="string">'orbgui(''BPMChangeUnits'',''1000xHardware'')'</span>);
0366         mh.r3=uimenu(mh.plot,<span class="string">'Label'</span>,<span class="string">'COR Unit Data Display'</span>);
0367         SYS.CORPhysicsUnits = <span class="keyword">...</span>
0368             uimenu(mh.r3,<span class="string">'Label'</span>,<span class="string">'Physics Units'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0369             <span class="string">'orbgui(''CORChangeUnits'',''Physics'')'</span>);
0370         SYS.CORHardwareUnits = <span class="keyword">...</span>
0371             uimenu(mh.r3,<span class="string">'Label'</span>,<span class="string">'Hardware Units'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0372             <span class="string">'orbgui(''CORChangeUnits'',''Hardware'')'</span>);
0373 <span class="comment">%         uimenu(mh.plot,'Label',' ');</span>
0374 <span class="comment">%         mh.r2r=uimenu(mh.plot,'Label','Raw/Real Data Display');</span>
0375 <span class="comment">%         uimenu(mh.r2r,'Label','Display Raw Data','Callback','orbgui('''')');</span>
0376 <span class="comment">%         uimenu(mh.r2r,'Label','Display Real Data','Callback','orbgui('''')');</span>
0377 <span class="comment">%         uimenu(mh.r2r,'Label','Update Raw2Real Coefficients','Callback','orbgui('''')');</span>
0378 <span class="comment">%         uimenu(mh.plot,'Label','Cross-Hair: Axes Start Location','Callback','orbgui(''StartLoc'')');</span>
0379 <span class="comment">%         uimenu(mh.plot,'Label','Cross-Hair: Axes Stop Location', 'Callback','orbgui(''StopLoc'')');</span>
0380 <span class="comment">%         uimenu(mh.plot,'Label','Reset Horizontal Scale',        'Callback','orbgui(''ResetAxes'')');</span>
0381         setappdata(0,<span class="string">'SYS'</span>,SYS);
0382     
0383         <span class="comment">%==========================================================</span>
0384     <span class="keyword">case</span> <span class="string">'BPMChangeUnits'</span>  <span class="comment">% BPM Unit data Display</span>
0385         <span class="comment">%==========================================================</span>
0386         
0387         BPM(1).units = varargin{1};
0388         BPM(2).units = varargin{1};
0389         
0390         setappdata(0,<span class="string">'BPM'</span>,BPM);
0391         
0392         <span class="comment">%% BPM y-axis label</span>
0393         label = get(get(SYS.ahbpm,<span class="string">'Ylabel'</span>),<span class="string">'string'</span>);       
0394         <span class="keyword">switch</span> varargin{1}
0395             <span class="keyword">case</span> <span class="string">'Hardware'</span>
0396                 Unit = <span class="string">'mm'</span>;
0397                 set(SYS.BPMPhysicsUnits,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0398                 set(SYS.BPMHardwareUnits,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0399                 set(SYS.BPM1000HardwareUnits,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0400                 BPM(1).scale = 1; 
0401                 BPM(2).scale = 1; 
0402             <span class="keyword">case</span> <span class="string">'1000xHardware'</span>
0403                 Unit = <span class="string">'um'</span>;
0404                 set(SYS.BPMPhysicsUnits,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0405                 set(SYS.BPMHardwareUnits,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0406                 set(SYS.BPM1000HardwareUnits,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0407                 BPM(1).scale = 1000; 
0408                 BPM(2).scale = 1000; 
0409             <span class="keyword">case</span> <span class="string">'Physics'</span>
0410                 Unit = <span class="string">'m'</span>;
0411                 set(SYS.BPMPhysicsUnits,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0412                 set(SYS.BPMHardwareUnits,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0413                 set(SYS.BPM1000HardwareUnits,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0414                 BPM(1).scale = 0.001; 
0415                 BPM(2).scale = 0.001; 
0416         <span class="keyword">end</span>
0417 
0418         label = [label(1:strfind(label,<span class="string">'('</span>)-1) <span class="string">'('</span> Unit <span class="string">')'</span>];
0419         set(get(SYS.ahbpm,<span class="string">'Ylabel'</span>),<span class="string">'string'</span>,label);
0420         
0421         setappdata(0,<span class="string">'SYS'</span>,SYS);
0422 
0423         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'RePlot'</span>);
0424         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'UpdateBPMBox'</span>);
0425         
0426         <span class="comment">%==========================================================</span>
0427     <span class="keyword">case</span> <span class="string">'CORChangeUnits'</span>  <span class="comment">% BPM Unit data Display</span>
0428         <span class="comment">%==========================================================</span>
0429         
0430         <span class="keyword">for</span> plane = 1:2
0431             COR(plane).units = varargin{1};
0432         <span class="keyword">end</span>
0433         
0434         setappdata(0,<span class="string">'COR'</span>,COR);
0435         
0436         <span class="comment">%% HCOR y-axis label</span>
0437         label = get(get(SYS.ahcor,<span class="string">'Ylabel'</span>),<span class="string">'string'</span>);       
0438         <span class="keyword">switch</span> varargin{1}
0439             <span class="keyword">case</span> {<span class="string">'Hardware'</span>,<span class="string">'1000xHardware'</span>}
0440                 Unit = <span class="string">'A'</span>;
0441                 set(SYS.CORPhysicsUnits,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0442                 set(SYS.CORHardwareUnits,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0443             <span class="keyword">case</span> <span class="string">'Physics'</span>
0444                 Unit = <span class="string">'mrad'</span>;
0445                 set(SYS.CORPhysicsUnits,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0446                 set(SYS.CORHardwareUnits,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0447         <span class="keyword">end</span>
0448         label = [label(1:strfind(label,<span class="string">'('</span>)-1) <span class="string">'('</span> Unit <span class="string">')'</span>];
0449         set(get(SYS.ahcor,<span class="string">'Ylabel'</span>),<span class="string">'string'</span>,label);
0450 
0451         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'RePlot'</span>)
0452         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'UpdateCorBox'</span>);
0453 
0454         <span class="comment">%==========================================================</span>
0455     <span class="keyword">case</span> <span class="string">'LoadRaw2Real'</span>                         <span class="comment">%  LoadRaw2Real</span>
0456         <span class="comment">%==========================================================</span>
0457         <span class="comment">%Load Raw2Real Coefficients into AppData</span>
0458 
0459         Families = {BPMxFamily, BPMzFamily, HCORFamily, VCORFamily};
0460 
0461         <span class="keyword">for</span> k = 1:length(Families)
0462             Family     = Families{k};
0463             DeviceList = getlist(Family,0);   <span class="comment">%0 gives all entries</span>
0464             raw2realdata.(Family).Gain    = getphysdata(Family, <span class="string">'Gain'</span>,   DeviceList);
0465             raw2realdata.(Family).Offset  = getphysdata(Family, <span class="string">'Offset'</span>, DeviceList);
0466         <span class="keyword">end</span>
0467 
0468         setappdata(0,<span class="string">'raw2realdata'</span>,raw2realdata);
0469 
0470 <span class="comment">%         %==========================================================</span>
0471 <span class="comment">%     case 'AlgorithmMenu'                       %  AlgorithmMenu</span>
0472 <span class="comment">%         %==========================================================</span>
0473 <span class="comment">%         %*** Algorithn MENU ***</span>
0474 <span class="comment">%         mh.algo = uimenu('Label','Fit Algorithm');</span>
0475 <span class="comment">%         uimenu(mh.algo,'Label','SVD','Callback',...</span>
0476 <span class="comment">%             'orbgui(''SVDAlgo'');');</span>
0477 <span class="comment">%         uimenu(mh.algo,'Label','Micado','Callback',...</span>
0478 <span class="comment">%             'orbgui(''MicadoAlgo'');');</span>
0479 
0480         <span class="comment">%==========================================================</span>
0481     <span class="keyword">case</span> <span class="string">'SVDAlgo'</span>                       <span class="comment">%  SVDAlgo</span>
0482         <span class="comment">%==========================================================</span>
0483         SYS.algo=<span class="string">'SVD'</span>;
0484         setappdata(0,<span class="string">'SYS'</span>,SYS);
0485 
0486         <span class="comment">%==========================================================</span>
0487 <span class="comment">%     case 'MicadoAlgo'                       %  MicadoAlgo</span>
0488 <span class="comment">%         %==========================================================</span>
0489 <span class="comment">%         SYS.algo='Micado';</span>
0490 <span class="comment">%         setappdata(0,'SYS',SYS);</span>
0491 
0492         <span class="comment">%==========================================================</span>
0493     <span class="keyword">case</span> <span class="string">'SuperperiodMenu'</span>                       <span class="comment">%  SuperperiodMenu</span>
0494         <span class="comment">%==========================================================</span>
0495         <span class="comment">%*** Algorithn MENU ***</span>
0496         mh.superperiod = uimenu(<span class="string">'Label'</span>,<span class="string">'Super-period'</span>);
0497         SYS.allmachine = <span class="keyword">...</span>
0498             uimenu(mh.superperiod,<span class="string">'Label'</span>,<span class="string">'All storage ring'</span>,<span class="string">'Callback'</span>,<span class="keyword">...</span>
0499             <span class="string">'orbgui(''plotxaxis'',''allmachine'');'</span>,<span class="string">'Tag'</span>,<span class="string">'allmachine'</span>);
0500         SYS.superperiod1 = <span class="keyword">...</span>
0501             uimenu(mh.superperiod,<span class="string">'Label'</span>,<span class="string">'Super period #1'</span>,<span class="string">'Callback'</span>,<span class="keyword">...</span>
0502             <span class="string">'orbgui(''plotxaxis'',''superperiod1'');'</span>,<span class="string">'Tag'</span>,<span class="string">'superperiod1'</span>);
0503         SYS.superperiod2 = <span class="keyword">...</span>
0504             uimenu(mh.superperiod,<span class="string">'Label'</span>,<span class="string">'Super period #2'</span>,<span class="string">'Callback'</span>,<span class="keyword">...</span>
0505             <span class="string">'orbgui(''plotxaxis'',''superperiod2'');'</span>,<span class="string">'Tag'</span>,<span class="string">'superperiod2'</span>);
0506         SYS.superperiod3 = <span class="keyword">...</span>
0507             uimenu(mh.superperiod,<span class="string">'Label'</span>,<span class="string">'Super period #3'</span>,<span class="string">'Callback'</span>,<span class="keyword">...</span>
0508             <span class="string">'orbgui(''plotxaxis'',''superperiod3'');'</span>,<span class="string">'Tag'</span>,<span class="string">'superperiod3'</span>);
0509         SYS.superperiod4 = <span class="keyword">...</span>
0510             uimenu(mh.superperiod,<span class="string">'Label'</span>,<span class="string">'Super period #4'</span>,<span class="string">'Callback'</span>,<span class="keyword">...</span>
0511             <span class="string">'orbgui(''plotxaxis'',''superperiod4'');'</span>,<span class="string">'Tag'</span>,<span class="string">'superperiod4'</span>);
0512         setappdata(0,<span class="string">'SYS'</span>,SYS);
0513 
0514         <span class="comment">%==========================================================</span>
0515     <span class="keyword">case</span> <span class="string">'plotxaxis'</span>
0516         <span class="comment">%==========================================================</span>
0517         
0518         action = varargin{1};
0519         
0520         bpm_axe     = axis(SYS.ahbpm);
0521         cor_axe     = axis(SYS.ahcor);
0522         lattice_axe = axis(SYS.ahpos);
0523       
0524         <span class="keyword">switch</span> action
0525             <span class="keyword">case</span> <span class="string">'allmachine'</span>
0526                 AxisRange1X = [0 1]*SYS.xlimax;
0527             <span class="keyword">case</span> <span class="string">'superperiod1'</span>
0528                 AxisRange1X = [0 0.25]*SYS.xlimax;
0529             <span class="keyword">case</span> <span class="string">'superperiod2'</span>
0530                 AxisRange1X = [0.25 0.5]*SYS.xlimax;
0531             <span class="keyword">case</span> <span class="string">'superperiod3'</span>
0532                 AxisRange1X = [0.5 0.75]*SYS.xlimax;
0533             <span class="keyword">case</span> <span class="string">'superperiod4'</span>
0534                 AxisRange1X = [0.75 1]*SYS.xlimax;
0535         <span class="keyword">end</span>
0536 
0537         axis(SYS.ahbpm,   [AxisRange1X bpm_axe(3:4)]);
0538         axis(SYS.ahcor, [AxisRange1X cor_axe(3:4)]);
0539         axis(SYS.ahpos, [AxisRange1X lattice_axe(3:4)]);
0540 
0541         setappdata(0, <span class="string">'xaxe'</span>, AxisRange1X);
0542 
0543         set(SYS.allmachine,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0544         set(SYS.superperiod1,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0545         set(SYS.superperiod2,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0546         set(SYS.superperiod3,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0547         set(SYS.superperiod4,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0548         set(SYS.(action),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0549 
0550 
0551         <span class="comment">%==========================================================</span>
0552     <span class="keyword">case</span> <span class="string">'BPMMenu'</span>                               <span class="comment">%  BPMMenu</span>
0553         <span class="comment">%==========================================================</span>
0554         <span class="comment">%*** BPM MENU ***</span>
0555         mh.bpms = uimenu(<span class="string">'Label'</span>,<span class="string">'BPMs'</span>);
0556         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Select All BPMs'</span>,<span class="string">'Callback'</span>,<span class="string">'bpmgui(''SelectAll'');'</span>);
0557         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Select No BPM'</span>,<span class="string">'Callback'</span>,<span class="string">'bpmgui(''SelectNone'');'</span>);
0558         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Remove BPM Drag Changes'</span>,<span class="string">'Callback'</span>,<span class="string">'bpmgui(''ClearOffsets'');'</span>);
0559         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Show BPM State'</span>,<span class="string">'Callback'</span>,<span class="string">'bpmgui(''ShowBPMState'');'</span>);
0560         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Archive X-Orbit'</span>,          <span class="string">'Callback'</span>, <span class="keyword">...</span>
0561             <span class="string">'readwrite(''ArchiveBPMOrbit'',''X'');'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0562         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Archive Z-Orbit'</span>,          <span class="string">'Callback'</span>, <span class="keyword">...</span>
0563             <span class="string">'readwrite(''ArchiveBPMOrbit'',''Z'');'</span>);
0564         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Archive X/Z-Orbit'</span>,        <span class="string">'Callback'</span>, <span class="keyword">...</span>
0565             <span class="string">'readwrite(''ArchiveBPMOrbit'',''XZ'');'</span>);
0566         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Load X-Reference Orbit'</span>,   <span class="string">'Callback'</span>, <span class="keyword">...</span>
0567             <span class="string">'readwrite(''ReadBPMReference'',''X'');'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0568         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Load Z-Reference Orbit'</span>,   <span class="string">'Callback'</span>, <span class="keyword">...</span>
0569             <span class="string">'readwrite(''ReadBPMReference'',''Z'');'</span>);
0570         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Load X/Z-Reference Orbit'</span>, <span class="string">'Callback'</span>, <span class="keyword">...</span>
0571             <span class="string">'readwrite(''ReadBPMReference'',''XZ'');'</span>);
0572         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Archive Golden X-Orbit'</span>,   <span class="string">'Callback'</span>, <span class="keyword">...</span>
0573             <span class="string">'readwrite(''ArchiveBPMOrbit'',''X'',''Golden'');'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0574         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Archive Golden Z-Orbit'</span>,   <span class="string">'Callback'</span>, <span class="keyword">...</span>
0575             <span class="string">'readwrite(''ArchiveBPMOrbit'',''Z'',''Golden'');'</span>);
0576         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Archive Golden X/Z-Orbit'</span>, <span class="string">'Callback'</span>, <span class="keyword">...</span>
0577             <span class="string">'readwrite(''ArchiveBPMOrbit'',''XZ'',''Golden'');'</span>);
0578         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Load Golden X-Reference'</span>,  <span class="string">'Callback'</span>, <span class="keyword">...</span>
0579             <span class="string">'readwrite(''ReadBPMReference'',''X'',''Golden'');'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0580         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Load Golden Z-Reference'</span>,  <span class="string">'Callback'</span>, <span class="keyword">...</span>
0581             <span class="string">'readwrite(''ReadBPMReference'',''Z'',''Golden'');'</span>);
0582         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Load Golden X/Z-Reference'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0583             <span class="string">'readwrite(''ReadBPMReference'',''XZ'',''Golden'');'</span>);
0584 
0585         <span class="comment">%Select horizontal BPM weights</span>
0586         cback=<span class="string">'rload(''GenFig'', BPM(1).name,BPM(1).avail,BPM(1).ifit,BPM(1).wt,'</span>;
0587         cback=[cback <span class="string">'''Horizontal BPM Weights'',''xbwt'');'</span>];
0588         <span class="comment">%instructions are used during 'load' procedure of rload window</span>
0589         instructions=[<span class="keyword">...</span>
0590             <span class="string">'   global BPM;'</span>,<span class="keyword">...</span>
0591             <span class="string">'   tlist = get(gcf,''UserData'');'</span>,<span class="keyword">...</span>
0592             <span class="string">'   BPM(1).wt=tlist{4};'</span>,<span class="keyword">...</span>
0593             <span class="string">'   setappdata(0,''BPM'',BPM);'</span>,<span class="keyword">...</span>
0594             <span class="string">'   orbgui(''RefreshOrbGUI'');'</span>];
0595         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Select X-BPM Weights'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0596             cback,<span class="string">'Tag'</span>,<span class="string">'xbwt'</span>,<span class="string">'Userdata'</span>,instructions,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0597 
0598         <span class="comment">%Select vertical BPM weights</span>
0599         cback=<span class="string">'rload(''GenFig'', BPM(2).name,BPM(2).avail,BPM(2).ifit,BPM(2).wt,'</span>;
0600         cback=[cback <span class="string">'''Vertical BPM Weights'',''zbwt'');'</span>];
0601         <span class="comment">%instructions are used during 'load' procedure of rload window</span>
0602         instructions=[<span class="keyword">...</span>
0603             <span class="string">'   global BPM;'</span>,<span class="keyword">...</span>
0604             <span class="string">'   tlist = get(gcf,''UserData'');'</span>,<span class="keyword">...</span>
0605             <span class="string">'   BPM(2).wt=tlist{4};'</span>,<span class="keyword">...</span>
0606             <span class="string">'   setappdata(0,''BPM'',BPM);'</span>,<span class="keyword">...</span>
0607             <span class="string">'   orbgui(''RefreshOrbGUI'');'</span>];
0608 
0609         uimenu(mh.bpms,<span class="string">'Label'</span>,<span class="string">'Select Z-BPM Weights'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0610             cback,<span class="string">'Tag'</span>,<span class="string">'ybwt'</span>,<span class="string">'Userdata'</span>,instructions);
0611 <span class="comment">%         uimenu(mh.bpms,'Label','   ');</span>
0612 <span class="comment">%         uimenu(mh.bpms,'Label','Help with BPM Functions','Callback','readwrite(''OpenHelp'');');</span>
0613 
0614         <span class="comment">%==========================================================</span>
0615     <span class="keyword">case</span> <span class="string">'CORMenu'</span>                               <span class="comment">%  CORMenu</span>
0616         <span class="comment">%==========================================================</span>
0617         <span class="comment">%*** CORRECTOR MENU ***</span>
0618         mh.cors = uimenu(<span class="string">'Label'</span>,<span class="string">'Correctors'</span>);
0619         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Update Correctors'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0620             <span class="string">'corgui(''UpdateCorrs'');'</span>);
0621         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Corrector strengths to zero (this plane)'</span>, <span class="keyword">...</span>
0622             <span class="string">'Callback'</span>,<span class="string">'orbgui(''Cor2Zero'')'</span>);
0623         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Select All Correctors'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0624             <span class="string">'corgui(''SelectAll'');'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0625         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Select No Correctors'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0626             <span class="string">'corgui(''SelectNone'');'</span>);
0627         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Load Correctors'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0628             <span class="string">'readwrite(''DialogBox'',''Read Correctors'',''ReadCorrectors'');'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0629         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Archive Correctors'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0630             <span class="string">'readwrite(''DialogBox'',''Write Correctors'',''WriteCorrectors'');'</span>);
0631 
0632         <span class="comment">%Select horizontal corrector limits</span>
0633         cback=<span class="string">'rload(''GenFig'', COR(1).name,COR(1).status,COR(1).avail,COR(1).lim,'</span>;
0634         cback=[cback <span class="string">'''Horizontal Corrector Limits'',''xclim'');'</span>];
0635         <span class="comment">%instructions are used during 'load' procedure of rload window</span>
0636         instructions=[<span class="keyword">...</span>
0637             <span class="string">'   global COR;'</span>,<span class="keyword">...</span>
0638             <span class="string">'   tlist = get(gcf,''UserData'');'</span>,<span class="keyword">...</span>
0639             <span class="string">'   COR(1).lim=tlist{4};'</span>,<span class="keyword">...</span>
0640             <span class="string">'   setappdata(0,''COR'',COR);'</span>];
0641         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Select X-Corrector Limits'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0642             cback,<span class="string">'Tag'</span>,<span class="string">'xclim'</span>,<span class="string">'Userdata'</span>,instructions,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0643 
0644         <span class="comment">%Select horizontal corrector weights</span>
0645         cback=<span class="string">'rload(''GenFig'', COR(1).name,COR(1).status,COR(1).ifit,COR(1).wt,'</span>;
0646         cback=[cback <span class="string">'''Horizontal Corrector Weights'',''xcwt'');'</span>];
0647         <span class="comment">%instructions are used during 'load' procedure of rload window</span>
0648         instructions=[<span class="keyword">...</span>
0649             <span class="string">'   global COR;'</span>,<span class="keyword">...</span>
0650             <span class="string">'   tlist = get(gcf,''UserData'');'</span>,<span class="keyword">...</span>
0651             <span class="string">'   COR(1).wt=tlist{4};'</span>,<span class="keyword">...</span>
0652             <span class="string">'   setappdata(0,''COR'',COR);'</span>,<span class="keyword">...</span>
0653             <span class="string">'   orbgui(''RefreshOrbGUI'');'</span>];
0654 
0655         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Select X-Corrector Weights'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0656             cback,<span class="string">'Tag'</span>,<span class="string">'xcwt'</span>,<span class="string">'Userdata'</span>,instructions);
0657 
0658         <span class="comment">%Select vertical corrector limits</span>
0659         cback=<span class="string">'rload(''GenFig'', COR(2).name,COR(2).status,COR(2).avail,COR(2).lim,'</span>;
0660         cback=[cback <span class="string">'''Vertical Corrector Limits'',''zclim'');'</span>];
0661         <span class="comment">%instructions are used during 'load' procedure of rload window</span>
0662         instructions=[<span class="keyword">...</span>
0663             <span class="string">'   global COR;'</span>,<span class="keyword">...</span>
0664             <span class="string">'   tlist = get(gcf,''UserData'');'</span>,<span class="keyword">...</span>
0665             <span class="string">'   COR(2).lim=tlist{4};'</span>,<span class="keyword">...</span>
0666             <span class="string">'   setappdata(0,''COR'',COR);'</span>];
0667         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Select Z-Corrector Limits'</span>,<span class="string">'Callback'</span>,cback, <span class="keyword">...</span>
0668             <span class="string">'Tag'</span>,<span class="string">'zclim'</span>,<span class="string">'Userdata'</span>,instructions,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0669 
0670         <span class="comment">%Select vertical corrector weights</span>
0671         cback=<span class="string">'rload(''GenFig'', COR(2).name,COR(2).status,COR(2).ifit,COR(2).wt,'</span>;
0672         cback=[cback <span class="string">'''Vertical Corrector Weights'',''zcwt'');'</span>];
0673         <span class="comment">%instructions are used during 'load' procedure of rload window</span>
0674         instructions=[<span class="keyword">...</span>
0675             <span class="string">'   global COR;'</span>,<span class="keyword">...</span>
0676             <span class="string">'   tlist = get(gcf,''UserData'');'</span>,<span class="keyword">...</span>
0677             <span class="string">'   COR(2).wt=tlist{4};'</span>,<span class="keyword">...</span>
0678             <span class="string">'   setappdata(0,''COR'',COR);'</span>,<span class="keyword">...</span>
0679             <span class="string">'   orbgui(''RefreshOrbGUI'');'</span>];
0680 
0681         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Select Z-Corrector Weights'</span>,<span class="string">'Callback'</span>,cback, <span class="keyword">...</span>
0682             <span class="string">'Tag'</span>,<span class="string">'zcwt'</span>,<span class="string">'Userdata'</span>,instructions);
0683         uimenu(mh.cors,<span class="string">'Label'</span>,<span class="string">'Show Corrector State'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0684             <span class="string">'corgui(''ShowCORState'');'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0685 <span class="comment">%         uimenu(mh.cors,'Label','Help with Corrector Functions','Callback','readwrite(''OpenHelp'');');</span>
0686 
0687         <span class="comment">%==========================================================</span>
0688     <span class="keyword">case</span> <span class="string">'EtaMenu'</span>                               <span class="comment">%  EtaMenu</span>
0689         <span class="comment">%==========================================================</span>
0690         <span class="comment">%*** Dispersion control MENU ***</span>
0691         mh.eta = uimenu(<span class="string">'Label'</span>,<span class="string">'Eta Fit'</span>);
0692         uimenu(mh.eta,<span class="string">'Label'</span>,<span class="string">'Load Dispersion Orbit'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0693             <span class="string">'readwrite(''DialogBox'',''Load Reference Orbit'',''ReadDispersion'');'</span>);
0694         uimenu(mh.eta,<span class="string">'Label'</span>,<span class="string">'Display Dispersion Control Panel'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0695             <span class="string">'respgui(''DispersionPanel'')'</span>);
0696         uimenu(mh.eta,<span class="string">'Label'</span>,<span class="string">'Display Dispersion Correction'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0697             <span class="string">'respgui(''DispersionPlot'')'</span>);
0698 
0699         <span class="comment">%==========================================================</span>
0700     <span class="keyword">case</span> <span class="string">'SYSMenu'</span>                               <span class="comment">%  SYSMenu</span>
0701         <span class="comment">%==========================================================</span>
0702         <span class="comment">%*** SYSTEM MENU ***</span>
0703         mh.sys = uimenu(<span class="string">'Label'</span>,<span class="string">'Session'</span>);
0704         menuh = uimenu(mh.sys,<span class="string">'Label'</span>,<span class="string">'Mode'</span>);
0705         SYS.online = uimenu(menuh,<span class="string">'Label'</span>,<span class="string">'Online'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0706             <span class="string">'orbgui(''Switch2online'')'</span>);        
0707         SYS.sim   = uimenu(menuh,<span class="string">'Label'</span>,<span class="string">'Simulator'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0708             <span class="string">'orbgui(''Switch2sim'')'</span>);
0709 
0710         menuh = uimenu(mh.sys,<span class="string">'Label'</span>,<span class="string">'Do not use this menu'</span>, <span class="keyword">...</span>
0711             <span class="string">'ForegroundColor'</span>, <span class="string">'r'</span>, <span class="string">'Separator'</span>,<span class="string">'On'</span>);
0712         uimenu(menuh,<span class="string">'Label'</span>,<span class="string">'Save Program Parameters'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0713             <span class="string">'readwrite(''DialogBox'',''Save System Parameters'',''SaveSystem'');'</span>);
0714         uimenu(menuh,<span class="string">'Label'</span>,<span class="string">'Restore Program Parameters'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0715             <span class="string">'readwrite(''DialogBox'',''Restore System Parameters'',''RestoreSystem'')'</span>);
0716         
0717         setappdata(0,<span class="string">'SYS'</span>,SYS);
0718 
0719         <span class="comment">%==========================================================</span>
0720     <span class="keyword">case</span> <span class="string">'Switch2online'</span>                         <span class="comment">%  Switch2online</span>
0721         <span class="comment">%==========================================================</span>
0722                 
0723         <span class="keyword">if</span> strcmpi(SYS.mode,<span class="string">'Simulator'</span>) <span class="comment">% was Simulator turned Online</span>
0724             set(SYS.online, <span class="string">'Checked'</span>, <span class="string">'On'</span>);
0725             set(SYS.sim,    <span class="string">'Checked'</span>, <span class="string">'Off'</span>);
0726             set(SYS.orbfig,<span class="string">'Name'</span>, <span class="keyword">...</span>
0727                 <span class="string">'SOLEIL Storage Ring Orbit Correction Interface (Online)'</span>);
0728             set(SYS.modecolor,<span class="string">'BackGroundColor'</span>,<span class="string">'r'</span>,<span class="string">'String'</span>,<span class="string">'Online'</span>);
0729             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">'Warning: switched to online'</span>);
0730             SYS.mode = <span class="string">'Online'</span>;
0731             setappdata(0,<span class="string">'SYS'</span>,SYS);
0732         <span class="keyword">end</span>
0733 
0734         <span class="comment">%==========================================================</span>
0735     <span class="keyword">case</span> <span class="string">'Switch2sim'</span>                         <span class="comment">%  Switch2sim</span>
0736         <span class="comment">%==========================================================</span>
0737         
0738         <span class="keyword">if</span> strcmpi(SYS.mode,<span class="string">'Online'</span>)
0739             set(SYS.online, <span class="string">'Checked'</span>, <span class="string">'Off'</span>);
0740             set(SYS.sim,    <span class="string">'Checked'</span>, <span class="string">'On'</span>);
0741             set(SYS.orbfig,<span class="string">'Name'</span>, <span class="keyword">...</span>
0742                 <span class="string">'SOLEIL Storage Ring Orbit Correction Interface (Simulator)'</span>);
0743             set(SYS.modecolor,<span class="string">'BackGroundColor'</span>,<span class="string">'g'</span>,<span class="string">'String'</span>,<span class="string">'Simulator'</span>);
0744             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">'Warning: switched to simulator'</span>);
0745             SYS.mode = <span class="string">'Simulator'</span>;
0746             setappdata(0,<span class="string">'SYS'</span>,SYS);
0747         <span class="keyword">end</span>
0748 
0749         <span class="comment">%==========================================================</span>
0750     <span class="keyword">case</span> <span class="string">'OptMenu'</span>                               <span class="comment">%  OptMenu</span>
0751         <span class="comment">%==========================================================</span>
0752         <span class="comment">%*** OPTICS MENU ***</span>
0753         mh.opt = uimenu(<span class="string">'Label'</span>,<span class="string">'Optics'</span>);
0754         uimenu(mh.opt,<span class="string">'Label'</span>,<span class="string">'Display Optics Parameters'</span>,<span class="string">'Callback'</span>,<span class="keyword">...</span>
0755             <span class="string">'orbgui(''DisplayOptics'')'</span>);
0756         <span class="keyword">if</span> ispc
0757             uimenu(mh.opt,<span class="string">'Label'</span>,<span class="string">'Display Optics Parameters in EXCEL'</span>, <span class="keyword">...</span>
0758                 <span class="string">'Callback'</span>,<span class="string">'orbgui(''DisplayOpticsEXCEL'')'</span>);
0759         <span class="keyword">end</span>
0760         uimenu(mh.opt,<span class="string">'Label'</span>,<span class="string">'Plot Betafunctions'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0761             <span class="string">'orbgui(''PlotBetaFunctions'')'</span>);
0762         uimenu(mh.opt,<span class="string">'Label'</span>,<span class="string">'Plot Ring Elements'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0763             <span class="string">'orbgui(''PlotRingElements'')'</span>);
0764 
0765         <span class="comment">%==========================================================</span>
0766     <span class="keyword">case</span> <span class="string">'SimMenu'</span>                               <span class="comment">%  SimMenu</span>
0767         <span class="comment">%==========================================================</span>
0768         <span class="comment">% %*** SIMULATION MENU ***</span>
0769         mh.sim = uimenu(<span class="string">'Label'</span>,<span class="string">'Simulator'</span>);
0770         uimenu(mh.sim,<span class="string">'Label'</span>,<span class="string">'New Quad Alignment (both plane)'</span>, <span class="keyword">...</span>
0771             <span class="string">'Callback'</span>, <span class="string">'orbgui(''QuadOffset'')'</span>);
0772         uimenu(mh.sim,<span class="string">'Label'</span>,<span class="string">'Make New Reference Orbit (this plane)'</span>, <span class="keyword">...</span>
0773             <span class="string">'Callback'</span>,<span class="string">'orbgui(''MakeNewRef'')'</span>);
0774         uimenu(mh.sim,<span class="string">'Label'</span>,<span class="string">'Quad alignment to zero (both planes)'</span>, <span class="keyword">...</span>
0775             <span class="string">'Callback'</span>,<span class="string">'orbgui(''Quad2Zero'')'</span>);
0776         uimenu(mh.sim,<span class="string">'Label'</span>,<span class="string">'Update Optics (LinOpt)'</span>, <span class="keyword">...</span>
0777             <span class="string">'Callback'</span>,<span class="string">'orbgui(''UpdateOptics'')'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
0778         t   = getphysdata;   
0779         str = sprintf(<span class="string">'Fit Tunes to %3.2f/%3.2f'</span>,t.TUNE.Golden(1),t.TUNE.Golden(2));
0780         uimenu(mh.sim,<span class="string">'Label'</span>,str,<span class="string">'Callback'</span>,<span class="string">'orbgui(''SetTune'')'</span>);
0781 
0782         <span class="comment">%==========================================================</span>
0783     <span class="keyword">case</span> <span class="string">'Cor2Zero'</span>                             <span class="comment">%...Quad2Zero</span>
0784         <span class="comment">%==========================================================</span>
0785         <span class="comment">%Callback of Simulator/'Corrector Strengths to Zero'</span>
0786 
0787         <span class="comment">%set correctors to zero</span>
0788         <span class="keyword">if</span> plane == 1
0789             setsp(HCORFamily,0.0,SYS.mode);   <span class="comment">%only sets correctors with valid status</span>
0790         <span class="keyword">elseif</span> plane == 2
0791             setsp(VCORFamily,0.0,SYS.mode);
0792         <span class="keyword">end</span>
0793 
0794         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'GetAct'</span>);
0795         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'GetAct'</span>);
0796         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'RefreshOrbGUI'</span>);
0797 
0798         <span class="comment">%==========================================================</span>
0799     <span class="keyword">case</span> <span class="string">'Quad2Zero'</span>                             <span class="comment">%...Quad2Zero</span>
0800         <span class="comment">%==========================================================</span>
0801         <span class="comment">%Callback of Simulator/'Quadrupole Strenths to Zero'</span>
0802 
0803         <span class="comment">%set quadrupole offsets to zero</span>
0804         quadalign(0.0,0.0);
0805         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'GetAct'</span>);
0806         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'GetAct'</span>);
0807         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'RefreshOrbGUI'</span>);
0808 
0809         <span class="comment">%==========================================================</span>
0810     <span class="keyword">case</span> <span class="string">'QuadOffset'</span>                            <span class="comment">%...QuadOffset</span>
0811         <span class="comment">%==========================================================</span>
0812         <span class="comment">%Callback of Simulator/'New Quad Alignment'</span>
0813 
0814         <span class="comment">%apply quadrupole offsets</span>
0815         quadalign(0.0001,0.0001);  <span class="comment">%units are meters</span>
0816         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'GetAct'</span>);
0817         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'GetAct'</span>);
0818         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'RefreshOrbGUI'</span>)
0819 
0820         <span class="comment">%==========================================================</span>
0821     <span class="keyword">case</span> <span class="string">'MakeNewRef'</span>                            <span class="comment">%...MakeNewRef</span>
0822         <span class="comment">%==========================================================</span>
0823         <span class="comment">%callback of Simulation 'Make New Reference Orbit'</span>
0824 
0825         <span class="comment">%record present quad positions for reset</span>
0826 
0827         AO = getappdata(0,<span class="string">'AcceleratorObjects'</span>);
0828 
0829         ATindx = [] ;
0830         
0831         aofields = fieldnames(AO);
0832         
0833         <span class="comment">%% look for quads in lattice</span>
0834         <span class="keyword">for</span> ii = 1:length(aofields)
0835             <span class="keyword">if</span> strcmpi(AO.(aofields{ii}).FamilyType,<span class="string">'quad'</span>)
0836                 ATindx = [AO.(aofields{ii}).AT.ATIndex];
0837             <span class="keyword">end</span>
0838         <span class="keyword">end</span>
0839         
0840         ATindx = unique(ATindx)';
0841 
0842         mx0 = getcellstruct(THERING,<span class="string">'T1'</span>,ATindx,1);
0843         my0 = getcellstruct(THERING,<span class="string">'T1'</span>,ATindx,3);
0844 
0845         <span class="comment">%set quads to zero</span>
0846         quadalign(0.0,0.0);  <span class="comment">%units are meters</span>
0847 
0848         <span class="comment">%produce a new random orbit</span>
0849         quadalign(0.00001,0.00001);  <span class="comment">%units are meters, 10 um rms</span>
0850 
0851         <span class="comment">%load new reference orbit</span>
0852         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'GetRef'</span>);
0853         BPM(1).des = BPM(1).ref;
0854         BPM(1).abs = BPM(1).ref;
0855         BPM(2).des = BPM(2).ref;
0856         BPM(2).abs = BPM(2).ref;
0857 
0858         <span class="keyword">if</span> SYS.relative == 1    <span class="comment">%Absolute orbit mode</span>
0859             BPM(1).abs = zeros(size(BPM(1).name,1),1);
0860             BPM(2).abs = zeros(size(BPM(2).name,1),1);
0861         <span class="keyword">end</span>
0862 
0863         setappdata(0,<span class="string">'BPM'</span>,BPM);
0864 
0865         <span class="comment">%put quads back to original position</span>
0866         setshift(ATindx,-mx0,-my0);
0867 
0868         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'GetAct'</span>);
0869         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'GetAct'</span>);
0870         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'RefreshOrbGUI'</span>);
0871 
0872         <span class="comment">%==========================================================</span>
0873     <span class="keyword">case</span> <span class="string">'PlotAlign'</span>                            <span class="comment">%...PlotAlign</span>
0874         <span class="comment">%==========================================================</span>
0875         <span class="comment">%update graphics after alignments changed</span>
0876         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'GetRef'</span>);
0877         BPM(1).des = BPM(1).ref;
0878         BPM(1).abs = BPM(1).ref;
0879         BPM(2).des = BPM(2).ref;
0880         BPM(2).abs = BPM(2).ref;
0881 
0882         <span class="keyword">if</span> SYS.relative == 1
0883             BPM(1).abs = zeros(size(BPM(1).name,1),1);
0884             BPM(2).abs = zeros(size(BPM(2).name,1),1);
0885         <span class="keyword">end</span>
0886 
0887         setappdata(0,<span class="string">'BPM'</span>,BPM);
0888 
0889         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'RefreshOrbGUI'</span>);
0890 
0891         <span class="comment">%==========================================================</span>
0892     <span class="keyword">case</span> <span class="string">'SetTune'</span>                    <span class="comment">%...SetTune</span>
0893         <span class="comment">%==========================================================</span>
0894         <span class="comment">%set tune back to nominal values</span>
0895         t = getphysdata;
0896         
0897         TuneFitFamily1 = <span class="string">'Q7'</span>;
0898         TuneFitFamily2 = <span class="string">'Q9'</span>;
0899         
0900         fittune2([t.TUNE.Golden(1),t.TUNE.Golden(2)], TuneFitFamily1, TuneFitFamily2);
0901         
0902         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'UpdateAct'</span>);
0903 
0904         <span class="comment">%==========================================================</span>
0905     <span class="keyword">case</span> <span class="string">'UpdateOptics'</span>                    <span class="comment">%...UpdateOptics</span>
0906         <span class="comment">%==========================================================</span>
0907         <span class="comment">%recompute linear optics</span>
0908         [LinData, Nu, Ksi] = linopt(THERING ,0.0, 1:length(THERING));
0909         disp([<span class="string">'Nux: '</span> num2str(Nu(1)) <span class="string">'       Nuz: '</span> num2str(Nu(2))])
0910 
0911         <span class="comment">%==========================================================</span>
0912     <span class="keyword">case</span> <span class="string">'DisplayOpticsEXCEL'</span>            <span class="comment">%...DisplayOpticsEXCEL</span>
0913         <span class="comment">%==========================================================</span>
0914         ring2excel
0915 
0916         <span class="comment">%==========================================================</span>
0917     <span class="keyword">case</span> <span class="string">'DisplayOptics'</span>                      <span class="comment">%...DisplayOptics</span>
0918         <span class="comment">%==========================================================</span>
0919         <span class="comment">%Display Optics to command window</span>
0920         NR = length(THERING);
0921         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">'Calculating Accelerator Optics...'</span>);
0922         optics = gettwiss(THERING,0.0);
0923         orbit  = findorbit4(THERING,0.0,1:NR);
0924         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">'Begin Writing Twiss Parameters'</span>);
0925  
0926         ivec = (1:NR)';        
0927         Strcell = cell(18,NR);
0928         Strcell(1,:) = num2cell(ivec);
0929         Strcell(2,:) = cellstr(optics.name)';
0930         Strcell(3:<span class="keyword">end</span>,:) = num2cell([optics.len,optics.s, <span class="keyword">...</span>
0931             optics.betax,optics.alfax, optics.phix, optics.etax, optics.etapx, <span class="keyword">...</span>
0932             optics.betay,optics.alfay, optics.phiy, optics.etay, optics.etapy, <span class="keyword">...</span>
0933             orbit(1,:)',orbit(2,:)',orbit(3,:)',orbit(4,:)'])';
0934 
0935         filename = [SYS.localdata <span class="string">'twissdata.txt'</span>];
0936         fid = fopen(filename,<span class="string">'w'</span>);
0937         fprintf(fid,[<span class="string">' index   name  length   s     betx   alfx   phix'</span> <span class="keyword">...</span>
0938             <span class="string">'etax   etaxp  betz   alfz   phiz   etaz   etazp    x'</span> <span class="keyword">...</span>
0939             <span class="string">'      xp     z      zp\n'</span>]);
0940         fprintf(fid,[<span class="string">'%4d %8s %6.2f %6.2f %6.2f %6.2f %6.2f % 6.2f %'</span> <span class="keyword">...</span>
0941             <span class="string">'6.2f %6.2f %6.2f %6.2f % 6.2f % 6.2f %6.2f %6.2f %6.2f '</span> <span class="keyword">...</span>
0942             <span class="string">'%6.2f\n'</span>],<span class="keyword">...</span>
0943             Strcell{:});
0944         fclose(fid);
0945         system([<span class="string">'nedit '</span>, filename, <span class="string">' &amp;'</span>]);  <span class="comment">% much faster</span>
0946         
0947 <span class="comment">%         for ii = 1:NR</span>
0948 <span class="comment">%             name = optics.name(ii,:);</span>
0949 <span class="comment">%             len  = optics.len(ii);</span>
0950 <span class="comment">%             s    = optics.s(ii);</span>
0951 <span class="comment">%             betx = optics.betax(ii);</span>
0952 <span class="comment">%             alfx = optics.alfax(ii);</span>
0953 <span class="comment">%             phix = optics.phix(ii);</span>
0954 <span class="comment">%             etax = optics.etax(ii);</span>
0955 <span class="comment">%             etapx= optics.etapx(ii);</span>
0956 <span class="comment">%</span>
0957 <span class="comment">%             bety = optics.betay(ii);</span>
0958 <span class="comment">%             alfy = optics.alfay(ii);</span>
0959 <span class="comment">%             phiy = optics.phiy(ii);</span>
0960 <span class="comment">%             etay = optics.etay(ii);</span>
0961 <span class="comment">%             etapy= optics.etapy(ii);</span>
0962 <span class="comment">%</span>
0963 <span class="comment">%             x = orbit(1,ii);  xp = orbit(2,ii);</span>
0964 <span class="comment">%             y = orbit(3,ii);  yp = orbit(4,ii);</span>
0965 <span class="comment">%</span>
0966 <span class="comment">%             fprintf('%6d %8s %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f %6.2f\n',...</span>
0967 <span class="comment">%                 ii,name,s,len,betx,alfx,phix,etax,etapx,bety,alfy,phiy,etay,etapy,x,xp,y,yp)</span>
0968 <span class="comment">%             %     'one',1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1)</span>
0969 <span class="comment">%         end</span>
0970 <span class="comment">%         disp(['Horizontal Tune ' num2str(phix) 'Vertical Tune ' num2str(phiy)])</span>
0971         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">'Finished Writing Twiss Parameters'</span>);
0972 
0973         <span class="comment">%==========================================================</span>
0974     <span class="keyword">case</span> <span class="string">'PlotBetaFunctions'</span>               <span class="comment">% PlotBetaFunctions</span>
0975         <span class="comment">%==========================================================</span>
0976         <span class="comment">%plot betafunctions</span>
0977         figure;
0978         plotbeta;
0979 
0980         <span class="comment">%==========================================================</span>
0981     <span class="keyword">case</span> <span class="string">'PlotRingElements'</span>                <span class="comment">% PlotRingElements</span>
0982         <span class="comment">%==========================================================</span>
0983         <span class="comment">%call intlat</span>
0984         intlat;
0985 
0986         <span class="comment">%==========================================================</span>
0987     <span class="keyword">case</span> <span class="string">'RespMenu'</span>                               <span class="comment">%  RespMenu</span>
0988         <span class="comment">%==========================================================</span>
0989         <span class="comment">%response matrix</span>
0990         mh.rsp = uimenu(<span class="string">'Label'</span>,<span class="string">'R-Matrix'</span>);
0991         uimenu(mh.rsp,<span class="string">'Label'</span>,<span class="string">'Read Response Matrix'</span>,<span class="string">'Callback'</span>, <span class="keyword">...</span>
0992             <span class="string">'readwrite(''ReadResponse'')'</span>);
0993 
0994         <span class="comment">% COULD BE NOT LATER</span>
0995 <span class="comment">%         uimenu(mh.rsp,'Label','Write Response Matrix', ...</span>
0996 <span class="comment">%             'Callback','readwrite(''DialogBox'',''Write Response Matrix'',''WriteResponse'')');</span>
0997 
0998 <span class="comment">%         uimenu(mh.rsp,'Label','    ');</span>
0999         SYS.showeig  = uimenu(mh.rsp,<span class="string">'Label'</span>,<span class="string">'Show Eigenvectors'</span>, <span class="keyword">...</span>
1000             <span class="string">'UserData'</span>,0,<span class="string">'Callback'</span>,<span class="string">'corgui(''ShowEig'')'</span>,<span class="string">'Separator'</span>,<span class="string">'on'</span>);
1001         SYS.showresp = uimenu(mh.rsp,<span class="string">'Label'</span>,<span class="string">'Show Response'</span>, <span class="keyword">...</span>
1002             <span class="string">'UserData'</span>,0,<span class="string">'Callback'</span>,<span class="string">'corgui(''ShowResp'')'</span>);
1003 
1004 <span class="comment">%         uimenu(mh.rsp,'Label','    ');</span>
1005         <span class="comment">%Select corrector currents for horizontal response to eBPMs</span>
1006 <span class="comment">%         cback = ['rload(''GenFig'', COR(1).name,COR(1).status,COR(1).ifit,COR(1).ebpm,'];</span>
1007 <span class="comment">%         cback = [cback '''Horizontal Correctors to Electron BPMs'',''hbpm'');'];</span>
1008 <span class="comment">%         %instructions are used during 'load' procedure of rload window</span>
1009 <span class="comment">%         instructions = [...</span>
1010 <span class="comment">%             '   global COR;',...</span>
1011 <span class="comment">%             '   tlist = get(gcf,''UserData'');',...</span>
1012 <span class="comment">%             '   COR(1).ebpm=tlist{4};',...</span>
1013 <span class="comment">%             '   setappdata(0,''COR'',COR);'];</span>
1014 <span class="comment">%         uimenu(mh.rsp,'Label','Select X-Corrector Strengths (BPM)',...</span>
1015 <span class="comment">%             'Callback',cback,...</span>
1016 <span class="comment">%             'Tag','hbpm',...</span>
1017 <span class="comment">%             'Userdata',instructions,'Separator','on');</span>
1018 
1019 <span class="comment">%         %Measure Horizontal</span>
1020 <span class="comment">%         uimenu(mh.rsp,'Label','Measure Horizontal to BPMs (all valid correctors)',...</span>
1021 <span class="comment">%             'Callback','corgui(''MeasureXResp'')');</span>
1022         <span class="comment">%==============</span>
1023         <span class="comment">%VERTICAL PLANE</span>
1024         <span class="comment">%==============</span>
1025 <span class="comment">%         uimenu(mh.rsp,'Label','    ');</span>
1026         <span class="comment">%Select corrector currents for vertical response to eBPMs</span>
1027 <span class="comment">%         cback = ['rload(''GenFig'', COR(2).name,COR(2).status,COR(2).ifit,COR(2).ebpm,'];</span>
1028 <span class="comment">%         cback = [cback '''Vertical Correctors to Electron BPMs'',''vbpm'');'];</span>
1029 <span class="comment">%         instructions = [...</span>
1030 <span class="comment">%             '   global COR;',...</span>
1031 <span class="comment">%             '   tlist = get(gcf,''UserData'');',...</span>
1032 <span class="comment">%             '   COR(2).ebpm=tlist{4};',...</span>
1033 <span class="comment">%             '   setappdata(0,''COR'',COR);'];</span>
1034 <span class="comment">%         uimenu(mh.rsp,'Label','Select Z-corrector Strengths (BPM)',...</span>
1035 <span class="comment">%             'Callback',cback,...</span>
1036 <span class="comment">%             'Tag','vbpm',...</span>
1037 <span class="comment">%             'Userdata',instructions,'Separator','on');</span>
1038 <span class="comment">%         %Measure Vertical</span>
1039 <span class="comment">%         uimenu(mh.rsp,'Label','Measure Vertical to BPMs (all valid correctors)',...</span>
1040 <span class="comment">%             'Callback','corgui(''MeasureYResp'')');</span>
1041 
1042         <span class="comment">%==========================================================</span>
1043     <span class="keyword">case</span> <span class="string">'UIControls'</span>                           <span class="comment">%  UIControls</span>
1044         <span class="comment">%==========================================================</span>
1045         <span class="comment">%pushbuttons located above main orbit display</span>
1046         <span class="comment">%other pushbuttons in routines OrbBox, CorBox</span>
1047 
1048         [screen_wide, screen_high]=screensizecm;
1049 
1050         x0=0.047*screen_wide; y0=0.7318*screen_high; dx=0.74*screen_wide; dy=0.06378*screen_high;
1051         SYS.display = uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="keyword">...</span>
1052             <span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1053             <span class="string">'Position'</span>,[x0 y0 dx dy]);            <span class="comment">%main frame</span>
1054 
1055         x0=0.057*screen_wide; y0=0.739*screen_high; dx=0.117*screen_wide; dy=0.021*screen_high;
1056         dely=0.03*screen_high;   delx=0.15*screen_wide;
1057 
1058         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
1059             <span class="string">'Units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1060             <span class="string">'Position'</span>, [x0+0*delx y0+1*dely dx dy], <span class="keyword">...</span>
1061             <span class="string">'String'</span>,<span class="string">'Update Display'</span>,<span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1062             <span class="string">'ToolTipString'</span>,<span class="string">'Update Measured Orbit (blue line)'</span>,<span class="keyword">...</span>
1063             <span class="string">'Callback'</span>,<span class="string">'bpmgui(''UpdateAct'')'</span>);     <span class="comment">%Update Orbit</span>
1064         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
1065             <span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1066             <span class="string">'Position'</span>, [x0+0*delx y0+0*dely dx dy], <span class="keyword">...</span>
1067             <span class="string">'String'</span>,<span class="string">'Update Reference'</span>,<span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1068             <span class="string">'ToolTipString'</span>,<span class="string">'Update Reference Orbit, both planes (red line)'</span>,<span class="keyword">...</span>
1069             <span class="string">'Callback'</span>,<span class="string">'bpmgui(''UpdateRef'')'</span>);        <span class="comment">%Update Reference Orbit</span>
1070 
1071         <span class="keyword">if</span> plane == 1, val=1; <span class="keyword">else</span> val=0; <span class="keyword">end</span>
1072         SYS.xplane=uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
1073             <span class="string">'Units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1074             <span class="string">'Position'</span>, [0.25*screen_wide y0+1*dely 0.08*screen_wide dy], <span class="keyword">...</span>
1075             <span class="string">'String'</span>,<span class="string">'Horizontal'</span>,<span class="string">'Value'</span>,val,<span class="keyword">...</span>
1076             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1077             <span class="string">'ToolTipString'</span>,<span class="string">'Horizontal Display and Control'</span>,<span class="keyword">...</span>
1078             <span class="string">'Callback'</span>,<span class="string">'orbgui(''Plane'')'</span>);  <span class="comment">%Toggle Plane-Horizontal</span>
1079 
1080         <span class="keyword">if</span> plane == 2, val=1; <span class="keyword">else</span> val=0; <span class="keyword">end</span>
1081         SYS.yplane=uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
1082             <span class="string">'Units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1083             <span class="string">'Position'</span>, [0.32*screen_wide y0+1*dely 0.08*screen_wide dy], <span class="keyword">...</span>
1084             <span class="string">'String'</span>,<span class="string">'Vertical'</span>,<span class="string">'Value'</span>,val,<span class="keyword">...</span>
1085             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1086             <span class="string">'ToolTipString'</span>,<span class="string">'Vertical Display and Control'</span>,<span class="keyword">...</span>
1087             <span class="string">'Callback'</span>,<span class="string">'orbgui(''Plane'')'</span>);  <span class="comment">%Toggle Plane-Vertical</span>
1088 
1089         <span class="keyword">if</span> SYS.relative==1, val=1; <span class="keyword">else</span> val=0; <span class="keyword">end</span>
1090         SYS.abs=uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1091             <span class="string">'Position'</span>, [0.25*screen_wide y0+0*dely 0.06*screen_wide dy], <span class="keyword">...</span>
1092             <span class="string">'String'</span>,<span class="string">'Absolute'</span>,<span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="string">'Value'</span>,val,<span class="keyword">...</span>
1093             <span class="string">'ToolTipString'</span>,<span class="string">'Absolute BPM Display'</span>,<span class="keyword">...</span>
1094             <span class="string">'Callback'</span>,<span class="string">'orbgui(''Relative'')'</span>);   <span class="comment">%Relative/Absolute-Absolute</span>
1095 
1096         <span class="keyword">if</span> SYS.relative==2, val=1; <span class="keyword">else</span> val=0; <span class="keyword">end</span>
1097         SYS.rel=uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1098             <span class="string">'Position'</span>, [0.32*screen_wide y0+0*dely 0.06*screen_wide dy], <span class="keyword">...</span>
1099             <span class="string">'String'</span>,<span class="string">'Relative'</span>,<span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="string">'Value'</span>,val,<span class="keyword">...</span>
1100             <span class="string">'ToolTipString'</span>,<span class="string">'Relative BPM Display'</span>,<span class="keyword">...</span>
1101             <span class="string">'Callback'</span>,<span class="string">'orbgui(''Relative'')'</span>);   <span class="comment">%Relative/Absolute-Relative</span>
1102 
1103         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
1104             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="keyword">...</span>
1105             <span class="string">'Position'</span>, [0.41*screen_wide 0.09*screen_high 0.45*dx dy], <span class="keyword">...</span>
1106             <span class="string">'String'</span>,<span class="string">'Apply'</span>,<span class="keyword">...</span>
1107             <span class="string">'ToolTipString'</span>,<span class="string">'Apply Correction: Blue Dash Line = Predicted Orbit'</span>,<span class="keyword">...</span>
1108             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1109             <span class="string">'Callback'</span>,<span class="string">'corgui(''ApplyCorrection'');'</span>);                  <span class="comment">%Apply Correction</span>
1110 
1111         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
1112             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="keyword">...</span>
1113             <span class="string">'Position'</span>, [0.47*screen_wide 0.09*screen_high 0.45*dx dy], <span class="keyword">...</span>
1114             <span class="string">'String'</span>,<span class="string">'Remove'</span>,<span class="keyword">...</span>
1115             <span class="string">'ToolTipString'</span>,<span class="string">'Remove Previous Corrector Solution'</span>,<span class="keyword">...</span>
1116             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1117             <span class="string">'Callback'</span>,<span class="string">'corgui(''RemoveCorrection'');'</span>);                 <span class="comment">%Remove Correction</span>
1118 
1119         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
1120             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="keyword">...</span>
1121             <span class="string">'Position'</span>, [0.41*screen_wide 0.06*screen_high 0.97*dx dy], <span class="keyword">...</span>
1122             <span class="string">'String'</span>,<span class="string">'Refresh Fit'</span>,<span class="keyword">...</span>
1123             <span class="string">'ToolTipString'</span>,<span class="string">'Acquire Orbit, Correctors, Fit, Refresh all Plots &amp; Fields'</span>,<span class="keyword">...</span>
1124             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1125             <span class="string">'Callback'</span>,<span class="string">'orbgui(''RefreshOrbGUI'');'</span>);                    <span class="comment">%Refresh Fit</span>
1126 
1127         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
1128             <span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1129             <span class="string">'Position'</span>, [x0+4*delx+0.53*dx        y0+1*dely 0.47*dx dy], <span class="keyword">...</span>
1130             <span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="string">'String'</span>,<span class="string">'Save'</span>,<span class="keyword">...</span>
1131             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1132             <span class="string">'ToolTipString'</span>,<span class="string">'Save Set - Use to Save Present Working Parameters'</span>,<span class="keyword">...</span>
1133             <span class="string">'Callback'</span>,<span class="string">'orbgui(''SaveSet'');'</span>);      <span class="comment">%SaveSet</span>
1134 
1135         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
1136             <span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1137             <span class="string">'Position'</span>, [x0+4*delx+0.53*dx        y0+0*dely 0.47*dx dy], <span class="keyword">...</span>
1138             <span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="string">'String'</span>,<span class="string">'Restore'</span>,<span class="keyword">...</span>
1139             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1140             <span class="string">'ToolTipString'</span>,<span class="string">'Restore System to Save Set Parameters'</span>,<span class="keyword">...</span>
1141             <span class="string">'Callback'</span>,<span class="string">'orbgui(''RestoreSaveSet'');'</span>);     <span class="comment">%RestoreSaveSet</span>
1142 
1143         <span class="comment">%% Scaling of the BPMs</span>
1144             
1145         x0=0.788*screen_wide; dx=0.015*screen_wide; dy=0.031*screen_high; y0=0.583*screen_high;
1146         SYS.BPMScale=uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1147             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="string">'Callback'</span>,<span class="string">'orbgui(''ScaleBPMAxis'');'</span>,<span class="keyword">...</span>
1148             <span class="string">'Max'</span>,1,<span class="string">'Min'</span>,-1,<span class="string">'SliderStep'</span>,[5e-1 2e-1],<span class="string">'Value'</span>,0);
1149 
1150         SYS.BPMAutoScale=uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1151             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1152             <span class="string">'Position'</span>,[x0 y0 - 1.5  dx dy], <span class="keyword">...</span>
1153             <span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="string">'String'</span>,<span class="string">'A'</span>,<span class="keyword">...</span>
1154             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1155             <span class="string">'ToolTipString'</span>,<span class="string">'Autoscales BPM axis'</span>,<span class="keyword">...</span>
1156             <span class="string">'Callback'</span>,<span class="string">'orbgui(''AutoScaleBPMAxis'');'</span>);  <span class="comment">%autoscale</span>
1157             
1158 
1159         <span class="comment">%% Scaling of the correctors</span>
1160         
1161         y0=0.355*screen_high;
1162         SYS.CORScale=uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1163             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="string">'Callback'</span>,<span class="string">'orbgui(''ScaleCORAxis'');'</span>,<span class="keyword">...</span>
1164             <span class="string">'Max'</span>,1,<span class="string">'Min'</span>,-1,<span class="string">'SliderStep'</span>,[5e-1 5e-1],<span class="string">'Value'</span>,0);
1165 
1166         SYS.BPMAutoScale=uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1167             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1168             <span class="string">'Position'</span>,[x0 y0 - 1.5  dx dy], <span class="keyword">...</span>
1169             <span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="string">'String'</span>,<span class="string">'A'</span>,<span class="keyword">...</span>
1170             <span class="string">'FontSize'</span>,9,<span class="string">'FontWeight'</span>,<span class="string">'demi'</span>,<span class="keyword">...</span>
1171             <span class="string">'ToolTipString'</span>,<span class="string">'Autoscales Corrector axis'</span>,<span class="keyword">...</span>
1172             <span class="string">'Callback'</span>,<span class="string">'orbgui(''AutoScaleCorrAxis'');'</span>);  <span class="comment">%autoscale</span>
1173 
1174         setappdata(0,<span class="string">'SYS'</span>,SYS);
1175 
1176         <span class="comment">%==========================================================</span>
1177     <span class="keyword">case</span> <span class="string">'BPMbox'</span>                               <span class="comment">%  BPMbox</span>
1178         <span class="comment">%==========================================================</span>
1179         <span class="comment">%BPM Dialog Box</span>
1180         <span class="comment">%located at bottom of main frame</span>
1181         [screen_wide, screen_high]=screensizecm;
1182 
1183         x0=0.013*screen_wide; dx=0.1640*screen_wide; y0=0.0158*screen_high; dy=0.17*screen_high;
1184         uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0 y0 dx dy]);     <span class="comment">%main frame</span>
1185 
1186         <span class="comment">%Static BPM text fields (labels)</span>
1187 <span class="comment">%         dx2=0.0888*screen_wide;</span>
1188         dy2=0.017*screen_high; dely=0.0175*screen_high;
1189 
1190         x0=0.7*screen_wide; dx=0.085*screen_wide; y0=0.705*screen_high;
1191         
1192         uicontrol(<span class="string">'Style'</span>,<span class="string">'Frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>, <span class="keyword">...</span>
1193             [x0-0.05 y0-0.05 dx+0.075 dy2+0.075]);  <span class="comment">%frame around toggle</span>
1194 
1195         SYS.togglebpm=uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
1196             <span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1197             <span class="string">'Position'</span>,[x0 y0 dx dy2],<span class="keyword">...</span>
1198             <span class="string">'String'</span>,<span class="string">'Toggle BPMs'</span>,<span class="keyword">...</span>
1199             <span class="string">'ToolTipString'</span>,<span class="string">'Toggle BPMs between fit (green) and no-fit (yellow)'</span>,<span class="keyword">...</span>
1200             <span class="string">'Callback'</span>,<span class="string">'bpmgui(''ToggleMode'')'</span>);     <span class="comment">%Radio BPM: Toggle Mode</span>
1201 
1202         uicontrol(<span class="string">'Style'</span>,<span class="string">'Frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>, <span class="keyword">...</span>
1203             [x0-1.5*dx-0.05 y0-0.05 dx+0.075 dy2+0.075]);  <span class="comment">%frame around drag</span>
1204 
1205         SYS.dragbpm=uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="keyword">...</span>
1206             <span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1207             <span class="string">'Position'</span>, [x0 - 1.5*dx  y0 dx dy2], <span class="keyword">...</span>
1208             <span class="string">'String'</span>,<span class="string">'Drag BPMs'</span>,<span class="keyword">...</span>
1209             <span class="string">'ToolTipString'</span>,<span class="string">'Enable BPMs for interactive drag'</span>,<span class="keyword">...</span>
1210             <span class="string">'Callback'</span>,<span class="string">'bpmgui(''DragMode'')'</span>);      <span class="comment">%Radio BPM: Drag Mode</span>
1211 
1212 
1213         x0=0.01856*screen_wide; dx=0.0576*screen_wide; y0=0.0247*screen_high; dy=0.01562*screen_high;
1214         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1215             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1216             <span class="string">'Position'</span>,[x0 y0+1.7*dely dx dy],<span class="keyword">...</span>
1217             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1218             <span class="string">'ToolTipString'</span>,<span class="string">'BPM weight'</span>,<span class="keyword">...</span>
1219             <span class="string">'String'</span>,<span class="string">'Weight:'</span>);
1220 
1221         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1222             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1223             <span class="string">'Position'</span>,[x0 y0+2.7*dely dx dy],<span class="keyword">...</span>
1224             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1225             <span class="string">'ToolTipString'</span>,<span class="string">'Predicted Orbit (blue dash line value at BPM site)'</span>,<span class="keyword">...</span>
1226             <span class="string">'String'</span>,<span class="string">'Prediction:'</span>);
1227 
1228         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1229             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1230             <span class="string">'Position'</span>,[x0 y0+3.7*dely dx dy],<span class="keyword">...</span>
1231             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1232             <span class="string">'ToolTipString'</span>,<span class="string">'Requested orbit (BPM icon value at BPM site)'</span>,<span class="keyword">...</span>
1233             <span class="string">'String'</span>,<span class="string">'Desired:'</span>);
1234 
1235         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1236             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1237             <span class="string">'Position'</span>,[x0 y0+4.7*dely dx dy],<span class="keyword">...</span>
1238             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1239             <span class="string">'ToolTipString'</span>,<span class="string">'Offset from BPM icon to red line at BPM site'</span>,<span class="keyword">...</span>
1240             <span class="string">'String'</span>,<span class="string">'Offset:'</span>);
1241 
1242         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1243             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1244             <span class="string">'Position'</span>,[x0 y0+6*dely dx dy],<span class="keyword">...</span>
1245             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1246             <span class="string">'ToolTipString'</span>,<span class="string">'Reference orbit (red line value at BPM site)'</span>,<span class="keyword">...</span>
1247             <span class="string">'String'</span>,<span class="string">'Reference:'</span>);
1248 
1249         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1250             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1251             <span class="string">'Position'</span>,[x0 y0+7*dely dx dy],<span class="keyword">...</span>
1252             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1253             <span class="string">'ToolTipString'</span>,<span class="string">'Measured orbit (blue line value at BPM site)'</span>,<span class="keyword">...</span>
1254             <span class="string">'String'</span>,<span class="string">'Measured:'</span>);
1255 
1256         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1257             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1258             <span class="string">'Position'</span>,[x0 y0+8*dely dx dy],<span class="keyword">...</span>
1259             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1260             <span class="string">'ToolTipString'</span>,<span class="string">'Selected BPM name'</span>,<span class="keyword">...</span>
1261             <span class="string">'String'</span>,<span class="string">'BPM Name:'</span>);
1262 
1263         <span class="comment">%Dynamic BPM text fields (data)</span>
1264         x0 = 0.09647*screen_wide; dx=0.075*screen_wide; <span class="comment">%0.065</span>
1265         y0 = 0.0247*screen_high; dy=0.0156*screen_high;
1266 <span class="comment">%         dx2 = 0.00037*screen_wide;</span>
1267         dely=0.0175*screen_high;
1268 
1269         SYS.bpmmeas =uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1270             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1271             <span class="string">'Position'</span>,[x0 y0+2.7*dely dx dy],<span class="keyword">...</span>
1272             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1273             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%BPMmeas</span>
1274 
1275         SYS.bpmdes=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1276             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1277             <span class="string">'Position'</span>,[x0 y0+3.7*dely dx dy],<span class="keyword">...</span>
1278             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1279             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%BPMdes</span>
1280 
1281         <span class="comment">%offset edit box</span>
1282         SYS.bpmedit=uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
1283             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1284             <span class="string">'Position'</span>,[x0 y0+4.7*dely dx 1.2*dy],<span class="keyword">...</span>
1285             <span class="string">'FontName'</span>,<span class="string">'times'</span>,<span class="string">'FontSize'</span>,8,<span class="keyword">...</span>
1286             <span class="string">'Callback'</span>,<span class="string">'bpmgui(''EditDesOrb'')'</span>,<span class="keyword">...</span>
1287             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%EditDesOrb</span>
1288 
1289         SYS.editbpmweight=uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
1290             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1291             <span class="string">'Position'</span>,[x0 y0+1.7*dely dx 1.2*dy],<span class="keyword">...</span>
1292             <span class="string">'FontName'</span>,<span class="string">'times'</span>,<span class="string">'FontSize'</span>,8,<span class="keyword">...</span>
1293             <span class="string">'Callback'</span>,<span class="string">'bpmgui(''EditBPMWeight'')'</span>,<span class="keyword">...</span>
1294             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%EditBPMWeight</span>
1295 
1296         SYS.bpmref=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1297             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1298             <span class="string">'Position'</span>,[x0 y0+6*dely dx dy],<span class="keyword">...</span>
1299             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1300             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%BPMref</span>
1301 
1302 
1303         SYS.bpmact=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1304             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1305             <span class="string">'Position'</span>,[x0 y0+7*dely dx dy],<span class="keyword">...</span>
1306             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1307             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%BPMact</span>
1308 
1309         SYS.bpmname=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1310             <span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="keyword">...</span>
1311             <span class="string">'Position'</span>,[x0 y0+8*dely dx dy],<span class="keyword">...</span>
1312             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1313             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%bpmname</span>
1314 
1315         <span class="comment">%RMS Display</span>
1316         x0=0.1*screen_wide; dx=0.035*screen_wide; y0=0.705*screen_high; dy=0.0175*screen_high;
1317 
1318         uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>, <span class="keyword">...</span>
1319             [x0-0.025 y0-0.025 2.2*dx+0.05 dy+0.05]); <span class="comment">%frame around RMS</span>
1320 
1321         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1322             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1323             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
1324             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1325             <span class="string">'ToolTipString'</span>,<span class="string">'RMS deviation of actual orbit from desired orbit'</span>,<span class="keyword">...</span>
1326             <span class="string">'String'</span>,<span class="string">' rms:'</span>);  <span class="comment">%Display RMS static</span>
1327 
1328         x0 = 0.135*screen_wide; dx = 0.04*screen_wide;
1329         SYS.bpmrms = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1330             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1331             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
1332             <span class="string">'String'</span>,<span class="string">''</span>);       <span class="comment">%RMS dynamic</span>
1333 
1334         x0=0.23*screen_wide; dx=0.035*screen_wide; y0=0.705*screen_high; dy=0.0175*screen_high;
1335 
1336         uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>, <span class="keyword">...</span>
1337             [x0-0.025 y0-0.025 2.4*dx+0.05 dy+0.05]); <span class="comment">%frame around mean</span>
1338 
1339         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1340             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1341             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
1342             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1343             <span class="string">'ToolTipString'</span>,<span class="string">'Mean deviation of actual orbit from desired orbit'</span>,<span class="keyword">...</span>
1344             <span class="string">'String'</span>,<span class="string">' mean:'</span>);    <span class="comment">%Display mean static</span>
1345 
1346         x0 = 0.27*screen_wide; dx = 0.04*screen_wide;
1347         SYS.bpmmean = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1348             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1349             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
1350             <span class="string">'String'</span>,<span class="string">''</span>); <span class="comment">%mean dynamic</span>
1351 
1352         setappdata(0,<span class="string">'SYS'</span>,SYS);
1353 
1354         <span class="comment">%==========================================================</span>
1355     <span class="keyword">case</span> <span class="string">'CorBox'</span>                      <span class="comment">% *** CorrectBox ***</span>
1356         <span class="comment">%==========================================================</span>
1357         <span class="comment">%frame for corrector uicontrols</span>
1358         <span class="comment">%located at bottom of main frame</span>
1359         [screen_wide, screen_high]=screensizecm;
1360 
1361         x0 = 0.2*screen_wide; dx=0.1650*screen_wide; 
1362         y0=0.016*screen_high; dy=0.17*screen_high;
1363         uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0 y0 dx dy]);  <span class="comment">%main frame</span>
1364 
1365         <span class="comment">%Static Corrector text fields (labels)</span>
1366         x0=0.21*screen_wide;
1367         dx=0.06*screen_wide; y0=0.025*screen_high; dy=0.015*screen_high;
1368         dx2=0.1*screen_wide; dely=0.0175*screen_high;
1369         <span class="comment">%dy2=0.017*screen_high;</span>
1370 
1371         <span class="comment">%% Construction from bottom to up</span>
1372         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span><span class="comment">                %Restore Correctors</span>
1373             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1374             <span class="string">'Position'</span>,[1.2*x0 y0+0*dely dx2 dy],<span class="keyword">...</span>
1375             <span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="keyword">...</span>
1376             <span class="string">'String'</span>,<span class="string">'Restore Correctors'</span>,<span class="keyword">...</span>
1377             <span class="string">'ToolTipString'</span>,<span class="string">'Restore corrector strengths in active plane'</span>,<span class="keyword">...</span>
1378             <span class="string">'Callback'</span>,<span class="string">'corgui(''RestoreCors'');'</span>);   <span class="comment">%Restore Correctors</span>
1379 
1380         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span><span class="comment">               %Save Correctors</span>
1381             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1382             <span class="string">'Position'</span>,[1.2*x0 y0+1.0*dely dx2 dy],<span class="keyword">...</span>
1383             <span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="keyword">...</span>
1384             <span class="string">'String'</span>,<span class="string">'Save Correctors'</span>,<span class="keyword">...</span>
1385             <span class="string">'ToolTipString'</span>,<span class="string">'Save corrector strengths in active plane'</span>,<span class="keyword">...</span>
1386             <span class="string">'Callback'</span>,<span class="string">'corgui(''SaveCors'',SYS.plane);'</span>);   <span class="comment">%save correctors for bump generation and restore</span>
1387 
1388        <span class="comment">%display rf offset</span>
1389         SYS.rftoggle = uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
1390             <span class="string">'units'</span>, <span class="string">'centimeters'</span>, <span class="keyword">...</span>
1391             <span class="string">'Position'</span>, [x0-dy*0.5 y0+dely 0.6*dx 1.2*dy], <span class="keyword">...</span>
1392             <span class="string">'Callback'</span>,<span class="string">'respgui(''RFToggle'')'</span>,<span class="string">'Value'</span>,0,<span class="keyword">...</span>
1393             <span class="string">'ToolTipString'</span>,<span class="string">'Toggle fitting for RF orbit component'</span>, <span class="keyword">...</span>
1394             <span class="string">'String'</span>,<span class="string">'RF'</span>);
1395         
1396 <span class="comment">%         uicontrol('Style','pushbutton',...                %MakeOrbitSlider</span>
1397 <span class="comment">%             'Units','centimeters',...</span>
1398 <span class="comment">%             'Position',[1.1*x0 y0+0.4*dely dx2 dy],...</span>
1399 <span class="comment">%             'ForeGroundColor','k',...</span>
1400 <span class="comment">%             'String','Make Slider',...</span>
1401 <span class="comment">%             'ToolTipString','Create Orbit Slider/Save File to Disk',...</span>
1402 <span class="comment">%             'Callback','corgui(''MakeOrbitSlider'');'); %MakeOrbitSlider</span>
1403         
1404         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1405             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1406             <span class="string">'Position'</span>,[x0 y0+2*dely dx dy],<span class="keyword">...</span>
1407             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1408             <span class="string">'ToolTipString'</span>,<span class="string">'RF value updated if RF correction'</span>,<span class="keyword">...</span>
1409             <span class="string">'String'</span>,<span class="string">'rf (MHz):'</span>);
1410 
1411         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1412             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1413             <span class="string">'Position'</span>,[x0 y0+3*dely dx dy],<span class="keyword">...</span>
1414             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1415             <span class="string">'ToolTipString'</span>,<span class="string">'RF shift if correction'</span>,<span class="keyword">...</span>
1416             <span class="string">'String'</span>,<span class="string">'drf (MHz):'</span>);
1417 
1418         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1419             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1420             <span class="string">'Position'</span>,[x0 y0+4*dely dx dy],<span class="keyword">...</span>
1421             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1422             <span class="string">'ToolTipString'</span>,<span class="string">'Requested corrector strength (red bar at corrector site)'</span>,<span class="keyword">...</span>
1423             <span class="string">'String'</span>,<span class="string">'Desired:'</span>);
1424 
1425         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1426             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1427             <span class="string">'Position'</span>,[x0 y0+5*dely dx dy],<span class="keyword">...</span>
1428             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1429             <span class="string">'ToolTipString'</span>,<span class="string">'Incremental corrector strength (red bar - green bar)'</span>,<span class="keyword">...</span>
1430             <span class="string">'String'</span>,<span class="string">'Fit Increment:'</span>);
1431 
1432         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1433             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1434             <span class="string">'Position'</span>,[x0 y0+6*dely dx dy],<span class="keyword">...</span>
1435             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1436             <span class="string">'ToolTipString'</span>,<span class="string">'Saved corrector value'</span>,<span class="keyword">...</span>
1437             <span class="string">'String'</span>,<span class="string">'Reference:'</span>);
1438 
1439         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1440             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1441             <span class="string">'Position'</span>,[x0 y0+7*dely dx dy],<span class="keyword">...</span>
1442             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1443             <span class="string">'ToolTipString'</span>,<span class="string">'Measured corrector value (green/yellow bar at corrector site)'</span>,<span class="keyword">...</span>
1444             <span class="string">'String'</span>,<span class="string">'Measured:'</span>);
1445 
1446        uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1447             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1448             <span class="string">'Position'</span>,[x0 y0+8*dely dx dy],<span class="keyword">...</span>
1449             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1450             <span class="string">'ToolTipString'</span>,<span class="string">'Selected corrector name'</span>,<span class="keyword">...</span>
1451             <span class="string">'String'</span>,<span class="string">'Corr Name:'</span>);
1452          
1453 
1454         <span class="comment">%Dynamic corrector text fields (data)</span>
1455         x0=0.28*screen_wide; dx=0.075*screen_wide; <span class="comment">%0.065</span>
1456 
1457         SYS.hrf=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1458             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1459             <span class="string">'Position'</span>,[x0 y0+2*dely dx dy],<span class="keyword">...</span>
1460             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1461             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%CORreq</span>
1462 
1463         SYS.hdrf=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1464             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1465             <span class="string">'Position'</span>,[x0 y0+3*dely dx dy],<span class="keyword">...</span>
1466             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1467             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%CORreq</span>
1468 
1469         SYS.correq=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1470             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1471             <span class="string">'Position'</span>,[x0 y0+4*dely dx dy],<span class="keyword">...</span>
1472             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1473             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%CORreq</span>
1474 
1475         SYS.coroffset=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1476             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1477             <span class="string">'Position'</span>,[x0 y0+5*dely dx dy],<span class="keyword">...</span>
1478             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1479             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%CORoffset</span>
1480 
1481         SYS.corref=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1482             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1483             <span class="string">'Position'</span>,[x0 y0+6*dely dx dy],<span class="keyword">...</span>
1484             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1485             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%CORref</span>
1486 
1487         SYS.coract=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1488             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1489             <span class="string">'Position'</span>,[x0 y0+7*dely dx dy],<span class="keyword">...</span>
1490             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1491             <span class="string">'String'</span>,<span class="string">''</span>);                 <span class="comment">%CORact</span>
1492 
1493         SYS.corname=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1494             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1495             <span class="string">'Position'</span>,[x0 y0+8*dely dx dy],<span class="keyword">...</span>
1496             <span class="string">'BackGroundColor'</span>,[0.77 0.91 1.00],<span class="keyword">...</span>
1497             <span class="string">'String'</span>,<span class="string">''</span>);               <span class="comment">%CORname</span>
1498 
1499         x0=0.7*screen_wide; dx=0.07*screen_wide; y0=0.445*screen_high; dy=0.0175*screen_high;
1500         uicontrol(<span class="string">'Style'</span>,<span class="string">'Frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>, <span class="keyword">...</span>
1501             [x0-0.05 y0-0.05 dx+0.075 dy+0.075]);  <span class="comment">%frame</span>
1502 
1503         SYS.togglecor=uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="string">'units'</span>, <span class="string">'centimeters'</span>,<span class="string">'Position'</span>, [x0 y0 dx dy],<span class="keyword">...</span>
1504             <span class="string">'String'</span>,<span class="string">'Toggle Corrs'</span>,<span class="keyword">...</span>
1505             <span class="string">'ToolTipString'</span>,<span class="string">'Toggle correctors for fit (green)/nofit (yellow)'</span>,<span class="keyword">...</span>
1506             <span class="string">'Callback'</span>,<span class="string">'corgui(''ToggleCor'')'</span>);        <span class="comment">%Radio Corr: Toggle</span>
1507 
1508 
1509         <span class="comment">%RMS Display</span>
1510         x0=0.055*screen_wide; dx=0.035*screen_wide;
1511         uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>, <span class="keyword">...</span>
1512             [x0-0.025 y0-0.025 2.2*dx+0.05 dy+0.05]); <span class="comment">%frame around RMS</span>
1513 
1514         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
1515             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1516             <span class="string">'ToolTipString'</span>,<span class="string">'RMS value of correctors used for fit'</span>,<span class="keyword">...</span>
1517             <span class="string">'String'</span>,<span class="string">' rms:'</span>);                          <span class="comment">%rms static</span>
1518 
1519         SYS.corrms = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'units'</span>,<span class="string">'centimeters'</span>, <span class="keyword">...</span>
1520             <span class="string">'Position'</span>,[x0+dx y0 dx dy],<span class="string">'String'</span>,<span class="string">''</span>);   <span class="comment">%rms dynamic</span>
1521 
1522         <span class="comment">%Mean Display</span>
1523         x0=0.16*screen_wide; dx=0.035*screen_wide;
1524         uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>, <span class="keyword">...</span>
1525             [x0-0.025 y0-0.025 2.4*dx+0.05 dy+0.05]); <span class="comment">%frame around mean</span>
1526 
1527         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
1528             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1529             <span class="string">'ToolTipString'</span>,<span class="string">'RMS value of correctors used for fit'</span>,<span class="keyword">...</span>
1530             <span class="string">'String'</span>,<span class="string">' mean:'</span>);                          <span class="comment">%mean static</span>
1531 
1532         SYS.cormean = uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'units'</span>,<span class="string">'centimeters'</span>, <span class="keyword">...</span>
1533             <span class="string">'Position'</span>,[x0+dx y0 dx dy],<span class="string">'String'</span>,<span class="string">''</span>);   <span class="comment">%mean dynamic</span>
1534         setappdata(0,<span class="string">'SYS'</span>,SYS);
1535 
1536         <span class="comment">%==========================================================</span>
1537     <span class="keyword">case</span> <span class="string">'SVDBox'</span>                               <span class="comment">%  SVDBox</span>
1538         <span class="comment">%==========================================================</span>
1539         <span class="comment">%SVD Dialog Box</span>
1540         <span class="comment">%located at bottom of main frame</span>
1541         [screen_wide, screen_high] = screensizecm;
1542 
1543         x0=0.385*screen_wide; dx=0.16*screen_wide; 
1544         y0=0.0158*screen_high; dy=0.17*screen_high;
1545 
1546         uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="string">'Position'</span>,[x0 y0 dx dy]);     <span class="comment">%main frame</span>
1547 
1548         x0=0.39*screen_wide; dx=0.09375*screen_wide; 
1549         y0=0.018*screen_high; dy=0.02*screen_high;
1550 <span class="comment">%         dy2=0.022*screen_high;</span>
1551         dely=0.02353*screen_high;
1552 
1553         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1554             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1555             <span class="string">'Position'</span>,[x0 y0+6*dely dx dy],<span class="keyword">...</span>
1556             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1557             <span class="string">'ToolTipString'</span>,<span class="string">'Choose number of singular values for fit'</span>,<span class="keyword">...</span>
1558             <span class="string">'String'</span>,<span class="string">'# Singular Values:'</span>);
1559 
1560         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1561             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1562             <span class="string">'Position'</span>,[x0 y0+5*dely dx*1.2 dy],<span class="keyword">...</span>
1563             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1564             <span class="string">'ToolTipString'</span>,<span class="string">'Fractional multiplier applied to all correctors (but not shown in fit)'</span>,<span class="keyword">...</span>
1565             <span class="string">'String'</span>,<span class="string">'Fraction of Correction:'</span>);
1566 
1567 
1568         x0 = 0.50*screen_wide; dx=0.032*screen_wide;
1569         default_nsvd = 56;
1570         <span class="comment">% Edit box for number of singular values</span>
1571         SYS.svdedit = uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
1572             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1573             <span class="string">'Position'</span>,[x0+dx/2 y0+6*dely dx/1.5 dy],<span class="keyword">...</span>
1574             <span class="string">'Callback'</span>,<span class="string">'respgui(''SVDEdit'');'</span>,<span class="keyword">...</span>
1575             <span class="string">'String'</span>,num2str(default_nsvd));   <span class="comment">%default to one singular value</span>
1576 
1577         <span class="comment">%Slider for number of singlar values  see %matlab help/slider</span>
1578 <span class="comment">%         SYS.svdslide=uicontrol('Style','slider',...</span>
1579 <span class="comment">%             'Units','centimeters',...</span>
1580 <span class="comment">%             'Position',[x0-dx/2 y0+6*dely dx/1.2 dy],...</span>
1581 <span class="comment">%             'Callback','respgui(''SVDSlider'');',...</span>
1582 <span class="comment">%             'Max',default_nsvd,'Min',1,...</span>
1583 <span class="comment">%             'SliderStep',[1/(default_nsvd-1),1/(default_nsvd-1)],...</span>
1584 <span class="comment">%             'Value',round(default_nsvd/2));</span>
1585 
1586         <span class="comment">%Edit box for fraction of correction</span>
1587         SYS.fract=uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
1588             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1589             <span class="string">'Position'</span>,[x0+dx/2 y0+5*dely dx/1.5 dy],<span class="keyword">...</span>
1590             <span class="string">'Callback'</span>,<span class="string">'corgui(''Fract'');'</span>,<span class="keyword">...</span>
1591             <span class="string">'String'</span>,num2str(1));
1592 
1593         setappdata(0,<span class="string">'SYS'</span>,SYS);
1594 
1595         <span class="comment">%==========================================================</span>
1596     <span class="keyword">case</span> <span class="string">'KnobBox'</span>                               <span class="comment">%  KnobBox</span>
1597         <span class="comment">%==========================================================</span>
1598 
1599         [screen_wide, screen_high]=screensizecm;
1600 
1601         x0=0.4170*screen_wide; y0=0.006*screen_high;
1602         dy=0.021*screen_high; dely=0.02353*screen_high;
1603 
1604         dx=0.14*screen_wide;
1605         SYS.addignknob=uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
1606             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1607             <span class="string">'Position'</span>,[x0 y0+3*dely dx dy],<span class="keyword">...</span>
1608             <span class="string">'ForeGroundColor'</span>,<span class="string">'k'</span>,<span class="keyword">...</span>
1609             <span class="string">'String'</span>,<span class="string">'Assign Knob'</span>,<span class="keyword">...</span>
1610             <span class="string">'ToolTipString'</span>,<span class="string">'Save knob corrector strengths in active plane'</span>,<span class="keyword">...</span>
1611             <span class="string">'Callback'</span>,<span class="string">'corgui(''AssignKnob'');'</span>);   <span class="comment">%Assign Knob</span>
1612 
1613         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1614             <span class="string">'units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1615             <span class="string">'Position'</span>,[1.03*x0 y0+1.8*dely dx/2 dy],<span class="keyword">...</span>
1616             <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1617             <span class="string">'ToolTipString'</span>,<span class="string">'Edit corrector knob strength'</span>,<span class="keyword">...</span>
1618             <span class="string">'String'</span>,<span class="string">'Knob Amplitude:'</span>);
1619 
1620         SYS.knobedit=uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
1621             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
1622             <span class="string">'Position'</span>,[1.25*x0 y0+1.9*dely dx/5 dy],<span class="keyword">...</span>
1623             <span class="string">'Callback'</span>,<span class="string">'corgui(''KnobEdit'');'</span>,<span class="keyword">...</span>
1624             <span class="string">'String'</span>,num2str(0));
1625 
1626         setappdata(0,<span class="string">'SYS'</span>,SYS);
1627 
1628         <span class="comment">%=============================================================</span>
1629     <span class="keyword">case</span> <span class="string">'Plane'</span>                             <span class="comment">% *** Plane ***</span>
1630         <span class="comment">%=============================================================</span>
1631         <span class="comment">%Toggle the x/y fitting displays</span>
1632         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'HidePlots'</span>);        <span class="comment">%Note: separate handles for corrector icons in each plane</span>
1633         <span class="comment">%hide existing icons before switching planes (visible/off)</span>
1634 
1635         <span class="keyword">if</span>  get(SYS.xplane,<span class="string">'Value'</span>)==0 &amp;&amp; SYS.plane==1     <span class="comment">%was in horizontal mode, stay in horizontal</span>
1636             set(SYS.xplane,<span class="string">'Value'</span>,1);
1637         <span class="keyword">elseif</span> get(SYS.yplane,<span class="string">'Value'</span>)==0 &amp;&amp; SYS.plane==2     <span class="comment">%%was in vertical mode, stay in vertical</span>
1638             set(SYS.yplane,<span class="string">'Value'</span>,1);
1639         <span class="keyword">elseif</span> get(SYS.yplane,<span class="string">'Value'</span>)==1 &amp;&amp; SYS.plane==1     <span class="comment">%%was in horizontal mode, switch to vertical</span>
1640             SYS.plane=2;           <span class="comment">%horizontal</span>
1641             set(SYS.xplane,<span class="string">'Value'</span>,0);
1642         <span class="keyword">elseif</span> get(SYS.xplane,<span class="string">'Value'</span>)==1 &amp;&amp; SYS.plane==2     <span class="comment">%%was in vertical mode, switch to horizontal</span>
1643             SYS.plane=1;           <span class="comment">%horizontal</span>
1644             set(SYS.yplane,<span class="string">'Value'</span>,0);
1645         <span class="keyword">end</span>
1646 
1647         setappdata(0,<span class="string">'SYS'</span>,SYS);
1648 
1649         <span class="keyword">if</span> RSP(2).rfflag  <span class="comment">% disable RF correction for vertical plane</span>
1650             <a href="respgui.html" class="code" title="function respgui(action, varargin)">respgui</a>(<span class="string">'RFToggle'</span>);            
1651         <span class="keyword">end</span>
1652 
1653         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'ShowPlots'</span>);        <span class="comment">%visible/on</span>
1654         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'RefreshOrbGUI'</span>);
1655 
1656         <span class="comment">%=============================================================</span>
1657     <span class="keyword">case</span> <span class="string">'TogglePlane'</span>                       <span class="comment">% *** TogglePlane ***</span>
1658         <span class="comment">%=============================================================</span>
1659         <span class="comment">%Toggle plane flag</span>
1660         SYS.plane=1+mod(SYS.plane,2);
1661         setappdata(0,<span class="string">'SYS'</span>,SYS);
1662 
1663         <span class="comment">%=============================================================</span>
1664     <span class="keyword">case</span> <span class="string">'RefreshOrbGUI'</span>                   <span class="comment">% *** RefreshOrbGUI ***</span>
1665         <span class="comment">%=============================================================</span>
1666 
1667         <a href="respgui.html" class="code" title="function respgui(action, varargin)">respgui</a>(<span class="string">'SolveSystem'</span>);    <span class="comment">%75 ms in simulator</span>
1668         <a href="respgui.html" class="code" title="function respgui(action, varargin)">respgui</a>(<span class="string">'UpdateFit'</span>);
1669 
1670         <span class="comment">%disp('update fields');    %15 ms in simulator</span>
1671         <span class="comment">%Set Defaults</span>
1672         set(SYS.togglebpm,<span class="string">'Value'</span>,0);        <span class="comment">%default to display only</span>
1673         set(SYS.dragbpm,  <span class="string">'Value'</span>,0);        <span class="comment">%default to no drag</span>
1674         set(SYS.togglecor,<span class="string">'Value'</span>,0);        <span class="comment">%default to no toggle</span>
1675         set(SYS.showresp, <span class="string">'Checked'</span>, <span class="string">'Off'</span>); <span class="comment">%default to no resp display</span>
1676         set(SYS.showeig,  <span class="string">'Checked'</span>, <span class="string">'Off'</span>); <span class="comment">%default to no eig display</span>
1677        
1678         <span class="comment">%default to no rf orbit subtraction</span>
1679         set(SYS.rftoggle, <span class="string">'Value'</span>, 0);
1680         set(SYS.hdrf,<span class="string">'String'</span>, <span class="string">'0.0'</span>);
1681         set(SYS.fract,<span class="string">'String'</span>, num2str(COR(plane).fract));
1682         
1683         <span class="comment">%re-write text fields</span>
1684         <span class="keyword">if</span> BPM(plane).mode == 1, set(SYS.togglebpm,<span class="string">'Value'</span>,1); <span class="keyword">end</span>;     <span class="comment">%toggle</span>
1685         <span class="keyword">if</span> BPM(plane).mode == 2, set(SYS.dragbpm,<span class="string">'Value'</span>,1); <span class="keyword">end</span>;       <span class="comment">%drag</span>
1686         <span class="keyword">if</span> COR(plane).mode == 1, set(SYS.togglecor,<span class="string">'Value'</span>,1); <span class="keyword">end</span>;     <span class="comment">%toggle</span>
1687         <span class="keyword">if</span> strcmpi(RSP(plane).disp(1:2),<span class="string">'on'</span>), set(SYS.showresp,<span class="string">'Checked'</span>, <span class="string">'on'</span>); <span class="keyword">end</span>;
1688         <span class="keyword">if</span> strcmpi(RSP(plane).eig(1:2),<span class="string">'on'</span>), set(SYS.showeig, <span class="string">'Checked'</span>, <span class="string">'on'</span>); <span class="keyword">end</span>;
1689         <span class="keyword">if</span> RSP(plane).rfflag  == 1 <span class="comment">% RF part</span>
1690             set(SYS.rftoggle,<span class="string">'Value'</span>,1);
1691             set(SYS.hdrf,<span class="string">'String'</span>, num2str(SYS.drf)); 
1692         <span class="keyword">end</span>;
1693 
1694         <span class="comment">%units for bpm and corrector plot abscissa</span>
1695         <span class="keyword">if</span> strcmp(SYS.xscale,<span class="string">'meter'</span>)
1696             SYS.xlimax = SYS.maxs;
1697         <span class="keyword">elseif</span> strcmp(SYS.xscale,<span class="string">'phase'</span>)
1698             SYS.xlimax = SYS.maxphi(plane);
1699         <span class="keyword">end</span>
1700 
1701         setappdata(0,<span class="string">'SYS'</span>,SYS);
1702 
1703         <span class="comment">%Update BPM Displays (100 ms in simulator)</span>
1704         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'ClearPlots'</span>);            <span class="comment">%remove eigenvector, response and fit plots</span>
1705         <span class="keyword">if</span> BPM(plane).scalemode == 0     <span class="comment">%manual</span>
1706             set(SYS.ahbpm,<span class="string">'YLim'</span>,[-BPM(plane).ylim,BPM(plane).ylim]);
1707         <span class="keyword">end</span>
1708         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'RePlot'</span>);                <span class="comment">%ref, des, act, fit, icons, limits, bar</span>
1709         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'UpdateBPMBox'</span>);
1710 
1711         <span class="comment">%Update Corrector Displays (100 ms in simulator)</span>
1712         <span class="keyword">if</span> COR(plane).scalemode == 0     <span class="comment">%manual</span>
1713             set(SYS.ahcor,<span class="string">'YLim'</span>,[-COR(plane).ylim,COR(plane).ylim]);   <span class="keyword">end</span>
1714         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'RePlot'</span>);                <span class="comment">%clear, actual, fit, bar, limits</span>
1715         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'UpdateCorBox'</span>);
1716 
1717         <span class="keyword">switch</span> SYS.algo
1718             <span class="keyword">case</span> <span class="string">'SVD'</span>
1719                 <span class="comment">%Update SVD Displays</span>
1720                 <a href="respgui.html" class="code" title="function respgui(action, varargin)">respgui</a>(<span class="string">'PlotSVD'</span>);
1721                 set(SYS.svdedit,<span class="string">'String'</span>,num2str(RSP(plane).nsvd));
1722 
1723 <span class="comment">%                 %slider_step=[arrow_step, trough_step] normalized to range</span>
1724 <span class="comment">%                 if RSP(plane).nsvdmax &gt; 1</span>
1725 <span class="comment">%                     slider_step = [1/(RSP(plane).nsvdmax-1),1/(RSP(plane).nsvdmax-1)];</span>
1726 <span class="comment">%                     set(SYS.svdslide,'Visible','On','Value',RSP(plane).nsvd,'Max',RSP(plane).nsvdmax,'Min',1,'SliderStep',slider_step);</span>
1727 <span class="comment">%                     set(SYS.svdedit,'Value',RSP(plane).nsvd);</span>
1728 <span class="comment">%                 else</span>
1729 <span class="comment">%                     set(SYS.svdslide,'Visible','Off');</span>
1730 <span class="comment">%                 end</span>
1731 
1732         <span class="keyword">end</span>   <span class="comment">%end algo case</span>
1733 
1734         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'UpdateParameters'</span>);
1735 
1736         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">' Finished acquisition and display refresh'</span>);
1737 
1738         <span class="comment">%=============================================================</span>
1739     <span class="keyword">case</span> <span class="string">'Relative'</span>                             <span class="comment">% *** Relative ***</span>
1740         <span class="comment">%=============================================================</span>
1741         <span class="comment">%Toggles orbit display absolute/relative</span>
1742         <span class="comment">%If reference orbit read from file then subtract</span>
1743         <span class="comment">%Otherwise reference orbit is zero</span>
1744 
1745         <span class="keyword">if</span>  get(SYS.abs,<span class="string">'Value'</span>) == 0 &amp;&amp; SYS.relative == 1     <span class="comment">%was in absolute mode, stay in absolute</span>
1746             set(SYS.abs,<span class="string">'Value'</span>,1);
1747         <span class="keyword">elseif</span> get(SYS.rel,<span class="string">'Value'</span>) == 0 &amp;&amp; SYS.relative == 2  <span class="comment">%was in relative mode, stay in relative</span>
1748             set(SYS.rel,<span class="string">'Value'</span>,1);
1749         <span class="keyword">elseif</span> get(SYS.rel,<span class="string">'Value'</span>) == 1 &amp;&amp; SYS.relative == 1  <span class="comment">%was in absolute mode, switch to relative</span>
1750             SYS.relative = 2;           <span class="comment">%relative mode</span>
1751             set(SYS.abs,<span class="string">'Value'</span>,0);
1752             BPM(1).abs = BPM(1).ref;    <span class="comment">%BPM.act and BPM.des have BPM.abs subtracted off at plot time</span>
1753             BPM(2).abs = BPM(2).ref;
1754         <span class="keyword">elseif</span> get(SYS.abs,<span class="string">'Value'</span>) == 1 &amp;&amp; SYS.relative == 2  <span class="comment">%was in relative mode, switch to absolute</span>
1755             SYS.relative = 1;           <span class="comment">%absolute mode</span>
1756             set(SYS.rel,<span class="string">'Value'</span>,0);
1757             BPM(1).abs = zeros(size(BPM(1).name,1),1);
1758             BPM(2).abs = zeros(size(BPM(2).name,1),1);
1759         <span class="keyword">end</span>
1760 
1761         setappdata(0,<span class="string">'SYS'</span>,SYS);
1762         setappdata(0,<span class="string">'BPM'</span>,BPM);
1763 
1764         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'RePlot'</span>);     <span class="comment">%do not replot correctors for relative</span>
1765         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'BPMBar'</span>);
1766         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'UpdateBPMBox'</span>);
1767         
1768         <span class="comment">%==========================================================</span>
1769     <span class="keyword">case</span> <span class="string">'Abort'</span>                                <span class="comment">% *** Abort ***</span>
1770         <span class="comment">%==========================================================</span>
1771         <span class="comment">%callback of corrector menu</span>
1772         <span class="comment">%in case user aborts response matrix measurement or feedback</span>
1773         SYS.abort = 1;
1774         setappdata(0,<span class="string">'SYS'</span>,SYS);
1775 
1776         <span class="comment">%==========================================================</span>
1777     <span class="keyword">case</span> <span class="string">'ScaleBPMAxis'</span>                  <span class="comment">% *** ScaleBPMAxis ***</span>
1778         <span class="comment">%==========================================================</span>
1779         axes(SYS.ahbpm);
1780         a = axis;
1781         ChangeFactor = 2;
1782         
1783         <span class="keyword">if</span> get(SYS.BPMScale,<span class="string">'Value'</span>) &lt; 0
1784             del = (ChangeFactor-1)*(a(4)-a(3));
1785         <span class="keyword">else</span>
1786             del = (1/ChangeFactor-1)*(a(4)-a(3));
1787         <span class="keyword">end</span>
1788         axis([a(1) a(2) a(3)-del/2 a(4)+del/2]);
1789         set(SYS.BPMScale, <span class="string">'Value'</span>, 0);
1790 
1791         BPM(plane).ylim = a(4)+del/2;
1792         setappdata(0,<span class="string">'BPM'</span>,BPM);
1793 
1794         <span class="comment">%rescale BPMBar</span>
1795         yd = [-BPM(plane).ylim/4,BPM(plane).ylim/4];
1796         set(SYS.lhbid,<span class="string">'YData'</span>,yd);
1797 
1798         <span class="comment">%==========================================================</span>
1799     <span class="keyword">case</span> <span class="string">'AutoScaleBPMAxis'</span>   <span class="comment">%  Autoscale BPMaxis</span>
1800         <span class="comment">%==========================================================</span>
1801         
1802         <span class="comment">% switchoff black cross</span>
1803         set(SYS.lhbid,<span class="string">'XData'</span>,[],<span class="string">'YData'</span>,[]);
1804         
1805         <span class="comment">% Auto-scale y-axis of BPM plot</span>
1806         val0 = axis(SYS.ahbpm);
1807         axis(SYS.ahbpm, <span class="string">'tight'</span>);
1808         val  = axis(SYS.ahbpm);
1809         BPM(plane).ylim = max(abs(val(3:4)))*1.2;
1810         axis(SYS.ahbpm, [val0(1:2) BPM(plane).ylim*[-1 1]]);
1811         setappdata(0,<span class="string">'BPM'</span>,BPM);
1812         
1813         <span class="comment">% Set back black cross in the BPM window</span>
1814         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'BPMBar'</span>);
1815         
1816         <span class="comment">%==================================================================</span>
1817     <span class="keyword">case</span> <span class="string">'AutoScaleCorrAxis'</span>                  <span class="comment">% *** AutoScaleCORAxis ***</span>
1818         <span class="comment">%==================================================================</span>
1819         
1820         <span class="comment">% switchoff black cross</span>
1821         set(SYS.lhcid,<span class="string">'XData'</span>,[],<span class="string">'YData'</span>,[]);
1822        
1823         <span class="comment">% Auto-scale y-axis of COR plot</span>
1824         val0 = axis(SYS.ahcor);
1825         axis(SYS.ahcor, <span class="string">'tight'</span>);
1826         val  = axis(SYS.ahcor);
1827         COR(plane).ylim = max(abs(val(3:4)))*1.2;
1828         axis(SYS.ahcor, [val0(1:2) COR(plane).ylim*[-1 1]]);
1829         setappdata(0,<span class="string">'COR'</span>,COR);
1830          
1831         <span class="comment">% Set back black cross in the BPM window</span>
1832         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'CorBar'</span>);
1833        
1834         <span class="comment">%==========================================================</span>
1835     <span class="keyword">case</span> <span class="string">'ScaleCORAxis'</span>                  <span class="comment">% *** ScaleCORAxis ***</span>
1836         <span class="comment">%==========================================================</span>
1837         axes(SYS.ahcor);
1838         a = axis;
1839         ChangeFactor = 2;
1840         
1841         <span class="keyword">if</span> get(SYS.CORScale,<span class="string">'Value'</span>) &lt; 0
1842             del = (ChangeFactor-1)*(a(4)-a(3));
1843         <span class="keyword">else</span>
1844             del = (1/ChangeFactor-1)*(a(4)-a(3));
1845         <span class="keyword">end</span>
1846         
1847         axis([a(1) a(2) a(3)-del/2 a(4)+del/2]);
1848         set(SYS.CORScale, <span class="string">'Value'</span>, 0);
1849 
1850         COR(plane).ylim = a(4)+del/2;
1851         setappdata(0,<span class="string">'COR'</span>,COR);
1852 
1853         <span class="comment">%rescale CORBar</span>
1854         yd = [-COR(plane).ylim/4, COR(plane).ylim/4];
1855         set(SYS.lhcid,<span class="string">'YData'</span>,yd);
1856 
1857         <span class="comment">%===========================================================</span>
1858 <span class="comment">%     case 'StartLoc'              %*** StartLoc ***</span>
1859 <span class="comment">%         %===========================================================</span>
1860 <span class="comment">%         %cross cursor to select a new start location on Z axis.</span>
1861 <span class="comment">%         %must put bpms into 'Select' mode (display only) so</span>
1862 <span class="comment">%         %bpm nearest cursor will not get toggled or dragged</span>
1863 <span class="comment">%         %NOTE: tried setting mode to zero and then reset after sizing plot but still toggles bpm state.</span>
1864 <span class="comment">%</span>
1865 <span class="comment">%         mode=BPM(plane).mode;     %save mode for after NewStart</span>
1866 <span class="comment">%         BPM(plane).mode=0;        %put in select mode</span>
1867 <span class="comment">%         setappdata(0,'BPM',BPM);</span>
1868 <span class="comment">%</span>
1869 <span class="comment">%         set(orbfig,'Pointer','fullcross',...</span>
1870 <span class="comment">%             'WindowButtonDownFcn','orbgui(''NewStart'')');</span>
1871 <span class="comment">%         BPM(plane).mode=mode;     %restore mode</span>
1872 <span class="comment">%         setappdata(0,'BPM',BPM);</span>
1873 <span class="comment">%</span>
1874 <span class="comment">%         %===========================================================</span>
1875 <span class="comment">%     case 'NewStart'              %*** NewStart ***</span>
1876 <span class="comment">%         %===========================================================</span>
1877 <span class="comment">%         %sets the current cursor position as the new Start Location of the plot.</span>
1878 <span class="comment">%         cpa = get(SYS.ahbpm,'CurrentPoint');</span>
1879 <span class="comment">%         limits = get(SYS.ahbpm,'XLim');</span>
1880 <span class="comment">%         set(SYS.ahbpm,'XLim',[cpa(1,1) limits(1,2)]);   %Change start, leave stop alone</span>
1881 <span class="comment">%         set(SYS.ahcor,'XLim',[cpa(1,1) limits(1,2)]);   %Change start, leave stop alone</span>
1882 <span class="comment">%         set(orbfig, 'Pointer','arrow',...</span>
1883 <span class="comment">%             'WindowButtonDownFcn','');</span>
1884 <span class="comment">%</span>
1885 <span class="comment">%         %===========================================================</span>
1886 <span class="comment">%     case 'StopLoc'              %*** StopLoc ***</span>
1887 <span class="comment">%         %===========================================================</span>
1888 <span class="comment">%         %creates a cross cursor for the user to select a new stopping location on Z axis.</span>
1889 <span class="comment">%         mode=BPM(plane).mode;     %save mode for after NewStart</span>
1890 <span class="comment">%         BPM(plane).mode=0;        %put in select mode</span>
1891 <span class="comment">%         setappdata(0,'BPM',BPM);</span>
1892 <span class="comment">%</span>
1893 <span class="comment">%         set(orbfig,'Pointer','fullcross',...</span>
1894 <span class="comment">%             'WindowButtonDownFcn','orbgui(''NewStop'')');</span>
1895 <span class="comment">%         BPM(plane).mode=mode;     %restore mode</span>
1896 <span class="comment">%         setappdata(0,'BPM',BPM);</span>
1897 <span class="comment">%</span>
1898 <span class="comment">%         %===========================================================</span>
1899 <span class="comment">%     case 'NewStop'              %*** NewStop ***</span>
1900 <span class="comment">%         %===========================================================</span>
1901 <span class="comment">%         %set the current cursor position as the new Stop Location of the plot.</span>
1902 <span class="comment">%         cpa = get(SYS.ahbpm,'CurrentPoint');</span>
1903 <span class="comment">%         limits = get(SYS.ahbpm,'XLim');</span>
1904 <span class="comment">%         set(SYS.ahbpm,'XLim',[limits(1,1) cpa(1,1)]);    %Change stop, leave start alone</span>
1905 <span class="comment">%         set(SYS.ahcor,'XLim',[limits(1,1) cpa(1,1)]);    %Change stop, leave start alone</span>
1906 <span class="comment">%         set(orbfig, 'Pointer','arrow',...</span>
1907 <span class="comment">%             'WindowButtonDownFcn','');</span>
1908 <span class="comment">%</span>
1909         <span class="comment">%===========================================================</span>
1910     <span class="keyword">case</span> <span class="string">'BPMPlotScale'</span>                    <span class="comment">%*** BPMPlotScale ***</span>
1911         <span class="comment">%===========================================================</span>
1912         <span class="comment">%Select vertical limit for BPM plot</span>
1913 
1914         <span class="comment">%Clear previous  figure</span>
1915         bpmscalefig = findobj(0,<span class="string">'tag'</span>,<span class="string">'bpmplotscale'</span>);
1916         <span class="keyword">if</span> ~isempty(bpmscalefig), delete(bpmscalefig); <span class="keyword">end</span>
1917 
1918         figure(<span class="string">'Position'</span>,[600 600 400 200],<span class="keyword">...</span>
1919             <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
1920             <span class="string">'Name'</span>,<span class="string">'BPM Plot Control'</span>,<span class="keyword">...</span>
1921             <span class="string">'Tag'</span>,<span class="string">'bpmplotscale'</span>,<span class="keyword">...</span>
1922             <span class="string">'MenuBar'</span>,<span class="string">'none'</span>);
1923 
1924         val=0;
1925         <span class="keyword">if</span> BPM(plane).scalemode==0; val=1; <span class="keyword">end</span>              <span class="comment">%manual</span>
1926         uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
1927             <span class="string">'Position'</span>,[20 150 120 20],<span class="keyword">...</span>
1928             <span class="string">'String'</span>,<span class="string">'Manual Scale'</span>,<span class="keyword">...</span>
1929             <span class="string">'Tag'</span>,<span class="string">'bpmmanual'</span>,<span class="keyword">...</span>
1930             <span class="string">'Value'</span>,val,<span class="keyword">...</span>
1931             <span class="string">'ToolTipString'</span>,<span class="string">'BPM plot scale Manual'</span>,<span class="keyword">...</span>
1932             <span class="string">'Callback'</span>,<span class="string">'orbgui(''BPMScaleType'', ''0'')'</span>);
1933 
1934         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
1935             <span class="string">'String'</span>,<span class="string">'Vertical Axis Limit: '</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1936             <span class="string">'Position'</span>,[150 150 100 20]);
1937 
1938         uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
1939             <span class="string">'tag'</span>,<span class="string">'bpmscale'</span>,<span class="keyword">...</span>
1940             <span class="string">'String'</span>,num2str(BPM(plane).ylim),<span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1941             <span class="string">'Position'</span>,[250 150 50 20]);
1942 
1943 
1944         val=0;
1945         <span class="keyword">if</span> BPM(plane).scalemode==1; val=1; <span class="keyword">end</span>              <span class="comment">%auto</span>
1946         uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
1947             <span class="string">'Position'</span>,[20 120 120 20],<span class="keyword">...</span>
1948             <span class="string">'String'</span>,<span class="string">'Auto Scale'</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
1949             <span class="string">'Tag'</span>,<span class="string">'bpmauto'</span>,<span class="keyword">...</span>
1950             <span class="string">'Value'</span>,val,<span class="keyword">...</span>
1951             <span class="string">'ToolTipString'</span>,<span class="string">'BPM plot scale Auto'</span>,<span class="keyword">...</span>
1952             <span class="string">'Callback'</span>,<span class="string">'orbgui(''BPMScaleType'', ''1'')'</span>);
1953 
1954         val=0;
1955         <span class="keyword">if</span> strcmp(SYS.xscale,<span class="string">'meter'</span>); val=1; <span class="keyword">end</span>           <span class="comment">%s-position</span>
1956         uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
1957             <span class="string">'Position'</span>,[20 90 150 20],<span class="keyword">...</span>
1958             <span class="string">'String'</span>,<span class="string">'Plot vs. s-position'</span>,<span class="keyword">...</span>
1959             <span class="string">'Tag'</span>,<span class="string">'plotspos'</span>,<span class="keyword">...</span>
1960             <span class="string">'Value'</span>,val,<span class="keyword">...</span>
1961             <span class="string">'ToolTipString'</span>,<span class="string">'Plot BPM vs. the s-position'</span>,<span class="keyword">...</span>
1962             <span class="string">'Callback'</span>,<span class="string">'orbgui(''PlotSPosition'')'</span>);
1963 
1964         val=0;
1965         <span class="keyword">if</span> strcmp(SYS.xscale,<span class="string">'phase'</span>); val=1; <span class="keyword">end</span>          <span class="comment">%betatron phase</span>
1966         uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
1967             <span class="string">'Position'</span>,[20 60 150 20],<span class="keyword">...</span>
1968             <span class="string">'String'</span>,<span class="string">'Plot vs. Phase'</span>,<span class="keyword">...</span>
1969             <span class="string">'Tag'</span>,<span class="string">'plotphase'</span>,<span class="keyword">...</span>
1970             <span class="string">'Value'</span>,val,<span class="keyword">...</span>
1971             <span class="string">'ToolTipString'</span>,<span class="string">'Plot BPMs vs. the phase'</span>,<span class="keyword">...</span>
1972             <span class="string">'Callback'</span>,<span class="string">'orbgui(''PlotPhase'')'</span>);
1973 
1974         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span><span class="comment">                  %apply</span>
1975             <span class="string">'String'</span>,<span class="string">'Apply'</span>,<span class="keyword">...</span>
1976             <span class="string">'Position'</span>,[150 20 50 20],<span class="keyword">...</span>
1977             <span class="string">'Callback'</span>,<span class="string">'orbgui(''ProcessBPMScale'');'</span>);
1978 
1979         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span><span class="comment">                  %cancel</span>
1980             <span class="string">'String'</span>,<span class="string">'Cancel'</span>,<span class="keyword">...</span>
1981             <span class="string">'Callback'</span>,<span class="string">'delete(gcf)'</span>,<span class="keyword">...</span>
1982             <span class="string">'Position'</span>,[210 20 50 20]);
1983 
1984         <span class="comment">%===========================================================</span>
1985     <span class="keyword">case</span> <span class="string">'ProcessBPMScale'</span>              <span class="comment">%*** ProcessBPMScale ***</span>
1986         <span class="comment">%===========================================================</span>
1987         <span class="comment">%select vertical limits for BPM axis (symetric limits)</span>
1988 
1989         h    = findobj(0,<span class="string">'Tag'</span>,<span class="string">'bpmscale'</span>);
1990         ylim = str2double(get(h,<span class="string">'String'</span>));
1991 
1992         <span class="keyword">if</span> isempty(ylim)
1993             ylim = BPM(plane).ylim;
1994         <span class="keyword">end</span>
1995 
1996         hmanual = findobj(0,<span class="string">'Tag'</span>,<span class="string">'bpmmanual'</span>);
1997         set(h,<span class="string">'Value'</span>,1);
1998         hauto = findobj(0,<span class="string">'Tag'</span>,<span class="string">'bpmauto'</span>);
1999         
2000         <span class="keyword">if</span> BPM(plane).scalemode == 0  <span class="comment">%manual mode</span>
2001             BPM(plane).ylim = ylim;
2002 
2003             set(SYS.ahbpm,<span class="string">'YLim'</span>, ylim*[-1, 1]);
2004 
2005             set(hmanual,<span class="string">'Value'</span>,1);
2006             set(hauto,<span class="string">'Value'</span>,0);
2007         <span class="keyword">else</span>                        <span class="comment">%auto mode</span>
2008             BPM(plane).ylim = ylim;
2009 
2010             set(hmanual,<span class="string">'Value'</span>,0);
2011             set(hauto,<span class="string">'Value'</span>,1);
2012         <span class="keyword">end</span>
2013 
2014         setappdata(0,<span class="string">'BPM'</span>,BPM);
2015 
2016         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'BPMBar'</span>);
2017 
2018         delete(gcf);
2019 
2020 
2021         <span class="comment">%===========================================================</span>
2022     <span class="keyword">case</span> <span class="string">'PlotSPosition'</span>                    <span class="comment">%*** PlotSPosition ***</span>
2023         <span class="comment">%===========================================================</span>
2024         <span class="comment">%plot BPMs and correctors in terms of s-position</span>
2025         h1 = findobj(0,<span class="string">'tag'</span>,<span class="string">'plotspos'</span>);
2026         h2 = findobj(0,<span class="string">'tag'</span>,<span class="string">'plotphase'</span>);
2027 
2028         <span class="keyword">if</span> get(h1,<span class="string">'Value'</span>) == 0 &amp;&amp; get(h2,<span class="string">'Value'</span>) == 0   <span class="comment">%...default to meters</span>
2029             set(h2,<span class="string">'Value'</span>,1);
2030             SYS.xscale = <span class="string">'phase'</span>;
2031             SYS.xlimax = SYS.maxphi(plane);
2032             set(get(SYS.ahcor,<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,<span class="string">'Betatron Phase (rad/(2pi))'</span>);
2033         <span class="keyword">else</span>
2034             SYS.xscale = <span class="string">'meter'</span>;
2035             set(h1,<span class="string">'Value'</span>,1);
2036             set(h2,<span class="string">'Value'</span>,0);
2037             SYS.xlimax = SYS.maxs;
2038             set(get(SYS.ahcor,<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,<span class="string">'Position in Storage Ring (m)'</span>);
2039         <span class="keyword">end</span>
2040 
2041         setappdata(0,<span class="string">'SYS'</span>,SYS);
2042 
2043         h  = allchild(get(SYS.allmachine,<span class="string">'Parent'</span>));
2044         id = strcmpi(get(h,<span class="string">'Checked'</span>),<span class="string">'on'</span>);
2045         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'plotxaxis'</span>,get(h(id),<span class="string">'Tag'</span>));
2046         
2047         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'RePlot'</span>);
2048         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'RePlot'</span>);
2049 
2050         <span class="comment">%===========================================================</span>
2051     <span class="keyword">case</span> <span class="string">'PlotPhase'</span>                    <span class="comment">%*** PlotPhase ***</span>
2052         <span class="comment">%===========================================================</span>
2053         <span class="comment">%plot BPMs and correctors in terms of phase</span>
2054         h1 = findobj(0,<span class="string">'tag'</span>,<span class="string">'plotspos'</span>);
2055         h2 = findobj(0,<span class="string">'tag'</span>,<span class="string">'plotphase'</span>);
2056 
2057         <span class="keyword">if</span> get(h1,<span class="string">'Value'</span>) == 0 &amp;&amp; get(h2,<span class="string">'Value'</span>) == 0   <span class="comment">%...default to meters</span>
2058             set(h1,<span class="string">'Value'</span>,1);
2059             SYS.xscale = <span class="string">'meter'</span>;
2060             SYS.xlimax = SYS.maxs;
2061             set(get(SYS.ahcor,<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,<span class="string">'Position in Storage Ring (m)'</span>);
2062         <span class="keyword">else</span> <span class="comment">% Phase</span>
2063             SYS.xscale = <span class="string">'phase'</span>;
2064             set(h1,<span class="string">'Value'</span>,0);
2065             set(h2,<span class="string">'Value'</span>,1);
2066             SYS.xlimax   = SYS.maxphi(plane);
2067             set(get(SYS.ahcor,<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,<span class="string">'Betatron Phase (rad)'</span>);
2068         <span class="keyword">end</span>
2069         
2070         setappdata(0,<span class="string">'SYS'</span>,SYS);
2071 
2072         h  = allchild(get(SYS.allmachine,<span class="string">'Parent'</span>));
2073         id = strcmpi(get(h,<span class="string">'Checked'</span>),<span class="string">'on'</span>);
2074         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'plotxaxis'</span>,get(h(id),<span class="string">'Tag'</span>));
2075         
2076         <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'RePlot'</span>);
2077         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'RePlot'</span>);
2078 
2079         <span class="comment">%===========================================================</span>
2080     <span class="keyword">case</span> <span class="string">'BPMScaleType'</span>                    <span class="comment">%*** BPMScaleType ***</span>
2081         <span class="comment">%===========================================================</span>
2082         <span class="comment">%toggle to manual mode for BPM vertical axis</span>
2083         stype = str2double(varargin{1});    <span class="comment">% stype=0 for manual,   stype=1 for auto</span>
2084 
2085         <span class="comment">%presently in manual mode, toggle to auto</span>
2086         <span class="keyword">if</span> (BPM(plane).scalemode == 0 &amp;&amp; stype==0) ||<span class="keyword">...</span>
2087                 (BPM(plane).scalemode==0 &amp;&amp; stype==1)
2088             h=findobj(0,<span class="string">'Tag'</span>,<span class="string">'bpmmanual'</span>);
2089             set(h,<span class="string">'Value'</span>,0);
2090             h=findobj(0,<span class="string">'Tag'</span>,<span class="string">'bpmauto'</span>);
2091             set(h,<span class="string">'Value'</span>,1);
2092             BPM(plane).scalemode = 1;
2093             setappdata(0,<span class="string">'BPM'</span>,BPM);
2094             <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'ylimits'</span>);
2095             <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'RePlot'</span>);
2096             <span class="keyword">return</span>
2097         <span class="keyword">end</span>
2098 
2099         <span class="comment">%presently in auto mode, toggle to manual</span>
2100         <span class="keyword">if</span> (BPM(plane).scalemode==1 &amp;&amp; stype==0) ||<span class="keyword">...</span>
2101                 (BPM(plane).scalemode==1 &amp;&amp; stype==1)
2102             h=findobj(0,<span class="string">'Tag'</span>,<span class="string">'bpmmanual'</span>);
2103             set(h,<span class="string">'Value'</span>,1);
2104             h=findobj(0,<span class="string">'Tag'</span>,<span class="string">'bpmauto'</span>);
2105             set(h,<span class="string">'Value'</span>,0);
2106             BPM(plane).scalemode=0;
2107             setappdata(0,<span class="string">'BPM'</span>,BPM);
2108             ylim=BPM(plane).ylim;
2109             set(SYS.ahbpm,<span class="string">'YLim'</span>,[-ylim,ylim]);
2110             <a href="bpmgui.html" class="code" title="function bpmgui(action, varargin)">bpmgui</a>(<span class="string">'RePlot'</span>);
2111             <span class="keyword">return</span>
2112         <span class="keyword">end</span>
2113 
2114         <span class="comment">%===========================================================</span>
2115     <span class="keyword">case</span> <span class="string">'CorPlotScale'</span>                    <span class="comment">%*** CorPlotScale ***</span>
2116         <span class="comment">%===========================================================</span>
2117         <span class="comment">%Select vertical limit for Corrector plot</span>
2118 
2119         <span class="comment">%Clear previous  figure</span>
2120         corscalefig = findobj(0,<span class="string">'tag'</span>,<span class="string">'corplotscale'</span>);
2121         <span class="keyword">if</span> ~isempty(corscalefig), delete(corscalefig); <span class="keyword">end</span>
2122 
2123         figure(<span class="string">'Position'</span>,[600 600 400 200],<span class="keyword">...</span>
2124             <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'corplotscale'</span>,<span class="keyword">...</span>
2125             <span class="string">'Name'</span>,<span class="string">'COR Vertical Axis Limits'</span>,<span class="keyword">...</span>
2126             <span class="string">'MenuBar'</span>,<span class="string">'none'</span>);
2127 
2128         val = 0;
2129         <span class="keyword">if</span> COR(plane).scalemode == 0, val = 1; <span class="keyword">end</span>   <span class="comment">%manual</span>
2130         uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
2131             <span class="string">'Position'</span>,[20 150 120 20],<span class="keyword">...</span>
2132             <span class="string">'String'</span>,<span class="string">'Manual Scale'</span>,<span class="keyword">...</span>
2133             <span class="string">'Tag'</span>,<span class="string">'cormanual'</span>,<span class="keyword">...</span>
2134             <span class="string">'Value'</span>,val,<span class="keyword">...</span>
2135             <span class="string">'ToolTipString'</span>,<span class="string">'Corrector plot scale Manual'</span>,<span class="keyword">...</span>
2136             <span class="string">'Callback'</span>,<span class="string">'orbgui(''CORScaleType'', ''0'')'</span>);
2137 
2138         val = 0;
2139         <span class="keyword">if</span> COR(plane).scalemode == 1, val = 1; <span class="keyword">end</span>
2140         uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
2141             <span class="string">'Position'</span>,[20 120 120 20],<span class="keyword">...</span>
2142             <span class="string">'String'</span>,<span class="string">'Auto Scale'</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
2143             <span class="string">'Tag'</span>,<span class="string">'corauto'</span>,<span class="keyword">...</span>
2144             <span class="string">'Value'</span>,val,<span class="keyword">...</span>
2145             <span class="string">'ToolTipString'</span>,<span class="string">'Corrector plot scale Auto'</span>,<span class="keyword">...</span>
2146             <span class="string">'Callback'</span>,<span class="string">'orbgui(''CORScaleType'', ''1'')'</span>);     <span class="comment">%auto</span>
2147 
2148         uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="keyword">...</span>
2149             <span class="string">'String'</span>,<span class="string">'Vertical Axis Limit: '</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
2150             <span class="string">'Position'</span>,[150 150 100 20]);
2151 
2152         uicontrol(<span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="keyword">...</span>
2153             <span class="string">'tag'</span>,<span class="string">'corscale'</span>,<span class="keyword">...</span>
2154             <span class="string">'String'</span>,num2str(COR(plane).ylim),<span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>,<span class="keyword">...</span>
2155             <span class="string">'Position'</span>,[250 150 50 20]);
2156 
2157         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span><span class="comment">                    %apply</span>
2158             <span class="string">'String'</span>,<span class="string">'Apply'</span>,<span class="keyword">...</span>
2159             <span class="string">'Position'</span>,[150 20 50 20],<span class="keyword">...</span>
2160             <span class="string">'Callback'</span>,<span class="string">'orbgui(''ProcessCORScale'');'</span>);
2161 
2162         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span><span class="comment">                    %cancel</span>
2163             <span class="string">'String'</span>,<span class="string">'Cancel'</span>,<span class="keyword">...</span>
2164             <span class="string">'Callback'</span>,<span class="string">'delete(gcf)'</span>,<span class="keyword">...</span>
2165             <span class="string">'Position'</span>,[210 20 50 20]);
2166 
2167         <span class="comment">%===========================================================</span>
2168     <span class="keyword">case</span> <span class="string">'CORScaleType'</span>                    <span class="comment">%*** CORScaleType ***</span>
2169         <span class="comment">%===========================================================</span>
2170         <span class="comment">%toggle to manual mode for COR vertical axis</span>
2171         
2172         <span class="comment">% stype=0 for manual, stype=1 for auto</span>
2173         stype = str2double(varargin{1});    
2174 
2175         hmanual = findobj(0,<span class="string">'Tag'</span>,<span class="string">'cormanual'</span>);
2176         hauto   = findobj(0,<span class="string">'Tag'</span>,<span class="string">'corauto'</span>);
2177 
2178         <span class="comment">%presently in manual mode, toggle to auto</span>
2179         <span class="keyword">if</span> (COR(plane).scalemode == 0 &amp;&amp; stype == 0) ||<span class="keyword">...</span>
2180                 (COR(plane).scalemode == 0 &amp;&amp; stype == 1)
2181             set(hmanual,<span class="string">'Value'</span>,0);
2182             set(hauto,  <span class="string">'Value'</span>,1);
2183             COR(plane).scalemode=1;
2184             setappdata(0,<span class="string">'COR'</span>,COR);
2185             <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'ylimits'</span>);
2186             <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'RePlot'</span>);
2187             <span class="keyword">return</span>
2188         <span class="keyword">end</span>
2189 
2190         <span class="comment">%presently in auto mode, toggle to manual</span>
2191         <span class="keyword">if</span> (COR(plane).scalemode==1 &amp;&amp; stype==0) ||<span class="keyword">...</span>
2192                 (COR(plane).scalemode==1 &amp;&amp; stype==1)
2193             set(hmanual,<span class="string">'Value'</span>,1);
2194             set(hauto,<span class="string">'Value'</span>,0);
2195             COR(plane).scalemode=0;
2196             setappdata(0,<span class="string">'COR'</span>,COR);
2197             ylim=COR(plane).ylim;
2198             set(SYS.ahcor,<span class="string">'YLim'</span>,[-ylim,ylim]);
2199             <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'RePlot'</span>);
2200             <span class="keyword">return</span>
2201         <span class="keyword">end</span>
2202 
2203         <span class="comment">%===========================================================</span>
2204     <span class="keyword">case</span> <span class="string">'ProcessCORScale'</span>              <span class="comment">%*** ProcessCORScale ***</span>
2205         <span class="comment">%===========================================================</span>
2206         h = findobj(0,<span class="string">'Tag'</span>,<span class="string">'corscale'</span>);
2207         ylim = str2double(get(h,<span class="string">'String'</span>));
2208         <span class="keyword">if</span> isempty(ylim), ylim = COR(plane).ylim; <span class="keyword">end</span>
2209 
2210         <span class="keyword">if</span> COR(plane).scalemode == 0  <span class="comment">%manual mode</span>
2211             COR(plane).ylim=ylim;
2212             setappdata(0,<span class="string">'COR'</span>,COR);
2213             set(SYS.ahcor,<span class="string">'YLim'</span>,[-ylim,ylim]);
2214 
2215             h=findobj(0,<span class="string">'Tag'</span>,<span class="string">'cormanual'</span>);
2216             set(h,<span class="string">'Value'</span>,1);
2217             h=findobj(0,<span class="string">'Tag'</span>,<span class="string">'corauto'</span>);
2218             set(h,<span class="string">'Value'</span>,0);
2219 
2220 
2221         <span class="keyword">else</span>                        <span class="comment">%auto mode</span>
2222             COR(plane).ylim=ylim;
2223             setappdata(0,<span class="string">'COR'</span>,COR);
2224             h=findobj(0,<span class="string">'Tag'</span>,<span class="string">'cormanual'</span>);
2225             set(h,<span class="string">'Value'</span>,0);
2226             h=findobj(0,<span class="string">'Tag'</span>,<span class="string">'corauto'</span>);
2227             set(h,<span class="string">'Value'</span>,1);
2228         <span class="keyword">end</span>
2229 
2230         <a href="corgui.html" class="code" title="function corgui(action, varargin)">corgui</a>(<span class="string">'CorBar'</span>);
2231 
2232         delete(gcf);
2233 
2234         <span class="comment">%=============================================================</span>
2235     <span class="keyword">case</span> <span class="string">'LstBox'</span>                               <span class="comment">%  ListBox</span>
2236         <span class="comment">%==========================================================</span>
2237         <span class="comment">%create list box to display program output dialog</span>
2238         ts = [<span class="string">'Program Start-Up: '</span> datestr(now,0)];
2239         [screen_wide, screen_high]=screensizecm;
2240 
2241         x0=0.013*screen_wide; y0=0.2000*screen_high; 
2242         dx=0.3061*screen_wide; dy=0.04817*screen_high;
2243 
2244         SYS.lstbox = uicontrol(<span class="string">'Style'</span>,<span class="string">'list'</span>,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>, <span class="keyword">...</span>
2245             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="string">'String'</span>,{ts});
2246 
2247 <span class="comment">%         %=============================================================</span>
2248 <span class="comment">%     case 'RestoreFileBox'                        %  RestoreFileBox</span>
2249 <span class="comment">%         %=============================================================</span>
2250 <span class="comment">%         %create list box to display program output dialog</span>
2251 <span class="comment">%         [screen_wide, screen_high]=screensizecm;</span>
2252 <span class="comment">%</span>
2253 <span class="comment">%         x0=0.63*screen_wide; y0=0.210*screen_high; dx=0.15*screen_wide; dy=0.025*screen_high;</span>
2254 <span class="comment">%</span>
2255 <span class="comment">%         uicontrol('Style','Text',...</span>
2256 <span class="comment">%             'Units','centimeters',...</span>
2257 <span class="comment">%             'Position',[x0 y0 dx dy],...</span>
2258 <span class="comment">%             'String',' ',...</span>
2259 <span class="comment">%             'tag','restorefile');</span>
2260 
2261         <span class="comment">%===========================================================</span>
2262     <span class="keyword">case</span> <span class="string">'LBox'</span>                          <span class="comment">%*** LBox ***</span>
2263         <span class="comment">%===========================================================</span>
2264         <span class="comment">%load latest sequence of strings into graphical display listbox</span>
2265         comment = varargin{1};
2266         ts      = datestr(now,0);
2267         addstr  = {[ts  <span class="string">': '</span> comment]};
2268         h       = SYS.lstbox;
2269         str     = get(h,<span class="string">'String'</span>);
2270         str     = [str; addstr];
2271         ione    = size(str,1);
2272         nentry  = 50;
2273         
2274         <span class="keyword">if</span> ione &gt;= nentry                <span class="comment">%keep only top entries</span>
2275             str = str(ione-nentry+1:ione,1);
2276             ione = size(str,1);
2277         <span class="keyword">end</span>
2278         
2279         set(h,<span class="string">'String'</span>,str,<span class="string">'listboxtop'</span>,ione);
2280 
2281         <span class="comment">% % % if ~isempty(SYS.SYSLogfid)              %write to log file</span>
2282         <span class="comment">% % %    str=char(addstr{1});</span>
2283         <span class="comment">% % %    fprintf(SYS.SYSLogfid,'%s\n',str);</span>
2284         <span class="comment">% % % end</span>
2285 
2286 <span class="comment">%         %==========================================================</span>
2287 <span class="comment">%     case 'StartPatchActive'                  % StartPatchActive</span>
2288 <span class="comment">%         %==========================================================</span>
2289 <span class="comment">%         %activate start patch in element icon/zoom bar</span>
2290 <span class="comment">%         set(orbfig,'WindowButtonMotionFcn','orbgui(''MoveStartPatch'')',...</span>
2291 <span class="comment">%             'WindowButtonUpFcn',    'orbgui(''StartPatchUp'')');</span>
2292 <span class="comment">%</span>
2293 <span class="comment">%         %==========================================================</span>
2294 <span class="comment">%     case 'MoveStartPatch'                    % MoveStartPatch</span>
2295 <span class="comment">%         %==========================================================</span>
2296 <span class="comment">%         xpos=orbgui('GetStartPos',0.02);</span>
2297 <span class="comment">%         orbgui('SetStartPatch',xpos);</span>
2298 
2299         <span class="comment">%==========================================================</span>
2300 <span class="comment">%     case 'GetStartPos'                    % GetStartPos</span>
2301 <span class="comment">%         %==========================================================</span>
2302 <span class="comment">%         %find starting position and check agains stop position</span>
2303 <span class="comment">%         stoplim=varargin(1); stoplim=stoplim{1};</span>
2304 <span class="comment">%         %check requested point to right of zero</span>
2305 <span class="comment">%         cpa = get(SYS.ahpos, 'CurrentPoint');</span>
2306 <span class="comment">%         xpos = cpa(1);</span>
2307 <span class="comment">%         if xpos&lt;=0.0055</span>
2308 <span class="comment">%             xpos=0.0055;</span>
2309 <span class="comment">%         end</span>
2310 <span class="comment">%</span>
2311 <span class="comment">%         %check requested point to left of stop patch</span>
2312 <span class="comment">%         h=findobj(0,'Tag','stoppatch');</span>
2313 <span class="comment">%         xlim=get(h,'XData');   %x-positions of three patch corners</span>
2314 <span class="comment">%         if xpos&gt;=xlim(1)-stoplim;</span>
2315 <span class="comment">%             xpos =xlim(1)-stoplim;</span>
2316 <span class="comment">%         end</span>
2317 <span class="comment">%         varargout{1}=xpos;</span>
2318 <span class="comment">%</span>
2319 <span class="comment">%         %==========================================================</span>
2320 <span class="comment">%     case 'SetStartPatch'                     % SetStartPatch</span>
2321 <span class="comment">%         %==========================================================</span>
2322 <span class="comment">%         %move the patch to mouse position</span>
2323 <span class="comment">%         xpos=varargin{1};</span>
2324 <span class="comment">%         h=findobj(orbfig,'tag','startpatch');</span>
2325 <span class="comment">%         xdata = [xpos-0.005 xpos+0.005 xpos-0.005];</span>
2326 <span class="comment">%         set(h, 'XData', xdata);</span>
2327 <span class="comment">%</span>
2328 <span class="comment">%         %==========================================================</span>
2329 <span class="comment">%     case 'StartPatchUp'                       %StartPatchUp</span>
2330 <span class="comment">%         %==========================================================</span>
2331 <span class="comment">%         %sequence to execute when startpatch let up</span>
2332 <span class="comment">%         xpos=orbgui('GetStartPos',0.01);</span>
2333 <span class="comment">%         orbgui('SetStartPatch',xpos);</span>
2334 <span class="comment">%</span>
2335 <span class="comment">%         %change BPM and corrector plot limits</span>
2336 <span class="comment">%         limits = get(SYS.ahbpm,'XLim');</span>
2337 <span class="comment">%         set(SYS.ahbpm,'XLim',[SYS.xlimax*xpos limits(1,2)]);   %Change start, leave stop alone</span>
2338 <span class="comment">%         set(SYS.ahcor,'XLim',[SYS.xlimax*xpos limits(1,2)]);</span>
2339 <span class="comment">%         corgui('PlotAct');</span>
2340 <span class="comment">%         corgui('PlotFit');</span>
2341 <span class="comment">%         set(orbfig, 'Pointer','arrow',...</span>
2342 <span class="comment">%             'WindowButtonMotionFcn','','WindowButtonUpFcn','');</span>
2343 <span class="comment">%</span>
2344 <span class="comment">%         %==========================================================</span>
2345 <span class="comment">%     case 'StopPatchActive'                  % StopPatchActive</span>
2346 <span class="comment">%         %==========================================================</span>
2347 <span class="comment">%         set(orbfig,'WindowButtonMotionFcn','orbgui(''MoveStopPatch'')',...</span>
2348 <span class="comment">%             'WindowButtonUpFcn',    'orbgui(''StopPatchUp'')');</span>
2349 <span class="comment">%</span>
2350 <span class="comment">%         %==========================================================</span>
2351 <span class="comment">%     case 'MoveStopPatch'                    % MoveStopPatch</span>
2352 <span class="comment">%         %==========================================================</span>
2353 <span class="comment">%         xpos=orbgui('GetStopPos',0.01);</span>
2354 <span class="comment">%         orbgui('SetStopPatch',xpos);</span>
2355 <span class="comment">%</span>
2356 <span class="comment">%         %==========================================================</span>
2357 <span class="comment">%     case 'GetStopPos'                    % GetStopPos</span>
2358 <span class="comment">%         %==========================================================</span>
2359 <span class="comment">%         stoplim=varargin(1); stoplim=stoplim{1};</span>
2360 <span class="comment">%         %check requested point to left of the x-limit</span>
2361 <span class="comment">%         cpa = get(SYS.ahpos, 'CurrentPoint');</span>
2362 <span class="comment">%         xpos = cpa(1);</span>
2363 <span class="comment">%         if xpos&gt;=(1.0 - 0.005)</span>
2364 <span class="comment">%             xpos =(1.0 - 0.005);</span>
2365 <span class="comment">%         end</span>
2366 <span class="comment">%</span>
2367 <span class="comment">%         %check requested point to right of start patch</span>
2368 <span class="comment">%         h=findobj(orbfig,'tag','startpatch');</span>
2369 <span class="comment">%         xlim=get(h,'XData');   %x-positions of three patch corners</span>
2370 <span class="comment">%         if xpos&lt;=xlim(1)+stoplim</span>
2371 <span class="comment">%             xpos=xlim(1)+stoplim+0.01;</span>
2372 <span class="comment">%         end</span>
2373 <span class="comment">%         varargout{1}=xpos;</span>
2374 <span class="comment">%</span>
2375 <span class="comment">%         % %check requested point to left of stop patch</span>
2376 <span class="comment">%         % h=findobj(orbfig,'tag','stoppatch');</span>
2377 <span class="comment">%         % xlim=get(h,'XData');   %x-positions of four patch corners</span>
2378 <span class="comment">%         % if xpos&gt;=xlim(1)-stoplim;</span>
2379 <span class="comment">%         %    xpos=xlim(1)-stoplim;</span>
2380 <span class="comment">%         % end</span>
2381 <span class="comment">%         % varargout{1}=xpos;</span>
2382 <span class="comment">%</span>
2383 <span class="comment">%         %==========================================================</span>
2384 <span class="comment">%     case 'SetStopPatch'                     % SetStopPatch</span>
2385 <span class="comment">%         %==========================================================</span>
2386 <span class="comment">%         xpos=varargin{1};</span>
2387 <span class="comment">%         h=findobj(orbfig,'tag','stoppatch');</span>
2388 <span class="comment">%         xdata = [xpos+0.005 xpos-0.005 xpos+0.005];</span>
2389 <span class="comment">%         set(h, 'XData', xdata);  %move the patch to mouse position</span>
2390 <span class="comment">%</span>
2391 <span class="comment">%         %==========================================================</span>
2392 <span class="comment">%     case 'StopPatchUp'                       %StopPatchUp</span>
2393 <span class="comment">%         %==========================================================</span>
2394 <span class="comment">%         xpos=orbgui('GetStopPos',0.01);</span>
2395 <span class="comment">%         orbgui('SetStopPatch',xpos);</span>
2396 <span class="comment">%</span>
2397 <span class="comment">%         %change BPM and corrector plot limits</span>
2398 <span class="comment">%         limits = get(SYS.ahbpm,'XLim');</span>
2399 <span class="comment">%         set(SYS.ahbpm,'XLim',[limits(1,1) SYS.xlimax*xpos]);   %Change stop, leave start alone</span>
2400 <span class="comment">%         set(SYS.ahcor,'XLim',[limits(1,1) SYS.xlimax*xpos]);</span>
2401 <span class="comment">%         corgui('PlotAct');</span>
2402 <span class="comment">%         corgui('PlotFit');</span>
2403 <span class="comment">%         set(orbfig, 'Pointer','arrow',...</span>
2404 <span class="comment">%             'WindowButtonMotionFcn','','WindowButtonUpFcn','');</span>
2405 
2406         <span class="comment">%==========================================================</span>
2407     <span class="keyword">case</span> <span class="string">'GetAbscissa'</span>                          <span class="comment">%...GetAbscissa</span>
2408         <span class="comment">%==========================================================</span>
2409         <span class="comment">%return coordinates for abscissa (position or phase)</span>
2410         SYS   = varargin{1};
2411         elem  = varargin{2};
2412         plane = SYS.plane;
2413         
2414         <span class="keyword">switch</span> SYS.xscale
2415             <span class="keyword">case</span> <span class="string">'meter'</span>
2416                 <span class="keyword">if</span> strcmpi(elem,<span class="string">'BPM'</span>), xd = BPM(plane).s; <span class="keyword">end</span>
2417                 <span class="keyword">if</span> strcmpi(elem,<span class="string">'COR'</span>), xd = COR(plane).s; <span class="keyword">end</span>
2418             <span class="keyword">case</span> <span class="string">'phase'</span>
2419                 <span class="keyword">if</span> strcmpi(elem,<span class="string">'BPM'</span>), xd = BPM(plane).phi; <span class="keyword">end</span>
2420                 <span class="keyword">if</span> strcmpi(elem,<span class="string">'COR'</span>), xd = COR(plane).phi; <span class="keyword">end</span>
2421         <span class="keyword">end</span>
2422 
2423         varargout = {xd};
2424 
2425         <span class="comment">%=============================================================</span>
2426     <span class="keyword">case</span> <span class="string">'InitialSaveSet'</span>                 <span class="comment">% *** InitialSaveSet ***</span>
2427         <span class="comment">%=============================================================</span>
2428         <span class="comment">%used during startup</span>
2429         <span class="comment">%generate a Save Set and copy to Initial slot</span>
2430         SYS.save.max = 5;     <span class="comment">%1 slot for Initial, 4 slot for Save Sets</span>
2431         setappdata(0,<span class="string">'SYS'</span>,SYS);
2432         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'SaveSet'</span>);
2433         SYS.save.ptr = 2;
2434         setappdata(0,<span class="string">'SYS'</span>,SYS);
2435         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'SaveSet2Initial'</span>);
2436         SYS.save.ptr = 1;
2437         setappdata(0,<span class="string">'SYS'</span>,SYS);
2438 
2439         <span class="comment">%=============================================================</span>
2440     <span class="keyword">case</span> <span class="string">'SaveSet2Initial'</span>               <span class="comment">% *** SaveSet2Initial ***</span>
2441         <span class="comment">%=============================================================</span>
2442         <span class="comment">%load selected Save Set into Initial Slot</span>
2443         ptr = SYS.save.ptr;
2444         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'MoveSaveSet'</span>,ptr,1);    <span class="comment">%move Save Set from ptr to 1</span>
2445         <span class="comment">%update figure if it exists</span>
2446         <span class="keyword">if</span> ~isempty(findobj(<span class="string">'Tag'</span>,<span class="string">'savesetfigure'</span>))
2447             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'UnDrawSaveSet'</span>);
2448             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'ReDrawSaveSet'</span>);
2449         <span class="keyword">end</span>
2450 
2451         <span class="comment">%=============================================================</span>
2452     <span class="keyword">case</span> <span class="string">'SaveSet'</span>                             <span class="comment">% *** SaveSet ***</span>
2453         <span class="comment">%=============================================================</span>
2454         <span class="comment">%generate SaveSet of parameters for both planes</span>
2455         <span class="comment">%bpm selection (ifit,wt)</span>
2456         <span class="comment">%beamline selection (ifit,wt)</span>
2457         <span class="comment">%corrector selection (ifit,wt)</span>
2458         <span class="comment">%bpm offsets (des)</span>
2459         <span class="comment">%system parameters: mode, bpmode, plane, relative, algorithm, bpmslp</span>
2460         <span class="comment">%fitting parameters: nsvd, etc</span>
2461 
2462         <span class="comment">%initialize buffer depth if necessary</span>
2463         <span class="keyword">if</span> ~isfield(SYS.save,<span class="string">'len'</span>), SYS.save.len = 1;  <span class="keyword">end</span>  
2464 
2465         <span class="comment">%system parameters</span>
2466         sys.mode       = SYS.mode;
2467         sys.bpmode     = SYS.bpmode;
2468         sys.plane      = SYS.plane;
2469         SYS.relative   = SYS.relative;
2470         sys.machine    = SYS.machine;
2471         sys.bpmslp     = SYS.bpmslp;
2472         sys.algo       = SYS.algo;
2473         sys.maxs       = SYS.maxs;
2474         sys.maxphi     = SYS.maxphi;
2475         sys.xscale     = SYS.xscale;
2476 
2477         <span class="comment">%bpm, corrector and response matrix parameters</span>
2478         <span class="keyword">for</span> ip = 1:2,
2479             <span class="comment">%BPM</span>
2480             bpm(ip).mode     = BPM(ip).mode;
2481             bpm(ip).scalemode= BPM(ip).scalemode;
2482 <span class="comment">%             bpm(ip).dev      = BPM(ip).dev;</span>
2483             bpm(ip).id       = BPM(ip).id;
2484             bpm(ip).ifit     = BPM(ip).ifit;
2485             bpm(ip).wt       = BPM(ip).wt;
2486             bpm(ip).des      = BPM(ip).des;
2487             <span class="comment">%Correctors</span>
2488             cor(ip).mode     = COR(ip).mode;
2489             cor(ip).scalemode= COR(ip).scalemode;
2490             cor(ip).fract    = COR(ip).fract;
2491             cor(ip).id       = COR(ip).id;
2492             cor(ip).ifit     = COR(ip).ifit;
2493             cor(ip).wt       = COR(ip).wt;
2494             cor(ip).ebpm     = COR(ip).ebpm;
2495             <span class="comment">%Orbit Response Matrix</span>
2496             rsp(ip).nsvd     = RSP(ip).nsvd;
2497             rsp(ip).disp     = RSP(ip).disp;
2498             rsp(ip).eig      = RSP(ip).eig;
2499         <span class="keyword">end</span>
2500 
2501         <span class="comment">%move Save Sets down</span>
2502         len = SYS.save.len;    <span class="comment">%present length of buffer</span>
2503         <span class="keyword">for</span> ii = len:-1:2      <span class="comment">%'Initial' occupies first slot</span>
2504             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'MoveSaveSet'</span>,ii,ii+1);
2505         <span class="keyword">end</span>
2506 
2507         <span class="comment">%load new Save Set slot #2 (slot #1 = Initial)</span>
2508         slot = 2;
2509         setappdata(orbfig,[<span class="string">'sys'</span> num2str(slot)],sys);
2510         setappdata(orbfig,[<span class="string">'bpm'</span> num2str(slot)],bpm);
2511         setappdata(orbfig,[<span class="string">'cor'</span> num2str(slot)],cor);
2512         setappdata(orbfig,[<span class="string">'rsp'</span> num2str(slot)],rsp);
2513         
2514         <span class="comment">%create time stamp</span>
2515         SYS.save.ts(slot,:) = datestr(now,0); 
2516 
2517         <span class="comment">%increment Save Set buffer length</span>
2518         SYS.save.len = SYS.save.len+1;                     
2519         
2520         <span class="keyword">if</span> SYS.save.len &gt; SYS.save.max    <span class="comment">%stop at maximum</span>
2521             SYS.save.len = SYS.save.max;
2522             setappdata(0,<span class="string">'SYS'</span>,SYS);
2523         <span class="keyword">end</span>
2524 
2525         <span class="comment">%update figure if it exists</span>
2526         <span class="keyword">if</span> ~isempty(findobj(<span class="string">'Tag'</span>,<span class="string">'savesetfigure'</span>))
2527             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'UnDrawSaveSet'</span>);
2528             SYS.save.ptr = 2;
2529             setappdata(0,<span class="string">'SYS'</span>,SYS);
2530             <span class="comment">%point to most recent selection</span>
2531             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'ReDrawSaveSet'</span>);
2532         <span class="keyword">end</span>
2533 
2534         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">' Saved parameter Save Set'</span>);
2535 
2536         <span class="comment">%=============================================================</span>
2537     <span class="keyword">case</span> <span class="string">'MoveSaveSet'</span>                       <span class="comment">% *** MoveSaveSet ***</span>
2538         <span class="comment">%=============================================================</span>
2539         <span class="comment">%moves a Save Set from one location in appdata to another</span>
2540         start = varargin{1};  <span class="comment">%initial SaveSet location</span>
2541         stop  = varargin{2};  <span class="comment">%final SaveSet location</span>
2542 
2543         sys = getappdata(orbfig,[<span class="string">'sys'</span> num2str(start)] );
2544         bpm = getappdata(orbfig,[<span class="string">'bpm'</span> num2str(start)] );
2545         cor = getappdata(orbfig,[<span class="string">'cor'</span> num2str(start)] );
2546         rsp = getappdata(orbfig,[<span class="string">'rsp'</span> num2str(start)] );
2547 
2548         setappdata(orbfig,[<span class="string">'sys'</span> num2str(stop)],sys);
2549         setappdata(orbfig,[<span class="string">'bpm'</span> num2str(stop)],bpm);
2550         setappdata(orbfig,[<span class="string">'cor'</span> num2str(stop)],cor);
2551         setappdata(orbfig,[<span class="string">'rsp'</span> num2str(stop)],rsp);
2552 
2553         SYS.save.ts(stop,:) = SYS.save.ts(start,:);    <span class="comment">%move time stamp</span>
2554         setappdata(0,<span class="string">'SYS'</span>,SYS);
2555 
2556         <span class="comment">%===================================================================</span>
2557     <span class="keyword">case</span> <span class="string">'RestoreSaveSet'</span>                       <span class="comment">% *** RestoreSaveSet ***</span>
2558         <span class="comment">%===================================================================</span>
2559         <span class="comment">%pop up screen with choices for SaveSet</span>
2560 
2561         <span class="comment">%test if Save Set panel already exists</span>
2562         h = findobj(0,<span class="string">'tag'</span>,<span class="string">'savesetfigure'</span>);
2563         <span class="keyword">if</span> ~isempty(h)
2564             delete(h);
2565         <span class="keyword">end</span>
2566 
2567         [screen_wide, screen_high]=screensizecm;
2568 
2569         <span class="comment">% Draw the outside box of the figure</span>
2570         x0=0.3545*screen_wide; y0=0.4297*screen_high; dx=0.4014*screen_wide; dy=0.2500*screen_high;
2571         figure(<span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
2572             <span class="string">'Position'</span>,[x0 y0 dx dy],<span class="keyword">...</span>
2573             <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
2574             <span class="string">'Name'</span>,<span class="string">'Save Set Selection'</span>,<span class="keyword">...</span>
2575             <span class="string">'Tag'</span>,<span class="string">'savesetfigure'</span>,<span class="keyword">...</span>
2576             <span class="string">'MenuBar'</span>,<span class="string">'none'</span>);
2577 
2578         <span class="comment">%pushbuttons for Save Set commands</span>
2579         x0=0.025*screen_wide; y0=0.02*screen_high; dx=0.08*screen_wide; dy=0.025*screen_high;
2580         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
2581             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
2582             <span class="string">'String'</span>,<span class="string">'Load Save Set'</span>,<span class="keyword">...</span>
2583             <span class="string">'Position'</span>,[x0+0*dx y0 dx dy],<span class="keyword">...</span>
2584             <span class="string">'Callback'</span>,<span class="string">'orbgui(''LoadSaveSet'');'</span>);
2585 
2586         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
2587             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
2588             <span class="string">'String'</span>,<span class="string">'Delete Save Set'</span>,<span class="keyword">...</span>
2589             <span class="string">'Callback'</span>,<span class="string">'orbgui(''DeleteSaveSet'');'</span>,<span class="keyword">...</span>
2590             <span class="string">'Position'</span>,[x0+1.1*dx y0 dx dy]);
2591 
2592         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
2593             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
2594             <span class="string">'String'</span>,<span class="string">'Load to Initial'</span>,<span class="keyword">...</span>
2595             <span class="string">'Callback'</span>,<span class="string">'orbgui(''SaveSet2Initial'');'</span>,<span class="keyword">...</span>
2596             <span class="string">'Position'</span>,[x0+2.2*dx y0 dx dy]);
2597 
2598         uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="keyword">...</span>
2599             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
2600             <span class="string">'String'</span>,<span class="string">'Cancel'</span>,<span class="keyword">...</span>
2601             <span class="string">'Callback'</span>,<span class="string">'delete(gcf)'</span>,<span class="keyword">...</span>
2602             <span class="string">'Position'</span>,[x0+3.3*dx y0 dx dy]);
2603 
2604         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'ReDrawSaveSet'</span>)
2605 
2606         <span class="comment">%=============================================================</span>
2607     <span class="keyword">case</span> <span class="string">'UnDrawSaveSet'</span>                   <span class="comment">% *** UnDrawSaveSet ***</span>
2608         <span class="comment">%=============================================================</span>
2609         <span class="comment">%remove radio buttons</span>
2610         <span class="keyword">for</span> ptr = 1:SYS.save.len
2611             h=findobj(0,<span class="string">'Tag'</span>,[<span class="string">'ss'</span> num2str(ptr)]);
2612             delete(h);
2613         <span class="keyword">end</span>
2614 
2615         <span class="comment">%=============================================================</span>
2616     <span class="keyword">case</span> <span class="string">'ReDrawSaveSet'</span>                   <span class="comment">% *** ReDrawSaveSet ***</span>
2617         <span class="comment">%=============================================================</span>
2618         [screen_wide, screen_high]=screensizecm;
2619         x0=0.025*screen_wide; y0=0.02*screen_high; dx=0.08*screen_wide; dy=0.025*screen_high;
2620 
2621         h=findobj(<span class="string">'Tag'</span>,<span class="string">'savesetfigure'</span>);
2622         figure(h);
2623         <span class="comment">%List Save Set choices</span>
2624         <span class="comment">%radio button for initial Save Set</span>
2625         uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
2626             <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
2627             <span class="string">'Position'</span>,[x0 y0+7*dy 4*dx 0.9*dy],<span class="keyword">...</span>
2628             <span class="string">'String'</span>,[<span class="string">'Initial Save Set  :  '</span> SYS.save.ts(1,:)],<span class="keyword">...</span>
2629             <span class="string">'Value'</span>,0,<span class="keyword">...</span>
2630             <span class="string">'Tag'</span>,<span class="string">'ss1'</span>,<span class="keyword">...</span>
2631             <span class="string">'Callback'</span>,<span class="string">'orbgui(''SelectSaveSet'');'</span>,<span class="keyword">...</span>
2632             <span class="string">'ToolTipString'</span>,<span class="string">'Restore to Initial Save Set'</span>);
2633 
2634         <span class="comment">%radio buttons for Save Sets</span>
2635         len = SYS.save.len;                      <span class="comment">%length of buffer</span>
2636         <span class="keyword">for</span> ii = 2:len
2637             tag = [<span class="string">'ss'</span> num2str(ii)];          <span class="comment">%add unity since initial in '1' slot</span>
2638             ts  = SYS.save.ts(ii,:);
2639             uicontrol(<span class="string">'Style'</span>,<span class="string">'radio'</span>,<span class="keyword">...</span>
2640                 <span class="string">'Units'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
2641                 <span class="string">'Position'</span>,[x0 y0+(7-ii)*dy 4*dx 0.9*dy],<span class="keyword">...</span>
2642                 <span class="string">'String'</span>,[<span class="string">'Save Set  '</span>,num2str(ii-1),<span class="string">'         :  '</span> ts],<span class="keyword">...</span>
2643                 <span class="string">'Value'</span>,0,<span class="keyword">...</span>
2644                 <span class="string">'Tag'</span>,tag,<span class="keyword">...</span>
2645                 <span class="string">'Callback'</span>,<span class="string">'orbgui(''SelectSaveSet'');'</span>,<span class="keyword">...</span>
2646                 <span class="string">'ToolTipString'</span>,<span class="string">'Restore Save Set'</span>);
2647         <span class="keyword">end</span>
2648 
2649         <span class="keyword">if</span> isfield(SYS.save,<span class="string">'ptr'</span>)
2650             <span class="keyword">if</span> ~isempty(SYS.save.ptr)
2651                 set(findobj(<span class="string">'Tag'</span>,[<span class="string">'ss'</span> num2str(SYS.save.ptr)]),<span class="string">'Value'</span>,1);
2652             <span class="keyword">end</span>
2653         <span class="keyword">end</span>
2654 
2655         <span class="comment">%=============================================================</span>
2656     <span class="keyword">case</span> <span class="string">'DeleteSaveSet'</span>               <span class="comment">% *** DeleteSaveSet ***</span>
2657         <span class="comment">%=============================================================</span>
2658         <span class="comment">%Delete the selected Save Set</span>
2659         <span class="comment">%first locate Save Set of choice</span>
2660         <span class="keyword">if</span> ~isfield(SYS.save,<span class="string">'ptr'</span>) || ~isfield(SYS.save,<span class="string">'len'</span>),<span class="keyword">return</span>; <span class="keyword">end</span>
2661 
2662         ptr = SYS.save.ptr;    <span class="comment">%pointer to selected Save Set</span>
2663         len = SYS.save.len;    <span class="comment">%total length of Save Set ring buffer</span>
2664 
2665         <span class="keyword">if</span> SYS.save.ptr == 1, <span class="keyword">return</span>; <span class="keyword">end</span>   <span class="comment">%don'td delete Initial</span>
2666 
2667         <span class="comment">%shift higher order Save Sets down one slot each</span>
2668         <span class="keyword">for</span> ii = ptr:len-1,
2669             sys = getappdata(orbfig,[<span class="string">'sys'</span> num2str(ii+1)] );
2670             bpm = getappdata(orbfig,[<span class="string">'bpm'</span> num2str(ii+1)] );
2671             cor = getappdata(orbfig,[<span class="string">'cor'</span> num2str(ii+1)] );
2672             rsp = getappdata(orbfig,[<span class="string">'rsp'</span> num2str(ii+1)] );
2673 
2674             setappdata(orbfig,[<span class="string">'sys'</span> num2str(ii)],sys);   <span class="comment">%initial in '1' slot</span>
2675             setappdata(orbfig,[<span class="string">'bpm'</span> num2str(ii)],bpm);
2676             setappdata(orbfig,[<span class="string">'cor'</span> num2str(ii)],cor);
2677             setappdata(orbfig,[<span class="string">'rsp'</span> num2str(ii)],rsp);
2678             SYS.save.ts(ii,:) = SYS.save.ts(ii+1,:);
2679         <span class="keyword">end</span>
2680         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'UnDrawSaveSet'</span>);                      <span class="comment">%clear drawing before reducing len</span>
2681         SYS.save.ptr=[];
2682 
2683         <span class="keyword">if</span> SYS.save.len&gt;=2
2684             SYS.save.len=len-1;
2685         <span class="keyword">end</span>
2686 
2687         setappdata(0,<span class="string">'SYS'</span>,SYS);
2688 
2689         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'ReDrawSaveSet'</span>)
2690 
2691         <span class="comment">%=============================================================</span>
2692     <span class="keyword">case</span> <span class="string">'SelectSaveSet'</span>               <span class="comment">% *** SelectSaveSet ***</span>
2693         <span class="comment">%=============================================================</span>
2694         imax=SYS.save.max+1;   <span class="comment">%add '1' to include Initial</span>
2695 
2696         <span class="comment">%first turn off all choices</span>
2697         <span class="keyword">for</span> ii=1:imax,
2698             set(findobj(0,<span class="string">'Tag'</span>,[<span class="string">'ss'</span> num2str(ii)]),<span class="string">'Value'</span>,0);
2699         <span class="keyword">end</span>
2700 
2701         <span class="comment">%turn on selection</span>
2702         set(gcbo,<span class="string">'Value'</span>,1);
2703         ptr=get(gcbo,<span class="string">'Tag'</span>);
2704         ptr=str2double(ptr(3));
2705 
2706         <span class="comment">%load selection into global</span>
2707         SYS.save.ptr=ptr;
2708         setappdata(0,<span class="string">'SYS'</span>,SYS);
2709 
2710         <span class="comment">%=============================================================</span>
2711     <span class="keyword">case</span> <span class="string">'LoadSaveSet'</span>                       <span class="comment">% *** LoadSaveSet ***</span>
2712         <span class="comment">%=============================================================</span>
2713         <span class="comment">%load parameters</span>
2714         <span class="comment">%update orbit</span>
2715         <span class="comment">%update correctors</span>
2716         <span class="comment">%solvesystem, backsub</span>
2717         <span class="comment">%replot</span>
2718 
2719         <span class="keyword">if</span> ~isfield(SYS.save,<span class="string">'ptr'</span>)
2720             disp(<span class="string">'Warning: no Save Set Selected'</span>);
2721             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">'Warning: no Save Set Selected'</span>);
2722             <span class="keyword">return</span>
2723         <span class="keyword">end</span>
2724 
2725         ptr = SYS.save.ptr;
2726 
2727         sys = getappdata(orbfig,[<span class="string">'sys'</span> num2str(ptr)] );
2728         bpm = getappdata(orbfig,[<span class="string">'bpm'</span> num2str(ptr)] );
2729         cor = getappdata(orbfig,[<span class="string">'cor'</span> num2str(ptr)] );
2730         rsp = getappdata(orbfig,[<span class="string">'rsp'</span> num2str(ptr)] );
2731 
2732         SYS.mode       = sys.mode;
2733         SYS.bpmode     = sys.bpmode;
2734         SYS.plane      = sys.plane;
2735         SYS.relative   = SYS.relative;
2736         SYS.machine    = sys.machine;
2737         SYS.bpmslp     = sys.bpmslp;
2738         SYS.algo       = sys.algo;
2739         SYS.maxs        = sys.maxs;
2740         SYS.maxphi      = sys.maxphi;
2741         SYS.xscale     = sys.xscale;
2742 
2743         <span class="keyword">for</span> ip = 1:2
2744             <span class="comment">% BPM</span>
2745             BPM(ip).mode     = bpm(ip).mode;
2746             BPM(ip).scalemode= bpm(ip).scalemode;
2747 <span class="comment">%             BPM(ip).dev      = bpm(ip).dev;</span>
2748             BPM(ip).id       = bpm(ip).id;
2749             BPM(ip).ifit     = bpm(ip).ifit;
2750             BPM(ip).wt       = bpm(ip).wt;
2751             BPM(ip).des      = bpm(ip).des;
2752             <span class="comment">%Correctors</span>
2753             COR(ip).mode     =cor(ip).mode;
2754             COR(ip).scalemode=cor(ip).scalemode;
2755             COR(ip).fract    =cor(ip).fract;
2756             COR(ip).id       =cor(ip).id;
2757             COR(ip).ifit     =cor(ip).ifit;
2758             COR(ip).wt       =cor(ip).wt;
2759             COR(ip).ebpm     =cor(ip).ebpm;
2760             <span class="comment">%Orbit response matrix</span>
2761             RSP(ip).nsvd     =rsp(ip).nsvd;
2762             RSP(ip).disp     =rsp(ip).disp;
2763             RSP(ip).eig      =rsp(ip).eig;
2764         <span class="keyword">end</span>
2765         
2766         setappdata(0,<span class="string">'SYS'</span>,SYS);
2767         setappdata(0,<span class="string">'BPM'</span>,BPM);
2768         setappdata(0,<span class="string">'COR'</span>,COR);
2769         setappdata(0,<span class="string">'RSP'</span>,RSP);
2770 
2771         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'RefreshOrbGUI'</span>);
2772 
2773         COR(1).rst = COR(1).act;
2774         COR(2).rst = COR(2).act;
2775         setappdata(0,<span class="string">'COR'</span>,COR);
2776 
2777         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,<span class="string">' Finished restoring system parameters '</span>);
2778         <span class="comment">%disp(['Save Set Loaded ' num2str(ptr) '  ' SYS.save.ts(ptr,:)]);</span>
2779 
2780         <span class="comment">%=============================================================</span>
2781     <span class="keyword">case</span> <span class="string">'RestoreSystem'</span>                   <span class="comment">% *** RestoreSystem ***</span>
2782         <span class="comment">%=============================================================</span>
2783         <span class="comment">%restore ORBIT program from file</span>
2784         pathname = char(varargin(1)); <span class="comment">%file directory</span>
2785         filename = char(varargin(2)); <span class="comment">%SaveSystem file name</span>
2786         auto     = char(varargin(3)); <span class="comment">%automatic load flag</span>
2787         [SYS BPM COR RSP] = RestoreOrbit(pathname,filename,auto,SYS,BPM,COR,RSP);  <span class="comment">%no graphics commands</span>
2788 
2789         <span class="comment">%Some code below this line is done in RestoreOrbit</span>
2790 
2791         <span class="comment">%Get BPM status, sort for avail, ifit</span>
2792         <span class="comment">% TODO</span>
2793         [BPM(1).status BPM(2).status] = SPEAR2BPMCheck999(BPM(1).hndl,BPM(2).hndl);
2794         BPM(1).avail = BPM(1).status;  <span class="comment">%...if status o.k. default to available</span>
2795         BPM(2).avail = BPM(2).status;
2796         [BPM]        = SortBPMs(BPM,RSP);
2797         setappdata(0,<span class="string">'BPM'</span>,BPM);
2798 
2799         <span class="comment">%Get COR status, sort for avail, ifit</span>
2800         [COR] = SortCORs(COR,RSP);
2801         setappdata(0,<span class="string">'COR'</span>,COR);
2802 
2803 
2804         <span class="comment">%Set up program parameters: both planes</span>
2805         <span class="keyword">for</span> ip = 1:2
2806             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'TogglePlane'</span>);
2807             <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'RefreshOrbGUI'</span>);        <span class="comment">%acquires new orbit, correctors, fits, updates plots</span>
2808             <span class="comment">%COR=getappdata(0,'COR');</span>
2809             COR(ip).ref = COR(ip).act;
2810             COR(ip).rst = COR(ip).act;       <span class="comment">%for save/restore</span>
2811         <span class="keyword">end</span>
2812 
2813         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'InitialSaveSet'</span>);   
2814         SYS.save.ptr = 1;   
2815         SYS.save.len = 2;   <span class="comment">%make save set, clear others</span>
2816 
2817         <a href="orbgui.html" class="code" title="function varargout = orbgui(action, varargin)">orbgui</a>(<span class="string">'LBox'</span>,[<span class="string">' Finished loading Restore File: '</span> filename]);
2818         set(findobj(<span class="string">'tag'</span>,<span class="string">'restorefile'</span>),<span class="string">'String'</span>,filename);
2819 
2820         <span class="comment">%=============================================================</span>
2821     <span class="keyword">case</span> <span class="string">'SaveSystem'</span>                         <span class="comment">% *** SaveSystem ***</span>
2822         <span class="comment">%=============================================================</span>
2823         <span class="comment">%write ORBIT parameters to *.m file</span>
2824         
2825         filename = char(varargin(1));    <span class="comment">%cell array containing file name</span>
2826         comment  = char(varargin(2));    <span class="comment">%cell array containing file comment</span>
2827         
2828         [fid,message] = fopen(filename,<span class="string">'w'</span>);
2829         
2830         <span class="keyword">if</span> fid == -1
2831             disp(message);
2832             <span class="keyword">return</span>
2833         <span class="keyword">end</span>
2834         
2835         <span class="comment">% Laurent asks %s\n for windows compatibility ???</span>
2836         
2837         fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'%system parameter save file'</span>);
2838         ts = datestr(now,0);
2839         fprintf(fid,<span class="string">'%s\n'</span>,[<span class="string">'%timestamp: '</span> ts]);
2840         fprintf(fid,<span class="string">'%s\n'</span>,[<span class="string">'%comment: '</span> comment]);
2841         <span class="comment">%</span>
2842         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.machine='</span>  ,<span class="string">''''</span>,SYS.machine,<span class="string">''';'</span>]);
2843         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'   %machine for control'</span>);
2844         <span class="comment">%</span>
2845         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.mode='</span>  ,<span class="string">''''</span>,SYS.mode,<span class="string">''';'</span>]);
2846         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'      %online or simulator'</span>);
2847         <span class="comment">%</span>
2848         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.bpmode='</span> ,<span class="string">''''</span>,SYS.bpmode,<span class="string">''';'</span>]);
2849         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'     %BPM system mode'</span>);
2850         <span class="comment">%</span>
2851         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.bpmslp= '</span>,num2str(SYS.bpmslp),<span class="string">';'</span>]);
2852         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'          %BPM sleep time in sec'</span>);
2853         <span class="comment">%</span>
2854         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.plane='</span>  ,     num2str(SYS.plane),<span class="string">';'</span>]);
2855         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'            %plane (1=horizontal 2=vertical)'</span>);
2856         <span class="comment">%</span>
2857         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.algo='</span>, <span class="string">'''SVD'';'</span>]);
2858         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'         %fitting algorithm'</span>);
2859         <span class="comment">%</span>
2860 <span class="comment">%         fprintf(fid,'%s',['sys.pbpm= ' ,num2str(SYS.pbpm),';']);</span>
2861 <span class="comment">%         fprintf(fid,'%s\n', '            %acquisition of photon BPMs');</span>
2862         <span class="comment">%</span>
2863         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.filepath=  '</span> ,<span class="string">''''</span>,SYS.filepath,<span class="string">''';'</span>]);
2864         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'     %file path in MATLAB'</span>);
2865         <span class="comment">%</span>
2866         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.reffile=  '</span> ,<span class="string">''''</span>,SYS.reffile,<span class="string">''';'</span>]);
2867         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'     %reference orbit file'</span>);
2868         <span class="comment">%</span>
2869 <span class="comment">%         fprintf(fid,'%s',['sys.rspfile=  ' ,'''',SYS.rspfile,''';']);</span>
2870 <span class="comment">%         fprintf(fid,'%s\n', '     %response matrix file');</span>
2871         <span class="comment">%</span>
2872 <span class="comment">%         fprintf(fid,'%s',['sys.brspfile= ','''',SYS.brspfile,''';']);</span>
2873 <span class="comment">%         fprintf(fid,'%s\n', '     %bump response matrix file');</span>
2874         <span class="comment">%</span>
2875         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.etafile= '</span> ,<span class="string">''''</span>,SYS.etafile,<span class="string">''';'</span>]);
2876         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'     %dispersion file'</span>);
2877         <span class="comment">%</span>
2878         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'SYS.relative= '</span> ,num2str(SYS.relative),<span class="string">';'</span>]);
2879         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'        %relative or absolute BPM plot 1=absolute, 2=relative'</span>);
2880         <span class="comment">%</span>
2881 <span class="comment">%         fprintf(fid,'%s',['sys.fdbk= 0;']);</span>
2882 <span class="comment">%         fprintf(fid,'%s\n', '            %no feedback');</span>
2883 <span class="comment">%         %</span>
2884 <span class="comment">%         fprintf(fid,'%s',['sys.abort=0;']);</span>
2885 <span class="comment">%         fprintf(fid,'%s\n', '            %reset abort flag');</span>
2886         <span class="comment">%</span>
2887         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.maxs= '</span>,num2str(SYS.maxs),<span class="string">';'</span>]);
2888         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'           %maximum ring circumference'</span>);
2889         <span class="comment">%</span>
2890         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.xlimax= '</span> ,num2str(SYS.xlimax),<span class="string">';'</span>]);
2891         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'        %abcissa plot limit'</span>);
2892         <span class="comment">%</span>
2893         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.maxphi(1)= '</span>,num2str(SYS.maxphi(1)),<span class="string">';'</span>]);
2894         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'        %maximum horizontal phase advance'</span>);
2895         <span class="comment">%</span>
2896         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.maxphi(2)= '</span>,num2str(SYS.maxphi(2)),<span class="string">';'</span>]);
2897         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'        %maximum vertical phase advance'</span>);
2898         <span class="comment">%</span>
2899         fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'sys.xscale='</span>, <span class="string">'''meter'';'</span>]);
2900         fprintf(fid,<span class="string">'%s\n'</span>, <span class="string">'        %abcissa plotting mode (meter or phase)'</span>);
2901 
2902         <span class="comment">%==============================================================</span>
2903         <span class="comment">%********   WRITE HORIZONTAL &amp; VERTICAL CONTROL DATA  *********</span>
2904         <span class="comment">%==============================================================</span>
2905         header = [<span class="string">'%*=== HORIZONTAL DATA ===*'</span>; <span class="string">'%*===   VERTICAL DATA ===*'</span>;];
2906         xy = [<span class="string">'x'</span>;<span class="string">'z'</span>;];
2907         <span class="keyword">for</span> ip = 1:2,
2908             p = num2str(ip);
2909             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">' '</span>);
2910             fprintf(fid,<span class="string">'%s\n'</span>,header(ip,:));
2911 
2912             <span class="comment">%BPM</span>
2913             fprintf(fid,<span class="string">'%s'</span>,[[<span class="string">'bpm('</span>,p,<span class="string">').dev='</span>]  ,num2str(10),          <span class="string">';'</span>]);
2914             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'          %maximum orbit deviation'</span>);
2915 <span class="comment">%             fprintf(fid,'%s',['bpm(',p,').drf=0;']);</span>
2916 <span class="comment">%             fprintf(fid,'%s\n','           %dispersion component zero');</span>
2917             fprintf(fid,<span class="string">'%s'</span>,[[<span class="string">'bpm('</span>,p,<span class="string">').id='</span>]  ,num2str(BPM(ip).id),          <span class="string">';'</span>]);
2918             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'          %BPM selection'</span>);
2919             fprintf(fid,<span class="string">'%s'</span>,[[<span class="string">'bpm('</span>,p,<span class="string">').scalemode='</span>]  ,num2str(BPM(ip).scalemode),          <span class="string">';'</span>]);
2920             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'     %BPM scale mode 0=manual mode, 1=autoscale'</span>);
2921             fprintf(fid,<span class="string">'%s'</span>,[[<span class="string">'bpm('</span>,p,<span class="string">').ylim='</span>]  ,num2str(BPM(ip).ylim),          <span class="string">';'</span>]);
2922             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'            %BPM vertical axis scale'</span>);
2923 
2924             <span class="comment">%COR</span>
2925             fprintf(fid,<span class="string">'%15s %6.3f'</span>,[[<span class="string">'cor('</span>,p,<span class="string">').fract='</span>],num2str(COR(ip).fract),<span class="string">';'</span>]);
2926             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'      %fraction of correctors'</span>);
2927             fprintf(fid,<span class="string">'%s'</span>,<span class="string">'cor('</span>,p,<span class="string">').savfrac =1.0;'</span>);
2928             fprintf(fid,<span class="string">'%s\n'</span> ,<span class="string">'    %saved fraction of corrector solution (unity)'</span>);
2929 
2930             <span class="comment">%RSP</span>
2931             fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'rsp('</span>,p,<span class="string">').disp =''off'';'</span>]);
2932             fprintf(fid,<span class="string">'%s\n'</span> ,<span class="string">'     %mode for matrix column display'</span>);
2933             fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'rsp('</span>,p,<span class="string">').eig  =''off'';'</span>]);
2934             fprintf(fid,<span class="string">'%s\n'</span> ,<span class="string">'     %mode for eigenvector display'</span>);
2935             fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'rsp('</span>,p,<span class="string">').fit  =0;'</span>]);
2936             fprintf(fid,<span class="string">'%s\n'</span> ,<span class="string">'         %valid fit flag'</span>);
2937             fprintf(fid,<span class="string">'%s %d'</span>,[<span class="string">'rsp('</span>,p,<span class="string">').rfflag='</span>, num2str(RSP(ip).rfflag),<span class="string">';'</span>]);
2938             fprintf(fid,<span class="string">'%s\n'</span> ,<span class="string">'           %rf fitting flag'</span>);
2939             fprintf(fid,<span class="string">'%s %d'</span>,[<span class="string">'rsp('</span>,p,<span class="string">').savflag=0;'</span>]);
2940             fprintf(fid,<span class="string">'%s\n'</span> ,<span class="string">'      %save solution flag'</span>);
2941             fprintf(fid,<span class="string">'%s'</span>,[[<span class="string">'rsp('</span>,p,<span class="string">').nsvd='</span> ],num2str(RSP(ip).nsvd), <span class="string">';'</span>]);
2942             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'         %number of singular values'</span>);
2943 <span class="comment">%             fprintf(fid,'%s',[['rsp(',p,').savnsvd=' ],num2str(RSP(ip).savnsvd), ';']);</span>
2944 <span class="comment">%             fprintf(fid,'%s\n','       %saved number of singular values');</span>
2945             fprintf(fid,<span class="string">'%s'</span>,[<span class="string">'rsp('</span>,p,<span class="string">').nsvdmax=1;'</span>]);
2946             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'        %default maximum number of singular values'</span>);
2947 <span class="comment">%             fprintf(fid,'%s',[['rsp(',p,').bmp=' ],num2str(RSP(ip).bmp), ';']);</span>
2948 <span class="comment">%             fprintf(fid,'%s\n','           %bump subtraction flag');</span>
2949             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">' '</span>);
2950 
2951 
2952             <span class="comment">%BPM fitting indices, weights</span>
2953             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'%BPM data: name, index, fit,  weight, etaweight'</span>);
2954             fprintf(fid,<span class="string">'%6s\n'</span> ,[<span class="string">'bpm'</span>,xy(ip,:),<span class="string">'={'</span>]);
2955 
2956             <span class="keyword">for</span> ii = 1:size(BPM(ip).name,1)
2957                 ifit = ii;
2958                 <span class="keyword">if</span> isempty(find(BPM(ip).ifit == ii,1))
2959                     ifit = 0;
2960                 <span class="keyword">end</span>
2961                 fprintf(fid,<span class="string">'%1s %10s %5d %5d %10.3f %10.3f %1s\n'</span> ,<span class="keyword">...</span>
2962                     <span class="string">'{'</span>,[<span class="string">''''</span>,BPM(ip).name(ii,:),<span class="string">''''</span>], ii, ifit, BPM(ip).wt(ii), 0.0, <span class="string">'}'</span>);
2963             <span class="keyword">end</span>
2964             fprintf(fid,<span class="string">'%2s\n'</span> ,<span class="string">'};'</span>);
2965             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">' '</span>);
2966 
2967             <span class="comment">%Corrector fitting indices, weights, limits, ebpm matrix, pbpm matrix</span>
2968             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'%COR data: name, index, fit,  weight,   limit,      ebpm,      pbpm'</span>);
2969             fprintf(fid,<span class="string">'%6s\n'</span> ,[<span class="string">'cor'</span>,xy(ip,:),<span class="string">'={'</span>]);
2970             <span class="keyword">for</span> ii = 1:size(COR(ip).name,1)
2971                 ifit = ii;
2972                 <span class="keyword">if</span> isempty(find(COR(ip).ifit == ii,1))
2973                     ifit = 0;
2974                 <span class="keyword">end</span>
2975                 fprintf(fid,<span class="string">'%1s %10s %5d %5d %10.3f %10.3f %10.3f  %1s\n'</span> ,<span class="keyword">...</span>
2976                     <span class="string">'{'</span>,[<span class="string">''''</span>,COR(ip).name(ii,:),<span class="string">''''</span>], ii, ifit,  <span class="keyword">...</span>
2977                     COR(ip).wt(ii), COR(ip).lim(ii), COR(ip).ebpm(ii),<span class="string">'}'</span>);
2978             <span class="keyword">end</span>
2979             fprintf(fid,<span class="string">'%2s\n'</span> ,<span class="string">'};'</span>);
2980             fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">' '</span>);
2981 
2982         <span class="keyword">end</span>    <span class="comment">%end of plane loop</span>
2983 
2984         <span class="comment">%close file, produce binary backup</span>
2985         fclose(fid);
2986         disp([<span class="string">'Saved system parameters to file... '</span> filename ]);
2987         temp = [filename <span class="string">'_binary'</span>];
2988         save(temp, <span class="string">'BPM'</span>, <span class="string">'COR'</span>, <span class="string">'RSP'</span>, <span class="string">'SYS'</span>);
2989         disp([<span class="string">'Backup file... '</span> temp ]);
2990 
2991         <span class="comment">%==========================================================</span>
2992     <span class="keyword">case</span> <span class="string">'SaveBump'</span>                               <span class="comment">%  SaveBump</span>
2993         <span class="comment">%==========================================================</span>
2994         <span class="comment">%*** Save Bump File ***</span>
2995         extype=<span class="string">'*.dat'</span>;
2996         [filename,pathname]=uiputfile(extype,<span class="string">'Select Bump File Name'</span>);
2997         <span class="keyword">if</span> isempty(findstr(filename,<span class="string">'.m'</span>))
2998             filename = [filename,<span class="string">'.m'</span>];
2999         <span class="keyword">end</span>
3000 
3001         <span class="keyword">if</span> isequal(filename,0) || isequal(pathname,0)
3002             disp(<span class="string">'File not open'</span>);
3003             <span class="keyword">return</span>
3004         <span class="keyword">else</span>
3005             disp([<span class="string">'File '</span>, [pathname filename], <span class="string">' open'</span>]);
3006         <span class="keyword">end</span>
3007 
3008         [fid,message]=fopen([pathname filename],<span class="string">'w'</span>);
3009         <span class="keyword">if</span> fid==-1
3010             disp([<span class="string">'WARNING: Unable to open file to write bump :'</span> pathname filename]);
3011             disp(message);
3012             <span class="keyword">return</span>
3013         <span class="keyword">end</span>
3014 
3015         ncor = length(COR(plane).ifit);
3016         fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'new bump'</span>);
3017         fprintf(fid,<span class="string">'%d\n'</span>,ncor);
3018         <span class="keyword">for</span> ii = 1:ncor
3019             id = COR(plane).ifit(ii);
3020             <span class="comment">%.name is not compressed   .fit vector is compressed</span>
3021             fprintf(fid,<span class="string">'%s %10.3f\n'</span> ,<span class="keyword">...</span>
3022                 [COR(plane).name(id,:) <span class="string">'     '</span>], COR(plane).fit(ii));
3023         <span class="keyword">end</span>
3024         fclose(fid);
3025 
3026         <span class="comment">%==========================================================</span>
3027     <span class="keyword">case</span> <span class="string">'CloseMainFigure'</span>                    <span class="comment">%CloseMainFigure</span>
3028         <span class="comment">%==========================================================</span>
3029 
3030         answer = questdlg(<span class="string">'Close Orbit GUI?'</span>,<span class="keyword">...</span>
3031             <span class="string">'Exit Orbit Control Program'</span>,<span class="keyword">...</span>
3032             <span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'Yes'</span>);
3033         <span class="keyword">switch</span> answer
3034 
3035             <span class="keyword">case</span> <span class="string">'Yes'</span>
3036 
3037                 <span class="comment">%     answer = questdlg('Clear channel access handles?',...</span>
3038                 <span class="comment">%                        'Channel Access handles',...</span>
3039                 <span class="comment">%                        'Yes','No','Yes');</span>
3040                 <span class="comment">%     if strcmp(answer,'Yes')</span>
3041                 <span class="comment">%         disp('   Closing Channel Access SYS...');</span>
3042                 <span class="comment">%         clearmcahandles;</span>
3043                 <span class="comment">%     end</span>
3044                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'makeorbitslider'</span>));
3045                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'bpmplotscale'</span>));
3046                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'corplotscale'</span>));
3047 
3048                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_xbwt'</span>));
3049                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_xclim'</span>));
3050                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_xcwt'</span>));
3051                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_hbpm'</span>));
3052                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_etawtx'</span>));
3053 
3054                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_zbwt'</span>));
3055                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_zclim'</span>));
3056                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_zcwt'</span>));
3057                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_ypwt'</span>));
3058                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_vbpm'</span>));
3059                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_etawtz'</span>));
3060 
3061                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'rload_vbl'</span>));
3062                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'toggle_blsel'</span>));
3063 
3064                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'dispersionpanel'</span>));
3065                 delete(findobj(<span class="string">'tag'</span>,<span class="string">'orbfig'</span>));
3066                 <span class="keyword">return</span>
3067 
3068             <span class="keyword">case</span> <span class="string">'No'</span>
3069                 <span class="keyword">return</span>
3070             <span class="keyword">otherwise</span>
3071                 <span class="keyword">return</span>
3072         <span class="keyword">end</span>
3073 
3074         <span class="comment">%===========================================================</span>
3075     <span class="keyword">otherwise</span>
3076         disp([<span class="string">'   Warning: CASE not found in ORBGUI: '</span> action]);
3077 
3078 <span class="keyword">end</span>  <span class="comment">%end switchyard</span>
3079</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:32:41 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>