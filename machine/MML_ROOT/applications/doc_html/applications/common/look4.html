<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of look4</title>
  <meta name="keywords" content="look4">
  <meta name="description" content="LOOK4 Quick-search M-files with keywords using a database.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">applications</a> &gt; <a href="index.html">common</a> &gt; look4.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for applications/common&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>look4
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>LOOK4 Quick-search M-files with keywords using a database.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = look4(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">LOOK4 Quick-search M-files with keywords using a database.
   LOOK4 ABC XYZ ... looks through a database of help files (H1 lines
   in m-files) for keywords ABC, XYZ, ... There can be as many keywords
   as desired. For all files in which a match occurs, the H1 line is
   displayed. CLASS METHODS will be indented by one space, and PRIVATE
   function will be indented by two spaces.

   LOOK4 is very similar to LOOKFOR, except that it searches through a
   database file named mfileDatabase#.mat (where # is the version
   number), so it is much faster.  Also, unlike LOOKFOR it accepts
   multiple keywords. The search is case-insensitive.

   mfileDatabase#.mat is created the first time LOOK4 is executed. It
   catalogs help texts of all m-files in the MATLABPATH (including class
   methods and private functions). The database file is stored in the same
   directory as this file. The generation of the database file may take
   a few minutes depending on the number of m-files and the speed of the
   computer.

   [H, P] = LOOK4('ABC', 'XYZ', ...) returns the H1 lines and the paths of
   the corresponding m-files, respectively.

   LOOK4 by itself invokes a GUI version of the search program. The GUI
   incorporates a &quot;key stroke&quot; search feature. Each key stroke updates the
   search result, but only after 0.5 seconds of non-keypress. This allows
   fast, continuous typing. Only alphabets and numbers (and quotes) are
   allowed in the GUI version. Click on results list, or use arrow keys to
   navigate through results. The full help text is displayed in the bottom
   panel.

  Search options:
   LOOK4 ABC XYZ ... -all  searches the entire first comment block of
                           m-files.
   LOOK4 ... -link         displays the results with hyperlinks to full
                           help texts

  Database creation/update:
   LOOK4 -new              re-creates the database file.
   LOOK4 -new -noverbose   does not show the name of the directory in
                           progress.
   LOOK4 -update           updates the database file for the current
                           directory. This is useful for updating personal
                           m-files.
   LOOK4 -autoupdate       sets up auto-updating feature.

   How Auto-Updating of Database Works:
     The database can be set to automatically update (re-hash) daily or
     weekly. LOOK4 accomplishes this by creating a function called
     look4_autoUpdateFcn.m that gets run during startup (The function call
     is appended to startup.m. If startup.m does not exist, it creates
     one). look4_autoUpdateFcn creates a TIMER object (tagged
     'look4AutoUpdateTimer') that gets executed at the appropriate time
     and interval. Matlab needs to be running at the time of TimerFcn
     execution. If Matlab is launched after the scheduled update time,
     then the TimerFcn will be scheduled to execute at the next update
     time.

     Every time LOOK4 loads the database into memory (it saves as a
     PERSISTENT variable), it also checks the age of the database file by
     checking the modification date, and gives a warning when 2 weeks has
     passed since the last modification. This feature creates a dummy file
     &quot;mfileDatabase#_vt.txt&quot; which is used to store the time when the
     warning was displayed.

   Examples:
     look4 root locus
     look4 root locus -all


   See also LOOKFOR, HELP, DOC.

   e-mail bug reports/comments to &lt;a href=&quot;mailto:jiro.doke@gmail.com&quot;&gt;jiro&lt;/a&gt;</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function createDatabase(d, datFile, isVerbose)</a></li><li><a href="#_sub2" class="code">function [dat, dat2_char, len] = loadData(datFile)</a></li><li><a href="#_sub3" class="code">function touchFile(fname)</a></li><li><a href="#_sub4" class="code">function [datout, ids] = look4Engine(datFile, searchType, varargin)</a></li><li><a href="#_sub5" class="code">function look4GUI(datFile)</a></li><li><a href="#_sub6" class="code">function clearSearchFieldFcn(varargin)</a></li><li><a href="#_sub7" class="code">function activateKeyPressMode(varargin)</a></li><li><a href="#_sub8" class="code">function keyPressFcn(varargin)</a></li><li><a href="#_sub9" class="code">function endKeyTimerFcn(varargin)</a></li><li><a href="#_sub10" class="code">function timerErrorFcn(varargin)</a></li><li><a href="#_sub11" class="code">function words=parseWords(blah)</a></li><li><a href="#_sub12" class="code">function varargin = parseWords_Int(varargin)</a></li><li><a href="#_sub13" class="code">function ln = GUIsearchResultCallback(varargin)</a></li><li><a href="#_sub14" class="code">function GUIuimenuCallback(varargin)</a></li><li><a href="#_sub15" class="code">function GUIradioButtonCallback(varargin)</a></li><li><a href="#_sub16" class="code">function setupAutoUpdate</a></li><li><a href="#_sub17" class="code">function out = modifyStartupFile(fname, result, opt)</a></li><li><a href="#_sub18" class="code">function autoUpdateBtnCallback(varargin)</a></li><li><a href="#_sub19" class="code">function autoUpdateEditCallback(varargin)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = look4(varargin)</a>
0002 <span class="comment">%LOOK4 Quick-search M-files with keywords using a database.</span>
0003 <span class="comment">%   LOOK4 ABC XYZ ... looks through a database of help files (H1 lines</span>
0004 <span class="comment">%   in m-files) for keywords ABC, XYZ, ... There can be as many keywords</span>
0005 <span class="comment">%   as desired. For all files in which a match occurs, the H1 line is</span>
0006 <span class="comment">%   displayed. CLASS METHODS will be indented by one space, and PRIVATE</span>
0007 <span class="comment">%   function will be indented by two spaces.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%   LOOK4 is very similar to LOOKFOR, except that it searches through a</span>
0010 <span class="comment">%   database file named mfileDatabase#.mat (where # is the version</span>
0011 <span class="comment">%   number), so it is much faster.  Also, unlike LOOKFOR it accepts</span>
0012 <span class="comment">%   multiple keywords. The search is case-insensitive.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%   mfileDatabase#.mat is created the first time LOOK4 is executed. It</span>
0015 <span class="comment">%   catalogs help texts of all m-files in the MATLABPATH (including class</span>
0016 <span class="comment">%   methods and private functions). The database file is stored in the same</span>
0017 <span class="comment">%   directory as this file. The generation of the database file may take</span>
0018 <span class="comment">%   a few minutes depending on the number of m-files and the speed of the</span>
0019 <span class="comment">%   computer.</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%   [H, P] = LOOK4('ABC', 'XYZ', ...) returns the H1 lines and the paths of</span>
0022 <span class="comment">%   the corresponding m-files, respectively.</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%   LOOK4 by itself invokes a GUI version of the search program. The GUI</span>
0025 <span class="comment">%   incorporates a &quot;key stroke&quot; search feature. Each key stroke updates the</span>
0026 <span class="comment">%   search result, but only after 0.5 seconds of non-keypress. This allows</span>
0027 <span class="comment">%   fast, continuous typing. Only alphabets and numbers (and quotes) are</span>
0028 <span class="comment">%   allowed in the GUI version. Click on results list, or use arrow keys to</span>
0029 <span class="comment">%   navigate through results. The full help text is displayed in the bottom</span>
0030 <span class="comment">%   panel.</span>
0031 <span class="comment">%</span>
0032 <span class="comment">%  Search options:</span>
0033 <span class="comment">%   LOOK4 ABC XYZ ... -all  searches the entire first comment block of</span>
0034 <span class="comment">%                           m-files.</span>
0035 <span class="comment">%   LOOK4 ... -link         displays the results with hyperlinks to full</span>
0036 <span class="comment">%                           help texts</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%  Database creation/update:</span>
0039 <span class="comment">%   LOOK4 -new              re-creates the database file.</span>
0040 <span class="comment">%   LOOK4 -new -noverbose   does not show the name of the directory in</span>
0041 <span class="comment">%                           progress.</span>
0042 <span class="comment">%   LOOK4 -update           updates the database file for the current</span>
0043 <span class="comment">%                           directory. This is useful for updating personal</span>
0044 <span class="comment">%                           m-files.</span>
0045 <span class="comment">%   LOOK4 -autoupdate       sets up auto-updating feature.</span>
0046 <span class="comment">%</span>
0047 <span class="comment">%   How Auto-Updating of Database Works:</span>
0048 <span class="comment">%     The database can be set to automatically update (re-hash) daily or</span>
0049 <span class="comment">%     weekly. LOOK4 accomplishes this by creating a function called</span>
0050 <span class="comment">%     look4_autoUpdateFcn.m that gets run during startup (The function call</span>
0051 <span class="comment">%     is appended to startup.m. If startup.m does not exist, it creates</span>
0052 <span class="comment">%     one). look4_autoUpdateFcn creates a TIMER object (tagged</span>
0053 <span class="comment">%     'look4AutoUpdateTimer') that gets executed at the appropriate time</span>
0054 <span class="comment">%     and interval. Matlab needs to be running at the time of TimerFcn</span>
0055 <span class="comment">%     execution. If Matlab is launched after the scheduled update time,</span>
0056 <span class="comment">%     then the TimerFcn will be scheduled to execute at the next update</span>
0057 <span class="comment">%     time.</span>
0058 <span class="comment">%</span>
0059 <span class="comment">%     Every time LOOK4 loads the database into memory (it saves as a</span>
0060 <span class="comment">%     PERSISTENT variable), it also checks the age of the database file by</span>
0061 <span class="comment">%     checking the modification date, and gives a warning when 2 weeks has</span>
0062 <span class="comment">%     passed since the last modification. This feature creates a dummy file</span>
0063 <span class="comment">%     &quot;mfileDatabase#_vt.txt&quot; which is used to store the time when the</span>
0064 <span class="comment">%     warning was displayed.</span>
0065 <span class="comment">%</span>
0066 <span class="comment">%   Examples:</span>
0067 <span class="comment">%     look4 root locus</span>
0068 <span class="comment">%     look4 root locus -all</span>
0069 <span class="comment">%</span>
0070 <span class="comment">%</span>
0071 <span class="comment">%   See also LOOKFOR, HELP, DOC.</span>
0072 <span class="comment">%</span>
0073 <span class="comment">%   e-mail bug reports/comments to &lt;a href=&quot;mailto:jiro.doke@gmail.com&quot;&gt;jiro&lt;/a&gt;</span>
0074 
0075 
0076 <span class="comment">%   VERSIONS:</span>
0077 <span class="comment">%     v1.0 - first version</span>
0078 <span class="comment">%     v1.1 - fix GUI window size (use normalized to fit to any screen)</span>
0079 <span class="comment">%            (Feb 13, 2006)</span>
0080 <span class="comment">%     v1.2 - fix the use of multi-word search (use single quotes)</span>
0081 <span class="comment">%            (Feb 13, 2006)</span>
0082 <span class="comment">%     v1.2.1 - always re-process CLASS and PRIVATE subdirectories.</span>
0083 <span class="comment">%              (Feb 16, 2006)</span>
0084 <span class="comment">%     v1.3 - added &quot;key stroke&quot; search feature. display hyperlink in</span>
0085 <span class="comment">%            command line. (March 24, 2006)</span>
0086 <span class="comment">%     v1.4 - added feature: auto-update of database. allow daily or weekly</span>
0087 <span class="comment">%            update of the database file. display warning when the database</span>
0088 <span class="comment">%            is old. (March 28, 2006)</span>
0089 <span class="comment">%     v1.4.1 - minor help text and code change for elegance.</span>
0090 <span class="comment">%              (March 29, 2006)</span>
0091 <span class="comment">%     v1.4.2 - bug fix (March 30, 2006)</span>
0092 <span class="comment">%</span>
0093 <span class="comment">%   Jiro Doke</span>
0094 <span class="comment">%   Feb 2, 2006</span>
0095 
0096 <span class="comment">%--------------------------------------------------------------------------</span>
0097 <span class="comment">% Error checking of input arguments</span>
0098 <span class="comment">%--------------------------------------------------------------------------</span>
0099 
0100 <span class="comment">% Check to see if input arguments are strings</span>
0101 iS = cellfun(<span class="string">'isclass'</span>, varargin, <span class="string">'char'</span>);
0102 <span class="keyword">if</span> ~all(iS)
0103   error(<span class="string">'Arguments must be strings.'</span>);
0104 <span class="keyword">end</span>
0105 
0106 <span class="comment">% If no input argument, assign empty cell to VARARGIN (will start GUI)</span>
0107 <span class="keyword">if</span> isempty(varargin)
0108   varargin = {<span class="string">''</span>};
0109 <span class="keyword">end</span>
0110 
0111 <span class="comment">%--------------------------------------------------------------------------</span>
0112 <span class="comment">% Check to see if database exists. If not, create one.</span>
0113 <span class="comment">%--------------------------------------------------------------------------</span>
0114 
0115 <span class="comment">% Determine the appropriate database file for this MATLAB version</span>
0116 v       = version;
0117 v       = strrep(strtok(v), <span class="string">'.'</span>, <span class="string">'_'</span>);
0118 datFile = fullfile(fileparts(which(mfilename)), <span class="keyword">...</span>
0119   sprintf(<span class="string">'mfileDatabase%s.mat'</span>, v));
0120 
0121 <span class="keyword">if</span> ~exist(datFile, <span class="string">'file'</span>) &amp;&amp; ~strcmpi(varargin{1}, <span class="string">'-new'</span>)
0122   fprintf(<span class="string">'Database file not found. Creating new database...\n'</span>);
0123   varargin = {<span class="string">'-new'</span>, <span class="string">'-noverbose'</span>};
0124 <span class="keyword">end</span>
0125 
0126 <span class="comment">%--------------------------------------------------------------------------</span>
0127 <span class="comment">% Perform appropriate process based on first argument</span>
0128 <span class="comment">%--------------------------------------------------------------------------</span>
0129 
0130 <span class="keyword">switch</span> lower(varargin{1})
0131   <span class="keyword">case</span> <span class="string">''</span>         <span class="comment">% Start GUI</span>
0132     <span class="keyword">if</span> nargout &gt; 0
0133       error(<span class="string">'Too many output arguments'</span>);
0134     <span class="keyword">end</span>
0135     <a href="#_sub5" class="code" title="subfunction look4GUI(datFile)">look4GUI</a>(datFile);
0136     <span class="keyword">return</span>;
0137     
0138   <span class="keyword">case</span> <span class="string">'-update'</span>  <span class="comment">% Update database for this directory</span>
0139     <a href="#_sub1" class="code" title="subfunction createDatabase(d, datFile, isVerbose)">createDatabase</a>(pwd, datFile, true);
0140     <span class="keyword">if</span> nargout &gt; 0
0141       error(<span class="string">'Too many output arguments'</span>);
0142     <span class="keyword">end</span>
0143     <span class="keyword">return</span>;
0144     
0145   <span class="keyword">case</span> <span class="string">'-new'</span>     <span class="comment">% (Re)Create new database</span>
0146     <span class="keyword">if</span> length(varargin) == 2 &amp;&amp; strcmpi(varargin{2}, <span class="string">'-noverbose'</span>)
0147       <a href="#_sub1" class="code" title="subfunction createDatabase(d, datFile, isVerbose)">createDatabase</a>(<span class="string">''</span>, datFile, false)
0148     <span class="keyword">else</span>
0149       <a href="#_sub1" class="code" title="subfunction createDatabase(d, datFile, isVerbose)">createDatabase</a>(<span class="string">''</span>, datFile, true);
0150     <span class="keyword">end</span>
0151     <span class="keyword">if</span> nargout &gt; 0
0152       error(<span class="string">'Too many output arguments'</span>);
0153     <span class="keyword">end</span>
0154     <span class="keyword">return</span>;
0155     
0156   <span class="keyword">case</span> <span class="string">'-autoupdate'</span>
0157     <a href="#_sub16" class="code" title="subfunction setupAutoUpdate">setupAutoUpdate</a>;
0158     <span class="keyword">return</span>;
0159     
0160   <span class="keyword">otherwise</span>       <span class="comment">% Perform keyword search</span>
0161     varargin = lower(varargin);
0162 
0163     id1 = strmatch(<span class="string">'-link'</span>, varargin, <span class="string">'exact'</span>);
0164     <span class="keyword">if</span> isempty(id1)
0165       showLink = false;
0166     <span class="keyword">else</span>
0167       showLink = true;
0168       varargin(id1) = <span class="string">''</span>;
0169     <span class="keyword">end</span>
0170     
0171     id2 = strmatch(<span class="string">'-all'</span>, varargin, <span class="string">'exact'</span>);
0172     <span class="keyword">if</span> isempty(id2)  <span class="comment">% If no '-all' flag, perform H1 line search</span>
0173       dat = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(datFile, 2, varargin{:});
0174       
0175     <span class="keyword">else</span>             <span class="comment">% Search through all help text</span>
0176       varargin(id2) = <span class="string">''</span>; <span class="comment">% Remove '-all' from search words</span>
0177       dat = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(datFile, 3, varargin{:});
0178     <span class="keyword">end</span>
0179 <span class="keyword">end</span>
0180 
0181 <span class="comment">%--------------------------------------------------------------------------</span>
0182 <span class="comment">% Process output</span>
0183 <span class="comment">%--------------------------------------------------------------------------</span>
0184 
0185 <span class="keyword">if</span> nargout &gt; 2
0186   error(<span class="string">'Too many output arguments.'</span>);
0187 <span class="keyword">elseif</span> nargout
0188   varargout{1} = dat(:, 2);
0189   varargout{2} = dat(:, 1);
0190 <span class="keyword">else</span>
0191   <span class="keyword">if</span> isempty(dat)
0192     fprintf(<span class="string">'\nNone found.\n\n'</span>);
0193   <span class="keyword">else</span>
0194     fprintf(<span class="string">'\n'</span>);
0195     <span class="keyword">if</span> showLink
0196       ddat=dat(:,[1, 1, 2])';
0197       fprintf(<span class="string">'&lt;a href=&quot;matlab:help(''%s'');disp(''%s'')&quot;&gt;?&lt;/a&gt; %s\n'</span>, <span class="keyword">...</span>
0198               ddat{:});
0199       fprintf(<span class="string">'\nClick on ? to get full help.\n'</span>);
0200     <span class="keyword">else</span>
0201       fprintf(<span class="string">'%s\n'</span>, dat{:, 2});
0202       fprintf(<span class="string">'\n'</span>);
0203     <span class="keyword">end</span>
0204     fprintf(<span class="string">'%d found.\n\n'</span>, size(dat, 1));
0205   <span class="keyword">end</span>
0206 <span class="keyword">end</span>
0207 
0208 
0209 <span class="comment">%--------------------------------------------------------------------------</span>
0210 <span class="comment">%--------------------------------------------------------------------------</span>
0211 <span class="comment">% createDatabase - create/update m-file database for quick-searching</span>
0212 <span class="comment">%--------------------------------------------------------------------------</span>
0213 <span class="comment">%--------------------------------------------------------------------------</span>
0214 <a name="_sub1" href="#_subfunctions" class="code">function createDatabase(d, datFile, isVerbose)</a>
0215 <span class="comment">% d         - directory name. '' for creating new database.</span>
0216 <span class="comment">% datFile   - full path to database file.</span>
0217 <span class="comment">% isVerbose - TRUE to display the directory names.</span>
0218 
0219 <span class="comment">% Database file is a n-by-3 cell array:</span>
0220 <span class="comment">%   Column 1: m-file paths</span>
0221 <span class="comment">%   Column 2: H1 lines</span>
0222 <span class="comment">%   Column 3: Full help text</span>
0223 
0224 <span class="keyword">if</span> isempty(d)
0225   createNew = true;
0226 <span class="keyword">else</span>
0227   createNew = false;
0228 <span class="keyword">end</span>
0229 
0230 fprintf(<span class="string">'Running %s...\n'</span>, upper(mfilename));
0231 
0232 <span class="keyword">if</span> createNew  <span class="comment">% (Re)Create new database</span>
0233   tic;
0234   <span class="comment">% Retrieve directories in the path</span>
0235   fprintf(<span class="string">'Retrieving path... '</span>);
0236   w = what(<span class="string">''</span>);
0237   fprintf(<span class="string">'Done\n'</span>);
0238   [idx, idx] = unique(lower({w.path}));
0239   w = w(idx);
0240   
0241   <span class="comment">% Total number of m-files</span>
0242   numFiles = sum(cellfun(<span class="string">'length'</span>, {w.m}));
0243   iFile = 1;
0244   
0245   <span class="comment">% Preallocate</span>
0246   dat = cell(numFiles, 3);
0247   
0248   fprintf(<span class="string">'Creating database...\n'</span>);
0249   
0250 <span class="keyword">else</span>          <span class="comment">% Update database</span>
0251 
0252   dat = load(datFile);
0253   dat = dat.dat;
0254   
0255   w = what(d); w = w(1);
0256   
0257   <span class="comment">%------------------------------------------------------------------------</span>
0258   <span class="comment">% Remove entries from the database before updating</span>
0259   <span class="comment">%------------------------------------------------------------------------</span>
0260   
0261   idM = strmatch([lower(w.path) filesep], lower(dat(:, 1)));
0262   
0263   <span class="keyword">if</span> ~isempty(idM)
0264     <span class="comment">% Ignore subdirectories</span>
0265     tmp = char(lower(dat(idM, 1)));
0266     tmp(:, 1:length(w.path)+1) = <span class="string">''</span>;
0267     rmID = sum(tmp == filesep, 2) &gt; 0;
0268     idM(rmID) = [];
0269     
0270     <span class="comment">%----------------------------------------------------------------------</span>
0271     <span class="comment">% Reprocess CLASSES and PRIVATE sub-directories</span>
0272     <span class="comment">%----------------------------------------------------------------------</span>
0273     
0274     <span class="comment">% Find PRIVATE directories in the database</span>
0275     idP = strmatch(fullfile(lower(w.path), <span class="string">'private'</span>, filesep), <span class="keyword">...</span>
0276       lower(dat(:, 1)));
0277     
0278     <span class="comment">% If PRIVATE directory exists, then add it to 'w'</span>
0279     <span class="keyword">if</span> isdir(fullfile(w.path, <span class="string">'private'</span>))
0280       ww = what(fullfile(w.path, <span class="string">'private'</span>));
0281       w(end + 1) = ww(1);
0282     <span class="keyword">end</span>
0283     
0284     <span class="comment">% Loop through CLASSES</span>
0285     idC = [];
0286     <span class="keyword">for</span> iC = 1:length(w(1).classes)
0287       <span class="comment">% Add CLASS directory to 'w'</span>
0288       ww = what(fullfile(w(1).path, [<span class="string">'@'</span> w(1).classes{iC}]));
0289       w(end + 1) = ww(1);
0290       
0291       <span class="comment">% Find CLASS directory in the database</span>
0292       idC = [idC; strmatch(fullfile(lower(w(1).path), <span class="keyword">...</span>
0293           [<span class="string">'@'</span> w(1).classes{iC}], filesep), lower(dat(:, 1)))];
0294       
0295       <span class="comment">% Find PRIVATE directory under CLASS in the database</span>
0296       idP = [idP; strmatch(fullfile(lower(w(1).path), <span class="keyword">...</span>
0297           [<span class="string">'@'</span> w(1).classes{iC}], <span class="string">'private'</span>, filesep), lower(dat(:, 1)))];
0298       
0299       <span class="comment">% if @CLASS/PRIVATE exists, then add it to 'w'</span>
0300       <span class="keyword">if</span> isdir(fullfile(w(1).path, [<span class="string">'@'</span> w(1).classes{iC}], <span class="string">'private'</span>))
0301         ww = what(fullfile(w(1).path, [<span class="string">'@'</span> w(1).classes{iC}], <span class="string">'private'</span>));
0302         w(end + 1) = ww(1);
0303       <span class="keyword">end</span>
0304       
0305     <span class="keyword">end</span>
0306     
0307     <span class="comment">% These are ideces of entries to be deleted from the database</span>
0308     idM = [idM; idC; idP];
0309   <span class="keyword">end</span>
0310   
0311   <span class="comment">% Delete entries from database</span>
0312   dat(idM, :) = <span class="string">''</span>;
0313   
0314   <span class="comment">% Total number of m-files</span>
0315   numFiles = sum(cellfun(<span class="string">'length'</span>, {w.m}));
0316   iFile = size(dat, 1) + 1;
0317   
0318   <span class="comment">% Preallocate</span>
0319   dat = [dat; cell(numFiles, 3)];
0320   
0321   fprintf(<span class="string">'Updating database...\n'</span>);
0322 <span class="keyword">end</span>
0323 
0324 <span class="comment">%--------------------------------------------------------------------------</span>
0325 <span class="comment">% Get help text for each m-file</span>
0326 <span class="comment">%--------------------------------------------------------------------------</span>
0327 
0328 <span class="comment">% Prepare for commandline progress display</span>
0329 <span class="comment">%c = max(cellfun('length', {w.path}));</span>
0330 <span class="comment">%delChar = repmat(char(8), 1, c+9);</span>
0331 <span class="comment">%fmtStr = ['%5.1f %% %-' num2str(c) 's\n'];</span>
0332 
0333 newlineChar = sprintf(<span class="string">'\n'</span>);
0334 
0335 hCancel = msgbox(sprintf(<span class="string">'%s: Click OK to stop'</span>, upper(mfilename)), <span class="string">'0 %'</span>);
0336 
0337 <span class="comment">% Loop through each directory</span>
0338 <span class="keyword">for</span> ii = 1:length(w)
0339   drawnow;
0340   <span class="keyword">if</span> ~ishandle(hCancel)
0341     fprintf(<span class="string">'Canceled.\n'</span>);
0342     <span class="keyword">return</span>;
0343   <span class="keyword">end</span>
0344   <span class="keyword">if</span> createNew
0345     set(hCancel, <span class="string">'name'</span>, sprintf(<span class="string">'%0.1f %%'</span>, iFile/numFiles*100));
0346     <span class="keyword">if</span> isVerbose
0347       disp(w(ii).path);
0348     <span class="keyword">end</span>
0349   <span class="keyword">else</span>
0350     fprintf(<span class="string">'%s ...\n'</span>, w(ii).path);
0351   <span class="keyword">end</span>
0352   
0353   <span class="comment">% Loop through each m-file in the directory</span>
0354   <span class="keyword">for</span> id = 1:length(w(ii).m)
0355     dat{iFile, 1} = [w(ii).path filesep w(ii).m{id}];
0356     
0357     <span class="comment">% Retrieve help text</span>
0358     s = help(dat{iFile, 1});
0359     
0360     <span class="keyword">if</span> ~isempty(s)
0361       <span class="comment">% Removing leading spaces</span>
0362       letterID = find(~isspace(s));
0363       <span class="keyword">if</span> ~isempty(letterID) <span class="comment">% empty means there's no help text!!</span>
0364         <span class="comment">% Full help text</span>
0365         s_Full = s(letterID(1):end);
0366         
0367         <span class="comment">% Find new line characters</span>
0368         nID    = strfind(s_Full, newlineChar);
0369         
0370         <span class="keyword">if</span> isempty(nID) <span class="comment">% there's only one line</span>
0371           s    = s_Full;
0372         <span class="keyword">else</span>            <span class="comment">% get the first line</span>
0373           s    = s_Full(1:nID(1));
0374         <span class="keyword">end</span>
0375         
0376         <span class="comment">% Remove trailing spaces</span>
0377         letterID = find(~isspace(s));
0378         <span class="keyword">if</span> ~isempty(letterID)
0379           s = s(1:letterID(end));
0380           
0381           [p, n] = fileparts(w(ii).path);
0382           <span class="keyword">if</span> isempty(n) <span class="comment">% in case path name ends in FILESEP</span>
0383             [n, n] = fileparts(p);
0384           <span class="keyword">end</span>
0385           <span class="keyword">if</span> ~isempty(n)  <span class="comment">% if still empty, means root (e.g. c:\)</span>
0386             <span class="keyword">if</span> n(1) == <span class="string">'@'</span>
0387               <span class="comment">% Class Method</span>
0388               s = [<span class="string">' '</span>, s];
0389             <span class="keyword">elseif</span> strcmpi(n, <span class="string">'private'</span>)
0390               <span class="comment">% Private Function</span>
0391               s = [<span class="string">'  '</span>, s];
0392             <span class="keyword">end</span>
0393           <span class="keyword">end</span>
0394           
0395           dat{iFile, 2} = s;
0396           dat{iFile, 3} = s_Full;
0397         <span class="keyword">end</span>
0398       <span class="keyword">end</span>
0399     <span class="keyword">end</span>
0400     
0401     iFile = iFile + 1;
0402   <span class="keyword">end</span>
0403 
0404 <span class="comment">%   if createNew</span>
0405 <span class="comment">%     fprintf('%s', delChar);</span>
0406 <span class="comment">%   end</span>
0407 <span class="keyword">end</span>
0408 
0409 delete(hCancel);
0410 
0411 <span class="comment">% Convert [] empty cells to '' empty cells</span>
0412 iE = cellfun(<span class="string">'isempty'</span>, dat(:, 2));
0413 dat(iE, 2:3) = {<span class="string">''</span>};
0414 
0415 <span class="comment">% Save database file. Save as V6 format (no compression) for faster loading</span>
0416 [p, n, e] = fileparts(datFile);
0417 verifiedTimeFile = fullfile(p, [n <span class="string">'_vt.txt'</span>]);
0418 v = version;
0419 <span class="keyword">if</span> str2double(v(1)) &gt; 6
0420   save(datFile, <span class="string">'dat'</span>, <span class="string">'-v6'</span>);
0421 <span class="keyword">else</span>
0422   save(datFile, <span class="string">'dat'</span>);
0423 <span class="keyword">end</span>  
0424 <a href="#_sub3" class="code" title="subfunction touchFile(fname)">touchFile</a>(verifiedTimeFile);
0425 
0426 <span class="comment">% Update PERSISTENT variable</span>
0427 <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(dat);
0428 
0429 <span class="keyword">if</span> createNew
0430   fprintf(<span class="string">'Elapsed time: %d sec ...'</span>, round(toc));
0431 <span class="keyword">end</span>
0432 fprintf(<span class="string">'Done\n'</span>);
0433 
0434 
0435 <span class="comment">%--------------------------------------------------------------------------</span>
0436 <span class="comment">%--------------------------------------------------------------------------</span>
0437 <span class="comment">% loadData - loads database. this is subfunction of look4Engine because it</span>
0438 <span class="comment">%            is called twice.</span>
0439 <span class="comment">%--------------------------------------------------------------------------</span>
0440 <span class="comment">%--------------------------------------------------------------------------</span>
0441 <a name="_sub2" href="#_subfunctions" class="code">function [dat, dat2_char, len] = loadData(datFile)</a>
0442 
0443 dat = load(datFile);
0444 dat = dat.dat;
0445 
0446 <span class="comment">% Check modified time of $$_vt.txt file.</span>
0447 <span class="comment">% This variable stores the last time out-of-date-database warning was</span>
0448 <span class="comment">% displayed. This prevents the warning from showing everytime this is run.</span>
0449 <span class="comment">% After a week, it will display the warning again if the database has not</span>
0450 <span class="comment">% be updated</span>
0451 [p, n, e] = fileparts(datFile);
0452 verifiedTimeFile = fullfile(p, [n <span class="string">'_vt.txt'</span>]);
0453 <span class="keyword">if</span> exist(verifiedTimeFile, <span class="string">'file'</span>)
0454   dd1 = dir(verifiedTimeFile);
0455 
0456 <span class="keyword">else</span>
0457   <a href="#_sub3" class="code" title="subfunction touchFile(fname)">touchFile</a>(verifiedTimeFile);
0458 
0459   dd1.date = datestr(0, 0);
0460 <span class="keyword">end</span>
0461 
0462 <span class="comment">% check the age of the database</span>
0463 dd2 = dir(datFile);
0464 tt = etime(clock, datevec(dd2.date))/(24*60*60);
0465 <span class="keyword">if</span> tt &gt; 14  <span class="comment">% give warning after 14 days</span>
0466   tt2 = etime(clock, datevec(dd1.date));
0467   <span class="keyword">if</span> tt2 &gt; 7*24*60*60 <span class="comment">% has been a week since last warning</span>
0468     warndlg(<span class="keyword">...</span>
0469       {sprintf(<span class="string">'It has been %d days since the database has been updated'</span>, <span class="keyword">...</span>
0470       round(tt)), <span class="keyword">...</span>
0471       <span class="string">'You may want to update the database.'</span>, <span class="keyword">...</span>
0472       <span class="string">''</span>, <span class="keyword">...</span>
0473       sprintf(<span class="string">'%s(''-new'')   OR    %s(''-update'')'</span>, <span class="keyword">...</span>
0474       mfilename, mfilename)}, <span class="keyword">...</span>
0475       sprintf(<span class="string">'%s: Old Database Warning'</span>, upper(mfilename)));
0476 
0477     <a href="#_sub3" class="code" title="subfunction touchFile(fname)">touchFile</a>(verifiedTimeFile);
0478 
0479   <span class="keyword">end</span>
0480 <span class="keyword">end</span>
0481 
0482 <span class="comment">% sort alphabetically</span>
0483 [ii, ii] = sortrows(strjust(char(dat(:, 2)), <span class="string">'left'</span>));
0484 dat = dat(ii, :);
0485 
0486 dat2_char=char(lower(dat(:, 2)));
0487 dat2_char=[blanks(size(dat, 1))', dat2_char, blanks(size(dat, 1))'];
0488 
0489 len = size(dat2_char, 2);
0490 
0491 
0492 <span class="comment">%--------------------------------------------------------------------------</span>
0493 <span class="comment">%--------------------------------------------------------------------------</span>
0494 <span class="comment">% touchFile</span>
0495 <span class="comment">%    Subfunction for 'touching' a file to update its file modification time</span>
0496 <span class="comment">%--------------------------------------------------------------------------</span>
0497 <span class="comment">%--------------------------------------------------------------------------</span>
0498 <a name="_sub3" href="#_subfunctions" class="code">function touchFile(fname)</a>
0499 
0500 [p, n, e] = fileparts(fname);
0501 fid = fopen(fname, <span class="string">'w'</span>);
0502 <span class="keyword">if</span> fid &gt; 0
0503   fclose(fid);
0504 <span class="keyword">else</span>
0505   fprintf(<span class="string">'Warning: Could not create %s.'</span>, [n, e]);
0506 <span class="keyword">end</span>
0507 
0508 
0509 <span class="comment">%--------------------------------------------------------------------------</span>
0510 <span class="comment">%--------------------------------------------------------------------------</span>
0511 <span class="comment">% look4Engine</span>
0512 <span class="comment">%    Main engine for searching</span>
0513 <span class="comment">%--------------------------------------------------------------------------</span>
0514 <span class="comment">%--------------------------------------------------------------------------</span>
0515 <a name="_sub4" href="#_subfunctions" class="code">function [datout, ids] = look4Engine(datFile, searchType, varargin)</a>
0516 <span class="comment">% datFile    - file name of database</span>
0517 <span class="comment">% searchType - 2 for H1 line only, 3 for full help search</span>
0518 <span class="comment">% varargin   - search keywords</span>
0519 
0520 <span class="keyword">persistent</span> dat dat2_char len
0521 
0522 <span class="keyword">if</span> nargin == 0 <span class="comment">% check whether persistent variable exists</span>
0523   <span class="keyword">if</span> isempty(dat)
0524     datout = false;
0525   <span class="keyword">else</span>
0526     datout = true;
0527   <span class="keyword">end</span>
0528   <span class="keyword">return</span>;
0529 <span class="keyword">elseif</span> nargin == 1
0530   <span class="keyword">switch</span> class(datFile)
0531     <span class="keyword">case</span> <span class="string">'cell'</span>
0532       dat = datFile;
0533       
0534       <span class="comment">% sort alphabetically</span>
0535       [ii, ii] = sortrows(strjust(char(dat(:, 2)), <span class="string">'left'</span>));
0536       dat = dat(ii, :);
0537 
0538       dat2_char=char(lower(dat(:, 2)));
0539       dat2_char=[blanks(size(dat, 1))', dat2_char, blanks(size(dat, 1))'];
0540 
0541       len = size(dat2_char, 2);
0542 
0543     <span class="keyword">case</span> <span class="string">'char'</span>
0544       [dat, dat2_char, len] = <a href="#_sub2" class="code" title="subfunction [dat, dat2_char, len] = loadData(datFile)">loadData</a>(datFile);
0545 
0546     <span class="keyword">case</span> <span class="string">'double'</span>
0547       datout = dat(datFile, :);
0548 
0549     <span class="keyword">otherwise</span>
0550       error(<span class="string">'Bad use of look4Engine'</span>);
0551 
0552   <span class="keyword">end</span>
0553   
0554   <span class="keyword">return</span>;
0555   
0556 <span class="keyword">end</span>
0557 
0558 <span class="comment">% If 'dat' not defined, load it from file (may have been cleared)</span>
0559 <span class="keyword">if</span> isempty(dat)
0560   [dat, dat2_char, len] = <a href="#_sub2" class="code" title="subfunction [dat, dat2_char, len] = loadData(datFile)">loadData</a>(datFile);
0561 <span class="keyword">end</span>
0562 
0563 
0564 <span class="comment">%--------------------------------------------------------------------------</span>
0565 <span class="comment">% Perform keyword search</span>
0566 <span class="comment">%--------------------------------------------------------------------------</span>
0567 
0568 <span class="comment">% For empty search words</span>
0569 allEmpty = true;
0570 
0571 <span class="comment">% Start off with all non-empty entries</span>
0572 ids = 1:size(dat, 1);
0573 ids(cellfun(<span class="string">'isempty'</span>, dat(:, 2))) = [];
0574 
0575 <span class="comment">% Loop through each keyword</span>
0576 <span class="keyword">for</span> iVar = 1:length(varargin)
0577 
0578   <span class="comment">% Break out of loop if 'ids' is empty, meaning that there are no matching</span>
0579   <span class="comment">% entries. -&gt; No need to continue.</span>
0580   <span class="keyword">if</span> isempty(ids)
0581     <span class="keyword">break</span>;
0582   <span class="keyword">end</span>
0583 
0584   wd = varargin{iVar};
0585   <span class="keyword">if</span> isempty(wd)
0586     <span class="keyword">continue</span>;
0587   <span class="keyword">else</span>
0588     allEmpty = false;
0589   <span class="keyword">end</span>
0590 
0591   <span class="keyword">if</span> searchType == 3
0592     <span class="comment">% Preallocate</span>
0593     a = false(length(ids), 1);
0594 
0595     <span class="comment">% Loop through each database entry</span>
0596     <span class="keyword">for</span> id = 1:length(ids)
0597       a(id) = ~isempty(strfind([<span class="string">' '</span>, lower(dat{ids(id), searchType}), <span class="string">' '</span>], wd));
0598     <span class="keyword">end</span>
0599 
0600     <span class="comment">% Update 'ids' to ones that only contain current keyword, so that the</span>
0601     <span class="comment">% next loop will be a smaller subset</span>
0602     ids = ids(a);
0603 
0604   <span class="keyword">else</span>  <span class="comment">% searchType == 2. This is faster for smaller search</span>
0605 
0606     temp_str=reshape(dat2_char(ids,:)',1,[]);
0607     id_files=strfind(temp_str,lower(wd));
0608     id_files=unique(ceil(id_files/len));
0609     ids=ids(id_files);
0610 
0611   <span class="keyword">end</span>
0612 <span class="keyword">end</span>
0613 
0614 <span class="keyword">if</span> allEmpty
0615   ids = [];
0616 <span class="keyword">end</span>  
0617 
0618 <span class="comment">% Return results</span>
0619 datout = dat(ids, 1:2);
0620 
0621 
0622 <span class="comment">%--------------------------------------------------------------------------</span>
0623 <span class="comment">%--------------------------------------------------------------------------</span>
0624 <span class="comment">% look4GUI - GUI initialization</span>
0625 <span class="comment">%--------------------------------------------------------------------------</span>
0626 <span class="comment">%--------------------------------------------------------------------------</span>
0627 <a name="_sub5" href="#_subfunctions" class="code">function look4GUI(datFile)</a>
0628 
0629 figH = findobj(<span class="string">'type'</span>, <span class="string">'figure'</span>, <span class="string">'tag'</span>, <span class="string">'look4MainGUI'</span>);
0630 <span class="keyword">if</span> ishandle(figH)
0631   close(figH);
0632 <span class="keyword">end</span>
0633 
0634 bgcolor1 = [.85 .85 .85];
0635 bgcolor2 = [1 1 1];
0636 bgcolor3 = [.7 .7 1];
0637 fgcolor1 = [0 0 0];
0638 fgcolor2 = [.5 .5 .5];
0639 
0640 <span class="comment">% Normalized figure size</span>
0641 figSize  = [.1 .05 .8 .9];
0642 
0643 figH = figure(                                                         <span class="keyword">...</span>
0644   <span class="string">'name'</span>                               , sprintf(<span class="string">'%s: M-File Search'</span>,  <span class="keyword">...</span>
0645                                          upper(mfilename)), <span class="keyword">...</span>
0646   <span class="string">'units'</span>                              , <span class="string">'normalized'</span>,                 <span class="keyword">...</span>
0647   <span class="string">'position'</span>                           , figSize,                      <span class="keyword">...</span>
0648   <span class="string">'resize'</span>                             , <span class="string">'off'</span>,                        <span class="keyword">...</span>
0649   <span class="string">'color'</span>                              , bgcolor1,                     <span class="keyword">...</span>
0650   <span class="string">'menubar'</span>                            , <span class="string">'none'</span>,                       <span class="keyword">...</span>
0651   <span class="string">'tag'</span>                                , <span class="string">'look4MainGUI'</span>,               <span class="keyword">...</span>
0652   <span class="string">'interruptible'</span>                      , <span class="string">'off'</span>,                        <span class="keyword">...</span>
0653   <span class="string">'numbertitle'</span>                        , <span class="string">'off'</span>,                        <span class="keyword">...</span>
0654   <span class="string">'visible'</span>                            , <span class="string">'off'</span>,                        <span class="keyword">...</span>
0655   <span class="string">'deletefcn'</span>                          , <span class="string">'delete(get(gcbf, ''us''));'</span>, <span class="keyword">...</span>
0656   <span class="string">'defaultuicontrolbackgroundcolor'</span>    , bgcolor1,                     <span class="keyword">...</span>
0657   <span class="string">'defaultuicontrolforegroundcolor'</span>    , fgcolor1,                     <span class="keyword">...</span>
0658   <span class="string">'defaultuicontrolfontname'</span>           , <span class="string">'verdana'</span>,                    <span class="keyword">...</span>
0659   <span class="string">'defaultuicontrolfontunits'</span>          , <span class="string">'points'</span>,                     <span class="keyword">...</span>
0660   <span class="string">'defaultuicontrolfontsize'</span>           , 9,                            <span class="keyword">...</span>
0661   <span class="string">'defaultuicontrolhorizontalalignment'</span>, <span class="string">'center'</span>,                     <span class="keyword">...</span>
0662   <span class="string">'defaultuicontrolunits'</span>              , <span class="string">'points'</span>,                     <span class="keyword">...</span>
0663   <span class="string">'defaultuicontrolenable'</span>             , <span class="string">'on'</span>);
0664 
0665 <span class="comment">% Convert and get figure position in POINTS</span>
0666 set(figH, <span class="string">'units'</span>, <span class="string">'points'</span>);
0667 figSizePt = get(figH, <span class="string">'position'</span>);
0668 fw        = figSizePt(3);
0669 fh        = figSizePt(4);
0670 fr        = round(fh/2);
0671 
0672 uicontrol(                                                       <span class="keyword">...</span>
0673   <span class="string">'style'</span>               , <span class="string">'frame'</span>,                               <span class="keyword">...</span>
0674   <span class="string">'position'</span>            , [0 0 fw fh]);
0675 uicontrol(                                                       <span class="keyword">...</span>
0676   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0677   <span class="string">'position'</span>            , [150 fh-30 80 18],                     <span class="keyword">...</span>
0678   <span class="string">'string'</span>              , <span class="string">'Search:'</span>,                             <span class="keyword">...</span>
0679   <span class="string">'fontsize'</span>            , 10,                                    <span class="keyword">...</span>
0680   <span class="string">'fontweight'</span>          , <span class="string">'bold'</span>,                                <span class="keyword">...</span>
0681   <span class="string">'horizontalalignment'</span> , <span class="string">'right'</span>);
0682 
0683 uicontrol(                                                       <span class="keyword">...</span>
0684   <span class="string">'style'</span>               , <span class="string">'edit'</span>,                                <span class="keyword">...</span>
0685   <span class="string">'tag'</span>                 , <span class="string">'SearchField'</span>,                         <span class="keyword">...</span>
0686   <span class="string">'position'</span>            , [235 fh-30 fw-290 18],                 <span class="keyword">...</span>
0687   <span class="string">'string'</span>              , <span class="string">'_'</span>,                                   <span class="keyword">...</span>
0688   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub7" class="code" title="subfunction activateKeyPressMode(varargin)">activateKeyPressMode</a>,                 <span class="keyword">...</span>
0689   <span class="string">'backgroundcolor'</span>     , bgcolor3,                              <span class="keyword">...</span>
0690   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>,                                <span class="keyword">...</span>
0691   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0692   <span class="string">'fontsize'</span>            , 10,                                    <span class="keyword">...</span>
0693   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0694   <span class="string">'tooltipstring'</span>       , sprintf(<span class="string">'%s\n%s'</span>,                      <span class="keyword">...</span>
0695                           <span class="string">'Type in search keywords. Use single'</span>, <span class="keyword">...</span>
0696                           <span class="string">'quotes to group multiple words.'</span>));
0697 
0698 uicontrol(                                                       <span class="keyword">...</span>
0699   <span class="string">'style'</span>               , <span class="string">'pushbutton'</span>,                          <span class="keyword">...</span>
0700   <span class="string">'tag'</span>                 , <span class="string">'ClearSearchField'</span>,                    <span class="keyword">...</span>
0701   <span class="string">'position'</span>            , [fw-55 fh-30 34 18],                   <span class="keyword">...</span>
0702   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub6" class="code" title="subfunction clearSearchFieldFcn(varargin)">clearSearchFieldFcn</a>,                  <span class="keyword">...</span>
0703   <span class="string">'fontsize'</span>            , 8,                                     <span class="keyword">...</span>
0704   <span class="string">'string'</span>              , <span class="string">'Clear'</span>,                               <span class="keyword">...</span>
0705   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0706   <span class="string">'tooltipstring'</span>       , <span class="string">'Clear search field. (&lt;ESC&gt;)'</span>);
0707                         
0708 uicontrol(                                                       <span class="keyword">...</span>
0709   <span class="string">'style'</span>               , <span class="string">'frame'</span>,                               <span class="keyword">...</span>
0710   <span class="string">'tag'</span>                 , <span class="string">'SearchScopeFrame'</span>,                    <span class="keyword">...</span>
0711   <span class="string">'position'</span>            , [20 fh-65 120 50]);
0712 
0713 uicontrol(                                                       <span class="keyword">...</span>
0714   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0715   <span class="string">'tag'</span>                 , <span class="string">'SearchScopeLabel'</span>,                    <span class="keyword">...</span>
0716   <span class="string">'position'</span>            , [25 fh-25 110 15],                     <span class="keyword">...</span>
0717   <span class="string">'fontweight'</span>          , <span class="string">'bold'</span>,                                <span class="keyword">...</span>
0718   <span class="string">'horizontalalignment'</span> , <span class="string">'center'</span>,                              <span class="keyword">...</span>
0719   <span class="string">'string'</span>              , <span class="string">'Search Scope'</span>);
0720 
0721 uicontrol(                                                       <span class="keyword">...</span>
0722   <span class="string">'style'</span>               , <span class="string">'radiobutton'</span>,                         <span class="keyword">...</span>
0723   <span class="string">'tag'</span>                 , <span class="string">'H1Search'</span>,                            <span class="keyword">...</span>
0724   <span class="string">'position'</span>            , [25 fh-40 110 18],                     <span class="keyword">...</span>
0725   <span class="string">'string'</span>              , <span class="string">'H1 Line Only (F1)'</span>,                   <span class="keyword">...</span>
0726   <span class="string">'value'</span>               , true,                                  <span class="keyword">...</span>
0727   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub15" class="code" title="subfunction GUIradioButtonCallback(varargin)">GUIradioButtonCallback</a>,               <span class="keyword">...</span>
0728   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0729   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0730 
0731 uicontrol(                                                       <span class="keyword">...</span>
0732   <span class="string">'style'</span>               , <span class="string">'radiobutton'</span>,                         <span class="keyword">...</span>
0733   <span class="string">'tag'</span>                 , <span class="string">'FullSearch'</span>,                          <span class="keyword">...</span>
0734   <span class="string">'position'</span>            , [25 fh-60 110 18],                     <span class="keyword">...</span>
0735   <span class="string">'string'</span>              , <span class="string">'Full Help (F2)'</span>,                      <span class="keyword">...</span>
0736   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub15" class="code" title="subfunction GUIradioButtonCallback(varargin)">GUIradioButtonCallback</a>,               <span class="keyword">...</span>
0737   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0738   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0739 
0740 uicontrol(                                                       <span class="keyword">...</span>
0741   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0742   <span class="string">'tag'</span>                 , <span class="string">'SearchWordsCaption'</span>,                  <span class="keyword">...</span>
0743   <span class="string">'position'</span>            , [150 fh-50 80 15],                     <span class="keyword">...</span>
0744   <span class="string">'string'</span>              , <span class="string">'Search Words:'</span>,                       <span class="keyword">...</span>
0745   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0746   <span class="string">'horizontalalignment'</span> , <span class="string">'right'</span>);
0747 
0748 uicontrol(                                                       <span class="keyword">...</span>
0749   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0750   <span class="string">'tag'</span>                 , <span class="string">'SearchWords'</span>,                         <span class="keyword">...</span>
0751   <span class="string">'position'</span>            , [235 fh-65 fw-255 30],                 <span class="keyword">...</span>
0752   <span class="string">'string'</span>              , <span class="string">''</span>,                                    <span class="keyword">...</span>
0753   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0754   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0755 
0756 uicontrol(                                                       <span class="keyword">...</span>
0757   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0758   <span class="string">'tag'</span>                 , <span class="string">'SearchFoundCaption'</span>,                  <span class="keyword">...</span>
0759   <span class="string">'position'</span>            , [20 fh-102 fw-40 12],                  <span class="keyword">...</span>
0760   <span class="string">'string'</span>              , <span class="string">'Entries Found: 0'</span>,                    <span class="keyword">...</span>
0761   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0762   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0763 
0764 uicontrol(                                                       <span class="keyword">...</span>
0765   <span class="string">'style'</span>               , <span class="string">'listbox'</span>,                             <span class="keyword">...</span>
0766   <span class="string">'tag'</span>                 , <span class="string">'SearchResults'</span>,                       <span class="keyword">...</span>
0767   <span class="string">'position'</span>            , [20 fr-20 fw-40 fh-fr-82],             <span class="keyword">...</span>
0768   <span class="string">'backgroundcolor'</span>     , bgcolor2,                              <span class="keyword">...</span>
0769   <span class="string">'interruptible'</span>       , <span class="string">'off'</span>,                                 <span class="keyword">...</span>
0770   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0771   <span class="string">'fontsize'</span>            , 8,                                     <span class="keyword">...</span>
0772   <span class="string">'callback'</span>            , @<a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>,              <span class="keyword">...</span>
0773   <span class="string">'max'</span>                 , 1,                                     <span class="keyword">...</span>
0774   <span class="string">'min'</span>                 , 1,                                     <span class="keyword">...</span>
0775   <span class="string">'tooltipstring'</span>       , <span class="string">'Double-click to view file in Editor.'</span>);
0776 
0777 uicontrol(                                                       <span class="keyword">...</span>
0778   <span class="string">'style'</span>               , <span class="string">'Text'</span>,                                <span class="keyword">...</span>
0779   <span class="string">'tag'</span>                 , <span class="string">'HelpTextCaption'</span>,                     <span class="keyword">...</span>
0780   <span class="string">'position'</span>            , [20 fr-40 fw-40 12],                   <span class="keyword">...</span>
0781   <span class="string">'string'</span>              , <span class="string">'Full Help:'</span>,                          <span class="keyword">...</span>
0782   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0783 
0784 uicontrol(                                                       <span class="keyword">...</span>
0785   <span class="string">'style'</span>               , <span class="string">'listbox'</span>,                             <span class="keyword">...</span>
0786   <span class="string">'tag'</span>                 , <span class="string">'HelpText'</span>,                            <span class="keyword">...</span>
0787   <span class="string">'position'</span>            , [20 20 fw-40 fr-60],                   <span class="keyword">...</span>
0788   <span class="string">'backgroundcolor'</span>     , bgcolor2,                              <span class="keyword">...</span>
0789   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub7" class="code" title="subfunction activateKeyPressMode(varargin)">activateKeyPressMode</a>,                 <span class="keyword">...</span>
0790   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0791   <span class="string">'fontsize'</span>            , 8,                                     <span class="keyword">...</span>
0792   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>,                                <span class="keyword">...</span>
0793   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0794   <span class="string">'visible'</span>             , <span class="string">'on'</span>);
0795 
0796 uiCmenuH = uicontextmenu;
0797 uimenu(                                                          <span class="keyword">...</span>
0798   <span class="string">'parent'</span>              , uiCmenuH,                              <span class="keyword">...</span>
0799   <span class="string">'label'</span>               , <span class="string">'Change directory'</span>,                    <span class="keyword">...</span>
0800   <span class="string">'tag'</span>                 , <span class="string">'ChangeDirMenu'</span>,                       <span class="keyword">...</span>
0801   <span class="string">'callback'</span>            , @<a href="#_sub14" class="code" title="subfunction GUIuimenuCallback(varargin)">GUIuimenuCallback</a>);
0802 uimenu(                                                          <span class="keyword">...</span>
0803   <span class="string">'parent'</span>              , uiCmenuH,                              <span class="keyword">...</span>
0804   <span class="string">'label'</span>               , <span class="string">'Copy to Clipboard'</span>,                   <span class="keyword">...</span>
0805   <span class="string">'tag'</span>                 , <span class="string">'ClipboardMenu'</span>,                       <span class="keyword">...</span>
0806   <span class="string">'callback'</span>            , @<a href="#_sub14" class="code" title="subfunction GUIuimenuCallback(varargin)">GUIuimenuCallback</a>);
0807 
0808 uicontrol(                                                       <span class="keyword">...</span>
0809   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0810   <span class="string">'tag'</span>                 , <span class="string">'FileLocation'</span>,                        <span class="keyword">...</span>
0811   <span class="string">'position'</span>            , [20 fh-90 fw-40 12],                   <span class="keyword">...</span>
0812   <span class="string">'string'</span>              , <span class="string">'File location:'</span>,                      <span class="keyword">...</span>
0813   <span class="string">'fontsize'</span>            , 8,                                     <span class="keyword">...</span>
0814   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>,                                <span class="keyword">...</span>
0815   <span class="string">'foregroundcolor'</span>     , <span class="string">'blue'</span>,                                <span class="keyword">...</span>
0816   <span class="string">'uicontextmenu'</span>       , uiCmenuH,                              <span class="keyword">...</span>
0817   <span class="string">'tooltipstring'</span>       , sprintf(<span class="string">'%s\n%s'</span>,                      <span class="keyword">...</span>
0818                           <span class="string">'Right-click to change directory'</span>,     <span class="keyword">...</span>
0819                           <span class="string">'or copy file path to clipboard.'</span>));
0820 
0821 <span class="comment">% Get handles structure</span>
0822 handles          = guihandles(figH);
0823 handles.datFile  = datFile;
0824 handles.bgcolor1 = bgcolor1;
0825 handles.bgcolor2 = bgcolor2;
0826 handles.bgcolor3 = bgcolor3;
0827 handles.fgcolor1 = fgcolor1;
0828 handles.fgcolor2 = fgcolor2;
0829 
0830 pos = get(handles.SearchResults, <span class="string">'position'</span>);
0831 handles.numLines = round(pos(4) / <span class="keyword">...</span>
0832   (get(handles.SearchResults, <span class="string">'fontsize'</span>)+2));
0833 
0834 handles.endKeyTimer = timer(<span class="keyword">...</span>
0835   <span class="string">'name'</span>      , <span class="string">'look4Timer'</span>, <span class="keyword">...</span>
0836   <span class="string">'startdelay'</span>, 0.5, <span class="keyword">...</span>
0837   <span class="string">'tag'</span>       , <span class="string">'look4Timer'</span>);
0838 
0839 guidata(figH, handles);
0840 set(handles.endKeyTimer, <span class="keyword">...</span>
0841   <span class="string">'timerfcn'</span>, {@<a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>, handles}, <span class="keyword">...</span>
0842   <span class="string">'errorfcn'</span>, {@<a href="#_sub10" class="code" title="subfunction timerErrorFcn(varargin)">timerErrorFcn</a>, handles});
0843 set(figH, <span class="keyword">...</span>
0844   <span class="string">'keypressfcn'</span> , {@<a href="#_sub8" class="code" title="subfunction keyPressFcn(varargin)">keyPressFcn</a>, handles}, <span class="keyword">...</span>
0845   <span class="string">'userdata'</span>    , handles.endKeyTimer);
0846 
0847 <span class="comment">% Make GUI visible</span>
0848 set(figH, <span class="string">'visible'</span>, <span class="string">'on'</span>);
0849 
0850 <span class="comment">% Load datFile as PERSISTENT in look4Engine (if not already defined)</span>
0851 <span class="keyword">if</span> ~<a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>
0852   <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(datFile);
0853   <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>([]);
0854 <span class="keyword">end</span>
0855 
0856 
0857 <span class="comment">%--------------------------------------------------------------------------</span>
0858 <span class="comment">%--------------------------------------------------------------------------</span>
0859 <span class="comment">% clearSearchFieldFcn</span>
0860 <span class="comment">%    Clears the search field.</span>
0861 <span class="comment">%--------------------------------------------------------------------------</span>
0862 <span class="comment">%--------------------------------------------------------------------------</span>
0863 <a name="_sub6" href="#_subfunctions" class="code">function clearSearchFieldFcn(varargin)</a>
0864 
0865 obj     = varargin{1};
0866 handles = guidata(obj);
0867 
0868 set(handles.SearchField, <span class="string">'string'</span>, <span class="string">'_'</span>);
0869 <a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>([], [], handles);
0870 <a href="#_sub7" class="code" title="subfunction activateKeyPressMode(varargin)">activateKeyPressMode</a>(obj);
0871 
0872 
0873 <span class="comment">%--------------------------------------------------------------------------</span>
0874 <span class="comment">%--------------------------------------------------------------------------</span>
0875 <span class="comment">% activateKeyPressMode</span>
0876 <span class="comment">%    When clicked on the search field or help window, it changes the</span>
0877 <span class="comment">%    background color and adds '_' (if not already present) to indicate</span>
0878 <span class="comment">%    that key input is allowed.</span>
0879 <span class="comment">%--------------------------------------------------------------------------</span>
0880 <span class="comment">%--------------------------------------------------------------------------</span>
0881 <a name="_sub7" href="#_subfunctions" class="code">function activateKeyPressMode(varargin)</a>
0882 
0883 handles = guidata(varargin{1});
0884 
0885 str = get(handles.SearchField, <span class="string">'string'</span>);
0886 <span class="keyword">if</span> isempty(strmatch(<span class="string">'_'</span>, fliplr(str)))
0887   str = [str, <span class="string">'_'</span>];
0888 <span class="keyword">end</span>
0889 set(handles.SearchField, <span class="keyword">...</span>
0890   <span class="string">'string'</span>          , str, <span class="keyword">...</span>
0891   <span class="string">'backgroundcolor'</span> , handles.bgcolor3, <span class="keyword">...</span>
0892   <span class="string">'foregroundcolor'</span> , handles.fgcolor1);
0893 
0894 
0895 <span class="comment">%--------------------------------------------------------------------------</span>
0896 <span class="comment">%--------------------------------------------------------------------------</span>
0897 <span class="comment">% keyPressFcn</span>
0898 <span class="comment">%    Pressing alpha-numeric keys results in appending the character to the</span>
0899 <span class="comment">%    search text in the search field. &lt;ESC&gt; clears the search field. &lt;DEL&gt;</span>
0900 <span class="comment">%    &lt;BACKSPACE&gt; deletes previous character. Arrow keys navigates through</span>
0901 <span class="comment">%    search results, displaying the full text in the bottom field.</span>
0902 <span class="comment">%--------------------------------------------------------------------------</span>
0903 <span class="comment">%--------------------------------------------------------------------------</span>
0904 <a name="_sub8" href="#_subfunctions" class="code">function keyPressFcn(varargin)</a>
0905 
0906 obj = varargin{1};
0907 handles = varargin{3};
0908 stop(handles.endKeyTimer);
0909 
0910 k = get(obj, <span class="string">'currentkey'</span>);
0911 k_d = double(k);
0912 
0913 str = get(handles.SearchField, <span class="string">'string'</span>);
0914 <span class="keyword">if</span> isempty(strmatch(<span class="string">'_'</span>, fliplr(str)))
0915   str = [str, <span class="string">'_'</span>];
0916 <span class="keyword">end</span>
0917 set(handles.SearchField, <span class="keyword">...</span>
0918   <span class="string">'backgroundcolor'</span>, handles.bgcolor3, <span class="keyword">...</span>
0919   <span class="string">'foregroundcolor'</span>, handles.fgcolor1);
0920 
0921 <span class="keyword">if</span> length(k) == 1 &amp;&amp; ismember(k_d, [48:57, 97:122])
0922   str = [str(1:end-1), k, <span class="string">'_'</span>];
0923 <span class="keyword">else</span>
0924   <span class="keyword">switch</span> k
0925     <span class="keyword">case</span> <span class="string">'space'</span>
0926       str = [str(1:end-1), <span class="string">' _'</span>];
0927       
0928     <span class="keyword">case</span> <span class="string">'quote'</span>
0929       str = [str(1:end-1), <span class="string">'''_'</span>];
0930       
0931     <span class="keyword">case</span> {<span class="string">'delete'</span>, <span class="string">'backspace'</span>}
0932       <span class="keyword">if</span> ~strcmp(str, <span class="string">'_'</span>)
0933         str = [str(1:end-2), <span class="string">'_'</span>];
0934       <span class="keyword">end</span>
0935       
0936     <span class="keyword">case</span> <span class="string">'hyphen'</span>
0937       str = [str(1:end-1), <span class="string">'-_'</span>];
0938       
0939     <span class="keyword">case</span> <span class="string">'period'</span>
0940       str = [str(1:end-1), <span class="string">'._'</span>];
0941       
0942     <span class="keyword">case</span> <span class="string">'escape'</span>
0943       set(handles.SearchField, <span class="string">'string'</span>, <span class="string">'_'</span>);
0944       <a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>([], [], handles);
0945       <span class="keyword">return</span>;
0946       
0947     <span class="keyword">case</span> <span class="string">'uparrow'</span>
0948       <span class="keyword">if</span> <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>
0949         val = get(handles.SearchResults, <span class="string">'value'</span>);
0950         set(handles.SearchResults, <span class="string">'value'</span>, max([1, val-1]));
0951         set(handles.look4MainGUI, <span class="string">'selectiontype'</span>, <span class="string">'normal'</span>);
0952         <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(handles.SearchResults);
0953       <span class="keyword">end</span>
0954       <span class="keyword">return</span>;
0955     
0956     <span class="keyword">case</span> <span class="string">'downarrow'</span>
0957       ln = <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>;
0958       <span class="keyword">if</span> ln
0959         val = get(handles.SearchResults, <span class="string">'value'</span>);
0960         set(handles.SearchResults, <span class="string">'value'</span>, min([ln, val+1]));
0961         set(handles.look4MainGUI, <span class="string">'selectiontype'</span>, <span class="string">'normal'</span>);
0962         <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(handles.SearchResults);
0963       <span class="keyword">end</span>
0964       <span class="keyword">return</span>;
0965     
0966     <span class="keyword">case</span> <span class="string">'return'</span>
0967       set(handles.look4MainGUI, <span class="string">'selectiontype'</span>, <span class="string">'open'</span>);
0968       <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(handles.SearchResults);
0969       <span class="keyword">return</span>;
0970     
0971     <span class="keyword">case</span> <span class="string">'f1'</span>
0972       <a href="#_sub15" class="code" title="subfunction GUIradioButtonCallback(varargin)">GUIradioButtonCallback</a>(handles.H1Search);
0973       <span class="keyword">return</span>;
0974       
0975     <span class="keyword">case</span> <span class="string">'f2'</span>
0976       <a href="#_sub15" class="code" title="subfunction GUIradioButtonCallback(varargin)">GUIradioButtonCallback</a>(handles.FullSearch);
0977       <span class="keyword">return</span>;
0978       
0979     <span class="keyword">otherwise</span>
0980       <span class="keyword">return</span>;
0981   
0982   <span class="keyword">end</span>
0983 <span class="keyword">end</span>
0984 
0985 set(handles.SearchField, <span class="string">'string'</span>, str);
0986 
0987 start(handles.endKeyTimer);
0988 
0989 
0990 <span class="comment">%--------------------------------------------------------------------------</span>
0991 <span class="comment">%--------------------------------------------------------------------------</span>
0992 <span class="comment">% endKeyTimerFcn</span>
0993 <span class="comment">%    This function gets called a preset time (t sec) after a key stroke.</span>
0994 <span class="comment">%    It performs the search using the words in the search field. The timer</span>
0995 <span class="comment">%    is used to prevent searching after each key stroke. It would only get</span>
0996 <span class="comment">%    executed when there is a pause (t sec) in key inputs. Everytime a key</span>
0997 <span class="comment">%    is pressed, the timer is stopped. Only when t seconds have passed</span>
0998 <span class="comment">%    without key presses, does this function get executed.</span>
0999 <span class="comment">%--------------------------------------------------------------------------</span>
1000 <span class="comment">%--------------------------------------------------------------------------</span>
1001 <a name="_sub9" href="#_subfunctions" class="code">function endKeyTimerFcn(varargin)</a>
1002 
1003 handles = varargin{3};
1004 set(handles.FileLocation, <span class="string">'string'</span>, <span class="string">'Searching ...'</span>);
1005 drawnow;
1006 
1007 str = get(handles.SearchField, <span class="string">'string'</span>);
1008 <span class="keyword">if</span> ~isempty(str) &amp;&amp; strcmp(str(end), <span class="string">'_'</span>)
1009   str = str(1:end-1);
1010 <span class="keyword">end</span>
1011 
1012 <span class="comment">% initialize</span>
1013 words = {};
1014 dat = cell(0, 2);
1015 idx = [];
1016 
1017 <span class="keyword">if</span> ~isempty(str)
1018   
1019   <span class="keyword">try</span>
1020     words=<a href="#_sub11" class="code" title="subfunction words=parseWords(blah)">parseWords</a>(deblank(str));
1021   <span class="keyword">catch</span>
1022     <span class="comment">% possibly a mis-matching quotes. In that case, append a quote at the</span>
1023     <span class="comment">% end</span>
1024     words=<a href="#_sub11" class="code" title="subfunction words=parseWords(blah)">parseWords</a>([deblank(str) <span class="string">''''</span>]);
1025   <span class="keyword">end</span>
1026   
1027   <span class="keyword">if</span> ~isempty(words)
1028     <span class="comment">% perform appropriate search based on search type</span>
1029     <span class="keyword">if</span> get(handles.H1Search, <span class="string">'value'</span>)
1030       [dat, idx] = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(handles.datFile, 2, words{:});
1031     <span class="keyword">else</span>
1032       [dat, idx] = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(handles.datFile, 3, words{:});
1033     <span class="keyword">end</span>
1034 
1035   <span class="keyword">end</span>
1036 <span class="keyword">end</span>
1037 
1038 <span class="comment">% update the indices</span>
1039 <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(idx);
1040 
1041 <span class="keyword">if</span> isempty(dat)
1042   set(handles.SearchResults , <span class="string">'string'</span>, <span class="string">''</span>, <span class="keyword">...</span>
1043                               <span class="string">'value'</span> , 0);
1044   set(handles.FileLocation  , <span class="string">'string'</span>, <span class="string">'File location:'</span>);
1045   set(handles.HelpText      , <span class="string">'string'</span>, <span class="string">''</span>);
1046 
1047   <span class="keyword">if</span> isempty(words)
1048     set(handles.SearchWords       , <span class="string">'string'</span>, <span class="string">''</span>);
1049     set(handles.SearchFoundCaption, <span class="string">'string'</span>, <span class="string">'Entries Found: 0'</span>);
1050   <span class="keyword">else</span>
1051     searchwords = sprintf(<span class="string">'[%s], '</span>, words{:});
1052     set(handles.SearchWords, <span class="keyword">...</span>
1053       <span class="string">'string'</span>, sprintf(<span class="string">'%s'</span>, searchwords(1:end-2)));
1054     set(handles.SearchFoundCaption, <span class="keyword">...</span>
1055       <span class="string">'string'</span>, <span class="string">'Entries Found: 0'</span>);
1056   <span class="keyword">end</span>
1057 <span class="keyword">else</span>
1058   <span class="keyword">if</span> size(dat, 1) &gt; handles.numLines
1059     set(handles.SearchResults, <span class="keyword">...</span>
1060       <span class="string">'string'</span>, [dat(1:handles.numLines-1, 2); {<span class="string">'&lt;show all...&gt;'</span>}], <span class="keyword">...</span>
1061       <span class="string">'value'</span> , 1);
1062   <span class="keyword">else</span>
1063     set(handles.SearchResults, <span class="keyword">...</span>
1064       <span class="string">'string'</span>, dat(:, 2), <span class="keyword">...</span>
1065       <span class="string">'value'</span> , 1);
1066   <span class="keyword">end</span>
1067   
1068   searchwords = sprintf(<span class="string">'[%s], '</span>, words{:});
1069   set(handles.SearchWords, <span class="keyword">...</span>
1070     <span class="string">'string'</span>, sprintf(<span class="string">'%s'</span>, searchwords(1:end-2)));
1071   set(handles.SearchFoundCaption, <span class="keyword">...</span>
1072     <span class="string">'string'</span>, sprintf(<span class="string">'Entries Found: %d'</span>, size(dat, 1)));
1073   
1074   set(handles.look4MainGUI, <span class="string">'SelectionType'</span>, <span class="string">'normal'</span>);
1075   <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(handles.SearchResults);
1076 <span class="keyword">end</span>
1077 
1078 
1079 <span class="comment">%--------------------------------------------------------------------------</span>
1080 <span class="comment">%--------------------------------------------------------------------------</span>
1081 <span class="comment">% timerErrorFcn</span>
1082 <span class="comment">%    This is called when an error occurs during timer fcn calls. It resets</span>
1083 <span class="comment">%    all properties.</span>
1084 <span class="comment">%--------------------------------------------------------------------------</span>
1085 <span class="comment">%--------------------------------------------------------------------------</span>
1086 <a name="_sub10" href="#_subfunctions" class="code">function timerErrorFcn(varargin)</a>
1087 
1088 handles = varargin{3};
1089 errordlg(sprintf(<span class="string">'Sorry, an internal error occurred.\nResetting GUI...'</span>), <span class="keyword">...</span>
1090   <span class="string">'error'</span>, <span class="string">'modal'</span>);
1091 
1092 set(handles.SearchField, <span class="keyword">...</span>
1093   <span class="string">'string'</span>          , <span class="string">'_'</span>, <span class="keyword">...</span>
1094   <span class="string">'backgroundcolor'</span> , handles.bgcolor3, <span class="keyword">...</span>
1095   <span class="string">'foregroundcolor'</span> , handles.fgcolor1);
1096 set(handles.SearchResults     , <span class="string">'string'</span>, <span class="string">''</span>, <span class="keyword">...</span>
1097                                 <span class="string">'value'</span> , 0);
1098 set(handles.FileLocation      , <span class="string">'string'</span>, <span class="string">'File location:'</span>);
1099 set(handles.HelpText          , <span class="string">'string'</span>, <span class="string">''</span>);
1100 set(handles.SearchWords       , <span class="string">'string'</span>, <span class="string">''</span>);
1101 set(handles.SearchFoundCaption, <span class="string">'string'</span>, <span class="string">'Entries Found: 0'</span>);
1102 <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(handles.datFile);
1103 <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>([]);
1104 
1105 
1106 <span class="comment">%--------------------------------------------------------------------------</span>
1107 <span class="comment">%--------------------------------------------------------------------------</span>
1108 <span class="comment">% parseWords</span>
1109 <span class="comment">%    This parses a string into words. It calls parseWords_Int.</span>
1110 <span class="comment">%--------------------------------------------------------------------------</span>
1111 <span class="comment">%--------------------------------------------------------------------------</span>
1112 <a name="_sub11" href="#_subfunctions" class="code">function words=parseWords(blah)</a>
1113 
1114 eval(sprintf(<span class="string">'parseWords_Int %s;'</span>, blah));
1115 <span class="comment">% the above line will create 'ans'</span>
1116 words = ans;
1117 
1118 <span class="comment">% delete empty words</span>
1119 words(cellfun(<span class="string">'isempty'</span>, words)) = <span class="string">''</span>;
1120 
1121 <span class="keyword">if</span> length(words) == 1 &amp;&amp; isempty(words{1})
1122   words = {};
1123 <span class="keyword">end</span>
1124 
1125 
1126 <span class="comment">%--------------------------------------------------------------------------</span>
1127 <span class="comment">%--------------------------------------------------------------------------</span>
1128 <span class="comment">% parseWords_Int</span>
1129 <span class="comment">%    This is a dummy function that just converts multiple string inputs</span>
1130 <span class="comment">%    into cell array of words.</span>
1131 <span class="comment">%--------------------------------------------------------------------------</span>
1132 <span class="comment">%--------------------------------------------------------------------------</span>
1133 <a name="_sub12" href="#_subfunctions" class="code">function varargin = parseWords_Int(varargin)</a>
1134 
1135 
1136 <span class="comment">%--------------------------------------------------------------------------</span>
1137 <span class="comment">%--------------------------------------------------------------------------</span>
1138 <span class="comment">% GUIsearchResultCallback</span>
1139 <span class="comment">%    This function is called when an entry in the results listbox is</span>
1140 <span class="comment">%    clicked. It recalls the full help text (from the database) and</span>
1141 <span class="comment">%    displays it in the help window (bottom). If double-clicked, it will</span>
1142 <span class="comment">%    open the file in the editor.</span>
1143 <span class="comment">%--------------------------------------------------------------------------</span>
1144 <span class="comment">%--------------------------------------------------------------------------</span>
1145 <a name="_sub13" href="#_subfunctions" class="code">function ln = GUIsearchResultCallback(varargin)</a>
1146 
1147 <span class="keyword">persistent</span> idx tmp
1148 
1149 <span class="keyword">if</span> nargin == 0
1150   ln = length(idx);
1151   <span class="keyword">return</span>;
1152   
1153 <span class="keyword">elseif</span> nargin == 1
1154   obj = varargin{1};
1155   <span class="keyword">if</span> isempty(obj) || length(obj) &gt; 1
1156     idx = obj;
1157     tmp = true;
1158     <span class="keyword">return</span>;
1159 
1160   <span class="keyword">elseif</span> ~ishandle(obj)
1161     idx = obj;
1162     tmp = true;
1163     <span class="keyword">return</span>;
1164   
1165   <span class="keyword">end</span>
1166 
1167   handles = guidata(obj);
1168   
1169 <span class="keyword">else</span> <span class="comment">% nargin==2 (listbox callback)</span>
1170   obj     = varargin{1};
1171   handles = guidata(obj);
1172   sf      = get(handles.SearchField, <span class="string">'string'</span>);
1173   <span class="keyword">if</span> isempty(sf)
1174     sf    = <span class="string">'_'</span>;
1175   <span class="keyword">elseif</span> ~strcmp(sf(end), <span class="string">'_'</span>)
1176     sf    = [sf, <span class="string">'_'</span>];
1177   <span class="keyword">end</span>
1178   set(handles.SearchField, <span class="keyword">...</span>
1179     <span class="string">'string'</span>          , sf(1:end-1), <span class="keyword">...</span>
1180     <span class="string">'backgroundcolor'</span> , handles.bgcolor1, <span class="keyword">...</span>
1181     <span class="string">'foregroundcolor'</span> , handles.fgcolor2);
1182   
1183   <span class="keyword">if</span> isempty(tmp) <span class="comment">% persistent not defined</span>
1184     
1185     set(handles.SearchField, <span class="string">'string'</span>, sf);
1186     <span class="keyword">try</span>
1187       <a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>([], [], handles);
1188     <span class="keyword">catch</span>
1189       <a href="#_sub10" class="code" title="subfunction timerErrorFcn(varargin)">timerErrorFcn</a>([], [], handles);
1190     <span class="keyword">end</span>
1191     set(handles.SearchField, <span class="string">'string'</span>, sf(1:end-1));
1192     
1193   <span class="keyword">end</span>
1194   
1195 <span class="keyword">end</span>
1196 
1197 str = get(obj, <span class="string">'string'</span>);
1198 <span class="keyword">if</span> ~isempty(str)
1199   <span class="keyword">if</span> ischar(str)
1200     str = {str};
1201   <span class="keyword">end</span>
1202   val = get(obj, <span class="string">'value'</span>);
1203   <span class="keyword">if</span> strcmp(str{val}, <span class="string">'&lt;show all...&gt;'</span>)
1204     dat = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(idx);
1205     set(obj, <span class="string">'string'</span>, dat(:,2));
1206   <span class="keyword">end</span>
1207   dat = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(idx(val));
1208   
1209   <span class="keyword">switch</span> get(handles.look4MainGUI, <span class="string">'selectiontype'</span>)
1210     
1211     <span class="keyword">case</span> <span class="string">'normal'</span> <span class="comment">% Single-click</span>
1212       <span class="comment">% Get help text</span>
1213       tmp = dat{3};
1214       <span class="keyword">if</span> ~isempty(tmp)
1215         <span class="comment">% Convert to | delimited string</span>
1216         tmp = strrep(tmp, sprintf(<span class="string">'\n'</span>), <span class="string">'|'</span>);
1217       <span class="keyword">end</span>
1218       set(handles.HelpText, <span class="keyword">...</span>
1219         <span class="string">'string'</span>, tmp, <span class="keyword">...</span>
1220         <span class="string">'value'</span> , 1);
1221       set(handles.FileLocation, <span class="keyword">...</span>
1222         <span class="string">'string'</span>, sprintf(<span class="string">'File location: %s'</span>, dat{1}));
1223       
1224     <span class="keyword">case</span> <span class="string">'open'</span>   <span class="comment">% Double-click</span>
1225       <span class="keyword">try</span>
1226         open(dat{1});
1227       <span class="keyword">catch</span>
1228         errordlg(<span class="string">'Error opening file.'</span>);
1229       <span class="keyword">end</span>
1230       
1231   <span class="keyword">end</span>
1232 <span class="keyword">end</span>
1233 
1234 
1235 <span class="comment">%--------------------------------------------------------------------------</span>
1236 <span class="comment">%--------------------------------------------------------------------------</span>
1237 <span class="comment">% GUIuimenuCallback</span>
1238 <span class="comment">%    This is the callback for UI context menu.</span>
1239 <span class="comment">%--------------------------------------------------------------------------</span>
1240 <span class="comment">%--------------------------------------------------------------------------</span>
1241 <a name="_sub14" href="#_subfunctions" class="code">function GUIuimenuCallback(varargin)</a>
1242 
1243 obj     = varargin{1};
1244 handles = guidata(obj);
1245 
1246 str = get(handles.FileLocation, <span class="string">'string'</span>);
1247 <span class="keyword">if</span> strcmp(str, <span class="string">'File location:'</span>)
1248   str = <span class="string">''</span>;
1249 <span class="keyword">else</span>
1250   str = str(16:end);
1251 <span class="keyword">end</span>
1252 <span class="keyword">if</span> ~isempty(str)
1253   <span class="keyword">switch</span> get(obj, <span class="string">'tag'</span>)
1254     <span class="keyword">case</span> <span class="string">'ChangeDirMenu'</span>
1255       pathname = fileparts(str);
1256       cd(pathname);
1257     
1258     <span class="keyword">case</span> <span class="string">'ClipboardMenu'</span>
1259       clipboard(<span class="string">'copy'</span>, str);
1260   <span class="keyword">end</span>
1261 <span class="keyword">end</span>
1262 
1263 
1264 <span class="comment">%--------------------------------------------------------------------------</span>
1265 <span class="comment">%--------------------------------------------------------------------------</span>
1266 <span class="comment">% GUIradioButtonCallback</span>
1267 <span class="comment">%    This is the callback for the search scope radio buttons</span>
1268 <span class="comment">%--------------------------------------------------------------------------</span>
1269 <span class="comment">%--------------------------------------------------------------------------</span>
1270 <a name="_sub15" href="#_subfunctions" class="code">function GUIradioButtonCallback(varargin)</a>
1271 
1272 obj     = varargin{1};
1273 handles = guidata(obj);
1274 
1275 <span class="keyword">if</span> ~get(obj, <span class="string">'value'</span>)
1276 
1277   set([handles.FullSearch, handles.H1Search], <span class="string">'value'</span>, false);
1278   set(obj, <span class="string">'value'</span>, true);
1279 
1280   <span class="comment">% Perform new search</span>
1281   <span class="keyword">try</span>
1282     <a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>(handles.SearchField, [], handles);
1283   <span class="keyword">catch</span>
1284     <a href="#_sub10" class="code" title="subfunction timerErrorFcn(varargin)">timerErrorFcn</a>([], [], handles);
1285   <span class="keyword">end</span>
1286 
1287 <span class="keyword">end</span>
1288 
1289 <span class="comment">% make sure key press mode is active</span>
1290 <a href="#_sub7" class="code" title="subfunction activateKeyPressMode(varargin)">activateKeyPressMode</a>(obj);
1291 
1292 
1293 <span class="comment">%--------------------------------------------------------------------------</span>
1294 <span class="comment">%--------------------------------------------------------------------------</span>
1295 <span class="comment">% setupAutoUpdate</span>
1296 <span class="comment">%--------------------------------------------------------------------------</span>
1297 <span class="comment">%--------------------------------------------------------------------------</span>
1298 <a name="_sub16" href="#_subfunctions" class="code">function setupAutoUpdate</a>
1299 
1300 un = get(0, <span class="string">'units'</span>);
1301 set(0, <span class="string">'units'</span>, <span class="string">'pixels'</span>);
1302 screenSize = get(0, <span class="string">'ScreenSize'</span>);
1303 set(0, <span class="string">'units'</span>, un);
1304 wd = 300;
1305 ht = 160;
1306 
1307 bgcolor1 = [.7, .7, .7];
1308 bgcolor2 = [ 1,  1,  1];
1309 bgcolor3 = [.9, .9, .9];
1310 bgcolor4 = [ 1, .5, .5];
1311 bgcolor5 = [.4, .4,  1];
1312 
1313 fH = figure(<span class="keyword">...</span>
1314   <span class="string">'integerHandle'</span>                   , <span class="string">'off'</span>, <span class="keyword">...</span>
1315   <span class="string">'name'</span>                            , <span class="string">'Auto Update'</span>, <span class="keyword">...</span>
1316   <span class="string">'numbertitle'</span>                     , <span class="string">'off'</span>, <span class="keyword">...</span>
1317   <span class="string">'menubar'</span>                         , <span class="string">'none'</span>, <span class="keyword">...</span>
1318   <span class="string">'units'</span>                           , <span class="string">'pixels'</span>, <span class="keyword">...</span>
1319   <span class="string">'position'</span>                        , [round((screenSize(3)-wd)/2), <span class="keyword">...</span>
1320                                        round((screenSize(4)-ht)/2), <span class="keyword">...</span>
1321                                        wd, ht], <span class="keyword">...</span>
1322   <span class="string">'color'</span>                           , bgcolor1, <span class="keyword">...</span>
1323   <span class="string">'resize'</span>                          , <span class="string">'off'</span>, <span class="keyword">...</span>
1324   <span class="string">'windowstyle'</span>                     , <span class="string">'modal'</span>, <span class="keyword">...</span>
1325   <span class="string">'tag'</span>                             , <span class="string">'autoUpdateMain'</span>, <span class="keyword">...</span>
1326   <span class="string">'defaultaxesunits'</span>                , <span class="string">'pixels'</span>, <span class="keyword">...</span>
1327   <span class="string">'defaultuicontrolbackgroundcolor'</span> , bgcolor3, <span class="keyword">...</span>
1328   <span class="string">'defaultuicontrolunits'</span>           , <span class="string">'pixels'</span>, <span class="keyword">...</span>
1329   <span class="string">'defaultuicontrolfontname'</span>        , <span class="string">'verdana'</span>, <span class="keyword">...</span>
1330   <span class="string">'defaultuicontrolfontsize'</span>        , 8, <span class="keyword">...</span>
1331   <span class="string">'defaultuicontrolfontweight'</span>      , <span class="string">'normal'</span>);
1332 
1333 uicontrol(<span class="keyword">...</span>
1334   <span class="string">'style'</span>              , <span class="string">'text'</span>, <span class="keyword">...</span>
1335   <span class="string">'backgroundcolor'</span>    , bgcolor1, <span class="keyword">...</span>
1336   <span class="string">'position'</span>           , [5, ht-25, wd-5, 20], <span class="keyword">...</span>
1337   <span class="string">'string'</span>             , <span class="string">'Specify database update interval:'</span>, <span class="keyword">...</span>
1338   <span class="string">'horizontalalignment'</span>, <span class="string">'left'</span>);
1339 
1340 uicontrol(<span class="keyword">...</span>
1341   <span class="string">'style'</span>              , <span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1342   <span class="string">'position'</span>           , [105, ht-50, 84, 22], <span class="keyword">...</span>
1343   <span class="string">'string'</span>             , <span class="string">'Weekly'</span>, <span class="keyword">...</span>
1344   <span class="string">'fontweight'</span>         , <span class="string">'bold'</span>, <span class="keyword">...</span>
1345   <span class="string">'enable'</span>             , <span class="string">'inactive'</span>, <span class="keyword">...</span>
1346   <span class="string">'buttondownfcn'</span>      , {@<a href="#_sub18" class="code" title="subfunction autoUpdateBtnCallback(varargin)">autoUpdateBtnCallback</a>, 2}, <span class="keyword">...</span>
1347   <span class="string">'tag'</span>                , <span class="string">'wkT'</span>);
1348 uicontrol(<span class="keyword">...</span>
1349   <span class="string">'style'</span>              , <span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1350   <span class="string">'position'</span>           , [20, ht-47, 84, 19], <span class="keyword">...</span>
1351   <span class="string">'string'</span>             , <span class="string">'Daily'</span>, <span class="keyword">...</span>
1352   <span class="string">'enable'</span>             , <span class="string">'inactive'</span>, <span class="keyword">...</span>
1353   <span class="string">'buttondownfcn'</span>      , {@<a href="#_sub18" class="code" title="subfunction autoUpdateBtnCallback(varargin)">autoUpdateBtnCallback</a>, 1}, <span class="keyword">...</span>
1354   <span class="string">'tag'</span>                , <span class="string">'daT'</span>);
1355 
1356 uicontrol(<span class="keyword">...</span>
1357   <span class="string">'style'</span>              , <span class="string">'frame'</span>, <span class="keyword">...</span>
1358   <span class="string">'enable'</span>             , <span class="string">'inactive'</span>, <span class="keyword">...</span>
1359   <span class="string">'backgroundcolor'</span>    , bgcolor3, <span class="keyword">...</span>
1360   <span class="string">'foregroundcolor'</span>    , bgcolor3, <span class="keyword">...</span>
1361   <span class="string">'position'</span>           , [5, ht-125, wd-10, 77], <span class="keyword">...</span>
1362   <span class="string">'tag'</span>                , <span class="string">'panel1'</span>);
1363 
1364 uicontrol(<span class="keyword">...</span>
1365   <span class="string">'style'</span>              , <span class="string">'text'</span>, <span class="keyword">...</span>
1366   <span class="string">'backgroundcolor'</span>    , bgcolor3, <span class="keyword">...</span>
1367   <span class="string">'position'</span>           , [10, ht-75, 140, 15], <span class="keyword">...</span>
1368   <span class="string">'string'</span>             , <span class="string">'What time? (HH:MM)  '</span>, <span class="keyword">...</span>
1369   <span class="string">'horizontalalignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1370   <span class="string">'tag'</span>                , <span class="string">'DailyQuestionCaption'</span>);
1371 uicontrol(<span class="keyword">...</span>
1372   <span class="string">'style'</span>              , <span class="string">'edit'</span>, <span class="keyword">...</span>
1373   <span class="string">'position'</span>           , [150, ht-75, wd-160, 20], <span class="keyword">...</span>
1374   <span class="string">'backgroundcolor'</span>    , bgcolor4, <span class="keyword">...</span>
1375   <span class="string">'horizontalalignment'</span>, <span class="string">'left'</span>, <span class="keyword">...</span>
1376   <span class="string">'callback'</span>           , @<a href="#_sub19" class="code" title="subfunction autoUpdateEditCallback(varargin)">autoUpdateEditCallback</a>, <span class="keyword">...</span>
1377   <span class="string">'tag'</span>                , <span class="string">'DailyUpdateTimeEdit'</span>);
1378 
1379 uicontrol(<span class="keyword">...</span>
1380   <span class="string">'style'</span>              , <span class="string">'text'</span>, <span class="keyword">...</span>
1381   <span class="string">'backgroundcolor'</span>    , bgcolor3, <span class="keyword">...</span>
1382   <span class="string">'position'</span>           , [10, ht-100, wd-20, 15], <span class="keyword">...</span>
1383   <span class="string">'string'</span>             , <span class="string">'Which day of the week?'</span>, <span class="keyword">...</span>
1384   <span class="string">'horizontalalignment'</span>, <span class="string">'left'</span>, <span class="keyword">...</span>
1385   <span class="string">'visible'</span>            , <span class="string">'on'</span>, <span class="keyword">...</span>
1386   <span class="string">'tag'</span>                , <span class="string">'WeeklyQuestionCaption'</span>);
1387 
1388 days = {<span class="string">'Sun'</span>, <span class="string">'Mon'</span>, <span class="string">'Tue'</span>, <span class="string">'Wed'</span>, <span class="string">'Thu'</span>, <span class="string">'Fri'</span>, <span class="string">'Sat'</span>};
1389 btnW = round((280-2*6)/7);
1390 <span class="keyword">for</span> id = 1:7
1391   uicontrol(<span class="keyword">...</span>
1392     <span class="string">'style'</span>            , <span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1393     <span class="string">'position'</span>         , [10+(id-1)*(btnW+2), ht-120, btnW, 20], <span class="keyword">...</span>
1394     <span class="string">'string'</span>           , days{id}, <span class="keyword">...</span>
1395     <span class="string">'enable'</span>           , <span class="string">'inactive'</span>, <span class="keyword">...</span>
1396     <span class="string">'backgroundcolor'</span>  , bgcolor4, <span class="keyword">...</span>
1397     <span class="string">'buttondownfcn'</span>    , {@<a href="#_sub18" class="code" title="subfunction autoUpdateBtnCallback(varargin)">autoUpdateBtnCallback</a>, 3}, <span class="keyword">...</span>
1398     <span class="string">'tag'</span>              , <span class="string">'dayBtns'</span>);
1399 <span class="keyword">end</span>
1400 
1401 callbackOpt = [4, 5, 0];
1402 stringVals  = {<span class="string">'OK'</span>, <span class="string">'No Update'</span>, <span class="string">'Cancel'</span>};
1403 tagNames    = {<span class="string">'OKBtn'</span>, <span class="string">'NoUpdateBtn'</span>, <span class="string">'CancelBtn'</span>};
1404 btnW        = round((280-5*2)/3);
1405 <span class="keyword">for</span> id = 1:3
1406 uicontrol(<span class="keyword">...</span>
1407   <span class="string">'style'</span>              , <span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1408   <span class="string">'position'</span>           , [10+(id-1)*(btnW+5), ht-150, btnW, 20], <span class="keyword">...</span>
1409   <span class="string">'string'</span>             , stringVals{id}, <span class="keyword">...</span>
1410   <span class="string">'backgroundcolor'</span>    , bgcolor1, <span class="keyword">...</span>
1411   <span class="string">'callback'</span>           , {@<a href="#_sub18" class="code" title="subfunction autoUpdateBtnCallback(varargin)">autoUpdateBtnCallback</a>, callbackOpt(id)}, <span class="keyword">...</span>
1412   <span class="string">'tag'</span>                , tagNames{id});
1413 <span class="keyword">end</span>
1414 
1415 handles             = guihandles(fH);
1416 handles.result.type = <span class="string">'weekly'</span>;
1417 handles.result.val  = {[], <span class="string">''</span>};
1418 handles.bgcolor1    = bgcolor1;
1419 handles.bgcolor2    = bgcolor2;
1420 handles.bgcolor3    = bgcolor3;
1421 handles.bgcolor4    = bgcolor4;
1422 handles.bgcolor5    = bgcolor5;
1423 
1424 <span class="keyword">if</span> exist(<span class="string">'startup.m'</span>, <span class="string">'file'</span>)
1425   fname   = which(<span class="string">'startup.m'</span>);
1426   result  = <a href="#_sub17" class="code" title="subfunction out = modifyStartupFile(fname, result, opt)">modifyStartupFile</a>(fname, [], <span class="string">'retrieve'</span>);
1427   <span class="keyword">if</span> ~isempty(result)
1428     <span class="keyword">switch</span> result.type
1429       <span class="keyword">case</span> <span class="string">'daily'</span>
1430         set(handles.panel1  , <span class="string">'position'</span>, [5, 80, 290, 32]);
1431         
1432         set([handles.wkT, handles.daT], <span class="keyword">...</span>
1433           {<span class="string">'fontweight'</span>, <span class="string">'position'</span>}, <span class="keyword">...</span>
1434           {<span class="string">'normal'</span>, [105, 113, 84, 19]; <span class="keyword">...</span>
1435             <span class="string">'bold'</span>, [20, 110, 84, 22]});
1436         set(handles.WeeklyQuestionCaption, <span class="keyword">...</span>
1437           <span class="string">'visible'</span>         , <span class="string">'off'</span>);
1438         set(handles.dayBtns, <span class="keyword">...</span>
1439           <span class="string">'visible'</span>         , <span class="string">'off'</span>);
1440         set(handles.DailyUpdateTimeEdit, <span class="keyword">...</span>
1441           <span class="string">'visible'</span>         , <span class="string">'on'</span>, <span class="keyword">...</span>
1442           <span class="string">'string'</span>          , sprintf(<span class="string">'%d:%02d'</span>, result.val{1}), <span class="keyword">...</span>
1443           <span class="string">'backgroundcolor'</span> , bgcolor2);
1444         
1445       <span class="keyword">case</span> <span class="string">'weekly'</span>
1446         set(handles.panel1  , <span class="string">'position'</span>, [5, 35, 290, 77]);
1447 
1448         set([handles.wkT, handles.daT], <span class="keyword">...</span>
1449           {<span class="string">'fontweight'</span>, <span class="string">'position'</span>}, <span class="keyword">...</span>
1450           {<span class="string">'bold'</span>, [105, 110, 84, 22]; <span class="keyword">...</span>
1451             <span class="string">'normal'</span>, [20, 113, 84, 19]});
1452         set(handles.DailyUpdateTimeEdit, <span class="keyword">...</span>
1453           <span class="string">'visible'</span>         , <span class="string">'on'</span>, <span class="keyword">...</span>
1454           <span class="string">'string'</span>          , sprintf(<span class="string">'%d:%02d'</span>, result.val{1}), <span class="keyword">...</span>
1455           <span class="string">'backgroundcolor'</span> , bgcolor2);
1456         set(handles.dayBtns, <span class="keyword">...</span>
1457           <span class="string">'visible'</span>         , <span class="string">'on'</span>, <span class="keyword">...</span>
1458           <span class="string">'backgroundcolor'</span> , bgcolor1);
1459         set(handles.WeeklyQuestionCaption, <span class="keyword">...</span>
1460           <span class="string">'visible'</span>         , <span class="string">'on'</span>);
1461         set(findobj(handles.dayBtns, <span class="string">'string'</span>, result.val{2}), <span class="keyword">...</span>
1462           <span class="string">'fontweight'</span>      , <span class="string">'bold'</span>);
1463         
1464     <span class="keyword">end</span>
1465     
1466     handles.result = result;
1467     
1468   <span class="keyword">end</span>
1469 <span class="keyword">end</span>
1470 
1471 guidata(fH, handles);
1472 setappdata(0, <span class="string">'look4_autoUpdateResults'</span>, []);
1473 
1474 <span class="comment">% wait until the dialog box is closed</span>
1475 waitfor(fH);
1476 
1477 result = getappdata(0, <span class="string">'look4_autoUpdateResults'</span>);
1478 rmappdata(0, <span class="string">'look4_autoUpdateResults'</span>);
1479 
1480 <span class="keyword">if</span> isempty(result)
1481   <span class="keyword">return</span>;
1482 <span class="keyword">else</span>
1483   <span class="keyword">if</span> exist(<span class="string">'startup.m'</span>, <span class="string">'file'</span>)
1484     fname = which(<span class="string">'startup.m'</span>);
1485     <a href="#_sub17" class="code" title="subfunction out = modifyStartupFile(fname, result, opt)">modifyStartupFile</a>(fname, result, <span class="string">'modify'</span>);
1486   <span class="keyword">else</span>
1487     <span class="keyword">if</span> strcmp(result.type, <span class="string">'reset'</span>)
1488       <span class="keyword">return</span>;
1489     <span class="keyword">else</span>
1490       p = lower(strread(path, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, pathsep));
1491       [sel, ok] = listdlg(<span class="keyword">...</span>
1492         <span class="string">'promptstring'</span>  , {<span class="string">'STARTUP.m does not exist.'</span>, <span class="keyword">...</span>
1493                            <span class="string">'Select a directory to create STARTUP.m'</span>}, <span class="keyword">...</span>
1494         <span class="string">'selectionmode'</span> , <span class="string">'single'</span>, <span class="keyword">...</span>
1495         <span class="string">'listsize'</span>      , [500 500], <span class="keyword">...</span>
1496         <span class="string">'liststring'</span>    , p);
1497       <span class="keyword">if</span> isequal(ok, 0)
1498         errordlg(<span class="string">'Canceled...'</span>);
1499         <span class="keyword">return</span>;
1500       <span class="keyword">else</span>
1501         fname = fullfile(p{sel}, <span class="string">'startup.m'</span>);
1502       <span class="keyword">end</span>
1503     <span class="keyword">end</span>
1504     <a href="#_sub17" class="code" title="subfunction out = modifyStartupFile(fname, result, opt)">modifyStartupFile</a>(fname, result, <span class="string">'new'</span>);
1505   <span class="keyword">end</span>
1506 <span class="keyword">end</span>
1507 
1508 
1509 <span class="comment">%--------------------------------------------------------------------------</span>
1510 <span class="comment">%--------------------------------------------------------------------------</span>
1511 <span class="comment">% modifyStartupFile</span>
1512 <span class="comment">%    This function creates the startup file. If one already exists, it</span>
1513 <span class="comment">%    modifies it. If it doesn't, it creates one.</span>
1514 <span class="comment">%--------------------------------------------------------------------------</span>
1515 <span class="comment">%--------------------------------------------------------------------------</span>
1516 <a name="_sub17" href="#_subfunctions" class="code">function out = modifyStartupFile(fname, result, opt)</a>
1517 
1518 <span class="keyword">switch</span> opt
1519   <span class="keyword">case</span> <span class="string">'new'</span>
1520     str = {};
1521     
1522   <span class="keyword">case</span> <span class="string">'modify'</span>
1523     str = textread(fname, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, <span class="string">'\n'</span>);
1524     [p, n] = fileparts(fname);
1525     copyfile(fname, fullfile(p, [n <span class="string">'_backup.m'</span>]));
1526     
1527   <span class="keyword">case</span> <span class="string">'retrieve'</span>
1528     str = textread(fname, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, <span class="string">'\n'</span>);
1529     id = strmatch(sprintf(<span class="string">'%s_autoUpdateFcn;'</span>, mfilename), str, <span class="string">'exact'</span>);
1530     <span class="keyword">if</span> isempty(id)
1531       out = [];
1532     <span class="keyword">else</span>
1533       update_fname = fullfile(fileparts(fname), <span class="keyword">...</span>
1534         sprintf(<span class="string">'%s_autoUpdateFcn.m'</span>, mfilename));
1535       <span class="keyword">if</span> exist(update_fname, <span class="string">'file'</span>)
1536         str = textread(update_fname, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, <span class="string">'\n'</span>);
1537         id = strmatch(<span class="string">'% out.'</span>, str);
1538         <span class="keyword">if</span> length(id) == 2
1539           eval(str{id(1)}(3:end));
1540           eval(str{id(2)}(3:end));
1541         <span class="keyword">else</span>
1542           out = [];
1543         <span class="keyword">end</span>
1544       <span class="keyword">else</span>
1545         out = [];
1546       <span class="keyword">end</span>
1547     <span class="keyword">end</span>
1548     <span class="keyword">return</span>;
1549     
1550 <span class="keyword">end</span>
1551 
1552 <span class="comment">% open startup file for writing (create if necessary)</span>
1553 fid = fopen(fname, <span class="string">'w'</span>);
1554 <span class="keyword">if</span> fid &lt; 0
1555   errordlg(<span class="string">'Could not open or create startup.m'</span>);
1556   <span class="keyword">return</span>;
1557 <span class="keyword">end</span>
1558 
1559 <span class="comment">% wrap everything by try ... catch, in case an error occurs. then restore</span>
1560 <span class="comment">% startup file.</span>
1561 <span class="keyword">try</span>
1562 
1563   <span class="comment">% first part of the text</span>
1564   tmp1 = {
1565     sprintf(<span class="string">'function %s_autoUpdateFcn'</span>, mfilename)
1566     <span class="string">''</span>
1567     sprintf(<span class="string">'%% %s_AUTOUPDATEFCN Auto-Update Function for %s'</span>, <span class="keyword">...</span>
1568       upper(mfilename), mfilename)
1569     sprintf(<span class="string">'%%   This is auto generated by %s.'</span>, <span class="keyword">...</span>
1570       upper(mfilename))
1571     sprintf(<span class="string">'%%   Do not modify manually. Use %s(''-autoupdate'') to change.'</span>, <span class="keyword">...</span>
1572       upper(mfilename))
1573     <span class="string">'%'</span>
1574     <span class="string">'%   Jiro Doke'</span>
1575     <span class="string">'%   Mar 2006'</span>
1576     <span class="string">''</span>
1577     <span class="string">'tm = timerfind(''tag'', ''look4AutoUpdateTimer'');'</span>
1578     <span class="string">'if ~isempty(tm)'</span>
1579     <span class="string">'  disp(''deleting old update timer...'');'</span>
1580     <span class="string">'  stop(tm);'</span>
1581     <span class="string">'  delete(tm);'</span>
1582     <span class="string">'end'</span>
1583     <span class="string">''</span>
1584     <span class="string">'c = clock;'</span>
1585     <span class="string">''</span>
1586     };
1587 
1588   tmp3 = {
1589     <span class="string">''</span>
1590     <span class="string">'delayTime = round(delayTime);'</span>
1591     <span class="string">''</span>
1592     <span class="string">'tm = timer(...'</span>
1593     <span class="string">'  ''name''          , sprintf(''Next database update: %s'', ...'</span>
1594     <span class="string">'                            datestr(now+delayTime/86400)), ...'</span>
1595     <span class="string">'  ''tag''           , ''look4AutoUpdateTimer'', ...'</span>
1596     <span class="string">'  ''startdelay''    , delayTime, ...'</span>
1597     <span class="string">'  ''executionmode'' , ''fixedrate'', ...'</span>
1598     <span class="string">'  ''timerfcn''      , {@databaseUpdateTimerFcn, periodVal}, ...'</span>
1599     <span class="string">'  ''period''        , periodVal);'</span>
1600     <span class="string">''</span>
1601     <span class="string">'start(tm);'</span>
1602     <span class="string">''</span>
1603     <span class="string">'%--------------------------------------------------------------------------'</span>
1604     <span class="string">'function databaseUpdateTimerFcn(obj, edata, periodVal)'</span>
1605     <span class="string">''</span>
1606     <span class="string">'set(obj, ''name'', ...'</span>
1607     <span class="string">'  sprintf(''Next database update: %s'', datestr(now+periodVal/86400)));'</span>
1608     sprintf(<span class="string">'%s(''-new'', ''-noverbose'');'</span>, mfilename)
1609     <span class="string">''</span>
1610     };
1611   
1612   <span class="keyword">switch</span> result.type
1613     <span class="keyword">case</span> <span class="string">'daily'</span>
1614       tmp2 = {
1615         sprintf(<span class="string">'c2 = [0, 0, 0, %d, %d, 0];'</span>, result.val{1})
1616         <span class="string">'if datenum([0, 0, 0, c(4:end)]) &gt; datenum(c2)  % go to next day'</span>
1617         <span class="string">'  c3 = datevec(datenum([c(1:3), c2(4:end)])+1);'</span>
1618         <span class="string">'else'</span>
1619         <span class="string">'  c3 = [c(1:3), c2(4:end)];'</span>
1620         <span class="string">'end'</span>
1621         <span class="string">'delayTime = etime(c3, c);'</span>
1622         <span class="string">'periodVal = 24*60*60; % update daily'</span>
1623         };
1624 
1625       tmp4 = {
1626         <span class="string">'% out.type = ''daily'';'</span>
1627         sprintf(<span class="string">'%% out.val = {[%d, %d], ''''};'</span>, result.val{1})
1628         };
1629 
1630     <span class="keyword">case</span> <span class="string">'weekly'</span>
1631       days  = {<span class="string">'sun'</span>, <span class="string">'mon'</span>, <span class="string">'tue'</span>, <span class="string">'wed'</span>, <span class="string">'thu'</span>, <span class="string">'fri'</span>, <span class="string">'sat'</span>};
1632       wd2   = strmatch(lower(result.val{2}), days, <span class="string">'exact'</span>);
1633       tmp2  = {
1634         sprintf(<span class="string">'updateTime = [%d, %d, 0];'</span>, result.val{1})
1635         <span class="string">'wd  = weekday(datenum(c));'</span>
1636         sprintf(<span class="string">'wd2 = %d; %% update weekday: %s'</span>, wd2, result.val{2})
1637         <span class="string">'wd3 = wd2 - wd;'</span>
1638         <span class="string">'if (wd3 == 0 &amp;&amp; ...'</span>
1639         <span class="string">'    datenum([0, 0, 0, c(4:end)]) &gt; datenum([0, 0, 0, updateTime])) || ...'</span>
1640         <span class="string">'    wd3 &lt; 0'</span>
1641         <span class="string">'  wd3 = wd3 + 7;'</span>
1642         <span class="string">'end'</span>
1643         <span class="string">'delayTime = etime(datevec(datenum([c(1:3), updateTime])+wd3), c);'</span>
1644         <span class="string">'periodVal = 7*24*60*60; % update weekly'</span>
1645         };
1646 
1647       tmp4 = {
1648         <span class="string">'% out.type = ''weekly'';'</span>
1649         sprintf(<span class="string">'%% out.val = {[%d, %d], ''%s''};'</span>, result.val{1}, result.val{2})
1650         };
1651 
1652     <span class="keyword">case</span> <span class="string">'reset'</span>
1653 
1654       tmp2 = {};
1655 
1656   <span class="keyword">end</span>
1657 
1658   <span class="comment">% see if the call to the auto update function exists in startup.m</span>
1659   id = strmatch(sprintf(<span class="string">'%s_autoUpdateFcn;'</span>, mfilename), str, <span class="string">'exact'</span>);
1660 
1661   update_fname = fullfile(fileparts(fname), <span class="keyword">...</span>
1662     sprintf(<span class="string">'%s_autoUpdateFcn.m'</span>, mfilename));
1663 
1664   <span class="keyword">if</span> isempty(tmp2) <span class="comment">% reset</span>
1665 
1666     <span class="comment">% delete current update timer</span>
1667     tm = timerfind(<span class="string">'tag'</span>, <span class="string">'look4AutoUpdateTimer'</span>);
1668     <span class="keyword">if</span> ~isempty(tm)
1669       disp(<span class="string">'deleting old update timer...'</span>);
1670       stop(tm);
1671       delete(tm);
1672     <span class="keyword">end</span>
1673 
1674     <span class="comment">% delete call to auto update function</span>
1675     str(id) = <span class="string">''</span>;
1676 
1677     <span class="comment">% if auto update function exists, delete it.</span>
1678     <span class="keyword">if</span> exist(update_fname, <span class="string">'file'</span>)
1679       delete(update_fname);
1680     <span class="keyword">end</span>
1681 
1682   <span class="keyword">else</span>
1683 
1684     <span class="comment">% create auto update function</span>
1685     fid2 = fopen(update_fname, <span class="string">'w'</span>);
1686     tmp = [tmp1; tmp2; tmp3; tmp4];
1687     fprintf(fid2, <span class="string">'%s\n'</span>, tmp{:});
1688     fclose(fid2);
1689 
1690     <span class="comment">% get the name of the auto update function</span>
1691     [fname, fname] = fileparts(update_fname);
1692 
1693     <span class="comment">% flush from memory</span>
1694     clear(fname);
1695 
1696     <span class="comment">% run function</span>
1697     feval(fname);
1698 
1699     <span class="comment">% if the call to the function does not exist in startup.m, create one.</span>
1700     <span class="keyword">if</span> isempty(id)
1701       str = [str; {sprintf(<span class="string">'%s_autoUpdateFcn;'</span>, mfilename)}];
1702     <span class="keyword">end</span>
1703   <span class="keyword">end</span>
1704 
1705   <span class="comment">% create startup.m</span>
1706   fprintf(fid, <span class="string">'%s\n'</span>, str{:});
1707 
1708   fclose(fid);
1709 
1710 <span class="keyword">catch</span>
1711   
1712   <span class="comment">% if an error occurs, try to restore previouse startup files</span>
1713   
1714   fclose all;
1715   
1716   fprintf(<span class="string">'Error occurred. STARTUP files restored\n'</span>);
1717   <span class="keyword">switch</span> opt
1718     <span class="keyword">case</span> <span class="string">'new'</span>
1719       <span class="keyword">try</span>
1720         delete(fname);
1721       <span class="keyword">catch</span>
1722       <span class="keyword">end</span>
1723     <span class="keyword">case</span> <span class="string">'modify'</span>
1724       movefile(fullfile(p, [n <span class="string">'_backup.m'</span>]), fname);
1725   <span class="keyword">end</span>
1726 
1727   rethrow(lasterror);
1728   
1729 <span class="keyword">end</span>
1730 
1731 
1732 <span class="comment">%--------------------------------------------------------------------------</span>
1733 <span class="comment">%--------------------------------------------------------------------------</span>
1734 <span class="comment">% autoUpdateBtnCallback</span>
1735 <span class="comment">%    This is called when one of the buttons in the auto update window is</span>
1736 <span class="comment">%    pressed.</span>
1737 <span class="comment">%--------------------------------------------------------------------------</span>
1738 <span class="comment">%--------------------------------------------------------------------------</span>
1739 <a name="_sub18" href="#_subfunctions" class="code">function autoUpdateBtnCallback(varargin)</a>
1740 
1741 obj = varargin{1};
1742 
1743 handles = guidata(obj);
1744 opt = varargin{3};
1745 <span class="comment">%fprintf('au_btn_%d\n', opt);</span>
1746 <span class="keyword">switch</span> opt
1747   
1748   <span class="keyword">case</span> 0  <span class="comment">% cancel</span>
1749     setappdata(0, <span class="string">'look4_autoUpdateResults'</span>, []);
1750     close(handles.autoUpdateMain);
1751     <span class="keyword">return</span>;
1752     
1753   <span class="keyword">case</span> 1  <span class="comment">% daily tab</span>
1754     handles.result.type = <span class="string">'daily'</span>;
1755     
1756     set(handles.panel1, <span class="string">'position'</span>, [5, 80, 290, 32]);
1757     
1758     set([handles.wkT, handles.daT], <span class="keyword">...</span>
1759       {<span class="string">'fontweight'</span>, <span class="string">'position'</span>}, <span class="keyword">...</span>
1760       {<span class="string">'normal'</span>, [105, 113, 84, 19]; <span class="keyword">...</span>
1761         <span class="string">'bold'</span>, [20, 110, 84, 22]});
1762     set([handles.WeeklyQuestionCaption, <span class="keyword">...</span>
1763       handles.dayBtns], <span class="keyword">...</span>
1764       <span class="string">'visible'</span>   , <span class="string">'off'</span>);
1765     set(handles.DailyUpdateTimeEdit, <span class="keyword">...</span>
1766       <span class="string">'visible'</span>   , <span class="string">'on'</span>);
1767     
1768   <span class="keyword">case</span> 2  <span class="comment">% weekly tab</span>
1769     handles.result.type = <span class="string">'weekly'</span>;
1770 
1771     set(handles.panel1, <span class="string">'position'</span>, [5, 35, 290, 77]);
1772     
1773     set([handles.wkT, handles.daT], <span class="keyword">...</span>
1774       {<span class="string">'fontweight'</span>, <span class="string">'position'</span>}, <span class="keyword">...</span>
1775       {<span class="string">'bold'</span>, [105, 110, 84, 22]; <span class="keyword">...</span>
1776         <span class="string">'normal'</span>, [20, 113, 84, 19]});
1777     set([handles.DailyUpdateTimeEdit, <span class="keyword">...</span>
1778       handles.dayBtns, <span class="keyword">...</span>
1779       handles.WeeklyQuestionCaption], <span class="keyword">...</span>
1780       <span class="string">'visible'</span>   , <span class="string">'on'</span>);
1781     
1782   <span class="keyword">case</span> 3  <span class="comment">% weekday button</span>
1783     handles.result.val{2} = get(obj, <span class="string">'string'</span>);
1784     
1785     set(handles.dayBtns, <span class="keyword">...</span>
1786       <span class="string">'backgroundcolor'</span> , handles.bgcolor1, <span class="keyword">...</span>
1787       <span class="string">'fontweight'</span>      , <span class="string">'normal'</span>);
1788     set(obj, <span class="keyword">...</span>
1789       <span class="string">'fontweight'</span>      , <span class="string">'bold'</span>);
1790     
1791     
1792   <span class="keyword">case</span> 4  <span class="comment">% ok</span>
1793     <span class="comment">% check whether entry is valid</span>
1794     isError = false;
1795     <span class="keyword">if</span> strcmp(handles.result.type, <span class="string">'daily'</span>)
1796       <span class="keyword">if</span> isempty(handles.result.val{1})
1797         isError = true;
1798       <span class="keyword">end</span>
1799     <span class="keyword">else</span>
1800       <span class="keyword">if</span> isempty(handles.result.val{1}) || isempty(handles.result.val{2})
1801         isError = true;
1802       <span class="keyword">end</span>
1803     <span class="keyword">end</span>
1804     
1805     <span class="keyword">if</span> isError
1806       errordlg(<span class="string">'Incomplete...'</span>);
1807     <span class="keyword">else</span>
1808       setappdata(0, <span class="string">'look4_autoUpdateResults'</span>, handles.result);
1809       close(handles.autoUpdateMain);
1810     <span class="keyword">end</span>
1811     <span class="keyword">return</span>;
1812     
1813   <span class="keyword">case</span> 5 <span class="comment">% no update</span>
1814     handles.result.type = <span class="string">'reset'</span>;
1815     handles.result.val  = [];
1816     setappdata(0, <span class="string">'look4_autoUpdateResults'</span>, handles.result);
1817     close(handles.autoUpdateMain);
1818     <span class="keyword">return</span>;
1819     
1820 <span class="keyword">end</span>
1821 
1822 guidata(obj, handles);
1823 
1824 
1825 <span class="comment">%--------------------------------------------------------------------------</span>
1826 <span class="comment">%--------------------------------------------------------------------------</span>
1827 <span class="comment">% autoUpdateEditCallback</span>
1828 <span class="comment">%    This is called when the edit box (time) is entered. It checks the</span>
1829 <span class="comment">%    validity of the entry.</span>
1830 <span class="comment">%--------------------------------------------------------------------------</span>
1831 <span class="comment">%--------------------------------------------------------------------------</span>
1832 <a name="_sub19" href="#_subfunctions" class="code">function autoUpdateEditCallback(varargin)</a>
1833 
1834 <span class="comment">%fprintf('au_edit\n');</span>
1835 
1836 obj = varargin{1};
1837 bgcolor1 = [1,  1,  1];
1838 bgcolor2 = [1, .5, .5];
1839 
1840 handles = guidata(obj);
1841 
1842 str = get(obj, <span class="string">'string'</span>);
1843 
1844 isError = false;
1845 <span class="keyword">try</span>
1846   s = strread(str, <span class="string">'%d'</span>, <span class="string">'delimiter'</span>, <span class="string">':'</span>)';
1847   <span class="keyword">if</span> length(s) == 2
1848     <span class="keyword">if</span> s(1) &lt; 0 || s(1) &gt; 23 || s(2) &lt; 0 || s(2) &gt; 59
1849       isError = true;
1850     <span class="keyword">end</span>
1851   <span class="keyword">else</span>
1852     isError = true;
1853   <span class="keyword">end</span>
1854 <span class="keyword">catch</span>
1855   isError = true;
1856 <span class="keyword">end</span>
1857 
1858 <span class="keyword">if</span> isError
1859   set(obj, <span class="string">'string'</span>, <span class="string">''</span>, <span class="string">'backgroundcolor'</span>, bgcolor2);
1860   handles.result.val{1} = [];
1861 
1862 <span class="keyword">else</span>
1863   set(obj, <span class="string">'string'</span>, sprintf(<span class="string">'%d:%02d'</span>, s), <span class="string">'backgroundcolor'</span>, bgcolor1);
1864   handles.result.val{1} = s;
1865 
1866 <span class="keyword">end</span>
1867 
1868 guidata(obj, handles);</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:32:41 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>