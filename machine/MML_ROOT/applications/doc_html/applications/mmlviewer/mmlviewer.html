<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of mmlviewer</title>
  <meta name="keywords" content="mmlviewer">
  <meta name="description" content="MMLVIEWER M-file for mmlviewer.fig">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">applications</a> &gt; <a href="index.html">mmlviewer</a> &gt; mmlviewer.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for applications/mmlviewer&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>mmlviewer
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>MMLVIEWER M-file for mmlviewer.fig</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = mmlviewer(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> MMLVIEWER M-file for mmlviewer.fig
      MMLVIEWER, by itself, creates a new MMLVIEWER or raises the existing
      singleton*.

      H = MMLVIEWER returns the handle to a new MMLVIEWER or the handle to
      the existing singleton*.

      MMLVIEWER('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in MMLVIEWER.M with the given input arguments.

      MMLVIEWER('Property','Value',...) creates a new MMLVIEWER or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before mmlviewer_OpeningFunction gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to mmlviewer_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one
      instance to run (singleton)&quot;.

 See also: GUIDE, GUIDATA, GUIHANDLES</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function mmlviewer_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = mmlviewer_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function FileMenu_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function OpenMenuItem_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function CloseMenuItem_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function PrintMenuItem_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function ListBox1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function ListBox2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function ListBox3_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function ListBox4_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function ListBox5_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function Graph1_ButtonDown(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function ListBoxData_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function CallNextListBox = ListBoxUpdate(handles, Box0, Box1, Data, j, Data0, Fields0)</a></li><li><a href="#_sub15" class="code">function Data = getandplotdata(handles, Family, Field, SubField, DeviceListTotal)</a></li><li><a href="#_sub16" class="code">function plotdatastruct(handles, d, Field)</a></li><li><a href="#_sub17" class="code">function DataText(handles, Data, iGood)</a></li><li><a href="#_sub18" class="code">function ViewAO_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function ViewAD_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function ViewProduction_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function ViewInjection_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function ViewFile_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function DataTypeDouble_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function DataTypeString_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub25" class="code">function PopPlot_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function PopPlotHoldOn_Callback(hObject, eventdata, handles)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = mmlviewer(varargin)</a>
0002 <span class="comment">% MMLVIEWER M-file for mmlviewer.fig</span>
0003 <span class="comment">%      MMLVIEWER, by itself, creates a new MMLVIEWER or raises the existing</span>
0004 <span class="comment">%      singleton*.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%      H = MMLVIEWER returns the handle to a new MMLVIEWER or the handle to</span>
0007 <span class="comment">%      the existing singleton*.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%      MMLVIEWER('CALLBACK',hObject,eventData,handles,...) calls the local</span>
0010 <span class="comment">%      function named CALLBACK in MMLVIEWER.M with the given input arguments.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%      MMLVIEWER('Property','Value',...) creates a new MMLVIEWER or raises the</span>
0013 <span class="comment">%      existing singleton*.  Starting from the left, property value pairs are</span>
0014 <span class="comment">%      applied to the GUI before mmlviewer_OpeningFunction gets called.  An</span>
0015 <span class="comment">%      unrecognized property name or invalid value makes property application</span>
0016 <span class="comment">%      stop.  All inputs are passed to mmlviewer_OpeningFcn via varargin.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one</span>
0019 <span class="comment">%      instance to run (singleton)&quot;.</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% See also: GUIDE, GUIDATA, GUIHANDLES</span>
0022 
0023 <span class="comment">% Edit the above text to modify the response to help mmlviewer</span>
0024 
0025 <span class="comment">% Last Modified by GUIDE v2.5 01-Nov-2006 11:34:04</span>
0026 
0027 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0028 gui_Singleton = 0;
0029 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0030     <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0031     <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction mmlviewer_OpeningFcn(hObject, eventdata, handles, varargin)">mmlviewer_OpeningFcn</a>, <span class="keyword">...</span>
0032     <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = mmlviewer_OutputFcn(hObject, eventdata, handles)">mmlviewer_OutputFcn</a>, <span class="keyword">...</span>
0033     <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0034     <span class="string">'gui_Callback'</span>,   []);
0035 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0036     gui_State.gui_Callback = str2func(varargin{1});
0037 <span class="keyword">end</span>
0038 
0039 <span class="keyword">if</span> nargout
0040     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0041 <span class="keyword">else</span>
0042     gui_mainfcn(gui_State, varargin{:});
0043 <span class="keyword">end</span>
0044 <span class="comment">% End initialization code - DO NOT EDIT</span>
0045 
0046 
0047 <span class="comment">% --- Executes just before mmlviewer is made visible.</span>
0048 <a name="_sub1" href="#_subfunctions" class="code">function mmlviewer_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0049 
0050 <span class="comment">% Choose default command line output for mmlviewer</span>
0051 handles.output = hObject;
0052 
0053 <span class="comment">% Update handles structure</span>
0054 guidata(hObject, handles);
0055 
0056 <span class="keyword">try</span>
0057     <span class="keyword">if</span> ~(isepics || istango)
0058         set(handles.ListBox5, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0059     <span class="keyword">else</span>
0060         set(handles.ListBox5, <span class="string">'Value'</span>, 1);
0061         set(handles.ListBox5, <span class="string">'String'</span>, <span class="string">''</span>);
0062     <span class="keyword">end</span>
0063     
0064     set(handles.axes1,<span class="string">'XTickLabel'</span>,<span class="string">''</span>);
0065     set(handles.axes1,<span class="string">'YTickLabel'</span>,<span class="string">''</span>);
0066     
0067     <span class="comment">% Fill the list boxes</span>
0068     <a href="#_sub18" class="code" title="subfunction ViewAO_Callback(hObject, eventdata, handles)">ViewAO_Callback</a>(hObject, eventdata, handles);
0069     <span class="comment">%ListBox1_Callback(hObject, eventdata, handles);</span>
0070 
0071 
0072     <span class="comment">% Make Monitor the default, if possible</span>
0073     Fields = get(handles.ListBox2, <span class="string">'String'</span>);
0074     <span class="keyword">if</span> length(Fields) &gt;= 1
0075         k = find(strcmpi(Fields, <span class="string">'Monitor'</span>));
0076         <span class="keyword">if</span> ~isempty(k)
0077             set(handles.ListBox2, <span class="string">'Value'</span>, k);
0078             <a href="#_sub8" class="code" title="subfunction ListBox2_Callback(hObject, eventdata, handles)">ListBox2_Callback</a>(hObject, eventdata, handles);
0079         <span class="keyword">end</span>
0080     <span class="keyword">end</span>
0081 
0082     <span class="comment">% Make TangoNames the default, if possible</span>
0083     Fields = get(handles.ListBox3, <span class="string">'String'</span>);
0084     <span class="keyword">if</span> length(Fields) &gt;= 1
0085         k = find(strcmpi(Fields, <span class="string">'TangoNames'</span>));
0086         <span class="keyword">if</span> isempty(k)
0087             k = find(strcmpi(Fields, <span class="string">'TangoNames'</span>));
0088         <span class="keyword">end</span>    
0089         <span class="keyword">if</span> ~isempty(k)
0090             set(handles.ListBox3, <span class="string">'Value'</span>, k);
0091             <a href="#_sub9" class="code" title="subfunction ListBox3_Callback(hObject, eventdata, handles)">ListBox3_Callback</a>(hObject, eventdata, handles);
0092         <span class="keyword">end</span>
0093     <span class="keyword">end</span>
0094 
0095 <span class="keyword">catch</span>
0096 <span class="keyword">end</span>
0097 
0098 
0099 <span class="comment">% UIWAIT makes mmlviewer wait for user response (see UIRESUME)</span>
0100 <span class="comment">% uiwait(handles.figure1);</span>
0101 
0102 
0103 
0104 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0105 <a name="_sub2" href="#_subfunctions" class="code">function varargout = mmlviewer_OutputFcn(hObject, eventdata, handles)</a>
0106 
0107 <span class="comment">% Get default command line output from handles structure</span>
0108 varargout{1} = handles.output;
0109 
0110 
0111 <span class="comment">% --------------------------------------------------------------------</span>
0112 <a name="_sub3" href="#_subfunctions" class="code">function FileMenu_Callback(hObject, eventdata, handles)</a>
0113 
0114 
0115 
0116 <span class="comment">% --------------------------------------------------------------------</span>
0117 <a name="_sub4" href="#_subfunctions" class="code">function OpenMenuItem_Callback(hObject, eventdata, handles)</a>
0118 [file, Directory] = uigetfile(<span class="string">'*.fig'</span>);
0119 <span class="keyword">if</span> ~isequal(file, 0)
0120     open([Directory file]);
0121 <span class="keyword">end</span>
0122 
0123 
0124 
0125 <span class="comment">% --------------------------------------------------------------------</span>
0126 <a name="_sub5" href="#_subfunctions" class="code">function CloseMenuItem_Callback(hObject, eventdata, handles)</a>
0127 <span class="comment">% selection = questdlg(['Close ' get(handles.figure1,'Name') '?'],...</span>
0128 <span class="comment">%                      ['Close ' get(handles.figure1,'Name') '...'],...</span>
0129 <span class="comment">%                      'Yes','No','Yes');</span>
0130 <span class="comment">% if strcmp(selection,'No')</span>
0131 <span class="comment">%     return;</span>
0132 <span class="comment">% end</span>
0133 delete(handles.figure1)
0134 
0135 
0136 
0137 <span class="comment">% --------------------------------------------------------------------</span>
0138 <a name="_sub6" href="#_subfunctions" class="code">function PrintMenuItem_Callback(hObject, eventdata, handles)</a>
0139 printdlg(handles.figure1)
0140 
0141 
0142 
0143 
0144 <span class="comment">% --- Executes on selection change in ListBox1.</span>
0145 <a name="_sub7" href="#_subfunctions" class="code">function ListBox1_Callback(hObject, eventdata, handles)</a>
0146 
0147 RootStruct = getappdata(handles.figure1, <span class="string">'RootStruct'</span>);
0148 Fields = fieldnames(RootStruct);
0149 j = get(handles.ListBox1, <span class="string">'Value'</span>);
0150 
0151 Data = RootStruct;
0152 
0153 Box0 = handles.ListBox1;
0154 Box1 = handles.ListBox2;
0155 Box2 = handles.ListBox3;
0156 
0157 CallNextListBox = <a href="#_sub14" class="code" title="subfunction CallNextListBox = ListBoxUpdate(handles, Box0, Box1, Data, j, Data0, Fields0)">ListBoxUpdate</a>(handles, Box0, Box1, Data, j);
0158 
0159 <span class="keyword">if</span> CallNextListBox
0160     <a href="#_sub8" class="code" title="subfunction ListBox2_Callback(hObject, eventdata, handles)">ListBox2_Callback</a>(hObject, eventdata, handles);
0161 <span class="keyword">else</span>
0162     set(handles.ListBox3, <span class="string">'Value'</span>, 1);
0163     set(handles.ListBox3, <span class="string">'String'</span>, <span class="string">''</span>);
0164     set(handles.ListBox4, <span class="string">'Value'</span>, 1);
0165     set(handles.ListBox4, <span class="string">'String'</span>, <span class="string">''</span>);
0166 <span class="keyword">end</span>
0167 
0168 
0169 <span class="comment">% --- Executes on selection change in ListBox2.</span>
0170 <a name="_sub8" href="#_subfunctions" class="code">function ListBox2_Callback(hObject, eventdata, handles)</a>
0171 
0172 RootStruct = getappdata(handles.figure1, <span class="string">'RootStruct'</span>);
0173 Fields = fieldnames(RootStruct);
0174 i = get(handles.ListBox1, <span class="string">'Value'</span>);
0175 j = get(handles.ListBox2, <span class="string">'Value'</span>);
0176 Data = RootStruct.(Fields{i});
0177 
0178 Box0 = handles.ListBox2;
0179 Box1 = handles.ListBox3;
0180 Box2 = handles.ListBox4;
0181 
0182 CallNextListBox = <a href="#_sub14" class="code" title="subfunction CallNextListBox = ListBoxUpdate(handles, Box0, Box1, Data, j, Data0, Fields0)">ListBoxUpdate</a>(handles, Box0, Box1, Data, j, RootStruct, Fields{i});
0183 
0184 <span class="keyword">if</span> CallNextListBox
0185     <a href="#_sub9" class="code" title="subfunction ListBox3_Callback(hObject, eventdata, handles)">ListBox3_Callback</a>(hObject, eventdata, handles);
0186 <span class="keyword">else</span>
0187     set(handles.ListBox4, <span class="string">'Value'</span>, 1);
0188     set(handles.ListBox4, <span class="string">'String'</span>, <span class="string">''</span>);
0189 <span class="keyword">end</span>
0190 
0191         
0192 <span class="comment">% --- Executes on selection change in ListBox3.</span>
0193 <a name="_sub9" href="#_subfunctions" class="code">function ListBox3_Callback(hObject, eventdata, handles)</a>
0194 
0195 RootStruct = getappdata(handles.figure1, <span class="string">'RootStruct'</span>);
0196 Fields1 = fieldnames(RootStruct);
0197 Fields2 = get(handles.ListBox2, <span class="string">'String'</span>);
0198 Fields3 = get(handles.ListBox3, <span class="string">'String'</span>);
0199 
0200 i = get(handles.ListBox1, <span class="string">'Value'</span>);
0201 j = get(handles.ListBox2, <span class="string">'Value'</span>);
0202 k = get(handles.ListBox3, <span class="string">'Value'</span>);
0203 
0204 Data = RootStruct.(Fields1{i}).(Fields2{j});
0205 
0206 Box0 = handles.ListBox3;
0207 Box1 = handles.ListBox4;
0208 Box2 = handles.ListBox5;
0209 
0210 CallNextListBox = <a href="#_sub14" class="code" title="subfunction CallNextListBox = ListBoxUpdate(handles, Box0, Box1, Data, j, Data0, Fields0)">ListBoxUpdate</a>(handles, Box0, Box1, Data, k, RootStruct.(Fields1{i}), Fields2{j});
0211 
0212 <span class="keyword">if</span> CallNextListBox
0213     <a href="#_sub10" class="code" title="subfunction ListBox4_Callback(hObject, eventdata, handles)">ListBox4_Callback</a>(hObject, eventdata, handles);
0214 <span class="keyword">end</span>
0215 
0216 
0217 <span class="comment">% --- Executes on selection change in ListBox4.</span>
0218 <a name="_sub10" href="#_subfunctions" class="code">function ListBox4_Callback(hObject, eventdata, handles)</a>
0219 
0220 i = get(handles.ListBox4, <span class="string">'Value'</span>);
0221 Data = get(handles.ListBoxData, <span class="string">'String'</span>);
0222 <span class="comment">%DataFields = fieldnames(Data);</span>
0223 
0224 <span class="keyword">if</span> size(Data, 1) == size(get(handles.ListBox4,<span class="string">'String'</span>),1)
0225     set(handles.ListBoxData, <span class="string">'Value'</span>, i);
0226 <span class="keyword">end</span>
0227 
0228 
0229 
0230 <span class="comment">% --- Executes on selection change in ListBox5.</span>
0231 <a name="_sub11" href="#_subfunctions" class="code">function ListBox5_Callback(hObject, eventdata, handles)</a>
0232 
0233 RootStruct = getappdata(handles.figure1, <span class="string">'RootStruct'</span>);
0234 Fields1 = fieldnames(RootStruct);
0235 Fields2 = get(handles.ListBox2, <span class="string">'String'</span>);
0236 
0237 i = get(handles.ListBox1, <span class="string">'Value'</span>);
0238 j = get(handles.ListBox2, <span class="string">'Value'</span>);
0239 
0240 
0241 EPICSFields = get(handles.ListBox5, <span class="string">'UserData'</span>);
0242 iEPICS = get(handles.ListBox5, <span class="string">'Value'</span>);
0243 setappdata(handles.figure1, <span class="string">'iEPICS'</span>, iEPICS);
0244 <span class="keyword">if</span> ~isempty(EPICSFields)
0245     DotField = EPICSFields{iEPICS};
0246 <span class="keyword">else</span>
0247     DotField = <span class="string">''</span>;
0248 <span class="keyword">end</span>
0249 
0250 
0251 <span class="comment">% Get data</span>
0252 <span class="keyword">try</span>
0253     Data = <a href="#_sub15" class="code" title="subfunction Data = getandplotdata(handles, Family, Field, SubField, DeviceListTotal)">getandplotdata</a>(handles, Fields1{i}, Fields2{j}, DotField, family2dev(Fields1{i}));
0254 <span class="keyword">catch</span>
0255     fprintf(<span class="string">'   Could not get data for the %s family.\n'</span>, Fields1{i});
0256     <span class="keyword">return</span>;
0257 <span class="keyword">end</span>
0258 
0259 
0260 
0261 <span class="comment">% --------------------------------------------------------------------</span>
0262 <a name="_sub12" href="#_subfunctions" class="code">function Graph1_ButtonDown(hObject, eventdata, handles)</a>
0263 CurrentPoint = get(handles.axes1, <span class="string">'CurrentPoint'</span>);
0264 SposMouse = CurrentPoint(1,1);
0265 SposData  = getappdata(handles.figure1, <span class="string">'SPosX'</span>);
0266 
0267 MeritFcn = abs(SposData-SposMouse);
0268 i = find(min(MeritFcn) == MeritFcn);
0269 <span class="keyword">if</span> ~isempty(i)
0270     set(handles.ListBoxData, <span class="string">'value'</span>, i(1));
0271     <a href="#_sub13" class="code" title="subfunction ListBoxData_Callback(hObject, eventdata, handles)">ListBoxData_Callback</a>(hObject, eventdata, handles);
0272 <span class="keyword">end</span>
0273 
0274 
0275 
0276 <span class="comment">% --- Executes on selection change in ListBoxData.</span>
0277 <a name="_sub13" href="#_subfunctions" class="code">function ListBoxData_Callback(hObject, eventdata, handles)</a>
0278 
0279 i = get(handles.ListBoxData, <span class="string">'Value'</span>);
0280 Data = get(handles.ListBox4, <span class="string">'String'</span>);
0281 
0282 <span class="keyword">if</span> isempty(Data)
0283     <span class="comment">% Try list box 3</span>
0284     Data = get(handles.ListBox3, <span class="string">'String'</span>);
0285     <span class="keyword">if</span> size(Data, 1) == size(get(handles.ListBoxData,<span class="string">'String'</span>),1)
0286         set(handles.ListBox3, <span class="string">'Value'</span>, i);
0287     <span class="keyword">end</span>
0288 <span class="keyword">else</span>
0289     <span class="keyword">if</span> size(Data, 1) == size(get(handles.ListBoxData,<span class="string">'String'</span>),1)
0290         set(handles.ListBox4, <span class="string">'Value'</span>, i);
0291     <span class="keyword">end</span>
0292 <span class="keyword">end</span>
0293 
0294 
0295 
0296 <a name="_sub14" href="#_subfunctions" class="code">function CallNextListBox = ListBoxUpdate(handles, Box0, Box1, Data, j, Data0, Fields0)</a>
0297 
0298 set(handles.ListBox5, <span class="string">'Value'</span>, 1);
0299 set(handles.ListBox5, <span class="string">'String'</span>, <span class="string">''</span>);
0300 
0301 CallNextListBox = 0;
0302 
0303 <span class="keyword">if</span> isstruct(Data)
0304     DataFields = fieldnames(Data);
0305     DataField = DataFields{j};
0306     
0307     SubData = Data.(DataField);
0308 
0309     <span class="comment">% Special cases</span>
0310     <span class="keyword">if</span> strcmpi(DataField, <span class="string">'TimeStamp'</span>)
0311         set(Box1, <span class="string">'Value'</span>, 1);
0312         set(Box1, <span class="string">'String'</span>, datestr(Data.(DataField),31));
0313         <span class="keyword">return</span>;
0314     <span class="keyword">elseif</span> strcmpi(DataField, <span class="string">'DataTime'</span>)
0315         set(Box1, <span class="string">'Value'</span>, 1);
0316         set(Box1, <span class="string">'String'</span>, datestr(Data.(DataField),31));
0317         
0318         <span class="comment">% Look to match it with ListBoxData</span>
0319         <span class="keyword">if</span> size(get(Box1, <span class="string">'String'</span>),1) == size(get(handles.ListBoxData, <span class="string">'String'</span>),1)
0320             set(Box1, <span class="string">'Value'</span>, get(handles.ListBoxData,<span class="string">'Value'</span>));
0321         <span class="keyword">end</span>
0322         <span class="keyword">return</span>;
0323     <span class="keyword">elseif</span> strcmpi(DataField, <span class="string">'t'</span>) || strcmpi(DataField, <span class="string">'tout'</span>)
0324         set(Box1, <span class="string">'Value'</span>, 1);
0325         set(Box1, <span class="string">'String'</span>, num2str(Data.(DataField)));
0326         <span class="keyword">return</span>;
0327     <span class="keyword">elseif</span> any(strcmp(DataField, {<span class="string">'Status'</span>,<span class="string">'DeviceList'</span>,<span class="string">'ElementList'</span>,<span class="string">'Position'</span>}))
0328         set(Box1, <span class="string">'Value'</span>, 1);
0329         set(Box1, <span class="string">'String'</span>, num2str(Data.(DataField)));
0330         
0331         <span class="comment">% Look to match it with ListBoxData</span>
0332         <span class="keyword">if</span> size(get(Box1, <span class="string">'String'</span>),1) == size(get(handles.ListBoxData, <span class="string">'String'</span>),1)
0333             set(Box1, <span class="string">'Value'</span>, get(handles.ListBoxData,<span class="string">'Value'</span>));
0334         <span class="keyword">end</span>
0335         <span class="keyword">return</span>;
0336     <span class="keyword">end</span>
0337 
0338     <span class="comment">% Get Box1 string of cell array of strings</span>
0339     <span class="keyword">if</span> isstruct(SubData)
0340         SubDataField = fieldnames(Data.(DataField));
0341     <span class="keyword">else</span>
0342         <span class="keyword">if</span> isnumeric(SubData)
0343             SubDataField = num2str(SubData);
0344         <span class="keyword">elseif</span> ischar(SubData)
0345             SubDataField = SubData;
0346         <span class="keyword">elseif</span> isa(Data,<span class="string">'function_handle'</span>)
0347             SubDataField = func2str(SubData);
0348         <span class="keyword">elseif</span> iscell(SubData)
0349             <span class="keyword">if</span> size(SubData,2) == 1
0350                 SubDataField = SubData(:);
0351             <span class="keyword">else</span>
0352                 SubDataField = <span class="string">'Too big to Display'</span>;
0353             <span class="keyword">end</span>
0354         <span class="keyword">else</span>
0355             SubDataField = <span class="string">''</span>;
0356         <span class="keyword">end</span>
0357     <span class="keyword">end</span>
0358     
0359     <span class="comment">% If the Value of Box1 is getting changed, test for a default</span>
0360     <span class="keyword">if</span> get(Box1, <span class="string">'Value'</span>) &gt; size(SubDataField,1)
0361         set(Box1, <span class="string">'Value'</span>, 1);
0362         
0363         <span class="comment">% Make Monitor the default, if possible</span>
0364         set(Box1, <span class="string">'Value'</span>, 1);
0365         <span class="keyword">if</span> length(SubDataField) &gt;= 1
0366             k = find(strcmpi(SubDataField, <span class="string">'Monitor'</span>));
0367             <span class="keyword">if</span> ~isempty(k)
0368                 set(Box1, <span class="string">'Value'</span>, k);
0369             <span class="keyword">end</span>
0370         <span class="keyword">end</span>
0371 
0372         <span class="comment">% Make TangoNames the default, if possible</span>
0373         <span class="keyword">if</span> length(SubDataField) &gt;= 1
0374             k = find(strcmpi(SubDataField, <span class="string">'TangoNames'</span>));
0375             <span class="keyword">if</span> ~isempty(k)
0376                 set(Box1, <span class="string">'Value'</span>, k);
0377             <span class="keyword">end</span>
0378         <span class="keyword">end</span>
0379     <span class="keyword">end</span>
0380     
0381     <span class="comment">% Set Box1</span>
0382     set(Box1, <span class="string">'String'</span>, SubDataField);
0383     
0384     <span class="comment">% If appropriate, plot the data</span>
0385     <span class="keyword">if</span> strcmp(DataField, <span class="string">'TangoNames'</span>)
0386         <span class="comment">% Change the Value of Box1 to equal ListBoxData</span>
0387         <span class="keyword">if</span> size(get(Box1, <span class="string">'String'</span>),1) == size(get(handles.ListBoxData, <span class="string">'String'</span>),1)
0388             set(Box1, <span class="string">'Value'</span>, get(handles.ListBoxData,<span class="string">'Value'</span>));
0389         <span class="keyword">end</span>
0390         
0391         <span class="comment">% Plot the channels - for control system fields add sub-data fields</span>
0392         DotField = <span class="string">''</span>;
0393         <span class="keyword">if</span> isfield(Data, <span class="string">'Mode'</span>)
0394             Mode = Data.Mode;
0395         <span class="keyword">else</span>
0396             Mode = <span class="string">'Online'</span>;
0397         <span class="keyword">end</span>
0398         <span class="keyword">if</span> isepics &amp;&amp; strcmpi(Mode, <span class="string">'Online'</span>)
0399             <span class="comment">% I should base this list on the type of channel</span>
0400             EPICSFields = {
0401                 <span class="string">'VAL'</span>; <span class="string">'SCAN'</span>;
0402                 <span class="string">'HOPR'</span>; <span class="string">'LOPR'</span>; <span class="string">'PREC'</span>; <span class="string">'DESC'</span>; 
0403                 <span class="string">'HIHI'</span>;<span class="string">'LOLO'</span>;  <span class="string">'HIGH'</span>; <span class="string">'LOW'</span>; <span class="string">'HHSV'</span>; <span class="string">'LLSV'</span>; <span class="string">'HSV'</span>; <span class="string">'LSV'</span>; <span class="string">'HYST'</span>;
0404                 <span class="string">'RVAL'</span>; <span class="string">'ROFF'</span>; <span class="string">'ASLO'</span>; <span class="string">'AOFF'</span>; <span class="string">'LINR'</span>; <span class="string">'ESLO'</span>; <span class="string">'EOFF'</span>; <span class="string">'EGUL'</span>; <span class="string">'EGUF'</span>; 
0405                 <span class="string">'MDEL'</span>; <span class="string">'ADEL'</span>;
0406                 <span class="string">'STAT'</span>; <span class="string">'SEVR'</span>; <span class="string">'ACKS'</span>; <span class="string">'UDF'</span>;
0407                 <span class="string">'PREC'</span>; <span class="string">'ORAW'</span>; <span class="string">'INIT'</span>; 
0408                 <span class="string">'DRVH'</span>; <span class="string">'DRVL'</span>; <span class="string">'RBV'</span>; <span class="string">'EGU'</span>; };
0409             set(handles.ListBox5, <span class="string">'String'</span>,   EPICSFields);
0410             set(handles.ListBox5, <span class="string">'UserData'</span>, EPICSFields);
0411             <span class="comment">%iEPICS = get(handles.ListBox5, 'Value');</span>
0412             iEPICS = getappdata(handles.figure1, <span class="string">'iEPICS'</span>);
0413             <span class="keyword">if</span> isempty(iEPICS)
0414                 iEPICS = 1;
0415             <span class="keyword">end</span>
0416             set(handles.ListBox5, <span class="string">'Value'</span>, iEPICS);
0417             <span class="keyword">if</span> ~isempty(EPICSFields)
0418                 DotField = EPICSFields{iEPICS};
0419             <span class="keyword">end</span>
0420             set(handles.ListBox5, <span class="string">'Visible'</span>, <span class="string">'On'</span>);
0421         <span class="keyword">else</span>
0422             set(handles.ListBox5, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0423         <span class="keyword">end</span>
0424 
0425         <span class="keyword">if</span> isempty(DotField) || strcmpi(DotField, <span class="string">'VAL'</span>)
0426             <span class="comment">% Get data all the data in the family</span>
0427             <span class="keyword">try</span>
0428                 DataNew = <a href="#_sub15" class="code" title="subfunction Data = getandplotdata(handles, Family, Field, SubField, DeviceListTotal)">getandplotdata</a>(handles, Data0.FamilyName, Fields0, <span class="string">''</span>, Data0.DeviceList);
0429             <span class="keyword">catch</span>
0430                 <span class="comment">%fprintf('%s',lasterr);</span>
0431                 fprintf(<span class="string">'   Problem occurred with family %s.\n'</span>, Data0.FamilyName);
0432                 <span class="keyword">return</span>
0433             <span class="keyword">end</span>
0434         <span class="keyword">else</span>
0435             <span class="comment">% Get control system fields fields</span>
0436             <a href="#_sub11" class="code" title="subfunction ListBox5_Callback(hObject, eventdata, handles)">ListBox5_Callback</a>([], [], handles);
0437         <span class="keyword">end</span>
0438 
0439     <span class="keyword">elseif</span> isnumeric(SubData) &amp;&amp; strcmpi(DataField, <span class="string">'Data'</span>)
0440         <a href="#_sub16" class="code" title="subfunction plotdatastruct(handles, d, Field)">plotdatastruct</a>(handles, Data, DataField);
0441 
0442     <span class="keyword">elseif</span> strcmp(DataField, <span class="string">'SpecialFunctionGet'</span>)
0443         <span class="comment">% Plot the channels</span>
0444         Data = <a href="#_sub15" class="code" title="subfunction Data = getandplotdata(handles, Family, Field, SubField, DeviceListTotal)">getandplotdata</a>(handles, Data0.FamilyName, Fields0, <span class="string">''</span>, Data0.DeviceList);
0445                
0446     <span class="keyword">elseif</span> isnumeric(SubData)
0447         
0448         set(handles.ListBox5, <span class="string">'UserData'</span>, <span class="string">''</span>);
0449 
0450         <span class="keyword">if</span> isfield(Data,<span class="string">'FamilyName'</span>) &amp;&amp; isfield(Data, <span class="string">'DeviceList'</span>)
0451             PlotData = Data.(DataField);
0452             s = getspos(Data.FamilyName, Data.DeviceList);
0453             <span class="keyword">if</span> size(SubData,1) == length(s) &amp;&amp; size(SubData,2) == 1
0454                 plot(handles.axes1, s, PlotData, <span class="string">'.-'</span>);
0455                 xlabel(handles.axes1, <span class="string">'Position [meters]'</span>);
0456                 YLabelString = sprintf(<span class="string">'%s.%s'</span>, Data.FamilyName, DataField);
0457                 ylabel(handles.axes1, YLabelString);
0458 
0459                 L = getfamilydata(<span class="string">'Circumference'</span>);
0460                 <span class="keyword">if</span> ~isempty(L)
0461                     a = axis(handles.axes1);
0462                     axis(handles.axes1, [0 L a(3:4)]);
0463                 <span class="keyword">end</span>
0464                 
0465                 <span class="comment">% Set the callback for mouse clicks on the plot</span>
0466                 setappdata(handles.figure1, <span class="string">'SPosX'</span>, s);
0467                 setappdata(handles.figure1, <span class="string">'SPosY'</span>, PlotData);
0468                 set(handles.axes1, <span class="string">'ButtonDownFcn'</span>, <span class="string">'mmlviewer(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
0469                 h = get(handles.axes1, <span class="string">'Children'</span>);
0470                 <span class="keyword">for</span> i = 1:length(h)
0471                     set(h(i) ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'mmlviewer(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
0472                 <span class="keyword">end</span>
0473 
0474                 
0475                 <span class="comment">% Reset DataBox if the new data is a shorter list</span>
0476                 <span class="keyword">if</span> get(handles.ListBoxData, <span class="string">'Value'</span>) &gt; size(SubData,1)
0477                     set(handles.ListBoxData, <span class="string">'Value'</span>, 1);
0478                 <span class="keyword">end</span>
0479 
0480                 DataMat = [];
0481                 <span class="keyword">for</span> ii = 1:size(Data.DeviceList,1)
0482                     DataMat = strvcat(DataMat, sprintf(<span class="string">'%s(%d,%d) = %+.4e'</span>, Data.FamilyName, Data.DeviceList(ii,:), SubData(ii,1)));
0483                 <span class="keyword">end</span>
0484                 <span class="keyword">if</span> isempty(get(handles.ListBoxData,<span class="string">'String'</span>))
0485                     WasEmpty = 1;
0486                 <span class="keyword">else</span>
0487                     WasEmpty = 0;
0488                 <span class="keyword">end</span>
0489                 set(handles.ListBoxData,<span class="string">'String'</span>, DataMat);
0490                 <span class="comment">%set(handles.ListBoxData, 'String', num2str(Data));</span>
0491                 
0492                 <span class="keyword">if</span> WasEmpty
0493                     set(handles.ListBoxData, <span class="string">'Value'</span>, get(Box1, <span class="string">'Value'</span>));
0494                 <span class="keyword">else</span>
0495                     set(Box1, <span class="string">'Value'</span>, get(handles.ListBoxData, <span class="string">'Value'</span>));
0496                 <span class="keyword">end</span>
0497                 set(handles.ListBoxData, <span class="string">'Visible'</span>, <span class="string">'On'</span>);
0498 
0499                 <a href="#_sub17" class="code" title="subfunction DataText(handles, Data, iGood)">DataText</a>(handles, SubData);
0500             <span class="keyword">end</span>
0501         <span class="keyword">end</span>
0502     <span class="keyword">else</span>
0503         CallNextListBox = 1;
0504     <span class="keyword">end</span>
0505 
0506 <span class="keyword">else</span>
0507     <span class="comment">% j points to a list</span>
0508     <span class="comment">% Look to match it with ListBoxData</span>
0509     <span class="keyword">if</span> size(get(Box0, <span class="string">'String'</span>),1) == size(get(handles.ListBoxData, <span class="string">'String'</span>),1)
0510         set(handles.ListBoxData, <span class="string">'Value'</span>, get(Box0,<span class="string">'Value'</span>));
0511     <span class="keyword">end</span>
0512     
0513     <span class="comment">% There shouldn't be anything in the next box at this point</span>
0514     set(Box1, <span class="string">'Value'</span>, 1);
0515     set(Box1, <span class="string">'String'</span>, <span class="string">''</span>);
0516 <span class="keyword">end</span>
0517 
0518 
0519 
0520 <a name="_sub15" href="#_subfunctions" class="code">function Data = getandplotdata(handles, Family, Field, SubField, DeviceListTotal)</a>
0521 
0522 <span class="keyword">if</span> nargin &lt; 4
0523     SubField = <span class="string">''</span>;
0524 <span class="keyword">end</span>
0525 <span class="keyword">if</span> strcmpi(SubField, <span class="string">'VAL'</span>)
0526     SubField = <span class="string">''</span>;
0527 <span class="keyword">end</span>
0528 
0529 <span class="keyword">if</span> nargin &lt; 5
0530     DeviceListTotal = family2dev(Family,0);
0531 <span class="keyword">end</span>
0532 
0533 <span class="comment">% Get data</span>
0534 <span class="keyword">try</span>
0535     <span class="comment">% Good channel device list</span>
0536     DeviceList = family2dev(Family);
0537     iGood = findrowindex(DeviceList, DeviceListTotal);
0538 
0539     <span class="comment">% This only works for scalar data</span>
0540     Data = NaN * ones(size(DeviceListTotal,1),1);
0541 
0542     <span class="keyword">if</span> isempty(SubField)
0543         <span class="comment">% Get by family</span>
0544         <span class="keyword">if</span> ~isempty(iGood)
0545             DataGood = getpv(Family, Field, DeviceList);
0546             Data(iGood,:) = DataGood;
0547             DataCell = mat2cell(num2str(Data), ones(1,size(Data,1)));
0548 
0549             <span class="keyword">if</span> strcmpi(get(handles.DataTypeString, <span class="string">'Checked'</span>) , <span class="string">'On'</span>)
0550                 <span class="comment">% Put strings in the list box</span>
0551                 DataGoodString = getpv(Family, Field, DeviceList, <span class="string">'String'</span>);
0552                 DataCell(iGood) = mat2cell(DataGoodString, ones(1,size(DataGoodString,1)));
0553             <span class="keyword">end</span>
0554        
0555         <span class="keyword">end</span>
0556         [Units, UnitsString] = getunits(Family, Field);
0557     <span class="keyword">else</span>
0558         <span class="comment">% Get by [channel.subfield]</span>
0559         <span class="keyword">if</span> ~isempty(iGood)
0560             ChanNames = family2channel(Family, Field, DeviceList);
0561             <span class="comment">%ChanNames = get(handles.ListBox4, 'String');</span>
0562             ChanNames = strcat(ChanNames, [<span class="string">'.'</span>,SubField]);
0563 
0564             <span class="comment">% Try 1 channel name first, so the error condition does not take so long</span>
0565             <span class="keyword">try</span>
0566                 DataGood = getpv(deblank(ChanNames(1,:)));
0567 
0568                 DataGood = getpv(ChanNames);
0569                 Data(iGood,:) = DataGood;
0570                 DataCell = mat2cell(num2str(Data), ones(1,size(Data,1)));
0571 
0572                 <span class="keyword">if</span> strcmpi(get(handles.DataTypeString, <span class="string">'Checked'</span>) , <span class="string">'On'</span>)
0573                     <span class="comment">% Put strings in the list box</span>
0574                     DataGoodString = getpv(ChanNames, <span class="string">'String'</span>);
0575                     DataCell(iGood) = mat2cell(DataGoodString, ones(1,size(DataGoodString,1)));
0576                 <span class="keyword">end</span>
0577             <span class="keyword">catch</span>
0578                 Data = NaN * ones(size(DeviceListTotal,1),1);
0579                 <span class="comment">%DataCell = mat2cell(num2str(Data), ones(1,size(Data,1)));</span>
0580                 <span class="keyword">for</span> i = 1:size(Data)
0581                     DataCell{i,1} = <span class="string">'No Data'</span>;
0582                 <span class="keyword">end</span>
0583             <span class="keyword">end</span>
0584 
0585         <span class="keyword">end</span>
0586         UnitsString = <span class="string">''</span>;
0587     <span class="keyword">end</span>
0588 <span class="keyword">catch</span>
0589     Data = NaN * ones(size(DeviceListTotal,1),1);
0590     <span class="comment">%DataCell = mat2cell(num2str(Data), ones(1,size(Data,1)));</span>
0591     <span class="keyword">for</span> i = 1:size(Data)
0592         DataCell{i,1} = <span class="string">'No Data'</span>;
0593     <span class="keyword">end</span>
0594 <span class="keyword">end</span>
0595 
0596 
0597 <span class="comment">% Plot</span>
0598 <span class="keyword">try</span>
0599     s = getspos(Family, DeviceListTotal);
0600     plot(handles.axes1, s, Data, <span class="string">'.-'</span>);
0601     xlabel(handles.axes1, <span class="string">'Position [meters]'</span>);
0602 
0603     YLabelString = sprintf(<span class="string">'%s.%s'</span>, Family, Field);
0604     <span class="keyword">if</span> ~isempty(SubField)
0605         YLabelString = sprintf(<span class="string">'%s.%s'</span>, YLabelString, SubField);
0606     <span class="keyword">end</span>
0607     <span class="keyword">if</span> ~isempty(UnitsString)
0608         YLabelString = sprintf(<span class="string">'%s [%s]'</span>, YLabelString, UnitsString);
0609     <span class="keyword">end</span>        
0610 
0611     ylabel(handles.axes1, YLabelString);
0612 
0613     L = getfamilydata(<span class="string">'Circumference'</span>);
0614     <span class="keyword">if</span> ~isempty(L)
0615         a = axis(handles.axes1);
0616         axis(handles.axes1, [0 L a(3:4)]);
0617     <span class="keyword">end</span>
0618 
0619     <span class="comment">% Set the callback for mouse clicks on the plot</span>
0620     setappdata(handles.figure1, <span class="string">'SPosX'</span>, s);
0621     setappdata(handles.figure1, <span class="string">'SPosY'</span>, Data);
0622     set(handles.axes1, <span class="string">'ButtonDownFcn'</span>, <span class="string">'mmlviewer(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
0623     h = get(handles.axes1, <span class="string">'Children'</span>);
0624     <span class="keyword">for</span> i = 1:length(h)
0625         set(h(i) ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'mmlviewer(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
0626     <span class="keyword">end</span>
0627     
0628     <span class="comment">% Data list box</span>
0629 
0630     <span class="comment">% Change the value in the data list box before setting the new string</span>
0631     DataValue = get(handles.ListBoxData, <span class="string">'Value'</span>);
0632     <span class="keyword">if</span> DataValue &gt; size(Data,1)
0633         set(handles.ListBoxData, <span class="string">'Value'</span>, 1);
0634         DataValue = 1;
0635     <span class="keyword">end</span>
0636 
0637     <span class="comment">%DataMat = [];</span>
0638     <span class="comment">%for ii = 1:size(DeviceListTotal,1)</span>
0639     <span class="comment">%    DataMat = strvcat(DataMat, sprintf('%s(%d,%d) = %+.4e', Family, DeviceListTotal(ii,:), Data(ii,1)));</span>
0640     <span class="comment">%end</span>
0641     <span class="comment">%set(handles.ListBoxData,'String', DataMat);</span>
0642     <span class="comment">%set(handles.ListBoxData, 'String', num2str(Data));</span>
0643 
0644     <span class="keyword">for</span> ii = 1:size(DeviceListTotal,1)
0645         DataCell{ii} = sprintf(<span class="string">'%s(%d,%d) = %s'</span>, Family, DeviceListTotal(ii,:), DataCell{ii});
0646     <span class="keyword">end</span>
0647     set(handles.ListBoxData,<span class="string">'String'</span>, DataCell);
0648     set(handles.ListBoxData, <span class="string">'Visible'</span>, <span class="string">'On'</span>);
0649 
0650     <a href="#_sub17" class="code" title="subfunction DataText(handles, Data, iGood)">DataText</a>(handles, Data, iGood);
0651 
0652 <span class="keyword">catch</span>
0653     set(handles.ListBoxData, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0654     set(handles.DataText,    <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0655     error(<span class="string">'An error occurred in getandplotdata the %s family'</span>, Family);
0656 <span class="keyword">end</span>
0657 
0658 
0659 
0660 <a name="_sub16" href="#_subfunctions" class="code">function plotdatastruct(handles, d, Field)</a>
0661 
0662 s = getspos(d.FamilyName, d.DeviceList);
0663 plot(handles.axes1, s, d.(Field), <span class="string">'.-'</span>);
0664 xlabel(handles.axes1, <span class="string">'Position [meters]'</span>);
0665 ylabel(handles.axes1, sprintf(<span class="string">'%s.%s [%s]'</span>, d.FamilyName, d.Field, d.UnitsString));
0666 
0667 L = getfamilydata(<span class="string">'Circumference'</span>);
0668 <span class="keyword">if</span> ~isempty(L)
0669     a = axis(handles.axes1);
0670     axis(handles.axes1, [0 L a(3:4)]);
0671 <span class="keyword">end</span>
0672 
0673 <span class="comment">% Set the callback for mouse clicks on the plot</span>
0674 setappdata(handles.figure1, <span class="string">'SPosX'</span>, s);
0675 setappdata(handles.figure1, <span class="string">'SPosY'</span>, d.(Field));
0676 set(handles.axes1, <span class="string">'ButtonDownFcn'</span>, <span class="string">'mmlviewer(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
0677 h = get(handles.axes1, <span class="string">'Children'</span>);
0678 <span class="keyword">for</span> i = 1:length(h)
0679     set(h(i) ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'mmlviewer(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
0680 <span class="keyword">end</span>
0681 
0682 <span class="comment">% Data list box</span>
0683 <span class="keyword">if</span> get(handles.ListBoxData, <span class="string">'Value'</span>) &gt; size(d.Data,1)
0684     set(handles.ListBoxData, <span class="string">'Value'</span>, 1);
0685 <span class="keyword">end</span>
0686 
0687 DataMat = [];
0688 <span class="keyword">for</span> ii = 1:size(d.DeviceList,1)
0689     DataMat = strvcat(DataMat, sprintf(<span class="string">'%s(%d,%d) = %+.4e'</span>, d.FamilyName, d.DeviceList(ii,:), d.Data(ii,1)));
0690 <span class="keyword">end</span>
0691 set(handles.ListBoxData,<span class="string">'String'</span>, DataMat);
0692 <span class="comment">%set(handles.ListBoxData, 'String', num2str(Data));</span>
0693 
0694 set(handles.ListBoxData, <span class="string">'Visible'</span>, <span class="string">'On'</span>);
0695 
0696 <a href="#_sub17" class="code" title="subfunction DataText(handles, Data, iGood)">DataText</a>(handles, d.Data);
0697 
0698 
0699 
0700 <a name="_sub17" href="#_subfunctions" class="code">function DataText(handles, Data, iGood)</a>
0701 
0702 <span class="keyword">if</span> nargin &lt; 3
0703     iGood = 1:size(Data,1);
0704 <span class="keyword">end</span>
0705 
0706 <span class="keyword">if</span> isempty(iGood)
0707     set(handles.DataText, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0708 <span class="keyword">else</span>
0709     MeanText = sprintf(<span class="string">'Mean = %+9.6e'</span>, mean(Data(iGood)));
0710     RMSText  = sprintf(<span class="string">'RMS  = %+9.6e'</span>, (length(Data(iGood))-1)*std(Data(iGood))/length(Data(iGood)));
0711     MaxText  = sprintf(<span class="string">'Max   = %+9.6e'</span>,  max(Data(iGood)));
0712     MinText  = sprintf(<span class="string">'Min    = %+9.6e'</span>,  min(Data(iGood)));
0713     set(handles.DataText, <span class="string">'String'</span>, {MeanText; RMSText; MaxText; MinText});
0714     set(handles.DataText, <span class="string">'FontSize'</span>, 8);
0715     <span class="keyword">if</span> isnan(mean(Data(iGood)))
0716         set(handles.DataText, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0717     <span class="keyword">else</span>
0718         set(handles.DataText, <span class="string">'Visible'</span>, <span class="string">'On'</span>);
0719     <span class="keyword">end</span>
0720 <span class="keyword">end</span>
0721 
0722 
0723 <span class="comment">% --------------------------------------------------------------------</span>
0724 <a name="_sub18" href="#_subfunctions" class="code">function ViewAO_Callback(hObject, eventdata, handles)</a>
0725 
0726 [Fields, RootStruct] = getfamilylist(<span class="string">'Cell'</span>);
0727 setappdata(handles.figure1, <span class="string">'RootStruct'</span>, RootStruct);
0728 
0729 set(handles.ListBox1, <span class="string">'Value'</span>, 1);
0730 set(handles.ListBox1, <span class="string">'String'</span>, Fields);
0731 <a href="#_sub7" class="code" title="subfunction ListBox1_Callback(hObject, eventdata, handles)">ListBox1_Callback</a>(hObject, eventdata, handles);
0732 
0733 set(handles.ViewAO,         <span class="string">'Checked'</span> , <span class="string">'On'</span>);
0734 set(handles.ViewAD,         <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0735 set(handles.ViewProduction, <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0736 set(handles.ViewInjection,  <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0737 set(handles.ViewFile,       <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0738 
0739 
0740 <span class="comment">% --------------------------------------------------------------------</span>
0741 <a name="_sub19" href="#_subfunctions" class="code">function ViewAD_Callback(hObject, eventdata, handles)</a>
0742 
0743 RootStruct = getad;
0744 Fields = fieldnames(RootStruct);
0745 setappdata(handles.figure1, <span class="string">'RootStruct'</span>, RootStruct);
0746 
0747 set(handles.ListBox1, <span class="string">'Value'</span>, 1);
0748 set(handles.ListBox1, <span class="string">'String'</span>, Fields);
0749 <a href="#_sub7" class="code" title="subfunction ListBox1_Callback(hObject, eventdata, handles)">ListBox1_Callback</a>(hObject, eventdata, handles);
0750 
0751 set(handles.ViewAO,         <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0752 set(handles.ViewAD,         <span class="string">'Checked'</span> , <span class="string">'On'</span>);
0753 set(handles.ViewProduction, <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0754 set(handles.ViewInjection,  <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0755 set(handles.ViewFile,       <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0756 
0757 
0758 <span class="comment">% --------------------------------------------------------------------</span>
0759 <a name="_sub20" href="#_subfunctions" class="code">function ViewProduction_Callback(hObject, eventdata, handles)</a>
0760 
0761 [RootStruct, Monitor, FileName] = getproductionlattice;
0762 Fields = fieldnames(RootStruct);
0763 setappdata(handles.figure1, <span class="string">'RootStruct'</span>, RootStruct);
0764 
0765 set(handles.ListBox1, <span class="string">'Value'</span>, 1);
0766 set(handles.ListBox1, <span class="string">'String'</span>, Fields);
0767 <a href="#_sub7" class="code" title="subfunction ListBox1_Callback(hObject, eventdata, handles)">ListBox1_Callback</a>(hObject, eventdata, handles);
0768 
0769 set(handles.ViewAO,         <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0770 set(handles.ViewAD,         <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0771 set(handles.ViewProduction, <span class="string">'Checked'</span> , <span class="string">'On'</span>);
0772 set(handles.ViewInjection,  <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0773 set(handles.ViewFile,       <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0774 
0775 
0776 <span class="comment">% --------------------------------------------------------------------</span>
0777 <a name="_sub21" href="#_subfunctions" class="code">function ViewInjection_Callback(hObject, eventdata, handles)</a>
0778 
0779 [RootStruct, Monitor, FileName] = getinjectionlattice;
0780 Fields = fieldnames(RootStruct);
0781 setappdata(handles.figure1, <span class="string">'RootStruct'</span>, RootStruct);
0782 
0783 set(handles.ListBox1, <span class="string">'Value'</span>, 1);
0784 set(handles.ListBox1, <span class="string">'String'</span>, Fields);
0785 <a href="#_sub7" class="code" title="subfunction ListBox1_Callback(hObject, eventdata, handles)">ListBox1_Callback</a>(hObject, eventdata, handles);
0786 
0787 set(handles.ViewAO,         <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0788 set(handles.ViewAD,         <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0789 set(handles.ViewProduction, <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0790 set(handles.ViewInjection,  <span class="string">'Checked'</span> , <span class="string">'On'</span>);
0791 set(handles.ViewFile,       <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0792 
0793 
0794 <span class="comment">% --------------------------------------------------------------------</span>
0795 <a name="_sub22" href="#_subfunctions" class="code">function ViewFile_Callback(hObject, eventdata, handles)</a>
0796 
0797 [RootStruct, Monitor, FileName] = getlattice;
0798 <span class="keyword">if</span> FileName == 0
0799     <span class="keyword">return</span>;
0800 <span class="keyword">end</span>
0801 Fields = fieldnames(RootStruct);
0802 setappdata(handles.figure1, <span class="string">'RootStruct'</span>, RootStruct);
0803 
0804 set(handles.ListBox1, <span class="string">'Value'</span>, 1);
0805 set(handles.ListBox1, <span class="string">'String'</span>, Fields);
0806 <a href="#_sub7" class="code" title="subfunction ListBox1_Callback(hObject, eventdata, handles)">ListBox1_Callback</a>(hObject, eventdata, handles);
0807 
0808 set(handles.ViewAO,         <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0809 set(handles.ViewAD,         <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0810 set(handles.ViewProduction, <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0811 set(handles.ViewInjection,  <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0812 set(handles.ViewFile,       <span class="string">'Checked'</span> , <span class="string">'On'</span>);
0813 
0814 
0815 <span class="comment">% --------------------------------------------------------------------</span>
0816 <a name="_sub23" href="#_subfunctions" class="code">function DataTypeDouble_Callback(hObject, eventdata, handles)</a>
0817 set(handles.DataTypeDouble, <span class="string">'Checked'</span> , <span class="string">'On'</span>);
0818 set(handles.DataTypeString, <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0819 <a href="#_sub7" class="code" title="subfunction ListBox1_Callback(hObject, eventdata, handles)">ListBox1_Callback</a>(hObject, eventdata, handles);
0820 
0821 <span class="comment">% --------------------------------------------------------------------</span>
0822 <a name="_sub24" href="#_subfunctions" class="code">function DataTypeString_Callback(hObject, eventdata, handles)</a>
0823 set(handles.DataTypeDouble, <span class="string">'Checked'</span> , <span class="string">'Off'</span>);
0824 set(handles.DataTypeString, <span class="string">'Checked'</span> , <span class="string">'On'</span>);
0825 <a href="#_sub7" class="code" title="subfunction ListBox1_Callback(hObject, eventdata, handles)">ListBox1_Callback</a>(hObject, eventdata, handles);
0826 
0827 
0828 <span class="comment">% --------------------------------------------------------------------</span>
0829 <a name="_sub25" href="#_subfunctions" class="code">function PopPlot_Callback(hObject, eventdata, handles)</a>
0830 a = figure;
0831 b = copyobj(handles.axes1, a); 
0832 set(b, <span class="string">'Position'</span>, [0.1300    0.1100    0.7750    0.8150]);
0833 set(b, <span class="string">'ButtonDownFcn'</span>,<span class="string">''</span>);
0834 set(b, <span class="string">'XAxisLocation'</span>,<span class="string">'Bottom'</span>);
0835 
0836 
0837 <span class="comment">% --------------------------------------------------------------------</span>
0838 <a name="_sub26" href="#_subfunctions" class="code">function PopPlotHoldOn_Callback(hObject, eventdata, handles)</a>
0839 
0840 <span class="comment">% Find the figure that is not the current figure</span>
0841 h = get(0,<span class="string">'children'</span>);
0842 
0843 a = [];
0844 <span class="keyword">for</span> i = 1:length(h)
0845     <span class="keyword">if</span> h(i)~=handles.figure1 &amp;&amp; strcmpi(get(h(i),<span class="string">'Type'</span>),<span class="string">'figure'</span>) &amp;&amp; strcmpi(get(h(i),<span class="string">'Visible'</span>),<span class="string">'On'</span>)
0846         a = h(i);
0847         <span class="keyword">break</span>;
0848     <span class="keyword">end</span>
0849 <span class="keyword">end</span>
0850 <span class="keyword">if</span> isempty(a)
0851     <a href="#_sub25" class="code" title="subfunction PopPlot_Callback(hObject, eventdata, handles)">PopPlot_Callback</a>(hObject, eventdata, handles);
0852     <span class="keyword">return</span>;
0853 <span class="keyword">end</span>
0854 
0855 x = getappdata(handles.figure1, <span class="string">'SPosX'</span>);
0856 y = getappdata(handles.figure1, <span class="string">'SPosY'</span>);
0857 
0858 figure(a);
0859 LegendHandle = legend; <span class="comment">%findobj(a, 'tag', 'legend');</span>
0860 YLabelOld = get(get(gca,<span class="string">'ylabel'</span>),<span class="string">'String'</span>);
0861 YLabelNew = get(get(handles.axes1,<span class="string">'ylabel'</span>),<span class="string">'String'</span>);
0862 
0863 hold on;
0864 Color = nxtcolor;
0865 plot(x, y, <span class="string">'.-'</span>, <span class="string">'Color'</span>, Color);
0866 hold off
0867 
0868 axis tight;
0869 L = getfamilydata(<span class="string">'Circumference'</span>);
0870 <span class="keyword">if</span> ~isempty(L)
0871     a = axis(handles.axes1);
0872     axis(handles.axes1, [0 L a(3:4)]);
0873 <span class="keyword">end</span>
0874 
0875 <span class="keyword">if</span> isempty(LegendHandle)
0876     <span class="keyword">if</span> isempty(YLabelOld)
0877         LegendCell = {};
0878     <span class="keyword">else</span>
0879         LegendCell = {YLabelOld};
0880     <span class="keyword">end</span>
0881 <span class="keyword">else</span>
0882     LegendHandle = LegendHandle(1);
0883     LegendCell = get(LegendHandle, <span class="string">'String'</span>);
0884     <span class="keyword">if</span> ~iscell(LegendCell)
0885         LegendCell = {LegendCell};
0886     <span class="keyword">end</span>
0887 <span class="keyword">end</span>
0888 LegendCell(end+1) = {YLabelNew};
0889 legend(LegendCell);
0890 
0891 set(get(gca,<span class="string">'ylabel'</span>),<span class="string">'String'</span>,<span class="string">''</span>);</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:32:41 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>