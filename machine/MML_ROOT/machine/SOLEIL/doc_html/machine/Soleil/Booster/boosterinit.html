<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of boosterinit</title>
  <meta name="keywords" content="boosterinit">
  <meta name="description" content="BOOSTERINIT - Initializes parameters for SOLEIL Booster control in MATLAB">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="index.html">Booster</a> &gt; boosterinit.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/Booster&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>boosterinit
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>BOOSTERINIT - Initializes parameters for SOLEIL Booster control in MATLAB</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function boosterinit(OperationalMode) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">BOOSTERINIT - Initializes parameters for SOLEIL Booster control in MATLAB

 Written by Laurent S. Nadolski, Synchrotron SOLEIL
 
==========================
 Accelerator Family Fields
==========================
 FamilyName            BPMx, HCOR, etc
 CommonNames           Shortcut name for each element
 DeviceList            [Sector, Number]
 ElementList           number in list
 Position              m, if thick, it is not the magnet center

 MONITOR FIELD
 Mode                  online/manual/special/simulator
 TangoNames            Device Tango Names
 Units                 Physics or HW
 HW2PhysicsFcn         function handle used to convert from hardware to physics units ==&gt; inline will not compile, see below
 HW2PhysicsParams      parameters used for conversion function
 Physics2HWFcn         function handle used to convert from physics to hardware units
 Physics2HWParams      parameters used for conversion function
 HWUnits               units for Hardware 'A';
 PhysicsUnits          units for physics 'Rad';
 Handles               monitor handle

 SETPOINT FIELDS
 Mode                  online/manual/special/simulator
 TangoNames            Devices tango names
 Units                 hardware or physics
 HW2PhysicsFcn         function handle used to convert from hardware to physics units
 HW2PhysicsParams      parameters used for conversion function
 Physics2HWFcn         function handle used to convert from physics to hardware units
 Physics2HWParams      parameters used for conversion function
 HWUnits               units for Hardware 'A';
 PhysicsUnits          units for physics 'Rad';
 Range                 minsetpoint, maxsetpoint;
 Tolerance             setpoint-monitor
 Handles               setpoint handle

=============================================
 Accelerator Toolbox Simulation Fields
=============================================
 ATType                Quad, Sext, etc
 ATIndex               index in THERING
 ATParameterGroup      parameter group

============
 Family List
============
    BPMx
    BPMz
    HCOR
    VCOR
    BEND
    QF and QD
    SF and SD
    RF
    TUNE
    DCCT
    Machine Parameters</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="setoperationalmode.html" class="code" title="function setoperationalmode(ModeNumber)">setoperationalmode</a>	SETOPERATIONALMODE - Switches between the various operational modes</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>	AOINIT - Initialization function for the Matlab Middle Layer (MML)</li><li><a href="boostersetup.html" class="code" title="function Boostersetup">boostersetup</a>	BoosterSETUP - GUI for doing Booster setup</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function boosterinit(OperationalMode)</a>
0002 <span class="comment">%BOOSTERINIT - Initializes parameters for SOLEIL Booster control in MATLAB</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Written by Laurent S. Nadolski, Synchrotron SOLEIL</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%==========================</span>
0007 <span class="comment">% Accelerator Family Fields</span>
0008 <span class="comment">%==========================</span>
0009 <span class="comment">% FamilyName            BPMx, HCOR, etc</span>
0010 <span class="comment">% CommonNames           Shortcut name for each element</span>
0011 <span class="comment">% DeviceList            [Sector, Number]</span>
0012 <span class="comment">% ElementList           number in list</span>
0013 <span class="comment">% Position              m, if thick, it is not the magnet center</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% MONITOR FIELD</span>
0016 <span class="comment">% Mode                  online/manual/special/simulator</span>
0017 <span class="comment">% TangoNames            Device Tango Names</span>
0018 <span class="comment">% Units                 Physics or HW</span>
0019 <span class="comment">% HW2PhysicsFcn         function handle used to convert from hardware to physics units ==&gt; inline will not compile, see below</span>
0020 <span class="comment">% HW2PhysicsParams      parameters used for conversion function</span>
0021 <span class="comment">% Physics2HWFcn         function handle used to convert from physics to hardware units</span>
0022 <span class="comment">% Physics2HWParams      parameters used for conversion function</span>
0023 <span class="comment">% HWUnits               units for Hardware 'A';</span>
0024 <span class="comment">% PhysicsUnits          units for physics 'Rad';</span>
0025 <span class="comment">% Handles               monitor handle</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% SETPOINT FIELDS</span>
0028 <span class="comment">% Mode                  online/manual/special/simulator</span>
0029 <span class="comment">% TangoNames            Devices tango names</span>
0030 <span class="comment">% Units                 hardware or physics</span>
0031 <span class="comment">% HW2PhysicsFcn         function handle used to convert from hardware to physics units</span>
0032 <span class="comment">% HW2PhysicsParams      parameters used for conversion function</span>
0033 <span class="comment">% Physics2HWFcn         function handle used to convert from physics to hardware units</span>
0034 <span class="comment">% Physics2HWParams      parameters used for conversion function</span>
0035 <span class="comment">% HWUnits               units for Hardware 'A';</span>
0036 <span class="comment">% PhysicsUnits          units for physics 'Rad';</span>
0037 <span class="comment">% Range                 minsetpoint, maxsetpoint;</span>
0038 <span class="comment">% Tolerance             setpoint-monitor</span>
0039 <span class="comment">% Handles               setpoint handle</span>
0040 <span class="comment">%</span>
0041 <span class="comment">%=============================================</span>
0042 <span class="comment">% Accelerator Toolbox Simulation Fields</span>
0043 <span class="comment">%=============================================</span>
0044 <span class="comment">% ATType                Quad, Sext, etc</span>
0045 <span class="comment">% ATIndex               index in THERING</span>
0046 <span class="comment">% ATParameterGroup      parameter group</span>
0047 <span class="comment">%</span>
0048 <span class="comment">%============</span>
0049 <span class="comment">% Family List</span>
0050 <span class="comment">%============</span>
0051 <span class="comment">%    BPMx</span>
0052 <span class="comment">%    BPMz</span>
0053 <span class="comment">%    HCOR</span>
0054 <span class="comment">%    VCOR</span>
0055 <span class="comment">%    BEND</span>
0056 <span class="comment">%    QF and QD</span>
0057 <span class="comment">%    SF and SD</span>
0058 <span class="comment">%    RF</span>
0059 <span class="comment">%    TUNE</span>
0060 <span class="comment">%    DCCT</span>
0061 <span class="comment">%    Machine Parameters</span>
0062 
0063 <span class="comment">%==============================</span>
0064 <span class="comment">%load AcceleratorData structure</span>
0065 <span class="comment">%==============================</span>
0066 
0067 <span class="keyword">if</span> nargin &lt; 1
0068     OperationalMode = 1;
0069 <span class="keyword">end</span>
0070 
0071 <span class="keyword">global</span> GLOBVAL THERING
0072 
0073 
0074 Mode             = <span class="string">'Online'</span>;
0075 setad([]);       <span class="comment">%clear AcceleratorData memory</span>
0076 AD.SubMachine       = <span class="string">'Booster'</span>; <span class="comment">% Machine Name</span>
0077 AD.Energy        = 2.75; <span class="comment">% Energy in GeV</span>
0078 
0079 
0080 setad(AD);   <span class="comment">%load AcceleratorData</span>
0081 
0082 <span class="comment">%%%%%%%%%%%%%%%%%%%%</span>
0083 <span class="comment">% ACCELERATOR OBJECT</span>
0084 <span class="comment">%%%%%%%%%%%%%%%%%%%%</span>
0085 
0086 setao([]);   <span class="comment">%clear previous AcceleratorObjects</span>
0087 
0088 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0089 <span class="comment">%% BPM data: status field designates if BPM in use</span>
0090 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0091 AO{1}.FamilyName               = <span class="string">'BPMx'</span>;
0092 AO{1}.FamilyType               = <span class="string">'BPM'</span>;
0093 AO{1}.MemberOf                 = {<span class="string">'BPM'</span>; <span class="string">'HBPM'</span>; <span class="string">'Diagnostics'</span>};
0094 AO{1}.Monitor.Mode             = Mode;
0095 AO{1}.Monitor.Units            = <span class="string">'Hardware'</span>;
0096 AO{1}.Monitor.HWUnits          = <span class="string">'mm'</span>;
0097 AO{1}.Monitor.PhysicsUnits     = <span class="string">'m'</span>;
0098 
0099 <span class="comment">% Get mapping from TANGO static database</span>
0100 map = tango_get_db_property(<span class="string">'booster'</span>,<span class="string">'tracy_bpm_mapping'</span>);
0101 
0102 cellindex = cell2mat(regexpi(map,<span class="string">'C[0-9]'</span>,<span class="string">'once'</span>))+1;
0103 numindex  = cell2mat(regexpi(map,<span class="string">'\.[0-9]'</span>,<span class="string">'once'</span>))+1;
0104 elemindex = cell2mat(regexpi(map,<span class="string">'BPM[0-9]'</span>,<span class="string">'once'</span>))+3;
0105 sep       = cell2mat(regexpi(map,<span class="string">'::'</span>,<span class="string">'once'</span>))-1;
0106 <span class="comment">% dev       = deblank(regexprep(char(map),'^BPM\d*::',''));</span>
0107 dev       = regexprep(map,<span class="string">'^BPM\d*::'</span>,<span class="string">''</span>)';
0108 
0109 nb = size(map,2);
0110 ik = 1;
0111 prev0 = 0;
0112 <span class="keyword">for</span> k = 1:nb
0113     prev = str2num(map{k}(cellindex(k):cellindex(k)+1));
0114     <span class="keyword">if</span> prev == prev0
0115         ik = ik + 1;
0116     <span class="keyword">else</span>
0117         ik = 1;
0118     <span class="keyword">end</span>
0119     AO{1}.DeviceList(k,:) = [prev ik];
0120     AO{1}.ElementList(k,:)= str2num(map{k}(elemindex(k):sep(k)));
0121     prev0 = prev;
0122 <span class="keyword">end</span>
0123 
0124 AO{1}.DeviceName(:,:)               = dev;
0125 AO{1}.Monitor.TangoNames(:,:)       = strcat(dev, <span class="string">'/XPosVector'</span>);
0126 AO{1}.CommonNames(:,:)              = [repmat(<span class="string">'BPMx'</span>,nb,1) num2str((1:nb)',<span class="string">'%02d'</span>)];
0127 
0128 AO{1}.Status                        = ones(nb,1);
0129 <span class="comment">% AO{1}.Status([5:22]) = 0;</span>
0130 AO{1}.Monitor.HW2PhysicsParams(:,:) = 1e-3*ones(nb,1);
0131 AO{1}.Monitor.Physics2HWParams(:,:) = 1e3*ones(nb,1);
0132 
0133 <span class="comment">% 2 lignes ajoutes pour test debug bpm versus le reste du monde</span>
0134 AO{1}.Monitor.Handles(:,1)       = NaN*ones(nb,1);
0135 AO{1}.Monitor.DataType         = <span class="string">'Vector'</span>;
0136 
0137 
0138 <span class="comment">% Vertical plane</span>
0139 AO{2} = AO{1};
0140 AO{2}.FamilyName              = <span class="string">'BPMz'</span>;
0141 AO{1}.MemberOf                 = {<span class="string">'BPM'</span>; <span class="string">'VBPM'</span>; <span class="string">'Diagnostics'</span>};
0142 AO{2}.Monitor.TangoNames(:,:) = strcat(dev,<span class="string">'/ZPosVector'</span>);
0143 AO{2}.CommonNames(:,:) = [repmat(<span class="string">'BPMz'</span>,nb,1) num2str((1:nb)',<span class="string">'%02d'</span>)];
0144 
0145 <span class="comment">% 2 lignes ajoutes pour test debug bpm versus le reste du monde</span>
0146 AO{2}.Monitor.DataType         = <span class="string">'Vector'</span>;
0147 AO{2}.Monitor.Handles(:,1)       = NaN*ones(nb,1);
0148 
0149 AO{1}.Status = AO{1}.Status(:);
0150 AO{2}.Status = AO{2}.Status(:);
0151 
0152 AO{1}.Monitor.Mode            = Mode; <span class="comment">%'Special';</span>
0153 AO{1}.Monitor.SpecialFunction = <span class="string">'getxsoleil'</span>;
0154 
0155 <span class="comment">%TODO</span>
0156 AO{1}.Sum.Monitor = AO{1}.Monitor;
0157 AO{1}.Sum.SpecialFunction = <span class="string">'getbpmsumspear'</span>;
0158 AO{1}.Sum.HWUnits          = <span class="string">'ADC Counts'</span>;
0159 AO{1}.Sum.PhysicsUnits     = <span class="string">'ADC Counts'</span>;
0160 AO{1}.Sum.HW2PhysicsParams = 1;
0161 AO{1}.Sum.Physics2HWParams = 1;
0162 
0163 AO{1}.Q = AO{1}.Monitor;
0164 AO{1}.Q.SpecialFunction = <span class="string">'getbpmqspear'</span>;
0165 AO{1}.Q.HWUnits          = <span class="string">'mm'</span>;
0166 AO{1}.Q.PhysicsUnits     = <span class="string">'m'</span>;
0167 AO{1}.Q.HW2PhysicsParams = 1e-3;
0168 AO{1}.Q.Physics2HWParams = 1000;
0169 
0170 AO{2}.Monitor.Mode            = Mode; <span class="comment">%'Special';</span>
0171 AO{2}.Monitor.SpecialFunction = <span class="string">'getzsoleil'</span>;
0172 
0173 AO{2}.Sum = AO{1}.Sum;
0174 AO{2}.Q   = AO{1}.Q;
0175 
0176 <span class="comment">% %===========================================================</span>
0177 <span class="comment">% %Corrector data: status field designates if corrector in use</span>
0178 <span class="comment">% %===========================================================</span>
0179 <span class="comment">%</span>
0180 setao(cell2field(AO));
0181 
0182 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0183 <span class="comment">%% SLOW HORIZONTAL CORRECTORS</span>
0184 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0185 ifam = 3;
0186 AO{ifam}.FamilyName               = <span class="string">'HCOR'</span>;
0187 AO{ifam}.FamilyType               = <span class="string">'COR'</span>;
0188 AO{ifam}.MemberOf                 = {<span class="string">'MachineConfig'</span>; <span class="string">'COR'</span>; <span class="string">'MCOR'</span>; <span class="string">'HCOR'</span>; <span class="string">'Magnet'</span>};
0189 
0190 AO{ifam}.Monitor.Mode             = Mode;
0191 AO{ifam}.Monitor.DataType         = <span class="string">'Scalar'</span>;
0192 AO{ifam}.Monitor.Units            = <span class="string">'Hardware'</span>;
0193 AO{ifam}.Monitor.HWUnits          = <span class="string">'A'</span>;
0194 AO{ifam}.Monitor.PhysicsUnits     = <span class="string">'rad'</span>;
0195 AO{ifam}.Monitor.HW2PhysicsFcn    = @amp2k;
0196 AO{ifam}.Monitor.Physics2HWFcn    = @k2amp;
0197 
0198 <span class="comment">% Get mapping from TANGO static database</span>
0199 map = tango_get_db_property(<span class="string">'booster'</span>,<span class="string">'tracy_correctorH_mapping'</span>);
0200 dev = regexprep(map,<span class="string">'^HCOR\d*::'</span>,<span class="string">''</span>)';
0201 cellindex = cell2mat(regexpi(map,<span class="string">'C[0-9]'</span>,<span class="string">'once'</span>))+1;
0202 numindex  = cell2mat(regexpi(map,<span class="string">'\.[0-9]'</span>,<span class="string">'once'</span>))+1;
0203 elemindex = cell2mat(regexpi(map,<span class="string">'HCOR[0-9]'</span>,<span class="string">'once'</span>))+4;
0204 sep       = cell2mat(regexpi(map,<span class="string">'::'</span>,<span class="string">'once'</span>))-1;
0205 
0206 nb = size(map,2);
0207 <span class="keyword">for</span> k = 1:nb
0208     AO{ifam}.DeviceList(k,:)  = [str2num(map{k}(cellindex(k):cellindex(k)+1)) 1];
0209     AO{ifam}.ElementList(k,:) = str2num(map{k}(elemindex(k):sep(k)));
0210 <span class="keyword">end</span>
0211 
0212 AO{ifam}.DeviceName(:,:)            = dev;
0213 AO{ifam}.CommonNames(:,:)           = [repmat(AO{ifam}.FamilyName,nb,1) num2str((1:nb)',<span class="string">'%03d'</span>)];
0214 AO{ifam}.Status                     = ones(nb,1);
0215 AO{ifam}.Monitor.TangoNames(:,:)    = strcat(dev,<span class="string">'/current'</span>);
0216 AO{ifam}.Monitor.Handles(:,1)       = NaN*ones(nb,1);
0217 
0218 <span class="comment">%Load fields from datablock</span>
0219 <span class="comment">% AT use the &quot;A-coefficients&quot; for correctors plus an offset</span>
0220 [C, Leff, MagnetType, coefficients] = magnetcoefficients(AO{ifam}.FamilyName);
0221 
0222 <span class="keyword">for</span> ii=1:nb
0223     AO{ifam}.Monitor.HW2PhysicsParams{1}(ii,:)  = coefficients;
0224     AO{ifam}.Monitor.Physics2HWParams{1}(ii,:)  = coefficients;
0225 <span class="keyword">end</span>
0226 
0227 AO{ifam}.Setpoint = AO{ifam}.Monitor;
0228 AO{ifam}.Desired  = AO{ifam}.Monitor;
0229 
0230 AO{ifam}.Setpoint.Range(:,:)        = repmat([-1.5 1.5],nb,1); <span class="comment">% 1 A for ???</span>
0231 AO{ifam}.Setpoint.Tolerance(:,:)    = 1000*ones(nb,1);
0232 AO{ifam}.Setpoint.DeltaRespMat(:,:) = ones(nb,1)*2e-5; <span class="comment">% ???</span>
0233 
0234 AO{ifam}.Status = AO{ifam}.Status(:);
0235 <span class="comment">%convert response matrix kicks to HWUnits (after AO is loaded to AppData)</span>
0236 setao(cell2field(AO));   <span class="comment">%required to make physics2hw function</span>
0237 AO{ifam}.Setpoint.DeltaRespMat = physics2hw(AO{ifam}.FamilyName,<span class="string">'Setpoint'</span>, <span class="keyword">...</span>
0238     AO{ifam}.Setpoint.DeltaRespMat, AO{ifam}.DeviceList);
0239 
0240 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0241 <span class="comment">%% SLOW VERTICAL CORRECTORS</span>
0242 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0243 ifam = ifam +1;
0244 AO{ifam}.FamilyName               = <span class="string">'VCOR'</span>;
0245 AO{ifam}.FamilyType               = <span class="string">'COR'</span>;
0246 AO{ifam}.MemberOf                 = {<span class="string">'MachineConfig'</span>; <span class="string">'COR'</span>; AO{ifam}.FamilyName; <span class="string">'Magnet'</span>};
0247 
0248 AO{ifam}.Monitor.Mode             = Mode;
0249 AO{ifam}.Monitor.DataType         = <span class="string">'Scalar'</span>;
0250 AO{ifam}.Monitor.Units            = <span class="string">'Hardware'</span>;
0251 AO{ifam}.Monitor.HWUnits          = <span class="string">'A'</span>;
0252 AO{ifam}.Monitor.PhysicsUnits     = <span class="string">'rad'</span>;
0253 AO{ifam}.Monitor.HW2PhysicsFcn = @amp2k;
0254 AO{ifam}.Monitor.Physics2HWFcn = @k2amp;
0255 
0256 <span class="comment">% Get mapping from TANGO static database</span>
0257 map = tango_get_db_property(<span class="string">'booster'</span>,<span class="string">'tracy_correctorV_mapping'</span>);
0258 dev = regexprep(map,<span class="string">'^VCOR\d*::'</span>,<span class="string">''</span>)';
0259 cellindex = cell2mat(regexpi(map,<span class="string">'C[0-9]'</span>,<span class="string">'once'</span>))+1;
0260 numindex  = cell2mat(regexpi(map,<span class="string">'\.[0-9]'</span>,<span class="string">'once'</span>))+1;
0261 elemindex = cell2mat(regexpi(map,<span class="string">'VCOR[0-9]'</span>,<span class="string">'once'</span>))+4;
0262 sep       = cell2mat(regexpi(map,<span class="string">'::'</span>,<span class="string">'once'</span>))-1;
0263 
0264 nb = size(map,2);
0265 <span class="keyword">for</span> k = 1:nb
0266     AO{ifam}.DeviceList(k,:)  = [str2num(map{k}(cellindex(k):cellindex(k)+1)) 1];
0267     AO{ifam}.ElementList(k,:) = str2num(map{k}(elemindex(k):sep(k)));
0268 <span class="keyword">end</span>
0269 
0270 AO{ifam}.DeviceName(:,:)            = dev;
0271 AO{ifam}.Status                     = ones(nb,1);
0272 AO{ifam}.CommonNames(:,:)           = [repmat(AO{ifam}.FamilyName,nb,1) num2str((1:nb)',<span class="string">'%03d'</span>)];
0273 AO{ifam}.Monitor.TangoNames(:,:)    = strcat(dev,<span class="string">'/current'</span>);
0274 
0275 AO{ifam}.Monitor.Handles(:,1)    = NaN*ones(nb,1);
0276 
0277 <span class="comment">%Load fields from datablock</span>
0278 <span class="comment">% AT use the &quot;A-coefficients&quot; for correctors plus an offset</span>
0279 [C, Leff, MagnetType, coefficients] = magnetcoefficients(AO{ifam}.FamilyName);
0280 
0281 <span class="keyword">for</span> ii = 1:nb
0282     AO{ifam}.Monitor.HW2PhysicsParams{1}(ii,:)  = coefficients;
0283     AO{ifam}.Monitor.Physics2HWParams{1}(ii,:)  = coefficients;
0284 <span class="keyword">end</span>
0285 
0286 AO{ifam}.Setpoint = AO{ifam}.Monitor;
0287 AO{ifam}.Desired  = AO{ifam}.Monitor;
0288 
0289 AO{ifam}.Setpoint.Range(:,:) = repmat([-1.5 1.5],nb,1); <span class="comment">%  1 A for ???</span>
0290 AO{ifam}.Setpoint.Tolerance(:,:) = 1000*ones(nb,1);
0291 AO{ifam}.Setpoint.DeltaRespMat(:,:) = ones(nb,1)*4e-5; <span class="comment">% ???</span>
0292 
0293 <span class="comment">%convert response matrix kicks to HWUnits (after AO is loaded to AppData)</span>
0294 setao(cell2field(AO));   <span class="comment">%required to make physics2hw function</span>
0295 AO{ifam}.Setpoint.DeltaRespMat = physics2hw(AO{ifam}.FamilyName,<span class="string">'Setpoint'</span>, <span class="keyword">...</span>
0296     AO{ifam}.Setpoint.DeltaRespMat, AO{ifam}.DeviceList);
0297 
0298 <span class="comment">%=============================</span>
0299 <span class="comment">% MAIN MAGNETS</span>
0300 <span class="comment">%=============================</span>
0301 
0302 <span class="comment">%===========</span>
0303 <span class="comment">%% Dipole data</span>
0304 <span class="comment">%===========</span>
0305 
0306 <span class="comment">% *** BEND ***</span>
0307 ifam = ifam+1;
0308 AO{ifam}.FamilyName                 = <span class="string">'BEND'</span>;
0309 AO{ifam}.FamilyType                 = <span class="string">'BEND'</span>;
0310 AO{ifam}.MemberOf                   = {<span class="string">'MachineConfig'</span>; <span class="string">'BEND'</span>; <span class="string">'Magnet'</span>;};
0311 HW2PhysicsParams                    = magnetcoefficients(<span class="string">'BEND'</span>);
0312 Physics2HWParams                    = HW2PhysicsParams;
0313 
0314 AO{ifam}.Monitor.Mode               = Mode;
0315 AO{ifam}.Monitor.DataType           = <span class="string">'Scalar'</span>;
0316 AO{ifam}.Monitor.Units              = <span class="string">'Hardware'</span>;
0317 AO{ifam}.Monitor.HW2PhysicsFcn      = @bend2gev;
0318 AO{ifam}.Monitor.Physics2HWFcn      = @gev2bend;
0319 AO{ifam}.Monitor.HWUnits            = <span class="string">'A'</span>;
0320 AO{ifam}.Monitor.PhysicsUnits       = <span class="string">'energy'</span>;
0321 
0322 
0323 <span class="comment">% nb = size(map,2);</span>
0324 nb = 1;
0325 
0326 AO{ifam}.DeviceList(:,:)   = [1 1];
0327 AO{ifam}.ElementList(:,:)  = 1;
0328 AO{ifam}.DeviceName(:,:)   = <span class="string">'BOO/AE/Dipole'</span>;
0329 AO{ifam}.Monitor.TangoNames(:,:)  = strcat(AO{ifam}.DeviceName,<span class="string">'/d1current'</span>);
0330 
0331 AO{ifam}.Status = 1;
0332 AO{ifam}.Monitor.Handles = NaN;
0333 
0334 val = 1.0;
0335 AO{ifam}.Monitor.HW2PhysicsParams{1}(1,:)                 = HW2PhysicsParams;
0336 AO{ifam}.Monitor.HW2PhysicsParams{2}(1,:)                 = val;
0337 AO{ifam}.Monitor.Physics2HWParams{1}(1,:)                 = Physics2HWParams;
0338 AO{ifam}.Monitor.Physics2HWParams{2}(1,:)                 = val;
0339 
0340 <span class="comment">% When using bend2gev / gev2bend don't use Params</span>
0341 AO{ifam}.Monitor = rmfield(AO{ifam}.Monitor,<span class="string">'HW2PhysicsParams'</span>);
0342 AO{ifam}.Monitor = rmfield(AO{ifam}.Monitor,<span class="string">'Physics2HWParams'</span>);
0343 
0344 AO{ifam}.Setpoint = AO{ifam}.Monitor;
0345 AO{ifam}.Desired  = AO{ifam}.Monitor;
0346 AO{ifam}.Setpoint.TangoNames = strcat(AO{ifam}.DeviceName,<span class="string">'/current'</span>);
0347 
0348 AO{ifam}.Setpoint.Range(:,:) = [0 560]; <span class="comment">% 525 A for 1.71T</span>
0349 AO{ifam}.Setpoint.Tolerance(:,:) = 0.05;
0350 AO{ifam}.Setpoint.DeltaRespMat(:,:) = 0.05;
0351 
0352 <span class="comment">%convert response matrix kicks to HWUnits (after AO is loaded to AppData)</span>
0353 <span class="comment">%setao(cell2field(AO));   %required to make physics2hw function</span>
0354 <span class="comment">%AO{ifam}.Setpoint.DeltaRespMat=physics2hw(AO{ifam}.FamilyName,'Setpoint',AO{ifam}.Setpoint.DeltaRespMat,AO{ifam}.DeviceList);</span>
0355 
0356 
0357 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0358 <span class="comment">%% QUADRUPOLE MAGNETS</span>
0359 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0360 
0361 map     = tango_get_db_property(<span class="string">'booster'</span>,<span class="string">'tracy_quadrupole_mapping'</span>);
0362 iifam   = cell2mat(regexpi(map,<span class="string">'/Q'</span>,<span class="string">'once'</span>))+2;
0363 ifound  = regexpi(map,<span class="string">'/QF'</span>);
0364 
0365 <span class="comment">%%% build mapping for the two families</span>
0366 <span class="comment">%%% cleanup</span>
0367 mapQF = []; mapQD = [];
0368 <span class="keyword">for</span> k = 1:length(ifound)
0369     <span class="keyword">if</span> isempty(ifound{k})
0370         mapQD = [mapQD map(k)];
0371     <span class="keyword">else</span>
0372         mapQF = [mapQF map(k)];
0373     <span class="keyword">end</span>
0374 <span class="keyword">end</span>
0375 
0376 
0377 mapQP  = {mapQF,mapQD};
0378 nameQP = {<span class="string">'QF'</span>, <span class="string">'QD'</span>};
0379 
0380 <span class="comment">% for both family</span>
0381 <span class="keyword">for</span> k = 1:2    
0382     sep = cell2mat(regexprep(mapQP{k},<span class="string">'::'</span>,<span class="string">'once'</span>))-1;
0383     dev = regexprep(mapQP{k},<span class="string">'^Q[F,D]\d*::'</span>,<span class="string">''</span>)';
0384     ifam = ifam + 1;
0385 
0386     AO{ifam}.FamilyName                 = nameQP{k};
0387     AO{ifam}.FamilyType                 = <span class="string">'QUAD'</span>;
0388     AO{ifam}.MemberOf                   = {<span class="string">'MachineConfig'</span>; <span class="string">'QUAD'</span>; <span class="string">'Magnet'</span>;};
0389     HW2PhysicsParams                    = magnetcoefficients(AO{ifam}.FamilyName);
0390     Physics2HWParams                    = magnetcoefficients(AO{ifam}.FamilyName);
0391 
0392     AO{ifam}.Monitor.Mode               = Mode;
0393     AO{ifam}.Monitor.DataType           = <span class="string">'Scalar'</span>;
0394     AO{ifam}.Monitor.Units              = <span class="string">'Hardware'</span>;
0395     AO{ifam}.Monitor.HWUnits            = <span class="string">'A'</span>;
0396     AO{ifam}.Monitor.PhysicsUnits       = <span class="string">'meter^-2'</span>;
0397     AO{ifam}.Monitor.HW2PhysicsFcn      = @amp2k;
0398     AO{ifam}.Monitor.Physics2HWFcn      = @k2amp;
0399     
0400     AO{ifam}.DeviceList(1,:) = [1 1];
0401     AO{ifam}.ElementList(1,:)= 1;
0402 
0403     prev0 = prev;
0404 
0405     AO{ifam}.DeviceName(:,:)    = dev;
0406     
0407     <span class="comment">%% Build common names</span>
0408     AO{ifam}.CommonNames(:,:) = AO{ifam}.FamilyName;
0409 
0410     AO{ifam}.Monitor.TangoNames(:,:)  = strcat(dev,<span class="string">'/current'</span>);
0411 
0412     AO{ifam}.Status = 1;
0413     AO{ifam}.Monitor.Handles(:,1) = NaN;
0414 
0415     AO{ifam}.Monitor.HW2PhysicsParams{1}(1,:)                 = HW2PhysicsParams;
0416     AO{ifam}.Monitor.HW2PhysicsParams{2}(1,:)                 = val;
0417     AO{ifam}.Monitor.Physics2HWParams{1}(1,:)                 = Physics2HWParams;
0418     AO{ifam}.Monitor.Physics2HWParams{2}(1,:)                 = val;
0419 
0420     AO{ifam}.Setpoint = AO{ifam}.Monitor;
0421     AO{ifam}.Desired  = AO{ifam}.Monitor;
0422 
0423     AO{ifam}.Setpoint.Range(:,:) = [0 300]; <span class="comment">%260 A for 19.7Tm-1</span>
0424     AO{ifam}.Setpoint.Tolerance(:,:) = 0.05;
0425     AO{ifam}.Setpoint.DeltaRespMat(:,:) = 0.02;
0426 
0427     <span class="comment">%convert response matrix kicks to HWUnits (after AO is loaded to AppData)</span>
0428     setao(cell2field(AO));   <span class="comment">%required to make physics2hw function</span>
0429 <span class="comment">%     AO{ifam}.Setpoint.DeltaRespMat = physics2hw(AO{ifam}.FamilyName, ...</span>
0430 <span class="comment">%         'Setpoint',AO{ifam}.Setpoint.DeltaRespMat,AO{ifam}.DeviceList);</span>
0431 <span class="keyword">end</span>
0432 
0433 
0434 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0435 <span class="comment">%% SEXTUPOLE MAGNETS</span>
0436 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0437 
0438 map=tango_get_db_property(<span class="string">'booster'</span>,<span class="string">'tracy_sextupole_mapping'</span>);
0439 iifam = cell2mat(regexpi(map,<span class="string">'/S'</span>,<span class="string">'once'</span>))+2;
0440 ifound  = regexpi(map,<span class="string">'/SF'</span>);
0441 
0442 <span class="comment">%%% build mapping for the ten families</span>
0443 <span class="comment">%%% cleanup</span>
0444 mapSF = []; mapSD = [];
0445 <span class="keyword">for</span> k = 1:length(ifound)
0446     <span class="keyword">if</span> isempty(ifound{k})
0447         mapSD = [mapSD map(k)];
0448     <span class="keyword">else</span>
0449         mapSF = [mapSF map(k)];
0450     <span class="keyword">end</span>
0451 <span class="keyword">end</span>
0452 
0453 
0454 mapS  = {mapSF,mapSD};
0455 nameS = {<span class="string">'SF'</span>, <span class="string">'SD'</span>};
0456 
0457 <span class="comment">% For both families</span>
0458 <span class="keyword">for</span> k = 1:2
0459     sep = cell2mat(regexpi(mapS{k},<span class="string">'::'</span>,<span class="string">'once'</span>))-1;
0460     dev = regexprep(mapS{k},<span class="string">'^S[F,D]\d*::'</span>,<span class="string">''</span>)';
0461 
0462     ifam=ifam+1;
0463 
0464     AO{ifam}.FamilyName                = nameS{k};
0465     AO{ifam}.FamilyType                = <span class="string">'SEXT'</span>;
0466     AO{ifam}.MemberOf                  = {<span class="string">'MachineConfig'</span>; <span class="string">'SEXT'</span>; <span class="string">'Magnet'</span>;};
0467     HW2PhysicsParams                   = magnetcoefficients(AO{ifam}.FamilyName);
0468     Physics2HWParams                   = magnetcoefficients(AO{ifam}.FamilyName);
0469 
0470     AO{ifam}.Monitor.Mode              = Mode;
0471     AO{ifam}.Monitor.DataType          = <span class="string">'Scalar'</span>;
0472     AO{ifam}.Monitor.Units             = <span class="string">'Hardware'</span>;
0473     AO{ifam}.Monitor.HW2PhysicsFcn     = @amp2k;
0474     AO{ifam}.Monitor.Physics2HWFcn     = @k2amp;
0475     AO{ifam}.Monitor.HWUnits           = <span class="string">'A'</span>;
0476     AO{ifam}.Monitor.PhysicsUnits      = <span class="string">'meter^-3'</span>;
0477 
0478     AO{ifam}.DeviceList(:,:) = [1 1];
0479     AO{ifam}.ElementList(:,:)= 1;
0480 
0481     AO{ifam}.DeviceName(:,:)    = dev;
0482     <span class="comment">%% Build common names</span>
0483     AO{ifam}.CommonNames(:,:)   = AO{ifam}.FamilyName;
0484     AO{ifam}.Monitor.TangoNames(:,:)  = strcat(dev,<span class="string">'/current'</span>);
0485     
0486 
0487     AO{ifam}.Status = 1;
0488     AO{ifam}.Monitor.Handles(:,1) = NaN;
0489 
0490     val = 1.0;
0491     AO{ifam}.Monitor.HW2PhysicsParams{1}(1,:)               = HW2PhysicsParams;
0492     AO{ifam}.Monitor.HW2PhysicsParams{2}(1,:)               = val;
0493     AO{ifam}.Monitor.Physics2HWParams{1}(1,:)               = Physics2HWParams;
0494     AO{ifam}.Monitor.Physics2HWParams{2}(1,:)               = val;
0495 
0496     AO{ifam}.Setpoint = AO{ifam}.Monitor;
0497     AO{ifam}.Desired  = AO{ifam}.Monitor;
0498 
0499     AO{ifam}.Setpoint.Range(:,:) = [0 400]; <span class="comment">% 343 A for 320 Tm-2</span>
0500     AO{ifam}.Setpoint.Tolerance(:,:) = 0.05;
0501     AO{ifam}.Setpoint.DeltaRespMat(:,:) = 0.05;
0502 
0503     <span class="comment">%convert response matrix kicks to HWUnits (after AO is loaded to AppData)</span>
0504     setao(cell2field(AO));   <span class="comment">%required to make physics2hw function</span>
0505 <span class="comment">%     AO{ifam}.Setpoint.DeltaRespMat=physics2hw(AO{ifam}.FamilyName,'Setpoint',AO{ifam}.Setpoint.DeltaRespMat,AO{ifam}.DeviceList);</span>
0506 <span class="keyword">end</span>
0507 
0508 <span class="comment">% Convert to new format</span>
0509 AO = cell2field(AO);
0510 
0511 
0512 <span class="comment">%=======</span>
0513 <span class="comment">%% TUNE</span>
0514 <span class="comment">%=======</span>
0515 ifam = <span class="string">'TUNE'</span>;
0516 AO.(ifam).FamilyName  = ifam;
0517 AO.(ifam).FamilyType  = <span class="string">'Diagnostic'</span>;
0518 AO.(ifam).MemberOf    = {<span class="string">'Diagnostics'</span>};
0519 AO.(ifam).CommonNames = [<span class="string">'nux'</span>;<span class="string">'nuz'</span>;<span class="string">'nus'</span>];
0520 AO.(ifam).DeviceList  = [1 1; 1 2; 1 3];
0521 AO.(ifam).ElementList = [1 2 3]';
0522 AO.(ifam).Status      = [1 1 1]';
0523 
0524 AO.(ifam).Monitor.Mode                   = Mode; <span class="comment">%'Simulator';  % Mode;</span>
0525 AO.(ifam).Monitor.DataType               = <span class="string">'Scalar'</span>;
0526 AO.(ifam).Monitor.DataTypeIndex          = [1 2];
0527 AO.(ifam).Monitor.TangoNames              = [<span class="string">'BOO/DG/BPM-TUNEX/Nu'</span>; <span class="keyword">...</span>
0528                                              <span class="string">'BOO/DG/BPM-TUNEZ/Nu'</span>; <span class="string">'BOO/DG/BPM-TUNEX/Nu'</span>];
0529 AO.(ifam).Monitor.Units                  = <span class="string">'Hardware'</span>;
0530 AO.(ifam).Monitor.Handles                = NaN;
0531 AO.(ifam).Monitor.HW2PhysicsParams       = 1;
0532 AO.(ifam).Monitor.Physics2HWParams       = 1;
0533 AO.(ifam).Monitor.HWUnits                = <span class="string">'fractional tune'</span>;
0534 AO.(ifam).Monitor.PhysicsUnits           = <span class="string">'fractional tune'</span>;
0535 
0536 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0537 <span class="comment">%% Pulsed Magnet</span>
0538 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0539 
0540 <span class="comment">%% Injection kicker</span>
0541 ifam = <span class="string">'K_Inj'</span>; 
0542 AO.(ifam).FamilyName           = <span class="string">'K_Inj'</span>;
0543 AO.(ifam).MemberOf             = {<span class="string">'Injection'</span>;<span class="string">'Archivable'</span>;<span class="string">'EP'</span>};
0544 AO.(ifam).Monitor.Mode         = Mode;
0545 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0546 
0547 AO.(ifam).Status                   = 1;
0548 AO.(ifam).DeviceName               = cellstr(<span class="string">'BOO-C01/EP/AL_K.Inj'</span>);
0549 AO.(ifam).CommonNames              = <span class="string">'K_Inj'</span>;
0550 AO.(ifam).ElementList              = 1;
0551 AO.(ifam).DeviceList(:,:)          = [1 1];
0552 AO.(ifam).Monitor.Handles(:,1)     = NaN;
0553 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/voltage'</span>);
0554 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0555 AO.(ifam).Monitor.Physics2HWParams = 1;
0556 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0557 AO.(ifam).Monitor.HWUnits          = <span class="string">'V'</span>;
0558 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mrad'</span>;
0559 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0560 AO.(ifam).Desired = AO.(ifam).Monitor;
0561 
0562 <span class="comment">%% Injection Septum</span>
0563 ifam = <span class="string">'SEP_Inj'</span>; 
0564 AO.(ifam).FamilyName           = <span class="string">'SEP_Inj'</span>;
0565 AO.(ifam).MemberOf             = {<span class="string">'Injection'</span>;<span class="string">'Archivable'</span>;<span class="string">'EP'</span>};
0566 AO.(ifam).Monitor.Mode         = Mode;
0567 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0568 
0569 AO.(ifam).Status                   = 1;
0570 AO.(ifam).DeviceName               = cellstr(<span class="string">'BOO-C22/EP/AL_SEP_P.Inj'</span>);
0571 AO.(ifam).CommonNames              = <span class="string">'SEP_P'</span>;
0572 AO.(ifam).ElementList              = 1;
0573 AO.(ifam).DeviceList(:,:)           = [1 1];
0574 AO.(ifam).Monitor.Handles(:,1)     = NaN;
0575 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/voltage'</span>);
0576 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0577 AO.(ifam).Monitor.Physics2HWParams = 1;
0578 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0579 AO.(ifam).Monitor.HWUnits          = <span class="string">'V'</span>;
0580 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mrad'</span>;
0581 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0582 AO.(ifam).Desired = AO.(ifam).Monitor;
0583 
0584 <span class="comment">%% Injection Septum</span>
0585 ifam = <span class="string">'SEPA_EXT'</span>; 
0586 AO.(ifam).FamilyName           = ifam;
0587 AO.(ifam).MemberOf             = {<span class="string">'Injection'</span>;<span class="string">'Archivable'</span>;<span class="string">'EP'</span>};
0588 AO.(ifam).Monitor.Mode         = Mode;
0589 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0590 
0591 AO.(ifam).Status                   = 0;
0592 AO.(ifam).DeviceName               = cellstr(<span class="string">'BOO-C22/EP/AL_SEP_P.Inj'</span>);
0593 AO.(ifam).CommonNames              = <span class="string">'SEP_P'</span>;
0594 AO.(ifam).ElementList              = 1;
0595 AO.(ifam).DeviceList(:,:)           = [1 1];
0596 AO.(ifam).Monitor.Handles(:,1)     = NaN;
0597 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/voltage'</span>);
0598 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0599 AO.(ifam).Monitor.Physics2HWParams = 1;
0600 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0601 AO.(ifam).Monitor.HWUnits          = <span class="string">'V'</span>;
0602 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mrad'</span>;
0603 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0604 AO.(ifam).Desired = AO.(ifam).Monitor;
0605 
0606 <span class="comment">%% Injection Septum</span>
0607 ifam = <span class="string">'SEP_P_EXT'</span>; 
0608 AO.(ifam).FamilyName           = ifam;
0609 AO.(ifam).MemberOf             = {<span class="string">'Injection'</span>;<span class="string">'Archivable'</span>;<span class="string">'EP'</span>};
0610 AO.(ifam).Monitor.Mode         = Mode;
0611 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0612 
0613 AO.(ifam).Status                   = 0;
0614 AO.(ifam).DeviceName               = cellstr(<span class="string">'BOO-C11/EP/AL_SEP_P.Ext'</span>);
0615 AO.(ifam).CommonNames              = <span class="string">'SEP_P_EXT'</span>;
0616 AO.(ifam).ElementList              = 1;
0617 AO.(ifam).DeviceList(:,:)           = [1 1];
0618 AO.(ifam).Monitor.Handles(:,1)     = NaN;
0619 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/voltage'</span>);
0620 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0621 AO.(ifam).Monitor.Physics2HWParams = 1;
0622 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0623 AO.(ifam).Monitor.HWUnits          = <span class="string">'V'</span>;
0624 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mrad'</span>;
0625 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0626 AO.(ifam).Desired = AO.(ifam).Monitor;
0627 
0628 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0629 <span class="comment">%% VACUUM SYSTEM</span>
0630 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0631 
0632 <span class="comment">%% IonPump</span>
0633 ifam = <span class="string">'PI'</span>;
0634 AO.(ifam).FamilyName           = <span class="string">'PI'</span>;
0635 AO.(ifam).FamilyType           = <span class="string">'PI'</span>;
0636 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'IonPump'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0637 AO.(ifam).Monitor.Mode         = Mode;
0638 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0639 
0640 map     = tango_get_db_property(<span class="string">'booster'</span>,<span class="string">'pompe_ionique'</span>);
0641 numindex  = cell2mat(regexpi(map,<span class="string">'\.[0-9]'</span>,<span class="string">'once'</span>))+1;
0642 
0643 nb = size(map,2);
0644 <span class="keyword">for</span> k = 1:nb,
0645     <span class="keyword">switch</span> map{k}(1:6)
0646         <span class="keyword">case</span> <span class="string">'BOO-B1'</span>
0647             k1 = 1;
0648         <span class="keyword">case</span> <span class="string">'BOO-Bi'</span>
0649             k1 = 2;
0650         <span class="keyword">case</span> <span class="string">'BOO-B2'</span>
0651             k1 = 3;
0652         <span class="keyword">case</span> <span class="string">'BOO-Be'</span>
0653             k1 = 4;
0654         <span class="keyword">case</span> <span class="string">'BOO-B3'</span>
0655             k1 = 5;
0656         <span class="keyword">case</span> <span class="string">'BOO-B4'</span>
0657             k1 = 6;
0658     <span class="keyword">end</span>            
0659     AO.(ifam).DeviceList(k,:)  = [k1 str2double(map{k}(numindex(k)))];
0660     AO.(ifam).ElementList(k,:) = k;
0661     AO.(ifam).CommonNames(k,:) = [<span class="string">'PI'</span> num2str(ik)];
0662 <span class="keyword">end</span>
0663 
0664 AO.(ifam).Status                   = ones(nb,1);
0665 <span class="comment">%AO.(ifam).Status(26) = 0;% BOO-Bext/VI/PI300.3</span>
0666 AO.(ifam).DeviceName               = map';
0667 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0668 AO.(ifam).ElementList              = (1:nb)';
0669 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0670 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0671 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0672 AO.(ifam).Monitor.Physics2HWParams = 1;
0673 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0674 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0675 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0676 
0677 <span class="comment">%% Penning Gauges</span>
0678 ifam = <span class="string">'JPEN'</span>;
0679 AO.(ifam).FamilyName           = <span class="string">'JPEN'</span>;
0680 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'PenningGauge'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0681 AO.(ifam).Monitor.Mode         = Mode;
0682 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0683 
0684 map     = tango_get_db_property(<span class="string">'booster'</span>,<span class="string">'jauge_penning'</span>);
0685 numindex  = cell2mat(regexpi(map,<span class="string">'\.[0-9]'</span>,<span class="string">'once'</span>))+1;
0686 
0687 nb = size(map,2);
0688 <span class="keyword">for</span> k = 1:nb,
0689     <span class="keyword">switch</span> map{k}(1:6)
0690         <span class="keyword">case</span> <span class="string">'BOO-B1'</span>
0691             k1 = 1;
0692         <span class="keyword">case</span> <span class="string">'BOO-Bi'</span>
0693             k1 = 2;
0694         <span class="keyword">case</span> <span class="string">'BOO-B2'</span>
0695             k1 = 3;
0696         <span class="keyword">case</span> <span class="string">'BOO-Be'</span>
0697             k1 = 4;
0698         <span class="keyword">case</span> <span class="string">'BOO-B3'</span>
0699             k1 = 5;
0700         <span class="keyword">case</span> <span class="string">'BOO-B4'</span>
0701             k1 = 6;
0702     <span class="keyword">end</span>            
0703     AO.(ifam).DeviceList(k,:)  = [k1 str2double(map{k}(numindex(k)))];
0704     AO.(ifam).ElementList(k,:) = k;
0705     AO.(ifam).CommonNames(k,:) = [<span class="string">'JPEN'</span> num2str(ik)];
0706 <span class="keyword">end</span>
0707 
0708 AO.(ifam).Status                   = ones(nb,1);
0709 AO.(ifam).DeviceName               = map';
0710 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0711 AO.(ifam).ElementList              = (1:nb)';
0712 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0713 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0714 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0715 AO.(ifam).Monitor.Physics2HWParams = 1;
0716 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0717 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0718 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0719 
0720 <span class="comment">%% Pirani Gauges</span>
0721 ifam = <span class="string">'JPIR'</span>;
0722 AO.(ifam).FamilyName           = <span class="string">'JPIR'</span>;
0723 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'PiraniGauge'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0724 AO.(ifam).Monitor.Mode         = Mode;
0725 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0726 
0727 map     = tango_get_db_property(<span class="string">'booster'</span>,<span class="string">'jauge_pirani'</span>);
0728 numindex  = cell2mat(regexpi(map,<span class="string">'\.[0-9]'</span>,<span class="string">'once'</span>))+1;
0729 
0730 nb = size(map,2);
0731 <span class="keyword">for</span> k = 1:nb,
0732     <span class="keyword">switch</span> map{k}(1:6)
0733         <span class="keyword">case</span> <span class="string">'BOO-B1'</span>
0734             k1 = 1;
0735         <span class="keyword">case</span> <span class="string">'BOO-Bi'</span>
0736             k1 = 2;
0737         <span class="keyword">case</span> <span class="string">'BOO-B2'</span>
0738             k1 = 3;
0739         <span class="keyword">case</span> <span class="string">'BOO-Be'</span>
0740             k1 = 4;
0741         <span class="keyword">case</span> <span class="string">'BOO-B3'</span>
0742             k1 = 5;
0743         <span class="keyword">case</span> <span class="string">'BOO-B4'</span>
0744             k1 = 6;
0745     <span class="keyword">end</span>            
0746     AO.(ifam).DeviceList(k,:)  = [k1 str2double(map{k}(numindex(k)))];
0747     AO.(ifam).ElementList(k,:) = k;
0748     AO.(ifam).CommonNames(k,:) = [<span class="string">'JPIR'</span> num2str(ik)];
0749 <span class="keyword">end</span>
0750 
0751 AO.(ifam).Status                   = ones(nb,1);
0752 AO.(ifam).DeviceName               = map';
0753 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0754 AO.(ifam).ElementList              = (1:nb)';
0755 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0756 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0757 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0758 AO.(ifam).Monitor.Physics2HWParams = 1;
0759 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0760 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0761 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0762 
0763 <span class="comment">%====</span>
0764 <span class="comment">%% DCCT</span>
0765 <span class="comment">%====</span>
0766 ifam=ifam+1;
0767 AO.DCCT.FamilyName                     = <span class="string">'DCCT'</span>;
0768 AO.DCCT.FamilyType                     = <span class="string">'Diagnostic'</span>;
0769 AO.DCCT.MemberOf                       = {<span class="string">'Diagnostics'</span>,<span class="string">'Archivable'</span>,<span class="string">'Plotfamily'</span>};
0770 AO.DCCT.CommonNames                    = <span class="string">'DCCT'</span>;
0771 AO.DCCT.DeviceList                     = [1 1; 1 2];
0772 AO.DCCT.ElementList                    = (1:2)';
0773 AO.DCCT.Status                         = AO.DCCT.ElementList;
0774 
0775 AO.DCCT.Monitor.Mode                   = Mode;
0776 AO.DCCT.FamilyName                     = <span class="string">'DCCT'</span>;
0777 AO.DCCT.deviceName                     = <span class="string">'BOO-C01/DG/DCCT'</span>;
0778 AO.DCCT.Monitor.DataType               = <span class="string">'Scalar'</span>;
0779 AO.DCCT.Monitor.TangoNames             = [<span class="string">'BOO-C01/DG/DCCT/iInj'</span>; <span class="string">'BOO-C01/DG/DCCT/iExt'</span>]; <span class="comment">%afin de ne pas avoir de bug</span>
0780 AO.DCCT.Monitor.Units                  = <span class="string">'Hardware'</span>;
0781 AO.DCCT.Monitor.Handles                = NaN;
0782 AO.DCCT.Monitor.HWUnits                = <span class="string">'milli-ampere'</span>;
0783 AO.DCCT.Monitor.PhysicsUnits           = <span class="string">'A'</span>;
0784 AO.DCCT.Monitor.HW2PhysicsParams       = 1;
0785 AO.DCCT.Monitor.Physics2HWParams       = 1;
0786 
0787 <span class="comment">%============</span>
0788 <span class="comment">%% RF System</span>
0789 <span class="comment">%============</span>
0790 ifam = <span class="string">'RF'</span>;
0791 AO.(ifam).FamilyName                = ifam;
0792 AO.(ifam).FamilyType                = <span class="string">'RF'</span>;
0793 AO.(ifam).MemberOf                  = {<span class="string">'RF'</span>,<span class="string">'RFSystem'</span>};
0794 AO.(ifam).Status                    = 1;
0795 AO.(ifam).CommonNames               = <span class="string">'RF'</span>;
0796 AO.(ifam).DeviceList                = [1 1];
0797 AO.(ifam).ElementList               = 1;
0798 AO.(ifam).DeviceName(:,:)           = {<span class="string">'BOO/RF/MasterClock/'</span>};
0799 
0800 <span class="comment">%Frequency Readback</span>
0801 AO.(ifam).Monitor.Mode                = Mode;
0802 AO.(ifam).Monitor.DataType            = <span class="string">'Scalar'</span>;
0803 AO.(ifam).Monitor.Units               = <span class="string">'Hardware'</span>;
0804 AO.(ifam).Monitor.HW2PhysicsParams    = 1e+6;       <span class="comment">%no hw2physics function necessary</span>
0805 AO.(ifam).Monitor.Physics2HWParams    = 1e-6;
0806 AO.(ifam).Monitor.HWUnits             = <span class="string">'MHz'</span>;
0807 AO.(ifam).Monitor.PhysicsUnits        = <span class="string">'Hz'</span>;
0808 AO.(ifam).Monitor.TangoNames          = {<span class="string">'ANS/RF/MasterClock/frequency'</span>};
0809 AO.(ifam).Monitor.Handles             = NaN;
0810 AO.(ifam).Monitor.Range               = [350e6 360e6];
0811 
0812 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0813 AO.(ifam).Desired  = AO.(ifam).Monitor;
0814 
0815 
0816 <span class="comment">%=====================</span>
0817 <span class="comment">%% Gamma Monitors DOSE</span>
0818 <span class="comment">%====================</span>
0819 ifam = ifam+1;
0820 AO.CIGdose.FamilyName                     = <span class="string">'CIGdose'</span>;
0821 AO.CIGdose.FamilyType                     = <span class="string">'Radioprotection'</span>;
0822 AO.CIGdose.MemberOf                       = {<span class="string">'Radioprotection'</span>,<span class="string">'Archivable'</span>,<span class="string">'Plotfamily'</span>};
0823 AO.CIGdose.CommonNames                    = <span class="string">'CIG'</span>;
0824 
0825 map = tango_get_db_property(<span class="string">'anneau'</span>,<span class="string">'gammamonitor_mapping'</span>);
0826 AO.CIGdose.DeviceName = map';
0827 
0828 AO.CIGdose.Monitor.Mode                   = Mode;
0829 AO.CIGdose.FamilyName                     = <span class="string">'CIGdose'</span>;
0830 AO.CIGdose.Monitor.DataType               = <span class="string">'Scalar'</span>;
0831 
0832 nb = length(AO.CIGdose.DeviceName); 
0833 AO.CIGdose.DeviceList                     = [ones(1,nb); (1:nb)]';
0834 AO.CIGdose.ElementList                    = (1:nb)';
0835 AO.CIGdose.Status                         = ones(nb,1);
0836 
0837 AO.CIGdose.Monitor.TangoNames            = strcat(AO.CIGdose.DeviceName,<span class="string">'/dose'</span>); 
0838 
0839 ;<span class="comment">%afin de ne pas avoir de bug</span>
0840 AO.CIGdose.Monitor.Units                  = <span class="string">'Hardware'</span>;
0841 AO.CIGdose.Monitor.Handles                = NaN;
0842 AO.CIGdose.Monitor.HWUnits                = <span class="string">'uGy'</span>;
0843 AO.CIGdose.Monitor.PhysicsUnits           = <span class="string">'uGy'</span>;
0844 AO.CIGdose.Monitor.HW2PhysicsParams       = 1;
0845 AO.CIGdose.Monitor.Physics2HWParams       = 1;
0846 
0847 <span class="comment">%=========================</span>
0848 <span class="comment">%% Gamma Monitors DOSErate</span>
0849 <span class="comment">%=========================</span>
0850 
0851 ifam = ifam+1;
0852 
0853 AO.CIGrate = AO.CIGdose;
0854 AO.CIGrate.FamilyName                     = <span class="string">'CIGrate'</span>;
0855 AO.CIGrate.CommonNames                    = <span class="string">'CIGrate'</span>;
0856 AO.CIGrate.FamilyName                     = <span class="string">'CIGrate'</span>;
0857 
0858 nb = length(AO.CIGrate.DeviceName); 
0859 AO.CIGrate.Status                         = ones(nb,1);
0860 
0861 AO.CIGrate.Monitor.TangoNames            = strcat(AO.CIGrate.DeviceName,<span class="string">'/doseRate'</span>); 
0862 
0863 <span class="comment">%afin de ne pas avoir de bug</span>
0864 AO.CIG.Monitor.HWUnits                = <span class="string">'uGy/h'</span>;
0865 AO.CIG.Monitor.PhysicsUnits           = <span class="string">'uGy/h'</span>;
0866 
0867 <span class="comment">%==================</span>
0868 <span class="comment">%Machine Parameters</span>
0869 <span class="comment">%==================</span>
0870 AO.MachineParameters.FamilyName                = <span class="string">'MachineParameters'</span>;
0871 AO.MachineParameters.FamilyType                = <span class="string">'Parameter'</span>;
0872 AO.MachineParameters.MemberOf                  = {<span class="string">'Diagnostics'</span>};
0873 AO.MachineParameters.Status                    = [1 1 1 1]';
0874 
0875 AO.MachineParameters.Monitor.Mode              = Mode;
0876 AO.MachineParameters.Monitor.DataType          = <span class="string">'Scalar'</span>;
0877 AO.MachineParameters.Monitor.Units             = <span class="string">'Hardware'</span>;
0878 
0879 <span class="comment">%use spear2 process variable names</span>
0880 mp={
0881     <span class="string">'mode    '</span>    <span class="string">'SPEAR:BeamStatus  '</span>          [1 1]  1; <span class="keyword">...</span>
0882     <span class="string">'energy  '</span>    <span class="string">'SPEAR:Energy      '</span>          [1 2]  2; <span class="keyword">...</span>
0883     <span class="string">'current '</span>    <span class="string">'SPEAR:BeamCurrAvg '</span>          [1 3]  3; <span class="keyword">...</span>
0884     <span class="string">'lifetime'</span>    <span class="string">'SPEAR:BeamLifetime'</span>          [1 4]  4; <span class="keyword">...</span>
0885     };
0886 AO.MachineParameters.Monitor.HWUnits          = <span class="string">' '</span>;
0887 AO.MachineParameters.Monitor.PhysicsUnits     = <span class="string">' '</span>;
0888 
0889 AO.MachineParameters.Setpoint.HWUnits         = <span class="string">' '</span>;
0890 AO.MachineParameters.Setpoint.PhysicsUnits    = <span class="string">' '</span>;
0891 
0892 <span class="keyword">for</span> ii=1:size(mp,1)
0893     name  =mp(ii,1);    AO.MachineParameters.CommonNames(ii,:)            = char(name{1});
0894     <span class="comment">%     name  =mp(ii,2);    AO.MachineParameters.Monitor.ChannelNames(ii,:)   = char(name{1});</span>
0895     <span class="comment">%     name  =mp(ii,2);    AO.MachineParameters.Setpoint.ChannelNames(ii,:)  = char(name{1});</span>
0896     val   =mp(ii,3);    AO.MachineParameters.DeviceList(ii,:)             = val{1};
0897     val   =mp(ii,4);    AO.MachineParameters.ElementList(ii,:)            = val{1};
0898 
0899     AO.MachineParameters.Monitor.HW2PhysicsParams(ii,:)    = 1;
0900     AO.MachineParameters.Monitor.Physics2HWParams(ii,:)    = 1;
0901     AO.MachineParameters.Monitor.Handles(ii,1)  = NaN;
0902     AO.MachineParameters.Setpoint.HW2PhysicsParams(ii,:)   = 1;
0903     AO.MachineParameters.Setpoint.Physics2HWParams(ii,:)   = 1;
0904     AO.MachineParameters.Setpoint.Handles(ii,1)  = NaN;
0905 <span class="keyword">end</span>
0906 
0907 <span class="comment">% Save AO</span>
0908 setao(AO);
0909 
0910 <span class="comment">% The operational mode sets the path, filenames, and other important params</span>
0911 <span class="comment">% Run setoperationalmode after most of the AO is built so that the Units and Mode fields</span>
0912 <span class="comment">% can be set in setoperationalmode</span>
0913 
0914 <a href="setoperationalmode.html" class="code" title="function setoperationalmode(ModeNumber)">setoperationalmode</a>(OperationalMode);
0915 
0916 <span class="comment">%======================================================================</span>
0917 <span class="comment">%======================================================================</span>
0918 <span class="comment">%% Append Accelerator Toolbox information</span>
0919 <span class="comment">%======================================================================</span>
0920 <span class="comment">%======================================================================</span>
0921 disp(<span class="string">'** Initializing Accelerator Toolbox information'</span>);
0922 
0923 AT = getao;
0924 
0925 ATindx = atindex(THERING);  <span class="comment">%structure with fields containing indices</span>
0926 
0927 s = findspos(THERING,1:length(THERING)+1)';
0928 
0929 <span class="comment">% Horizontal BPMS</span>
0930 <span class="comment">% WARNING: BPM1 is the one before the injection straigth section</span>
0931 <span class="comment">%          since a cell begins from begin of Straigths</span>
0932 <span class="comment">% CELL1 BPM1 to BPM7</span>
0933 ifam = (<span class="string">'BPMx'</span>);
0934 AO.(ifam).AT.ATType  = ifam;
0935 AO.(ifam).AT.ATIndex = ATindx.BPM(:);
0936 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0937 
0938 <span class="comment">% Vertical BPMS</span>
0939 ifam = (<span class="string">'BPMz'</span>);
0940 AO.(ifam).AT.ATType  = ifam;
0941 AO.(ifam).AT.ATIndex = ATindx.BPM(:);
0942 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);  
0943 
0944 <span class="comment">% SLOW HORIZONTAL CORRECTORS</span>
0945 ifam = (<span class="string">'HCOR'</span>);
0946 AO.(ifam).AT.ATType  = ifam;
0947 AO.(ifam).AT.ATIndex = ATindx.HCOR(:);
0948 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0949 
0950 <span class="comment">% SLOW VERTICAL CORRECTORS</span>
0951 ifam = (<span class="string">'VCOR'</span>);
0952 AO.(ifam).AT.ATType  = ifam;
0953 AO.(ifam).AT.ATIndex = ATindx.VCOR(:);
0954 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);  
0955 
0956 <span class="comment">%% BENDING magnets</span>
0957 ifam = (<span class="string">'BEND'</span>);
0958 AO.(ifam).AT.ATType  = ifam;
0959 AO.(ifam).AT.ATIndex = ATindx.BEND(:);
0960 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0961 
0962 <span class="comment">%% QF magnets</span>
0963 ifam = (<span class="string">'QF'</span>);
0964 AO.(ifam).AT.ATType  = <span class="string">'QUAD'</span>;
0965 AO.(ifam).AT.ATIndex = ATindx.QPF(:);
0966 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0967 AO.(ifam).AT.ATParameterGroup = mkparamgroup(THERING,AO.(ifam).AT.ATIndex,<span class="string">'K'</span>);
0968 
0969 <span class="comment">%% QD magnets</span>
0970 ifam = (<span class="string">'QD'</span>);
0971 AO.(ifam).AT.ATType  = <span class="string">'QUAD'</span>;
0972 AO.(ifam).AT.ATIndex = ATindx.QPD(:);
0973 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0974 AO.(ifam).AT.ATParameterGroup = mkparamgroup(THERING,AO.(ifam).AT.ATIndex,<span class="string">'K'</span>);
0975 
0976 <span class="comment">%% SF magnets</span>
0977 ifam = (<span class="string">'SF'</span>);
0978 AO.(ifam).AT.ATType  = <span class="string">'SEXT'</span>;
0979 AO.(ifam).AT.ATIndex = ATindx.SXF(:);
0980 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0981 AO.(ifam).AT.ATParameterGroup = mkparamgroup(THERING,AO.(ifam).AT.ATIndex,<span class="string">'K2'</span>);
0982 
0983 <span class="comment">%% SD magnets</span>
0984 ifam = (<span class="string">'SD'</span>);
0985 AO.(ifam).AT.ATType  = <span class="string">'SEXT'</span>;
0986 AO.(ifam).AT.ATIndex = ATindx.SXD(:);
0987 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0988 AO.(ifam).AT.ATParameterGroup = mkparamgroup(THERING,AO.(ifam).AT.ATIndex,<span class="string">'S'</span>);
0989 
0990 <span class="comment">% RF Cavity</span>
0991 ifam = (<span class="string">'RF'</span>);
0992 AO.(ifam).AT.ATType = <span class="string">'RF Cavity'</span>;
0993 AO.(ifam).AT.ATIndex = findcells(THERING,<span class="string">'Frequency'</span>)';
0994 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0995 
0996 <span class="comment">% Save AO</span>
0997 setao(AO);
0998 
0999 <span class="keyword">if</span> iscontrolroom
1000     switch2online;
1001 <span class="keyword">else</span>
1002     switch2sim;
1003 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>