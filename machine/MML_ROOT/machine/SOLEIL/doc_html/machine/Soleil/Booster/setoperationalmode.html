<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setoperationalmode</title>
  <meta name="keywords" content="setoperationalmode">
  <meta name="description" content="SETOPERATIONALMODE - Switches between the various operational modes">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="index.html">Booster</a> &gt; setoperationalmode.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/Booster&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>setoperationalmode
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>SETOPERATIONALMODE - Switches between the various operational modes</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function setoperationalmode(ModeNumber) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">SETOPERATIONALMODE - Switches between the various operational modes
  setoperationalmode(ModeNumber)

  INPUTS
  1. ModeNumber = 1. 2.7391 GeV, multibunch

                100. Laurent's Mode

  See also <a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>, <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>, LT1init</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>	UPDATEATINDEX - Updates the AT indices in the MiddleLayer with the present AT lattice (THERING)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="boosterinit.html" class="code" title="function boosterinit(OperationalMode)">boosterinit</a>	BOOSTERINIT - Initializes parameters for SOLEIL Booster control in MATLAB</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function setoperationalmode(ModeNumber)</a>
0002 <span class="comment">%SETOPERATIONALMODE - Switches between the various operational modes</span>
0003 <span class="comment">%  setoperationalmode(ModeNumber)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  INPUTS</span>
0006 <span class="comment">%  1. ModeNumber = 1. 2.7391 GeV, multibunch</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%                100. Laurent's Mode</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%  See also aoinit, updateatindex, LT1init</span>
0011 
0012 <span class="comment">%</span>
0013 <span class="comment">% Written by Laurent S. Nadolski</span>
0014 
0015 <span class="keyword">global</span> THERING
0016 
0017 <span class="comment">% Check if the AO exists</span>
0018 checkforao;
0019 
0020 
0021 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0022 <span class="comment">% Accelerator Dependent Modes %</span>
0023 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0024 <span class="keyword">if</span> nargin &lt; 1
0025     ModeNumber = [];
0026 <span class="keyword">end</span>
0027 <span class="keyword">if</span> isempty(ModeNumber)
0028     ModeCell = {<span class="string">'2.7391 GeV, multibunch'</span>,  <span class="keyword">...</span>
0029         <span class="string">'Laurent''s Mode'</span>};
0030     [ModeNumber, OKFlag] = listdlg(<span class="string">'Name'</span>,<span class="string">'SOLEIL'</span>,<span class="string">'PromptString'</span>,<span class="string">'Select the Operational Mode:'</span>, <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>, <span class="string">'ListString'</span>, ModeCell, <span class="string">'ListSize'</span>, [450 200]);
0031     <span class="keyword">if</span> OKFlag ~= 1
0032         fprintf(<span class="string">'   Operational mode not changed\n'</span>);
0033         <span class="keyword">return</span>
0034     <span class="keyword">elseif</span> ModeNumber == 2
0035         ModeNumber = 100;  <span class="comment">% Laurent</span>
0036     <span class="keyword">end</span>
0037 <span class="keyword">end</span>
0038 
0039 
0040 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0041 <span class="comment">% Accelerator Data Structure %</span>
0042 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0043 AD = getad;
0044 AD.Machine = <span class="string">'SOLEIL'</span>;            <span class="comment">% Will already be defined if setpathmml was used</span>
0045 AD.MachineType = <span class="string">'StorageRing'</span>;   <span class="comment">% Will already be defined if setpathmml was used</span>
0046 AD.SubMachine  = <span class="string">'Booster'</span>;       <span class="comment">% Will already be defined if setpathmml was used</span>
0047 AD.OperationalMode = <span class="string">''</span>;          <span class="comment">% Gets filled in later</span>
0048 
0049 
0050 <span class="comment">% Tune processor delay: delay required to wait</span>
0051 <span class="comment">% to have a fresh tune measurement after changing</span>
0052 <span class="comment">% a variable like the RF frequency.  Setpv will wait</span>
0053 <span class="comment">% 2.2 * TuneDelay to be guaranteed a fresh data point.</span>
0054 AD.BPMDelay  = 0.25; <span class="comment">% use [N, BPMDelay]=getbpmsaverages (AD.BPMDelay will disappear)</span>
0055 AD.TuneDelay = 0.1;
0056 
0057 
0058 <span class="comment">% SP-AM Error level</span>
0059 <span class="comment">% AD.ErrorWarningLevel = 0 -&gt; SP-AM errors are Matlab errors {Default}</span>
0060 <span class="comment">%                       -1 -&gt; SP-AM errors are Matlab warnings</span>
0061 <span class="comment">%                       -2 -&gt; SP-AM errors prompt a dialog box</span>
0062 <span class="comment">%                       -3 -&gt; SP-AM errors are ignored (ErrorFlag=-1 is returned)</span>
0063 AD.ErrorWarningLevel = 0;
0064 
0065 <span class="comment">%%%%%%%%%%%%%%%%%%%%%</span>
0066 <span class="comment">% Operational Modes %</span>
0067 <span class="comment">%%%%%%%%%%%%%%%%%%%%%</span>
0068 
0069 <span class="comment">% Mode setup variables (mostly path and file names)</span>
0070 <span class="comment">% AD.OperationalMode - String used in titles</span>
0071 <span class="comment">% ModeName - String used for mode directory name off DataRoot/MachineName</span>
0072 <span class="comment">% OpsFileExtension - string add to default file names</span>
0073 
0074 <span class="keyword">if</span> ModeNumber == 1
0075     <span class="comment">% Booster Nominal Lattice</span>
0076     AD.OperationalMode = <span class="string">'2.7391 GeV, multibunch'</span>;
0077     AD.Energy = 2.7391; <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0078     ModeName = <span class="string">'boosterreal'</span>;
0079     OpsFileExtension = <span class="string">'_boosterreal'</span>;
0080 
0081     <span class="comment">% AT lattice</span>
0082     <span class="comment">%AD.ATModel       = 'boostersteerer'; % lattice file</span>
0083     AD.ATModel = <span class="string">'boosterreal'</span>;
0084     eval(AD.ATModel);  <span class="comment">%run model for compilersolamor2linb;</span>
0085 
0086     switch2hw;
0087     
0088 <span class="keyword">elseif</span> ModeNumber == 100
0089     <span class="comment">% User mode - High Tune, Top Off injection</span>
0090     error(<span class="string">'To be completed'</span>);    
0091 
0092 <span class="keyword">else</span>
0093     error(<span class="string">'Operational mode unknown'</span>);
0094 <span class="keyword">end</span>
0095 
0096 
0097 
0098 <span class="comment">% Set the AD directory path</span>
0099 setad(AD);
0100 MMLROOT = setmmldirectories(AD.Machine, AD.SubMachine, ModeName, OpsFileExtension);
0101 AD = getad;
0102 
0103 <span class="comment">% SOLEIL specific path changes</span>
0104 
0105  <span class="comment">% Top Level Directories</span>
0106 
0107 AD.Directory.DataRoot       = fullfile(MMLROOT, <span class="string">'measdata'</span>, <span class="string">'Boosterdata'</span>, filesep);
0108 AD.Directory.OpsData        = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'BoosterOpsData'</span>, filesep);
0109 AD.Directory.Lattice        = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'Booster'</span>, <span class="string">'Lattices'</span>, filesep);
0110 AD.Directory.Orbit          = fullfile(MMLROOT, <span class="string">'applications'</span>, <span class="string">'orbit'</span>, filesep);
0111 
0112 <span class="comment">% Data Archive Directories</span>
0113 AD.Directory.BPMData        = fullfile(AD.Directory.DataRoot, <span class="string">'BPM'</span>, filesep);
0114 AD.Directory.TuneData       = fullfile(AD.Directory.DataRoot, <span class="string">'Tune'</span>, filesep);
0115 AD.Directory.ChroData       = fullfile(AD.Directory.DataRoot, <span class="string">'Chromaticity'</span>, filesep);
0116 AD.Directory.DispData       = fullfile(AD.Directory.DataRoot, <span class="string">'Dispersion'</span>, filesep);
0117 AD.Directory.ConfigData     = fullfile(AD.Directory.DataRoot, <span class="string">'MachineConfig'</span>, filesep);
0118 AD.Directory.BumpData       = fullfile(AD.Directory.DataRoot, <span class="string">'Bumps'</span>, filesep);
0119 AD.Directory.Archiving      = fullfile(AD.Directory.DataRoot, <span class="string">'ArchivingData'</span>, filesep);
0120 AD.Directory.TurnByTurnTune = fullfile(AD.Directory.DataRoot, <span class="string">'BPM'</span>, <span class="string">'turnbyturntune'</span>);
0121 
0122 
0123 <span class="comment">% quick fix (dixit Alex)</span>
0124 AD.Directory.Timing         = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'LT1'</span>, <span class="string">'LT1data'</span>, <span class="string">'Timing'</span>, filesep);
0125 
0126 <span class="comment">%Response Matrix Directories</span>
0127 AD.Directory.BPMResponse    = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'BPM'</span>, filesep);
0128 AD.Directory.TuneResponse   = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'Tune'</span>, filesep);
0129 AD.Directory.ChroResponse   = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'Chrom'</span>, filesep);
0130 AD.Directory.DispResponse   = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'Disp'</span>, filesep);
0131 
0132 <span class="comment">%Default Data File Prefix</span>
0133 AD.Default.BPMArchiveFile   = <span class="string">'BPM'</span>;                <span class="comment">%file in AD.Directory.BPM               orbit data</span>
0134 AD.Default.TuneArchiveFile  = <span class="string">'Tune'</span>;               <span class="comment">%file in AD.Directory.Tune              tune data</span>
0135 AD.Default.ChroArchiveFile  = <span class="string">'Chro'</span>;               <span class="comment">%file in AD.Directory.Chromaticity       chromaticity data</span>
0136 AD.Default.DispArchiveFile  = <span class="string">'Disp'</span>;               <span class="comment">%file in AD.Directory.Dispersion       dispersion data</span>
0137 AD.Default.CNFArchiveFile   = <span class="string">'CNF'</span>;                <span class="comment">%file in AD.Directory.CNF               configuration data</span>
0138 AD.Default.QUADArchiveFile  = <span class="string">'QuadBeta'</span>;           <span class="comment">%file in AD.Directory.QUAD             betafunction for quadrupoles</span>
0139 
0140 <span class="comment">%Default Response Matrix File Prefix</span>
0141 AD.Default.BPMRespFile      = <span class="string">'BPMRespMat'</span>;         <span class="comment">%file in AD.Directory.BPMResponse       BPM response matrices</span>
0142 AD.Default.TuneRespFile     = <span class="string">'TuneRespMat'</span>;        <span class="comment">%file in AD.Directory.TuneResponse      tune response matrices</span>
0143 AD.Default.ChroRespFile     = <span class="string">'ChroRespMat'</span>;        <span class="comment">%file in AD.Directory.ChroResponse      chromaticity response matrices</span>
0144 AD.Default.DispRespFile     = <span class="string">'DispRespMat'</span>;        <span class="comment">%file in AD.Directory.DispResponse      dispersion response matrices</span>
0145 
0146 <span class="comment">%Operational Files</span>
0147 AD.OpsData.LatticeFile       = <span class="string">'GoldenLattice'</span>;     <span class="comment">%Golden Lattice File (setup for users)</span>
0148 AD.OpsData.PhysDataFile      = <span class="string">'GoldenPhysData'</span>;
0149 <span class="comment">%AD.OpsData.BPMGoldenFile     = 'GoldenBPMOrbit';</span>
0150 <span class="comment">%AD.OpsData.BPMOffsetFile     = 'OffsetBPMOrbit';</span>
0151 AD.OpsData.BPMSigmaFile      = <span class="string">'BPMSigma'</span>;
0152 <span class="comment">%AD.OpsData.TuneFile          = 'GoldenTune';</span>
0153 <span class="comment">%AD.OpsData.ChroFile          = 'GoldenChro';</span>
0154 <span class="comment">%AD.OpsData.DispFile          = 'GoldenDisp';</span>
0155 
0156 <span class="comment">%Operational Response Files</span>
0157 AD.OpsData.BPMRespFile       = <span class="string">'GoldenBPMResp'</span>;     
0158 AD.OpsData.TuneRespFile      = <span class="string">'GoldenTuneResp'</span>;    
0159 AD.OpsData.ChroRespFile      = <span class="string">'GoldenChroResp'</span>; 
0160 AD.OpsData.DispRespFile      = <span class="string">'GoldenDispResp'</span>;
0161 AD.OpsData.RespFiles         = {AD.OpsData.BPMRespFile,  <span class="keyword">...</span>
0162                                 AD.OpsData.TuneRespFile, <span class="keyword">...</span>
0163                                 AD.OpsData.ChroRespFile, <span class="keyword">...</span>
0164                                 AD.OpsData.DispRespFile};
0165 
0166 <span class="comment">% Circumference</span>
0167 AD.Circumference = findspos(THERING,length(THERING)+1);
0168 setad(AD);
0169 
0170 <span class="comment">% Updates the AT indices in the MiddleLayer with the present AT lattice</span>
0171 <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>;
0172 
0173 <span class="comment">% Set the model energy</span>
0174 setenergymodel(AD.Energy);
0175 
0176 
0177 <span class="comment">% Momentum compaction factor</span>
0178 MCF = getmcf(<span class="string">'Model'</span>);
0179 <span class="keyword">if</span> isnan(MCF)
0180     AD.MCF = 0.0150;  
0181     fprintf(<span class="string">'   Model alpha calculation failed, middlelayer alpha set to  %f\n'</span>, AD.MCF);
0182 <span class="keyword">else</span>
0183     AD.MCF = MCF;
0184     fprintf(<span class="string">'   Middlelayer alpha set to %f (AT model).\n'</span>, AD.MCF);
0185 <span class="keyword">end</span>
0186 setad(AD);
0187 
0188 
0189 fprintf(<span class="string">'   lattice files have changed or if the AT lattice has changed.\n'</span>);
0190 fprintf(<span class="string">'   Middlelayer setup for operational mode: %s\n'</span>, AD.OperationalMode);
0191 
0192 setad(orderfields(AD));</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>