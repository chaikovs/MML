<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of amp2k</title>
  <meta name="keywords" content="amp2k">
  <meta name="description" content="AMP2K - Converts amperes to simulator values">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="index.html">common</a> &gt; amp2k.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/common&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>amp2k
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>AMP2K - Converts amperes to simulator values</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function k = amp2k(Family, Field, Amps, DeviceList, Energy, C, K2AmpScaleFactor) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">AMP2K - Converts amperes to simulator values
  k = amp2k(Family, Field, Amps, DeviceList, Energy, Coefficients, K2AmpScaleFactor)
    or
  k = amp2k(Family, Field, Amps, DeviceList, Energy, MagnetCoreType, K2AmpScaleFactor)

  Calculates the &quot;K-value&quot; from the coefficients (or MagnetCoreType), current [amps], energy, and linear scale factor

  A Coefficients vector or a MagnetCoreType string (coefficient found from magnetcoefficents.m) can be used
  Amps and Coefficients must have equal number of rows or one must only have one row
 INPUTS
 1. Family - Family Name
 2. Field  - Family Field (like 'Setpoint')
 3. Amps   - Ampere vector to convert
 4. DeviceList - Device list (Amps and DeviceList must have the same
 number of rows)
 5. Energy - Energy in GeV {Default: getenergy}
              If Energy is a vector, each output column will correspond to that energy.
              Energy can be anything getenergy accepts, like 'Model' or 'Online'. 
              (Note: If Energy is a vector, then Amps can only have 1
              column)Family, Field, value(:,i), DeviceList, Energy, ParamsList{:}
 6. C - %  A Coefficients vector or a MagnetCoreType string (coefficient found from magnetcoefficents.m) can be used
  Amps and Coefficients must have equal number of rows or one must only
  have one row
 7. K2AmpScaleFactor - linearly scales the input current:  Amps = Amps ./ K2AmpScaleFactor
    This can be used to account for linear calibration errors of the power supply and magnet

 OUTPUT
 1. K and B - K-value and field in AT convention
    For dipole:      k = B / Brho
    For quadrupole:  k = B'/ Brho
    For sextupole:   k = B&quot;/ Brho / 2  (to be compatible with AT)

  NOTES
  1. If energy is not an input or empty, then the energy is obtained from getenergy.
  2. Family and Field inputs are not used but there automatically part of the hw2physics call. 

 See Also <a href="k2amp.html" class="code" title="function Amps = k2amp(Family, Field, k, DeviceList, Energy, C, K2AmpScaleFactor)">k2amp</a>, <a href="magnetcoefficients.html" class="code" title="function [C, Leff, MagnetType, A] = magnetcoefficients(MagnetCoreType, Amps, InputType)">magnetcoefficients</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="magnetcoefficients.html" class="code" title="function [C, Leff, MagnetType, A] = magnetcoefficients(MagnetCoreType, Amps, InputType)">magnetcoefficients</a>	MAGNETCOEFFICIENTS - Retrieves coefficient for conversion between Physics and Hardware units</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="listfonction.html" class="code" title="">listfonction</a>	</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function k = amp2k(Family, Field, Amps, DeviceList, Energy, C, K2AmpScaleFactor)</a>
0002 <span class="comment">%AMP2K - Converts amperes to simulator values</span>
0003 <span class="comment">%  k = amp2k(Family, Field, Amps, DeviceList, Energy, Coefficients, K2AmpScaleFactor)</span>
0004 <span class="comment">%    or</span>
0005 <span class="comment">%  k = amp2k(Family, Field, Amps, DeviceList, Energy, MagnetCoreType, K2AmpScaleFactor)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%  Calculates the &quot;K-value&quot; from the coefficients (or MagnetCoreType), current [amps], energy, and linear scale factor</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%  A Coefficients vector or a MagnetCoreType string (coefficient found from magnetcoefficents.m) can be used</span>
0010 <span class="comment">%  Amps and Coefficients must have equal number of rows or one must only have one row</span>
0011 <span class="comment">% INPUTS</span>
0012 <span class="comment">% 1. Family - Family Name</span>
0013 <span class="comment">% 2. Field  - Family Field (like 'Setpoint')</span>
0014 <span class="comment">% 3. Amps   - Ampere vector to convert</span>
0015 <span class="comment">% 4. DeviceList - Device list (Amps and DeviceList must have the same</span>
0016 <span class="comment">% number of rows)</span>
0017 <span class="comment">% 5. Energy - Energy in GeV {Default: getenergy}</span>
0018 <span class="comment">%              If Energy is a vector, each output column will correspond to that energy.</span>
0019 <span class="comment">%              Energy can be anything getenergy accepts, like 'Model' or 'Online'.</span>
0020 <span class="comment">%              (Note: If Energy is a vector, then Amps can only have 1</span>
0021 <span class="comment">%              column)Family, Field, value(:,i), DeviceList, Energy, ParamsList{:}</span>
0022 <span class="comment">% 6. C - %  A Coefficients vector or a MagnetCoreType string (coefficient found from magnetcoefficents.m) can be used</span>
0023 <span class="comment">%  Amps and Coefficients must have equal number of rows or one must only</span>
0024 <span class="comment">%  have one row</span>
0025 <span class="comment">% 7. K2AmpScaleFactor - linearly scales the input current:  Amps = Amps ./ K2AmpScaleFactor</span>
0026 <span class="comment">%    This can be used to account for linear calibration errors of the power supply and magnet</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% OUTPUT</span>
0029 <span class="comment">% 1. K and B - K-value and field in AT convention</span>
0030 <span class="comment">%    For dipole:      k = B / Brho</span>
0031 <span class="comment">%    For quadrupole:  k = B'/ Brho</span>
0032 <span class="comment">%    For sextupole:   k = B&quot;/ Brho / 2  (to be compatible with AT)</span>
0033 <span class="comment">%</span>
0034 <span class="comment">%  NOTES</span>
0035 <span class="comment">%  1. If energy is not an input or empty, then the energy is obtained from getenergy.</span>
0036 <span class="comment">%  2. Family and Field inputs are not used but there automatically part of the hw2physics call.</span>
0037 <span class="comment">%</span>
0038 <span class="comment">% See Also k2amp, magnetcoefficients</span>
0039 
0040 <span class="comment">% ALGORITHM</span>
0041 <span class="comment">%</span>
0042 <span class="comment">% k = (c0 + c1*I + ... + cn*I^n)/Brho</span>
0043 
0044 <span class="comment">%</span>
0045 <span class="comment">% Written by M. Yoon 4/8/03</span>
0046 <span class="comment">% Adapted by Laurent S. Nadolski</span>
0047 
0048 <span class="keyword">if</span> nargin &lt; 4
0049     error(<span class="string">'At least 4 inputs required'</span>);
0050 <span class="keyword">end</span>
0051 
0052 <span class="keyword">if</span> nargin &lt; 6
0053     C = [];
0054 <span class="keyword">end</span>
0055 <span class="keyword">if</span> isempty(C)
0056     <span class="comment">%[C, Leff, MagnetName] = magnetcoefficients(Family);</span>
0057     C = getfamilydata(Family, Field, <span class="string">'HW2PhysicsParams'</span>, DeviceList);
0058     C = C{1};
0059     <span class="comment">%Leff = getleff(Family, DeviceList(ii,:));</span>
0060 <span class="keyword">end</span>
0061 
0062 <span class="keyword">if</span> nargin &lt; 5
0063     Energy = [];
0064 <span class="keyword">end</span>
0065 <span class="keyword">if</span> isempty(Energy)
0066     Energy = getenergy; <span class="comment">% like getenergy('Production')</span>
0067 <span class="keyword">elseif</span> ischar(Energy)
0068     Energy = getenergy(Energy);
0069 <span class="keyword">end</span>
0070 
0071 
0072 <span class="comment">% If Amps is a row vector make it a column vector</span>
0073 Amps = Amps(:);
0074 
0075 <span class="comment">% Scale solution if required</span>
0076 <span class="keyword">if</span> nargin &gt;= 7
0077     Amps = Amps ./ K2AmpScaleFactor;
0078 <span class="keyword">end</span>
0079 
0080 brho = getbrho(Energy);
0081 
0082 <span class="comment">% Compute polynomial expansion:  polynom = c0 + c1*I ...</span>
0083 <span class="comment">% For dipole:      polynom = B  * Leff / I</span>
0084 <span class="comment">% For quadrupole:  polynom = B' * Leff / I</span>
0085 <span class="comment">% For sextupole:   polynom = B&quot; * Leff / I  (use AT unit /2 from MAD units)</span>
0086 
0087 <span class="comment">% polynom = (C(8)+C(7)*Amps+C(6)*Amps^2+C(5)*Amps^3+C(4)*Amps^4+C(3)*Amps^5+C(2)*Amps^6+C(1)*Amps^7)</span>
0088 <span class="comment">% polynom = (c0+c1*Amps+c2*Amps^2+c3*Amps^3+c4*Amps^4+c5*Amps^5+c6*Amps^6+c7*Amps^7)</span>
0089 
0090 <span class="keyword">if</span> isstr(C)
0091     TableLookUpFlag = 1;
0092     MagnetCoreType = C;
0093     [C, Leff, MagnetName] = <a href="magnetcoefficients.html" class="code" title="function [C, Leff, MagnetType, A] = magnetcoefficients(MagnetCoreType, Amps, InputType)">magnetcoefficients</a>(MagnetCoreType, Amps(1));
0094     Amps0 = Amps(1);
0095 <span class="keyword">else</span>
0096     TableLookUpFlag = 0;
0097 <span class="keyword">end</span>
0098 
0099 <span class="keyword">if</span> any(size(C,1) ~= length(Amps))
0100     <span class="keyword">if</span> length(Amps) == 1
0101         Amps = ones(size(C,1),1) * Amps;
0102     <span class="keyword">elseif</span> size(C,1) == 1
0103         <span class="comment">%C = ones(size(Amps,1),1) * C;</span>
0104     <span class="keyword">else</span>
0105         error(<span class="string">'Amps and Coefficients must have equal number of rows or one must only have one row'</span>);
0106     <span class="keyword">end</span>
0107 <span class="keyword">end</span>
0108 
0109 <span class="comment">% B, B', or B&quot; scaled by energy</span>
0110 <span class="keyword">for</span> i = 1:length(Amps)
0111     <span class="comment">% For piecewise tables, get a new polynomial</span>
0112     <span class="keyword">if</span> TableLookUpFlag
0113         <span class="keyword">if</span> Amps(i) ~= Amps0;
0114             [C, Leff, MagnetName] = <a href="magnetcoefficients.html" class="code" title="function [C, Leff, MagnetType, A] = magnetcoefficients(MagnetCoreType, Amps, InputType)">magnetcoefficients</a>(MagnetCoreType, Amps(i));
0115             Amps0 = Amps(i);
0116         <span class="keyword">end</span>
0117     <span class="keyword">end</span>
0118     
0119     <span class="keyword">if</span> size(C,1) == 1
0120         k(i,1) = polyval(C, Amps(i)) / brho;
0121     <span class="keyword">else</span>
0122         k(i,1) = polyval(C(i,:), Amps(i)) / brho;
0123     <span class="keyword">end</span>
0124 <span class="keyword">end</span>
0125 
0126 
0127 <span class="comment">% switch upper(deblank(MagnetName))</span>
0128 <span class="comment">%     case 'BEND'</span>
0129 <span class="comment">%         k = (Amps/brho)*polynom/Leff;   % B scaled by energy</span>
0130 <span class="comment">%         %BLeff = Amps*polynom;</span>
0131 <span class="comment">%         %B = BLeff/Leff;</span>
0132 <span class="comment">%</span>
0133 <span class="comment">%     case 'QUAD'</span>
0134 <span class="comment">%         k = (Amps/brho)*polynom/Leff;   % B' scaled by energy</span>
0135 <span class="comment">%         %BPrimeLeff = Amps*polynom;</span>
0136 <span class="comment">%         %Bprime = BPrimeLeff/Leff;</span>
0137 <span class="comment">%</span>
0138 <span class="comment">%     case 'SEXT'</span>
0139 <span class="comment">%         k = (Amps/brho)*polynom/Leff;   % B&quot; scaled by energy</span>
0140 <span class="comment">%         %BPrimePrimeLeff = Amps*polynom;</span>
0141 <span class="comment">%         %BPrimePrime = BPrimePrimeLeff/Leff;</span>
0142 <span class="comment">% end</span></pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>