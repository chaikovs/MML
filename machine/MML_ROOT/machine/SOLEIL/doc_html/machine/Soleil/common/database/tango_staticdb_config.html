<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of tango_staticdb_config</title>
  <meta name="keywords" content="tango_staticdb_config">
  <meta name="description" content="TANGO_STATICDB_EDITOR M-file for tango_staticdb_config.fig">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="../index.html">common</a> &gt; <a href="index.html">database</a> &gt; tango_staticdb_config.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/common/database&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>tango_staticdb_config
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>TANGO_STATICDB_EDITOR M-file for tango_staticdb_config.fig</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function varargout = tango_staticdb_config(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> TANGO_STATICDB_EDITOR M-file for tango_staticdb_config.fig
      TANGO_STATICDB_EDITOR, by itself, creates a new TANGO_STATICDB_EDITOR or raises the existing
      singleton*.

      H = TANGO_STATICDB_EDITOR returns the handle to a new TANGO_STATICDB_EDITOR or the handle to
      the existing singleton*.

      TANGO_STATICDB_EDITOR('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in TANGO_STATICDB_EDITOR.M with the given input arguments.

      TANGO_STATICDB_EDITOR('Property','Value',...) creates a new TANGO_STATICDB_EDITOR or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before tango_staticdb_config_OpeningFunction gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to tango_staticdb_config_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one
      instance to run (singleton)&quot;.

 See also: GUIDE, GUIDATA, GUIHANDLES</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function tango_staticdb_config_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = tango_staticdb_config_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function popupmenu_group_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function popupmenu_group_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function popupmenu_attribute_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function popupmenu_attribute_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function popupmenu_property_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function popupmenu_property_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function listbox_group_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function listbox_group_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function listbox_property_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function listbox_property_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function checkbox_all_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function edit_value_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function edit_value_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function uimenu_linac_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function uimenu_LT1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub18" class="code">function handles = init_uimenu(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function uimenu_booster_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function uimenu_LT2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function uimenu_anneau_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function listbox_attribute_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function listbox_attribute_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function popupmenu_command_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub25" class="code">function popupmenu_command_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function pushbutton_apply_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub27" class="code">function pushbutton_refresh_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub28" class="code">function listbox_log_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub29" class="code">function listbox_log_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub30" class="code">function writelog(strvalue, handles)</a></li><li><a href="#_sub31" class="code">function listbox_dev_property_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub32" class="code">function listbox_dev_property_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub33" class="code">function popupmenu_dev_prop_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub34" class="code">function popupmenu_dev_prop_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub35" class="code">function edit_dev_propvalue_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub36" class="code">function edit_dev_propvalue_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub37" class="code">function edit_dev_propname_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub38" class="code">function edit_dev_propname_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub39" class="code">function pushbutton_dev_prop_Callback(hObject, eventdata, handles)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = tango_staticdb_config(varargin)</a>
0002 <span class="comment">% TANGO_STATICDB_EDITOR M-file for tango_staticdb_config.fig</span>
0003 <span class="comment">%      TANGO_STATICDB_EDITOR, by itself, creates a new TANGO_STATICDB_EDITOR or raises the existing</span>
0004 <span class="comment">%      singleton*.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%      H = TANGO_STATICDB_EDITOR returns the handle to a new TANGO_STATICDB_EDITOR or the handle to</span>
0007 <span class="comment">%      the existing singleton*.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%      TANGO_STATICDB_EDITOR('CALLBACK',hObject,eventData,handles,...) calls the local</span>
0010 <span class="comment">%      function named CALLBACK in TANGO_STATICDB_EDITOR.M with the given input arguments.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%      TANGO_STATICDB_EDITOR('Property','Value',...) creates a new TANGO_STATICDB_EDITOR or raises the</span>
0013 <span class="comment">%      existing singleton*.  Starting from the left, property value pairs are</span>
0014 <span class="comment">%      applied to the GUI before tango_staticdb_config_OpeningFunction gets called.  An</span>
0015 <span class="comment">%      unrecognized property name or invalid value makes property application</span>
0016 <span class="comment">%      stop.  All inputs are passed to tango_staticdb_config_OpeningFcn via varargin.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one</span>
0019 <span class="comment">%      instance to run (singleton)&quot;.</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% See also: GUIDE, GUIDATA, GUIHANDLES</span>
0022 
0023 <span class="comment">% Copyright 2002-2003 The MathWorks, Inc.</span>
0024 
0025 <span class="comment">% Edit the above text to modify the response to help tango_staticdb_config</span>
0026 
0027 <span class="comment">% Last Modified by GUIDE v2.5 24-Mar-2006 11:54:22</span>
0028 
0029 <span class="comment">% Laurent S. Nadolski, SOLEIL</span>
0030 
0031 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0032 gui_Singleton = 1;
0033 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0034     <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0035     <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction tango_staticdb_config_OpeningFcn(hObject, eventdata, handles, varargin)">tango_staticdb_config_OpeningFcn</a>, <span class="keyword">...</span>
0036     <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = tango_staticdb_config_OutputFcn(hObject, eventdata, handles)">tango_staticdb_config_OutputFcn</a>, <span class="keyword">...</span>
0037     <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0038     <span class="string">'gui_Callback'</span>,   []);
0039 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0040     gui_State.gui_Callback = str2func(varargin{1});
0041 <span class="keyword">end</span>
0042 
0043 <span class="keyword">if</span> nargout
0044     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0045 <span class="keyword">else</span>
0046     gui_mainfcn(gui_State, varargin{:});
0047 <span class="keyword">end</span>
0048 <span class="comment">% End initialization code - DO NOT EDIT</span>
0049 
0050 
0051 <span class="comment">% --- Executes just before tango_staticdb_config is made visible.</span>
0052 <a name="_sub1" href="#_subfunctions" class="code">function tango_staticdb_config_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0053 <span class="comment">% This function has no output args, see OutputFcn.</span>
0054 <span class="comment">% hObject    handle to figure</span>
0055 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0056 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0057 <span class="comment">% varargin   command line arguments to tango_staticdb_config (see VARARGIN)</span>
0058 
0059 <span class="comment">% Choose default command line output for tango_staticdb_config</span>
0060 handles.output = hObject;
0061 
0062 <span class="comment">% Update handles structure</span>
0063 guidata(hObject, handles);
0064 
0065 <span class="comment">% UIWAIT makes tango_staticdb_config wait for user response (see UIRESUME)</span>
0066 <span class="comment">% uiwait(handles.figure1);</span>
0067 
0068 disp(<span class="string">'TANGO Static DataBase Configurator'</span>);
0069 
0070 set(handles.figure1,<span class="string">'HandleVisibility'</span>,<span class="string">'Callback'</span>);
0071 set(handles.listbox_log, <span class="string">'String'</span>,{[datestr(now) <span class="string">': application started'</span>], <span class="string">' '</span>});
0072 
0073 <span class="comment">% uimenu_anneau_Callback(handles.uimenu_LT1, eventdata, handles);</span>
0074 <span class="comment">%uimenu_LT1_Callback(handles.uimenu_LT1, eventdata, handles);</span>
0075 <span class="comment">% Update handles structure</span>
0076 guidata(hObject, handles);
0077 
0078 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0079 <a name="_sub2" href="#_subfunctions" class="code">function varargout = tango_staticdb_config_OutputFcn(hObject, eventdata, handles)</a>
0080 <span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
0081 <span class="comment">% hObject    handle to figure</span>
0082 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0083 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0084 
0085 <span class="comment">% Get default command line output from handles structure</span>
0086 varargout{1} = handles.output;
0087 
0088 
0089 <span class="comment">% --- Executes on selection change in popupmenu_group.</span>
0090 <a name="_sub3" href="#_subfunctions" class="code">function popupmenu_group_Callback(hObject, eventdata, handles)</a>
0091 <span class="comment">% hObject    handle to popupmenu_group (see GCBO)</span>
0092 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0093 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0094 
0095 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_group contents as cell array</span>
0096 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_group</span>
0097 
0098 contents = get(hObject,<span class="string">'String'</span>);
0099 num      = get(hObject,<span class="string">'Value'</span>);
0100 family   = contents{num};
0101 
0102 AO = getfamilydata(family);
0103 setappdata(handles.figure1,<span class="string">'AO'</span>,AO);
0104 setappdata(handles.figure1, <span class="string">'Family'</span>, family);
0105 
0106 <span class="comment">%% Status one devices</span>
0107 valid  = find(AO.Status);
0108 <span class="comment">%% Builds up attribut list for selected family</span>
0109 <span class="keyword">if</span> ~iscell(AO.DeviceName)
0110     AO.DeviceName = {AO.DeviceName};
0111 <span class="keyword">end</span>
0112 
0113 attributeList = tango_get_attribute_list(AO.DeviceName{valid(1)});
0114 
0115 <span class="keyword">if</span> isnumeric(attributeList) &amp;&amp;  attributeList == -1
0116     error(<span class="string">'Cannot communicate with device %s'</span>,AO.DeviceName{valid(1)})
0117 <span class="keyword">end</span>
0118 
0119 num = get(handles.popupmenu_attribute,<span class="string">'Value'</span>);
0120 <span class="keyword">if</span> num &gt; length(attributeList)
0121     num = 1;
0122     set(handles.popupmenu_attribute,<span class="string">'Value'</span>,num);
0123 <span class="keyword">end</span>
0124 set(handles.popupmenu_attribute,<span class="string">'String'</span>,attributeList);
0125 
0126 <span class="comment">%setback selected elements and property to first one</span>
0127 set(handles.listbox_property,<span class="string">'Value'</span>,1);
0128 set(handles.listbox_group,<span class="string">'Value'</span>,1);
0129 set(handles.listbox_dev_property,<span class="string">'Value'</span>,1);
0130 
0131 <a href="#_sub5" class="code" title="subfunction popupmenu_attribute_Callback(hObject, eventdata, handles)">popupmenu_attribute_Callback</a>(handles.popupmenu_attribute, eventdata, handles);
0132 
0133 <span class="comment">%% Build up command list</span>
0134 <span class="comment">% popupmenu_group_Callback(handles.popupmenu_attribute, eventdata, handles);</span>
0135 
0136 commandList = tango_command_list_query(AO.DeviceName{valid(1)});
0137 
0138 num = get(handles.popupmenu_command,<span class="string">'Value'</span>);
0139 <span class="keyword">if</span> num &gt; length(attributeList)
0140     num = 1;
0141     set(handles.popupmenu_command,<span class="string">'Value'</span>,num);
0142 <span class="keyword">end</span>
0143 
0144 <span class="comment">% trick for getting a field array from a cell array</span>
0145 commandOutputType = eval([<span class="string">'{commandList.'</span>, <span class="string">'out_type}'</span>]);
0146 commandInputType  = eval([<span class="string">'{commandList.'</span>, <span class="string">'in_type}'</span>]);
0147 setappdata(handles.figure1,<span class="string">'cmd_output_type'</span>,commandOutputType);
0148 setappdata(handles.figure1,<span class="string">'cmd_input_type'</span>,commandInputType);
0149 commandList = eval([<span class="string">'{commandList.'</span>, <span class="string">'cmd_name}'</span>]);
0150 
0151 set(handles.popupmenu_command,<span class="string">'String'</span>,commandList);
0152 
0153 <span class="comment">%% Build up a NaN attribute value pannel</span>
0154 set(handles.listbox_attribute,<span class="string">'String'</span>, repmat(<span class="string">'NaN'</span>,size(AO.DeviceName)));
0155 set(handles.listbox_dev_property,<span class="string">'String'</span>, repmat(<span class="string">'NaN'</span>,size(AO.DeviceName)));
0156 
0157 <span class="comment">%% Build up device property device list</span>
0158 devPropList = tango_command_list_query(AO.DeviceName{valid(1)});
0159 
0160 <span class="comment">% Update handles structure</span>
0161 guidata(hObject, handles);
0162 
0163 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0164 <a name="_sub4" href="#_subfunctions" class="code">function popupmenu_group_CreateFcn(hObject, eventdata, handles)</a>
0165 <span class="comment">% hObject    handle to popupmenu_group (see GCBO)</span>
0166 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0167 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0168 
0169 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0170 <span class="comment">%       See ISPC and COMPUTER.</span>
0171 <span class="keyword">if</span> ispc
0172     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0173 <span class="keyword">else</span>
0174     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0175 <span class="keyword">end</span>
0176 
0177 
0178 <span class="comment">% --- Executes on selection change in popupmenu_attribute.</span>
0179 <a name="_sub5" href="#_subfunctions" class="code">function popupmenu_attribute_Callback(hObject, eventdata, handles)</a>
0180 <span class="comment">% hObject    handle to popupmenu_attribute (see GCBO)</span>
0181 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0182 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0183 
0184 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_attribute contents as cell array</span>
0185 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_attribute</span>
0186 
0187 contents  = get(hObject,<span class="string">'String'</span>);
0188 num       = get(hObject,<span class="string">'Value'</span>);
0189 attribute = contents{num};
0190 
0191 family     = getappdata(handles.figure1,<span class="string">'Family'</span>);
0192 AO         = getappdata(handles.figure1,<span class="string">'AO'</span>);
0193 
0194 <span class="comment">%% Selects valid devices</span>
0195 valid  = find(AO.Status);
0196 <span class="comment">%% Builds up property list for selected family</span>
0197 
0198 <span class="keyword">if</span> ~iscell(AO.DeviceName)
0199     AO.DeviceName = cellstr(AO.DeviceName);
0200 <span class="keyword">end</span>
0201     
0202 propertyList = fieldnames(tango_attribute_query(AO.DeviceName{valid(1)}, attribute));
0203 
0204 num = get(hObject,<span class="string">'Value'</span>);
0205 <span class="keyword">if</span> num &gt; length(propertyList)
0206     num = 1;
0207     set(handles.popupmenu_property,<span class="string">'Value'</span>,num);
0208 <span class="keyword">end</span>
0209 set(handles.popupmenu_property,<span class="string">'String'</span>,propertyList);
0210 
0211 <span class="comment">% Reset to first item in selection list</span>
0212 set(handles.listbox_property,<span class="string">'Value'</span>,1);
0213 set(handles.listbox_group,<span class="string">'Value'</span>,1);
0214 set(handles.listbox_attribute,<span class="string">'Value'</span>,1);
0215 
0216 <a href="#_sub7" class="code" title="subfunction popupmenu_property_Callback(hObject, eventdata, handles)">popupmenu_property_Callback</a>(handles.popupmenu_property, eventdata, handles);
0217 
0218 <span class="comment">%set(handles.radiobutton_property,'Value',1);</span>
0219 
0220 <span class="comment">% Update handles structure</span>
0221 guidata(hObject, handles);
0222 
0223 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0224 <a name="_sub6" href="#_subfunctions" class="code">function popupmenu_attribute_CreateFcn(hObject, eventdata, handles)</a>
0225 <span class="comment">% hObject    handle to popupmenu_attribute (see GCBO)</span>
0226 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0227 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0228 
0229 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0230 <span class="comment">%       See ISPC and COMPUTER.</span>
0231 <span class="keyword">if</span> ispc
0232     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0233 <span class="keyword">else</span>
0234     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0235 <span class="keyword">end</span>
0236 
0237 
0238 <span class="comment">% --- Executes on selection change in popupmenu_property.</span>
0239 <a name="_sub7" href="#_subfunctions" class="code">function popupmenu_property_Callback(hObject, eventdata, handles)</a>
0240 <span class="comment">% hObject    handle to popupmenu_property (see GCBO)</span>
0241 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0242 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0243 
0244 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_property contents as cell array</span>
0245 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_property</span>
0246 
0247 contents  = get(hObject,<span class="string">'String'</span>);
0248 num       = get(hObject,<span class="string">'Value'</span>);
0249 property  = contents{num};
0250 
0251 attribute  = get(handles.popupmenu_attribute,<span class="string">'String'</span>);
0252 iattribute = get(handles.popupmenu_attribute,<span class="string">'Value'</span>);
0253 AO         = getappdata(handles.figure1,<span class="string">'AO'</span>);
0254 
0255 
0256 <span class="comment">% Status one devices</span>
0257 valid  = find(AO.Status);
0258 
0259 <span class="comment">% Update Group list</span>
0260 
0261 <span class="keyword">if</span> ~iscell(AO.DeviceName) 
0262     AO.DeviceName = {AO.DeviceName};
0263 <span class="keyword">end</span>
0264 
0265 set(handles.listbox_group,<span class="string">'String'</span>,AO.DeviceName(valid));
0266 
0267 <span class="comment">% Contruct DeviceName/AttributName list</span>
0268 fullTangoNames = strcat(AO.DeviceName(valid), <span class="string">'/'</span>, attribute{iattribute});
0269 
0270 <span class="comment">% Builds up property list</span>
0271 list = tango_get_attribute_property(fullTangoNames, property);
0272 set(handles.listbox_property,<span class="string">'String'</span>,list);
0273 <span class="comment">% Reset to first item in selection list</span>
0274 set(handles.listbox_property,<span class="string">'Value'</span>,1);
0275 set(handles.listbox_group,<span class="string">'Value'</span>,1);
0276 set(handles.listbox_attribute,<span class="string">'Value'</span>,1);
0277 set(handles.checkbox_all,<span class="string">'Value'</span>,0);
0278 
0279 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Values for property '''</span> char(property) <span class="string">''' refreshed'</span>],handles);
0280 
0281 <span class="comment">%popupmenu_command_Callback(handles.popupmenu_property, eventdata, handles);</span>
0282 
0283 <span class="comment">% Update handles structure</span>
0284 guidata(hObject, handles);
0285 
0286 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0287 <a name="_sub8" href="#_subfunctions" class="code">function popupmenu_property_CreateFcn(hObject, eventdata, handles)</a>
0288 <span class="comment">% hObject    handle to popupmenu_property (see GCBO)</span>
0289 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0290 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0291 
0292 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0293 <span class="comment">%       See ISPC and COMPUTER.</span>
0294 <span class="keyword">if</span> ispc
0295     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0296 <span class="keyword">else</span>
0297     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0298 <span class="keyword">end</span>
0299 
0300 <span class="comment">% --- Executes on selection change in listbox_group.</span>
0301 <a name="_sub9" href="#_subfunctions" class="code">function listbox_group_Callback(hObject, eventdata, handles)</a>
0302 <span class="comment">% hObject    handle to listbox_group (see GCBO)</span>
0303 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0304 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0305 
0306 <span class="comment">% Hints: contents = get(hObject,'String') returns listbox_group contents as cell array</span>
0307 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox_group</span>
0308 
0309 idx = get(hObject,<span class="string">'Value'</span>);
0310 
0311 set(handles.listbox_attribute,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0312 set(handles.listbox_property,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0313 set(handles.listbox_dev_property,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0314 set(handles.checkbox_all,<span class="string">'Value'</span>,0);
0315 
0316 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0317 <a name="_sub10" href="#_subfunctions" class="code">function listbox_group_CreateFcn(hObject, eventdata, handles)</a>
0318 <span class="comment">% hObject    handle to listbox_group (see GCBO)</span>
0319 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0320 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0321 
0322 <span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
0323 <span class="comment">%       See ISPC and COMPUTER.</span>
0324 <span class="keyword">if</span> ispc
0325     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0326 <span class="keyword">else</span>
0327     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0328 <span class="keyword">end</span>
0329 
0330 
0331 <span class="comment">% --- Executes on selection change in listbox_property.</span>
0332 <a name="_sub11" href="#_subfunctions" class="code">function listbox_property_Callback(hObject, eventdata, handles)</a>
0333 <span class="comment">% hObject    handle to listbox_property (see GCBO)</span>
0334 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0335 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0336 
0337 <span class="comment">% Hints: contents = get(hObject,'String') returns listbox_property contents as cell array</span>
0338 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox_property</span>
0339 
0340 contents = get(hObject,<span class="string">'String'</span>);
0341 idx = get(hObject,<span class="string">'Value'</span>);
0342 
0343 set(handles.listbox_group,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0344 set(handles.listbox_attribute,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0345 set(handles.listbox_dev_property,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0346 set(handles.checkbox_all,<span class="string">'Value'</span>,0);
0347 
0348 set(handles.edit_value,<span class="string">'String'</span>,contents{idx(1)});
0349 
0350 <span class="comment">%select radiobutton</span>
0351 set(handles.radiobutton_property,<span class="string">'Value'</span>,1);
0352 
0353 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0354 <a name="_sub12" href="#_subfunctions" class="code">function listbox_property_CreateFcn(hObject, eventdata, handles)</a>
0355 <span class="comment">% hObject    handle to listbox_property (see GCBO)</span>
0356 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0357 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0358 
0359 <span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
0360 <span class="comment">%       See ISPC and COMPUTER.</span>
0361 <span class="keyword">if</span> ispc
0362     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0363 <span class="keyword">else</span>
0364     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0365 <span class="keyword">end</span>
0366 
0367 
0368 <span class="comment">% --- Executes on button press in checkbox_all.</span>
0369 <a name="_sub13" href="#_subfunctions" class="code">function checkbox_all_Callback(hObject, eventdata, handles)</a>
0370 <span class="comment">% hObject    handle to checkbox_all (see GCBO)</span>
0371 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0372 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0373 
0374 <span class="comment">% Hint: get(hObject,'Value') returns toggle state of checkbox_all</span>
0375 val = get(handles.listbox_group,<span class="string">'String'</span>);
0376 
0377 <span class="keyword">if</span> get(hObject,<span class="string">'Value'</span>) == 1
0378     set(handles.listbox_group,<span class="string">'Value'</span>,1:length(val));
0379     set(handles.listbox_attribute,<span class="string">'Value'</span>,1:length(val));
0380     set(handles.listbox_property,<span class="string">'Value'</span>,1:length(val));
0381     set(handles.listbox_dev_property,<span class="string">'Value'</span>,1:length(val));
0382     set(handles.listbox_group,<span class="string">'listboxtop'</span>,1);
0383     set(handles.listbox_attribute,<span class="string">'listboxtop'</span>,1);
0384     set(handles.listbox_property,<span class="string">'listboxtop'</span>,1);
0385     set(handles.listbox_dev_property,<span class="string">'listboxtop'</span>,1);
0386 <span class="keyword">end</span>
0387 
0388 <a name="_sub14" href="#_subfunctions" class="code">function edit_value_Callback(hObject, eventdata, handles)</a>
0389 <span class="comment">% hObject    handle to edit_value (see GCBO)</span>
0390 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0391 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0392 
0393 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_value as text</span>
0394 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_value as a double</span>
0395 
0396 <span class="comment">% First of all, ask for confirmation</span>
0397 answer = questdlg(<span class="string">'Do you want to apply change ?'</span>,<span class="string">'Confirmation dialog box'</span>);
0398 
0399 <span class="keyword">switch</span> answer
0400     <span class="keyword">case</span> <span class="string">'Yes'</span>
0401 
0402         <span class="comment">% Get the new value</span>
0403         <span class="comment">% Need to force char array</span>
0404         value = char(get(hObject,<span class="string">'String'</span>));       
0405 
0406         attribute  = get(handles.popupmenu_attribute,<span class="string">'String'</span>);
0407         iattribute = get(handles.popupmenu_attribute,<span class="string">'Value'</span>);
0408         property   = get(handles.popupmenu_property,<span class="string">'String'</span>);
0409         iproperty  = get(handles.popupmenu_property,<span class="string">'Value'</span>);        
0410         iSelected  = get(handles.listbox_group,<span class="string">'Value'</span>);
0411         Family     = getappdata(handles.figure1, <span class="string">'Family'</span>);
0412         DeviceName = family2tangodev(Family);
0413 
0414         <span class="keyword">switch</span> get(handles.radiobutton_property,<span class="string">'Value'</span>)
0415 
0416             <span class="keyword">case</span> 1 <span class="comment">% property change</span>
0417 
0418                 <span class="comment">%% Get selected element</span>
0419                 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Please wait: writting property '</span> property{iproperty}  <span class="string">'...'</span>], handles);
0420                 
0421                 tango_set_attribute_property(strcat(DeviceName(iSelected), <span class="keyword">...</span>
0422                     <span class="string">'/'</span>,attribute{iattribute}),property{iproperty}, value)
0423                 
0424                 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'Properties written'</span>, handles);
0425                 
0426                 <span class="comment">% refresh display</span>
0427                 <a href="#_sub7" class="code" title="subfunction popupmenu_property_Callback(hObject, eventdata, handles)">popupmenu_property_Callback</a>(handles.popupmenu_property,eventdata, handles);
0428 
0429             <span class="keyword">case</span> 0 <span class="comment">%attribute change</span>
0430                                                
0431                <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Please wait: writting attributes '</span>, attribute{iattribute}, <span class="string">'  ...'</span>], handles);
0432  
0433                value = repmat(value,size(DeviceName(iSelected),1),1);
0434                writeattribute(strcat(DeviceName(iSelected), <span class="keyword">...</span>
0435                    <span class="string">'/'</span>,attribute{iattribute}), value, <span class="string">'QueryDB'</span>);
0436 
0437                <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'Attributes written'</span>, handles);
0438 
0439                 <span class="comment">% refresh display</span>
0440                 <a href="#_sub27" class="code" title="subfunction pushbutton_refresh_Callback(hObject, eventdata, handles)">pushbutton_refresh_Callback</a>(handles.pushbutton_refresh,eventdata, handles);
0441         <span class="keyword">end</span>
0442     <span class="keyword">case</span> {<span class="string">'No'</span>,<span class="string">'Cancel'</span>}
0443         <span class="keyword">return</span>;
0444     <span class="keyword">otherwise</span>
0445         warning(<span class="string">'Wrong answer'</span>)
0446 <span class="keyword">end</span>
0447 
0448 
0449 
0450 
0451 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0452 <a name="_sub15" href="#_subfunctions" class="code">function edit_value_CreateFcn(hObject, eventdata, handles)</a>
0453 <span class="comment">% hObject    handle to edit_value (see GCBO)</span>
0454 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0455 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0456 
0457 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
0458 <span class="comment">%       See ISPC and COMPUTER.</span>
0459 <span class="keyword">if</span> ispc
0460     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0461 <span class="keyword">else</span>
0462     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0463 <span class="keyword">end</span>
0464 
0465 
0466 <span class="comment">% --------------------------------------------------------------------</span>
0467 <a name="_sub16" href="#_subfunctions" class="code">function uimenu_linac_Callback(hObject, eventdata, handles)</a>
0468 <span class="comment">% hObject    handle to uimenu_linac (see GCBO)</span>
0469 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0470 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0471 
0472 <a href="#_sub18" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0473 
0474 <span class="comment">% -------------------------------------------------------------------------</span>
0475 <a name="_sub17" href="#_subfunctions" class="code">function uimenu_LT1_Callback(hObject, eventdata, handles)</a>
0476 <span class="comment">% hObject    handle to uimenu_LT1 (see GCBO)</span>
0477 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0478 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0479 
0480 AD = getad;
0481 
0482 <span class="keyword">if</span> isempty(AD)
0483     LT1init;
0484 <span class="keyword">elseif</span> ~strcmpi(AD.Machine,<span class="string">'LT1'</span>)
0485     LT1init;
0486 <span class="keyword">end</span>
0487 
0488 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'LT1 loaded'</span>,handles);
0489 handles = <a href="#_sub18" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0490 <span class="comment">% Update handles structure</span>
0491 guidata(hObject, handles);
0492 
0493 <span class="comment">% -------------------------------------------------------------------------</span>
0494 <a name="_sub18" href="#_subfunctions" class="code">function handles = init_uimenu(hObject, eventdata, handles)</a>
0495 
0496 <span class="comment">%% Checked box</span>
0497 all = findobj(get(hObject,<span class="string">'Parent'</span>),<span class="string">'Type'</span>,<span class="string">'UImenu'</span>);
0498 set(all, <span class="string">'Checked'</span>, <span class="string">'Off'</span>);
0499 set(hObject, <span class="string">'Checked'</span>, <span class="string">'On'</span>);
0500 
0501 <span class="comment">%% Initialize popupmenu w/ first element, first attribute, first property</span>
0502 listfamily = fieldnames(getfamilydata);
0503 set(handles.popupmenu_group,<span class="string">'String'</span>,listfamily);
0504 
0505 <a href="#_sub3" class="code" title="subfunction popupmenu_group_Callback(hObject, eventdata, handles)">popupmenu_group_Callback</a>(handles.popupmenu_group, eventdata, handles);
0506 
0507 <span class="comment">% --------------------------------------------------------------------</span>
0508 <a name="_sub19" href="#_subfunctions" class="code">function uimenu_booster_Callback(hObject, eventdata, handles)</a>
0509 <span class="comment">% hObject    handle to uimenu_booster (see GCBO)</span>
0510 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0511 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0512 
0513 AD = getad;
0514 
0515 <span class="keyword">if</span> isempty(AD)
0516     boosterinit;
0517 <span class="keyword">elseif</span> ~strcmpi(AD.Machine,<span class="string">'Booster'</span>)
0518     boosterinit
0519 <span class="keyword">end</span>
0520 
0521 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'Booster loaded'</span>,handles);
0522 <a href="#_sub18" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0523 
0524 <span class="comment">% --------------------------------------------------------------------</span>
0525 <a name="_sub20" href="#_subfunctions" class="code">function uimenu_LT2_Callback(hObject, eventdata, handles)</a>
0526 <span class="comment">% hObject    handle to uimenu_LT2 (see GCBO)</span>
0527 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0528 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0529 
0530 AD = getad;
0531 
0532 <span class="keyword">if</span> isempty(AD)
0533     LT2init
0534 <span class="keyword">elseif</span> ~strcmpi(AD.Machine,<span class="string">'LT2'</span>)
0535     LT2init;
0536 <span class="keyword">end</span>
0537 
0538 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'LT2 loaded'</span>,handles);
0539 
0540 <a href="#_sub18" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0541 
0542 <span class="comment">% --------------------------------------------------------------------</span>
0543 <a name="_sub21" href="#_subfunctions" class="code">function uimenu_anneau_Callback(hObject, eventdata, handles)</a>
0544 <span class="comment">% hObject    handle to uimenu_anneau (see GCBO)</span>
0545 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0546 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0547 
0548 machineName = getsubmachinename;
0549 
0550 <span class="keyword">if</span> isempty(machineName)
0551     soleilinit;
0552 <span class="keyword">elseif</span> ~strcmpi(machineName,<span class="string">'StorageRing'</span>)
0553     soleilinit
0554 <span class="keyword">end</span>
0555 
0556 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'Ring loaded'</span>,handles);
0557 
0558 <a href="#_sub18" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0559 
0560 <span class="comment">% --- Executes on selection change in listbox_attribute.</span>
0561 <a name="_sub22" href="#_subfunctions" class="code">function listbox_attribute_Callback(hObject, eventdata, handles)</a>
0562 <span class="comment">% hObject    handle to listbox_attribute (see GCBO)</span>
0563 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0564 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0565 
0566 <span class="comment">% Hints: contents = get(hObject,'String') returns listbox_attribute contents as cell array</span>
0567 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox_attribute</span>
0568 
0569 contents = get(hObject,<span class="string">'String'</span>);
0570 idx = get(hObject,<span class="string">'Value'</span>);
0571 set(handles.listbox_group,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0572 set(handles.listbox_property,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0573 set(handles.listbox_dev_property,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0574 set(handles.checkbox_all,<span class="string">'Value'</span>,0);
0575 
0576 <span class="comment">% Selected only first element</span>
0577 <span class="comment">% If all elements are numeric, return a char array and not a cell!</span>
0578 <span class="keyword">if</span> ischar(contents)
0579     contents = cellstr(contents);
0580 <span class="keyword">end</span>
0581 set(handles.edit_value,<span class="string">'String'</span>,contents{idx(1)});
0582 
0583 <span class="comment">%select radiobutton</span>
0584 set(handles.radiobutton_attribute,<span class="string">'Value'</span>,1);
0585 
0586 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0587 <a name="_sub23" href="#_subfunctions" class="code">function listbox_attribute_CreateFcn(hObject, eventdata, handles)</a>
0588 <span class="comment">% hObject    handle to listbox_attribute (see GCBO)</span>
0589 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0590 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0591 
0592 <span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
0593 <span class="comment">%       See ISPC and COMPUTER.</span>
0594 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0595     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0596 <span class="keyword">end</span>
0597 
0598 
0599 <span class="comment">% --- Executes on selection change in popupmenu_command.</span>
0600 <a name="_sub24" href="#_subfunctions" class="code">function popupmenu_command_Callback(hObject, eventdata, handles)</a>
0601 <span class="comment">% hObject    handle to popupmenu_command (see GCBO)</span>
0602 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0603 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0604 
0605 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_command contents as cell array</span>
0606 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_command</span>
0607 
0608 contents  = get(hObject,<span class="string">'String'</span>);
0609 num       = get(hObject,<span class="string">'Value'</span>);
0610 command  = contents{num};
0611 
0612 setappdata(handles.figure1,<span class="string">'command'</span>, command);
0613 
0614 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0615 <a name="_sub25" href="#_subfunctions" class="code">function popupmenu_command_CreateFcn(hObject, eventdata, handles)</a>
0616 <span class="comment">% hObject    handle to popupmenu_command (see GCBO)</span>
0617 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0618 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0619 
0620 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0621 <span class="comment">%       See ISPC and COMPUTER.</span>
0622 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0623     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0624 <span class="keyword">end</span>
0625 
0626 
0627 <span class="comment">% --- Executes on button press in pushbutton_apply.</span>
0628 <a name="_sub26" href="#_subfunctions" class="code">function pushbutton_apply_Callback(hObject, eventdata, handles)</a>
0629 <span class="comment">% hObject    handle to pushbutton_apply (see GCBO)</span>
0630 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0631 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0632 
0633 <span class="comment">% Apply command</span>
0634 
0635 answer = questdlg(<span class="string">'Do you want to apply change ?'</span>,<span class="string">'Confirmation dialog box'</span>);
0636 
0637 <span class="keyword">switch</span> answer
0638     <span class="keyword">case</span> <span class="string">'Yes'</span>
0639         <span class="comment">% get selected device</span>
0640         iSelected = get(handles.listbox_group,<span class="string">'Value'</span>);
0641 
0642         Family = getappdata(handles.figure1, <span class="string">'Family'</span>);
0643         DeviceName = family2tangodev(Family);
0644 
0645         <span class="keyword">if</span> isempty(iSelected)
0646             <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'Non device names selected or status 0'</span>,handles);
0647             <span class="keyword">return</span>;
0648         <span class="keyword">end</span>
0649 
0650         valS = repmat(<span class="string">'NaN'</span>,size(DeviceName));
0651         val = cellstr(valS);
0652         <span class="comment">%get selected command</span>
0653         icmd    = get(handles.popupmenu_command,<span class="string">'Value'</span>);
0654         cmdlist = get(handles.popupmenu_command,<span class="string">'String'</span>);
0655         command = cmdlist{icmd};
0656         
0657         <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Applying command: '</span> command], handles);
0658         set(handles.listbox_attribute,<span class="string">'String'</span>,val);
0659         
0660         commandOutputType = getappdata(handles.figure1,<span class="string">'cmd_output_type'</span>);
0661         commandOutputType = commandOutputType{icmd};
0662         commandInputType  = getappdata(handles.figure1,<span class="string">'cmd_input_type'</span>);
0663         commandInputType  = commandInputType{icmd};
0664 
0665         <span class="keyword">switch</span> commandOutputType
0666             <span class="keyword">case</span> {<span class="string">'1-by-n char'</span>}        
0667                 <span class="keyword">for</span> k = 1:length(iSelected),
0668                     val0 = tango_command_inout2(DeviceName{iSelected(k)},command);
0669                     val{iSelected(k)} = val0;
0670                 <span class="keyword">end</span>
0671                 set(handles.listbox_attribute,<span class="string">'String'</span>,val);
0672             <span class="keyword">otherwise</span> <span class="comment">% not output command</span>
0673                 <span class="keyword">for</span> k=1:length(iSelected),
0674                     tango_command_inout2(DeviceName{iSelected(k)},command);
0675                 <span class="keyword">end</span>
0676         <span class="keyword">end</span>
0677         <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'Command applied'</span>, handles);
0678     <span class="keyword">case</span> {<span class="string">'No'</span>,<span class="string">'Cancel'</span>}
0679         <span class="keyword">return</span>;
0680     <span class="keyword">otherwise</span>
0681         warning(<span class="string">'Wrong answer'</span>)
0682 <span class="keyword">end</span>
0683 
0684 
0685 <span class="comment">% --- Executes on button press in pushbutton_refresh.</span>
0686 <a name="_sub27" href="#_subfunctions" class="code">function pushbutton_refresh_Callback(hObject, eventdata, handles)</a>
0687 <span class="comment">% hObject    handle to pushbutton_refresh (see GCBO)</span>
0688 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0689 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0690 
0691 <span class="comment">% attributes</span>
0692 <span class="comment">% refresh ALL</span>
0693 ifamily = get(handles.popupmenu_group,<span class="string">'Value'</span>);
0694 family = get(handles.popupmenu_group,<span class="string">'String'</span>);
0695 
0696 Family = family{ifamily};
0697 DeviceName = family2tangodev(Family);
0698 
0699 <span class="keyword">if</span> isempty(Family)
0700     <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'No machine loaded!'</span>,handles);
0701     <span class="keyword">return</span>
0702 <span class="keyword">end</span>
0703 
0704 iattribute = get(handles.popupmenu_attribute,<span class="string">'Value'</span>);
0705 attribute  = get(handles.popupmenu_attribute,<span class="string">'String'</span>);
0706 iSelected  = get(handles.listbox_group,<span class="string">'Value'</span>);
0707 
0708 val  = ones(size(DeviceName))*NaN';
0709 valS = repmat(<span class="string">'NaN'</span>,size(DeviceName));
0710 <span class="comment">%val0 = readattribute(strcat(DeviceName,'/',char(attribute(iattribute))));</span>
0711 val0 = readattribute(strcat(DeviceName(iSelected),<span class="string">'/'</span>,char(attribute(iattribute))));
0712 
0713 <span class="keyword">if</span> iscellstr(val0) <span class="comment">% See timestamp for MON as an example</span>
0714     val = cellstr(valS);
0715     val(iSelected,:) = val0;
0716 <span class="keyword">else</span>
0717     val(iSelected) = val0;
0718 <span class="keyword">end</span>
0719 
0720 <span class="comment">% % update listbox</span>
0721  set(handles.listbox_attribute,<span class="string">'String'</span>,val);
0722 <span class="comment">% % update editbox</span>
0723 <span class="comment">% set(handles.edit_value,'String',val(1));</span>
0724 <span class="comment">% set(handles.listbox_attribute,'Value',1);</span>
0725 <span class="comment">% set(handles.listbox_group,'Value',1);</span>
0726 <span class="comment">% set(handles.listbox_dev_property,'Value',1);</span>
0727 <span class="comment">% set(handles.listbox_property,'Value',1);</span>
0728 <span class="comment">% % uncheck buttons</span>
0729 <span class="comment">% set(handles.checkbox_all,'Value', 0);</span>
0730 
0731 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Values for attribute '''</span> char(attribute(iattribute)) <span class="string">''' refreshed'</span>],handles);
0732 
0733 <span class="comment">% --- Executes on selection change in listbox_log.</span>
0734 <a name="_sub28" href="#_subfunctions" class="code">function listbox_log_Callback(hObject, eventdata, handles)</a>
0735 <span class="comment">% hObject    handle to listbox_log (see GCBO)</span>
0736 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0737 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0738 
0739 <span class="comment">% Hints: contents = get(hObject,'String') returns listbox_log contents as cell array</span>
0740 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox_log</span>
0741 
0742 
0743 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0744 <a name="_sub29" href="#_subfunctions" class="code">function listbox_log_CreateFcn(hObject, eventdata, handles)</a>
0745 <span class="comment">% hObject    handle to listbox_log (see GCBO)</span>
0746 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0747 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0748 
0749 <span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
0750 <span class="comment">%       See ISPC and COMPUTER.</span>
0751 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0752     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0753 <span class="keyword">end</span>
0754 
0755 
0756 <a name="_sub30" href="#_subfunctions" class="code">function writelog(strvalue, handles)</a>
0757 <span class="comment">% Add stuff in the logging window</span>
0758 
0759 str = get(handles.listbox_log, <span class="string">'String'</span>);
0760 str = {str{:} [datestr(now) <span class="string">': '</span> strvalue]};
0761 <span class="comment">% update logging window</span>
0762 set(handles.listbox_log, <span class="string">'String'</span>,str,<span class="string">'ListBoxTop'</span>,length(str));
0763 
0764 
0765 <span class="comment">% --- Executes on selection change in listbox_dev_property.</span>
0766 <a name="_sub31" href="#_subfunctions" class="code">function listbox_dev_property_Callback(hObject, eventdata, handles)</a>
0767 <span class="comment">% hObject    handle to listbox_dev_property (see GCBO)</span>
0768 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0769 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0770 
0771 <span class="comment">% Hints: contents = get(hObject,'String') returns listbox_dev_property contents as cell array</span>
0772 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox_dev_property</span>
0773 contents = get(hObject,<span class="string">'String'</span>);
0774 idx = get(hObject,<span class="string">'Value'</span>);
0775 
0776 set(handles.listbox_group,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0777 set(handles.listbox_attribute,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0778 set(handles.listbox_property,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0779 set(handles.listbox_dev_property,<span class="string">'Value'</span>,idx,<span class="string">'ListBoxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0780 set(handles.checkbox_all,<span class="string">'Value'</span>,0);
0781 
0782 set(handles.edit_value,<span class="string">'String'</span>,contents{idx(1)});
0783 
0784 
0785 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0786 <a name="_sub32" href="#_subfunctions" class="code">function listbox_dev_property_CreateFcn(hObject, eventdata, handles)</a>
0787 <span class="comment">% hObject    handle to listbox_dev_property (see GCBO)</span>
0788 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0789 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0790 
0791 <span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
0792 <span class="comment">%       See ISPC and COMPUTER.</span>
0793 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0794     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0795 <span class="keyword">end</span>
0796 
0797 
0798 <span class="comment">% --- Executes on selection change in popupmenu_dev_prop.</span>
0799 <a name="_sub33" href="#_subfunctions" class="code">function popupmenu_dev_prop_Callback(hObject, eventdata, handles)</a>
0800 <span class="comment">% hObject    handle to popupmenu_dev_prop (see GCBO)</span>
0801 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0802 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0803 
0804 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_dev_prop contents as cell array</span>
0805 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_dev_prop</span>
0806 contents  = get(hObject,<span class="string">'String'</span>);
0807 num       = get(hObject,<span class="string">'Value'</span>);
0808 devproperty  = contents{num};
0809 
0810 setappdata(handles.figure1,<span class="string">'devproperty'</span>, devproperty);
0811 
0812 
0813 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0814 <a name="_sub34" href="#_subfunctions" class="code">function popupmenu_dev_prop_CreateFcn(hObject, eventdata, handles)</a>
0815 <span class="comment">% hObject    handle to popupmenu_dev_prop (see GCBO)</span>
0816 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0817 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0818 
0819 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0820 <span class="comment">%       See ISPC and COMPUTER.</span>
0821 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0822     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0823 <span class="keyword">end</span>
0824 
0825 
0826 
0827 <a name="_sub35" href="#_subfunctions" class="code">function edit_dev_propvalue_Callback(hObject, eventdata, handles)</a>
0828 <span class="comment">% hObject    handle to edit_dev_propvalue (see GCBO)</span>
0829 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0830 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0831 
0832 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_dev_propvalue as text</span>
0833 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_dev_propvalue as a double</span>
0834 <span class="comment">% First of all, ask for confirmation</span>
0835 answer = questdlg(<span class="string">'Do you want to apply change ?'</span>,<span class="string">'Confirmation dialog box'</span>);
0836 
0837 <span class="keyword">switch</span> answer
0838     <span class="keyword">case</span> <span class="string">'Yes'</span>
0839 
0840         <span class="comment">% Get the new value</span>
0841         <span class="comment">% Need to force char array</span>
0842         value = char(get(hObject,<span class="string">'String'</span>));
0843 
0844         propertyname  = get(handles.edit_dev_propname,<span class="string">'String'</span>);
0845         propertyvalue = get(handles.edit_dev_propvalue,<span class="string">'String'</span>);
0846         Family        = getappdata(handles.figure1, <span class="string">'Family'</span>);
0847         DeviceName    = family2tangodev(Family);
0848 
0849         iSelected = get(handles.listbox_group,<span class="string">'Value'</span>);
0850 
0851         val = tango_get_device_property(DeviceName(iSelected), <span class="keyword">...</span>
0852             propertyname);
0853 
0854         <span class="comment">%% Get selected element</span>
0855         <span class="keyword">if</span> isempty(val)
0856             <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Cancelled: property '</span> str2mat(propertyvalue)  <span class="string">'not defined'</span>], handles);
0857             set(handles.listbox_dev_property,<span class="string">'String'</span>, repmat(<span class="string">'NaN'</span>,size(DeviceName)));
0858         <span class="keyword">else</span>
0859             <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Please wait: writting DEVICE property '</span> str2mat(propertyvalue)  <span class="string">'...'</span>], handles);
0860 
0861             tango_set_device_property(DeviceName(iSelected), <span class="keyword">...</span>
0862                 propertyname, propertyvalue);
0863 
0864             <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'Device properties written'</span>, handles);
0865 
0866             <span class="comment">% refresh display</span>
0867             <a href="#_sub39" class="code" title="subfunction pushbutton_dev_prop_Callback(hObject, eventdata, handles)">pushbutton_dev_prop_Callback</a>(handles.edit_dev_propvalue,eventdata, handles);
0868         <span class="keyword">end</span>
0869     <span class="keyword">case</span> {<span class="string">'No'</span>,<span class="string">'Cancel'</span>}
0870         <span class="keyword">return</span>;
0871     <span class="keyword">otherwise</span>
0872         warning(<span class="string">'Wrong answer'</span>)
0873 <span class="keyword">end</span>
0874 
0875 
0876 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0877 <a name="_sub36" href="#_subfunctions" class="code">function edit_dev_propvalue_CreateFcn(hObject, eventdata, handles)</a>
0878 <span class="comment">% hObject    handle to edit_dev_propvalue (see GCBO)</span>
0879 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0880 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0881 
0882 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
0883 <span class="comment">%       See ISPC and COMPUTER.</span>
0884 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0885     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0886 <span class="keyword">end</span>
0887 
0888 
0889 
0890 <a name="_sub37" href="#_subfunctions" class="code">function edit_dev_propname_Callback(hObject, eventdata, handles)</a>
0891 <span class="comment">% hObject    handle to edit_dev_propname (see GCBO)</span>
0892 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0893 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0894 
0895 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_dev_propname as text</span>
0896 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_dev_propname as a double</span>
0897 
0898 
0899 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0900 <a name="_sub38" href="#_subfunctions" class="code">function edit_dev_propname_CreateFcn(hObject, eventdata, handles)</a>
0901 <span class="comment">% hObject    handle to edit_dev_propname (see GCBO)</span>
0902 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0903 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0904 
0905 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
0906 <span class="comment">%       See ISPC and COMPUTER.</span>
0907 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0908     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0909 <span class="keyword">end</span>
0910 
0911 
0912 <span class="comment">% --- Executes on button press in pushbutton_dev_prop.</span>
0913 <a name="_sub39" href="#_subfunctions" class="code">function pushbutton_dev_prop_Callback(hObject, eventdata, handles)</a>
0914 <span class="comment">% hObject    handle to pushbutton_dev_prop (see GCBO)</span>
0915 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0916 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0917 
0918 ifamily = get(handles.popupmenu_group,<span class="string">'Value'</span>);
0919 family  = get(handles.popupmenu_group,<span class="string">'String'</span>);
0920 
0921 Family        = family{ifamily};
0922 DeviceName    = family2tangodev(Family);
0923 
0924 <span class="keyword">if</span> isempty(Family)
0925     <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>(<span class="string">'No machine loaded!'</span>,handles);
0926     <span class="keyword">return</span>
0927 <span class="keyword">end</span>
0928 
0929 val = ones(size(DeviceName))*NaN';
0930 valS = repmat(<span class="string">'NaN'</span>,size(DeviceName));
0931 
0932 property  = get(handles.edit_dev_propname,<span class="string">'String'</span>);
0933 
0934 val0 = tango_get_device_property(DeviceName,property);
0935 
0936 <span class="keyword">if</span> isempty(val0)
0937     <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Property '''</span> property <span class="string">''' not defined'</span>],handles);
0938     <span class="keyword">return</span>;
0939 <span class="keyword">end</span>
0940 
0941 <span class="keyword">if</span> iscellstr(val0)
0942     val = cellstr(val0);
0943 <span class="keyword">else</span>
0944     val = val0;
0945 <span class="keyword">end</span>
0946 
0947 <span class="comment">% unpdate listbox</span>
0948 set(handles.listbox_dev_property,<span class="string">'String'</span>,val);
0949 <span class="comment">% update editbox</span>
0950 set(handles.edit_value,<span class="string">'String'</span>,val(1));
0951 set(handles.listbox_attribute,<span class="string">'Value'</span>,1);
0952 set(handles.listbox_group,<span class="string">'Value'</span>,1);
0953 set(handles.listbox_dev_property,<span class="string">'Value'</span>,1);
0954 set(handles.listbox_property,<span class="string">'Value'</span>,1);
0955 <span class="comment">% uncheckk buttons</span>
0956 set(handles.checkbox_all,<span class="string">'Value'</span>, 0);
0957 
0958 <a href="#_sub30" class="code" title="subfunction writelog(strvalue, handles)">writelog</a>([<span class="string">'Values for property '''</span> property <span class="string">''' refreshed'</span>],handles);
0959</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>