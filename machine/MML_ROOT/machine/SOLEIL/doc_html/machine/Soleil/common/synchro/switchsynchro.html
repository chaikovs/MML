<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of switchsynchro</title>
  <meta name="keywords" content="switchsynchro">
  <meta name="description" content="switchsynchro - Switch timing for using the Machine study kickers (KEM) or Normal injection mode">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="../index.html">common</a> &gt; <a href="index.html">synchro</a> &gt; switchsynchro.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/common/synchro&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>switchsynchro
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>switchsynchro - Switch timing for using the Machine study kickers (KEM) or Normal injection mode</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function switchsynchro(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> switchsynchro - Switch timing for using the Machine study kickers (KEM) or Normal injection mode

  INPUTS
  Injection - Mode for standard injection into the storage ring
  KEM       - Mode for kicking the beam with a soft event  
  Init      - For first use, set the delay for both machine study kickers</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function checktimingconfig(value, varargin)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function switchsynchro(varargin)</a>
0002 <span class="comment">% switchsynchro - Switch timing for using the Machine study kickers (KEM) or Normal injection mode</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  INPUTS</span>
0005 <span class="comment">%  Injection - Mode for standard injection into the storage ring</span>
0006 <span class="comment">%  KEM       - Mode for kicking the beam with a soft event</span>
0007 <span class="comment">%  Init      - For first use, set the delay for both machine study kickers</span>
0008 
0009 <span class="comment">%</span>
0010 <span class="comment">%  Written by Laurent S. Nadolski</span>
0011 <span class="comment">%  22 July 2008: Display and group added</span>
0012 
0013 SynchroFlag = <span class="string">'Injection'</span>;
0014 DisplayFlag = 1;
0015 InitFlag = 0;
0016 
0017 <span class="comment">% Input parser</span>
0018 <span class="keyword">for</span> i = length(varargin):-1:1,
0019     <span class="keyword">if</span> strcmpi(varargin{i},<span class="string">'Injection'</span>) || strcmpi(varargin{i},<span class="string">'Inj'</span>)
0020         SynchroFlag = <span class="string">'Injection'</span>;
0021         varargin(i) = [];
0022     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'KEM'</span>)
0023         SynchroFlag = <span class="string">'KEM'</span>;
0024     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Display'</span>)
0025         DisplayFlag = 1;
0026         varargin(i) = [];
0027     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'NoDisplay'</span>)
0028         DisplayFlag = 0;
0029         varargin(i) = [];
0030     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Init'</span>)
0031         InitFlag = 1;
0032     <span class="keyword">end</span>
0033 <span class="keyword">end</span>
0034 
0035 <span class="comment">% delay 179010 Âµs to have the same time for BPM as for injection</span>
0036 <span class="comment">% the idea is to keep the same delays for the bpms</span>
0037 <span class="keyword">if</span> InitFlag <span class="comment">% delay for first quarter filled up</span>
0038 <span class="comment">%     tango_write_attribute2('ANS-C01/SY/LOCAL.EP.1','k-h.trigTimeDelay',179010.537);</span>
0039 <span class="comment">%     tango_write_attribute2('ANS-C01/SY/LOCAL.EP.1','k-v.trigTimeDelay',179010.537);</span>
0040 <span class="comment">%     tango_write_attribute2('ANS-C01/SY/LOCAL.EP.1','k-h.trigTimeDelay',151271.472);</span>
0041 <span class="comment">%     tango_write_attribute2('ANS-C01/SY/LOCAL.EP.1','k-v.trigTimeDelay',151271.502);</span>
0042 <span class="keyword">end</span>
0043 
0044 <span class="comment">% switchyard for injection</span>
0045 <span class="keyword">switch</span> SynchroFlag
0046     <span class="keyword">case</span> <span class="string">'KEM'</span> <span class="comment">% Switch Timing system for using KEMs</span>
0047         event = 16;
0048         tango_write_attribute2(<span class="string">'ANS/SY/CENTRAL'</span>,<span class="string">'softEventAdress'</span>,int32(event));
0049         tango_write_attribute2(<span class="string">'ANS-C01/SY/LOCAL.DG.2'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0050         tango_write_attribute2(<span class="string">'ANS-C02/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0051         tango_write_attribute2(<span class="string">'ANS-C03/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0052         tango_write_attribute2(<span class="string">'ANS-C04/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0053         tango_write_attribute2(<span class="string">'ANS-C05/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0054         tango_write_attribute2(<span class="string">'ANS-C06/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0055         tango_write_attribute2(<span class="string">'ANS-C07/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0056         tango_write_attribute2(<span class="string">'ANS-C08/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0057         tango_write_attribute2(<span class="string">'ANS-C09/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0058         tango_write_attribute2(<span class="string">'ANS-C10/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0059         tango_write_attribute2(<span class="string">'ANS-C11/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0060         tango_write_attribute2(<span class="string">'ANS-C12/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0061         tango_write_attribute2(<span class="string">'ANS-C13/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0062         tango_write_attribute2(<span class="string">'ANS-C14/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0063         tango_write_attribute2(<span class="string">'ANS-C15/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0064         tango_write_attribute2(<span class="string">'ANS-C16/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(event));
0065         tango_write_attribute2(<span class="string">'ANS-C01/SY/LOCAL.EP.1'</span>,<span class="string">'k-h.trigEvent'</span>,int32(event));
0066         tango_write_attribute2(<span class="string">'ANS-C01/SY/LOCAL.EP.1'</span>,<span class="string">'k-v.trigEvent'</span>,int32(event));
0067         pause(1)
0068         <a href="#_sub1" class="code" title="subfunction checktimingconfig(value, varargin)">checktimingconfig</a>(event, <span class="string">'KEM'</span>);
0069         
0070         <span class="comment">%% timing BPM</span>
0071 <span class="comment">%         tango_write_attribute2('ANS-C01/SY/LOCAL.DG.2','bpm.trigTimeDelay',151262.5274);</span>
0072 <span class="comment">%         tango_write_attribute2('ANS-C02/SY/LOCAL.DG.1','bpm.trigTimeDelay',151262.44);</span>
0073 <span class="comment">%         tango_write_attribute2('ANS-C16/SY/LOCAL.DG.1','bpm.trigTimeDelay',151262.24);</span>
0074     <span class="keyword">case</span> <span class="string">'Injection'</span>  <span class="comment">% Switch back for injection</span>
0075         eventInj = 3;
0076         tango_write_attribute2(<span class="string">'ANS/SY/CENTRAL'</span>,<span class="string">'softEventAdress'</span>,int32(5));
0077         tango_write_attribute2(<span class="string">'ANS-C01/SY/LOCAL.DG.2'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0078         tango_write_attribute2(<span class="string">'ANS-C02/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0079         tango_write_attribute2(<span class="string">'ANS-C03/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0080         tango_write_attribute2(<span class="string">'ANS-C04/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0081         tango_write_attribute2(<span class="string">'ANS-C05/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0082         tango_write_attribute2(<span class="string">'ANS-C06/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0083         tango_write_attribute2(<span class="string">'ANS-C07/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0084         tango_write_attribute2(<span class="string">'ANS-C08/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0085         tango_write_attribute2(<span class="string">'ANS-C09/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0086         tango_write_attribute2(<span class="string">'ANS-C10/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0087         tango_write_attribute2(<span class="string">'ANS-C11/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0088         tango_write_attribute2(<span class="string">'ANS-C12/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0089         tango_write_attribute2(<span class="string">'ANS-C13/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0090         tango_write_attribute2(<span class="string">'ANS-C14/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0091         tango_write_attribute2(<span class="string">'ANS-C15/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0092         tango_write_attribute2(<span class="string">'ANS-C16/SY/LOCAL.DG.1'</span>,<span class="string">'bpm.trigEvent'</span>,int32(eventInj));
0093         pause(1)
0094         <a href="#_sub1" class="code" title="subfunction checktimingconfig(value, varargin)">checktimingconfig</a>(eventInj);
0095         <span class="comment">%% timing BPM</span>
0096 <span class="comment">%         tango_write_attribute2('ANS-C01/SY/LOCAL.DG.2','bpm.trigTimeDelay',31922.5274);</span>
0097 <span class="comment">%         tango_write_attribute2('ANS-C02/SY/LOCAL.DG.1','bpm.trigTimeDelay',31922.44);</span>
0098 <span class="comment">%         tango_write_attribute2('ANS-C16/SY/LOCAL.DG.1','bpm.trigTimeDelay',31923.24);</span>
0099 <span class="keyword">end</span>
0100 
0101 <span class="comment">% Diagnostics for checking evering thing is OK</span>
0102 
0103 devName={<span class="string">'ANS-C01/SY/LOCAL.DG.2'</span>
0104          <span class="string">'ANS-C02/SY/LOCAL.DG.1'</span>
0105          <span class="string">'ANS-C03/SY/LOCAL.DG.1'</span>
0106          <span class="string">'ANS-C04/SY/LOCAL.DG.1'</span>
0107          <span class="string">'ANS-C05/SY/LOCAL.DG.1'</span>
0108          <span class="string">'ANS-C06/SY/LOCAL.DG.1'</span>
0109          <span class="string">'ANS-C07/SY/LOCAL.DG.1'</span>
0110          <span class="string">'ANS-C08/SY/LOCAL.DG.1'</span>
0111          <span class="string">'ANS-C09/SY/LOCAL.DG.1'</span>
0112          <span class="string">'ANS-C10/SY/LOCAL.DG.1'</span>
0113          <span class="string">'ANS-C11/SY/LOCAL.DG.1'</span>
0114          <span class="string">'ANS-C12/SY/LOCAL.DG.1'</span>
0115          <span class="string">'ANS-C13/SY/LOCAL.DG.1'</span>
0116          <span class="string">'ANS-C14/SY/LOCAL.DG.1'</span>
0117          <span class="string">'ANS-C15/SY/LOCAL.DG.1'</span>
0118          <span class="string">'ANS-C16/SY/LOCAL.DG.1'</span>
0119     };
0120 
0121 <span class="keyword">if</span> DisplayFlag
0122     val =[];
0123     <span class="keyword">for</span> k=1:length(devName)
0124         val(k) = readattribute([devName{k} <span class="string">'/bpm.trigEvent'</span>]);
0125     <span class="keyword">end</span>
0126 
0127     figure
0128     bar(val)
0129     title(<span class="string">'Trigger Event Value for BPM timing board'</span>)
0130     xlabel(<span class="string">'Cell number'</span>)
0131     ylabel(<span class="string">'Event value'</span>)
0132 <span class="keyword">end</span>
0133 
0134 <span class="comment">% subfunction</span>
0135 <a name="_sub1" href="#_subfunctions" class="code">function checktimingconfig(value, varargin)</a>
0136 
0137 <span class="comment">% Defaul flag</span>
0138 KEMFlag = 0;
0139 
0140 <span class="keyword">for</span> i = length(varargin):-1:1
0141     <span class="keyword">if</span> strcmpi(varargin{i},<span class="string">'NoKEM'</span>)
0142         KEMFlag = 0;
0143         varargin(i) = [];
0144     <span class="keyword">else</span> strcmpi(varargin{i},<span class="string">'KEM'</span>)
0145         KEMFlag = 1;
0146         varargin(i) = [];
0147     <span class="keyword">end</span>
0148 <span class="keyword">end</span>
0149 
0150 
0151 <span class="keyword">if</span> KEMFlag
0152     val = ones(1,19)*NaN;
0153 <span class="keyword">else</span>
0154     val = ones(1,17)*NaN;
0155 <span class="keyword">end</span>
0156 
0157 val(1) = readattribute([<span class="string">'ANS/SY/CENTRAL'</span>,<span class="string">'/softEventAdress'</span>]);
0158 val(2) = readattribute([<span class="string">'ANS-C01/SY/LOCAL.DG.2'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0159 val(3) = readattribute([<span class="string">'ANS-C02/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0160 val(4) = readattribute([<span class="string">'ANS-C03/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0161 val(5) = readattribute([<span class="string">'ANS-C04/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0162 val(6) = readattribute([<span class="string">'ANS-C05/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0163 val(7) = readattribute([<span class="string">'ANS-C06/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0164 val(8) = readattribute([<span class="string">'ANS-C07/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0165 val(9) = readattribute([<span class="string">'ANS-C08/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0166 val(10) = readattribute([<span class="string">'ANS-C09/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0167 val(11) = readattribute([<span class="string">'ANS-C10/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0168 val(12) = readattribute([<span class="string">'ANS-C11/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0169 val(13) = readattribute([<span class="string">'ANS-C12/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0170 val(14) = readattribute([<span class="string">'ANS-C13/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0171 val(15) = readattribute([<span class="string">'ANS-C14/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0172 val(16) = readattribute([<span class="string">'ANS-C15/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0173 val(17) = readattribute([<span class="string">'ANS-C16/SY/LOCAL.DG.1'</span>,<span class="string">'/bpm.trigEvent'</span>]);
0174 
0175 <span class="keyword">if</span> KEMFlag
0176     val(18) = readattribute([<span class="string">'ANS-C01/SY/LOCAL.EP.1'</span>,<span class="string">'/k-h.trigEvent'</span>]);
0177     val(19) = readattribute([<span class="string">'ANS-C01/SY/LOCAL.EP.1'</span>,<span class="string">'/k-v.trigEvent'</span>]);
0178 <span class="keyword">end</span>
0179 
0180 <span class="keyword">if</span> mean(val(2:end)) ~= value
0181     fprintf(<span class="string">'At least one timing board is not set properly to %d soft address \n'</span>, value);
0182 <span class="keyword">end</span>
0183</pre></div>
<hr><address>Generated on Fri 23-Jul-2010 00:42:07 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>