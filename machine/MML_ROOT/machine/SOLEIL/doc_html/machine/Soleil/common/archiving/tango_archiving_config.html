<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of tango_archiving_config</title>
  <meta name="keywords" content="tango_archiving_config">
  <meta name="description" content="TANGO_ARCHIVING_CONFIG M-file for tango_archiving_config.fig">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="../index.html">common</a> &gt; <a href="index.html">archiving</a> &gt; tango_archiving_config.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/common/archiving&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>tango_archiving_config
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>TANGO_ARCHIVING_CONFIG M-file for tango_archiving_config.fig</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function varargout = tango_archiving_config(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> TANGO_ARCHIVING_CONFIG M-file for tango_archiving_config.fig
      TANGO_ARCHIVING_CONFIG, by itself, creates a new TANGO_ARCHIVING_CONFIG or raises the existing
      singleton*.

      H = TANGO_ARCHIVING_CONFIG returns the handle to a new TANGO_ARCHIVING_CONFIG or the handle to
      the existing singleton*.

      TANGO_ARCHIVING_CONFIG('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in TANGO_ARCHIVING_CONFIG.M with the given input arguments.

      TANGO_ARCHIVING_CONFIG('Property','Value',...) creates a new TANGO_ARCHIVING_CONFIG or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before tango_archiving_config_OpeningFunction gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to tango_archiving_config_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one
      instance to run (singleton)&quot;.

 See also: GUIDE, GUIDATA, GUIHANDLES</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="archiving_panel_mode.html" class="code" title="function varargout = archiving_panel_mode(varargin)">archiving_panel_mode</a>	ARCHIVING_PANEL_MODE M-file for archiving_panel_mode.fig</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function tango_archiving_config_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = tango_archiving_config_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function popupmenu_group_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function popupmenu_group_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function popupmenu_attribute_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function popupmenu_attribute_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function popupmenu_command_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function argin = BuildArgin(fullTangoNames, mode, handles)</a></li><li><a href="#_sub9" class="code">function start_archiving(archivingmanager,command,argin,handles)</a></li><li><a href="#_sub10" class="code">function display_archiving_error(error,handles)</a></li><li><a href="#_sub11" class="code">function popupmenu_command_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function listbox_group_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function listbox_group_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function listbox_property_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function listbox_property_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function checkbox_all_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function edit_value_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub18" class="code">function edit_value_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function uimenu_linac_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function uimenu_LT1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function handles = init_uimenu(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function uimenu_booster_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function uimenu_LT2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function uimenu_anneau_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub25" class="code">function Untitled_1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function hdbmenu_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub27" class="code">function tdbmenu_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub28" class="code">function Untitled_2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub29" class="code">function checkbox_loadbalancing_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub30" class="code">function list = format_output_list(varargin)</a></li><li><a href="#_sub31" class="code">function listbox_group_ButtonDownFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub32" class="code">function menu_file_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub33" class="code">function savemenu_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub34" class="code">function summarymenu_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub35" class="code">function loadmenu_Callback(hObject, eventdata, handles)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = tango_archiving_config(varargin)</a>
0002 <span class="comment">% TANGO_ARCHIVING_CONFIG M-file for tango_archiving_config.fig</span>
0003 <span class="comment">%      TANGO_ARCHIVING_CONFIG, by itself, creates a new TANGO_ARCHIVING_CONFIG or raises the existing</span>
0004 <span class="comment">%      singleton*.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%      H = TANGO_ARCHIVING_CONFIG returns the handle to a new TANGO_ARCHIVING_CONFIG or the handle to</span>
0007 <span class="comment">%      the existing singleton*.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%      TANGO_ARCHIVING_CONFIG('CALLBACK',hObject,eventData,handles,...) calls the local</span>
0010 <span class="comment">%      function named CALLBACK in TANGO_ARCHIVING_CONFIG.M with the given input arguments.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%      TANGO_ARCHIVING_CONFIG('Property','Value',...) creates a new TANGO_ARCHIVING_CONFIG or raises the</span>
0013 <span class="comment">%      existing singleton*.  Starting from the left, property value pairs are</span>
0014 <span class="comment">%      applied to the GUI before tango_archiving_config_OpeningFunction gets called.  An</span>
0015 <span class="comment">%      unrecognized property name or invalid value makes property application</span>
0016 <span class="comment">%      stop.  All inputs are passed to tango_archiving_config_OpeningFcn via varargin.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one</span>
0019 <span class="comment">%      instance to run (singleton)&quot;.</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% See also: GUIDE, GUIDATA, GUIHANDLES</span>
0022 
0023 <span class="comment">% Copyright 2002-2003 The MathWorks, Inc.</span>
0024 
0025 <span class="comment">% Edit the above text to modify the response to help tango_archiving_config</span>
0026 
0027 <span class="comment">% Last Modified by GUIDE v2.5 07-Apr-2005 09:47:11</span>
0028 
0029 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0030 gui_Singleton = 1;
0031 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0032     <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0033     <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction tango_archiving_config_OpeningFcn(hObject, eventdata, handles, varargin)">tango_archiving_config_OpeningFcn</a>, <span class="keyword">...</span>
0034     <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = tango_archiving_config_OutputFcn(hObject, eventdata, handles)">tango_archiving_config_OutputFcn</a>, <span class="keyword">...</span>
0035     <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0036     <span class="string">'gui_Callback'</span>,   []);
0037 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0038     gui_State.gui_Callback = str2func(varargin{1});
0039 <span class="keyword">end</span>
0040 
0041 <span class="keyword">if</span> nargout
0042     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0043 <span class="keyword">else</span>
0044     gui_mainfcn(gui_State, varargin{:});
0045 <span class="keyword">end</span>
0046 <span class="comment">% End initialization code - DO NOT EDIT</span>
0047 
0048 <span class="comment">%</span>
0049 <span class="comment">% Written by Laurent S. Nadolski</span>
0050 
0051 
0052 <span class="comment">% --- Executes just before tango_archiving_config is made visible.</span>
0053 <a name="_sub1" href="#_subfunctions" class="code">function tango_archiving_config_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0054 <span class="comment">% This function has no output args, see OutputFcn.</span>
0055 <span class="comment">% hObject    handle to figure</span>
0056 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0057 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0058 <span class="comment">% varargin   command line arguments to tango_archiving_config (see VARARGIN)</span>
0059 
0060 <span class="comment">% Choose default command line output for tango_archiving_config</span>
0061 handles.output = hObject;
0062 
0063 <span class="comment">% Update handles structure</span>
0064 guidata(hObject, handles);
0065 
0066 <span class="comment">% UIWAIT makes tango_archiving_config wait for user response (see UIRESUME)</span>
0067 <span class="comment">% uiwait(handles.figure1);</span>
0068 
0069 disp(<span class="string">'TANGO Archiving Configurator'</span>);
0070 
0071 <span class="comment">%% Look for archiving manager TANGO name in static Database</span>
0072 archivingmanager = cell2mat(tango_get_db_property(<span class="string">'archivage'</span>,<span class="string">'archivingmanager'</span>));
0073 tango_set_timeout(archivingmanager,30000);
0074 
0075 setappdata(handles.figure1,<span class="string">'archivingmanager'</span>, archivingmanager);
0076 
0077 <span class="comment">%% Initialize database {HDB} and machine {LT1}</span>
0078 handles.database=<span class="string">'HDB'</span>;
0079 guidata(hObject, handles);
0080 
0081 <a href="#_sub26" class="code" title="subfunction hdbmenu_Callback(hObject, eventdata, handles)">hdbmenu_Callback</a>(hObject, eventdata, handles);
0082 <a href="#_sub24" class="code" title="subfunction uimenu_anneau_Callback(hObject, eventdata, handles)">uimenu_anneau_Callback</a>(handles.uimenu_LT1, eventdata, handles);
0083 
0084 <span class="comment">% Update handles structure</span>
0085 guidata(hObject, handles);
0086 
0087 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0088 <a name="_sub2" href="#_subfunctions" class="code">function varargout = tango_archiving_config_OutputFcn(hObject, eventdata, handles)</a>
0089 <span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
0090 <span class="comment">% hObject    handle to figure</span>
0091 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0092 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0093 
0094 <span class="comment">% Get default command line output from handles structure</span>
0095 varargout{1} = handles.output;
0096 
0097 <span class="comment">% --- Executes on selection change in popupmenu_group.</span>
0098 <a name="_sub3" href="#_subfunctions" class="code">function popupmenu_group_Callback(hObject, eventdata, handles)</a>
0099 <span class="comment">% hObject    handle to popupmenu_group (see GCBO)</span>
0100 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0101 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0102 
0103 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_group contents as cell array</span>
0104 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_group</span>
0105 
0106 contents = get(hObject,<span class="string">'String'</span>);
0107 num      = get(hObject,<span class="string">'Value'</span>);
0108 group    = contents{num};
0109 
0110 setappdata(handles.figure1,<span class="string">'group'</span>, group);
0111 
0112 AO       = getappdata(handles.figure1,<span class="string">'AO'</span>);
0113 
0114 <span class="comment">% Status one devices</span>
0115 valid  = find(AO.(group).Status);
0116 
0117 <span class="comment">% Update Group list</span>
0118 set(handles.listbox_group,<span class="string">'String'</span>,AO.(group).DeviceName(valid));
0119 
0120 set(handles.popupmenu_command,<span class="string">'BackgroundColor'</span>,<span class="string">'red'</span>);
0121 
0122 <span class="comment">% Builds up attribut list for selected group</span>
0123 attributeList = tango_get_attribute_list(AO.(group).DeviceName{valid(1)});
0124 
0125 num = get(handles.popupmenu_attribute,<span class="string">'Value'</span>);
0126 <span class="keyword">if</span> num &gt; length(attributeList)
0127     num = 1;
0128     set(handles.popupmenu_attribute,<span class="string">'Value'</span>,num);
0129 <span class="keyword">end</span>
0130 set(handles.popupmenu_attribute,<span class="string">'String'</span>,attributeList);
0131 
0132 <a href="#_sub5" class="code" title="subfunction popupmenu_attribute_Callback(hObject, eventdata, handles)">popupmenu_attribute_Callback</a>(handles.popupmenu_attribute, eventdata, handles);
0133 
0134 <span class="comment">%setback selected element and property to first one</span>
0135 set(handles.listbox_property,<span class="string">'Value'</span>,1);
0136 set(handles.listbox_group,<span class="string">'Value'</span>,1);
0137 
0138 
0139 <span class="comment">% Update handles structure</span>
0140 guidata(hObject, handles);
0141 
0142 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0143 <a name="_sub4" href="#_subfunctions" class="code">function popupmenu_group_CreateFcn(hObject, eventdata, handles)</a>
0144 <span class="comment">% hObject    handle to popupmenu_group (see GCBO)</span>
0145 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0146 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0147 
0148 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0149 <span class="comment">%       See ISPC and COMPUTER.</span>
0150 <span class="keyword">if</span> ispc
0151     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0152 <span class="keyword">else</span>
0153     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0154 <span class="keyword">end</span>
0155 
0156 
0157 <span class="comment">% --- Executes on selection change in popupmenu_attribute.</span>
0158 <a name="_sub5" href="#_subfunctions" class="code">function popupmenu_attribute_Callback(hObject, eventdata, handles)</a>
0159 <span class="comment">% hObject    handle to popupmenu_attribute (see GCBO)</span>
0160 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0161 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0162 
0163 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_attribute contents as cell array</span>
0164 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_attribute</span>
0165 
0166 contents  = get(hObject,<span class="string">'String'</span>);
0167 num       = get(hObject,<span class="string">'Value'</span>);
0168 attribute = contents{num};
0169 
0170 setappdata(handles.figure1,<span class="string">'attribute'</span>, attribute);
0171 
0172 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0173 <a name="_sub6" href="#_subfunctions" class="code">function popupmenu_attribute_CreateFcn(hObject, eventdata, handles)</a>
0174 <span class="comment">% hObject    handle to popupmenu_attribute (see GCBO)</span>
0175 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0176 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0177 
0178 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0179 <span class="comment">%       See ISPC and COMPUTER.</span>
0180 <span class="keyword">if</span> ispc
0181     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0182 <span class="keyword">else</span>
0183     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0184 <span class="keyword">end</span>
0185 
0186 
0187 <span class="comment">% --- Executes on selection change in popupmenu_command.</span>
0188 <a name="_sub7" href="#_subfunctions" class="code">function popupmenu_command_Callback(hObject, eventdata, handles)</a>
0189 <span class="comment">% hObject    handle to popupmenu_command (see GCBO)</span>
0190 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0191 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0192 
0193 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_command contents as cell array</span>
0194 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_command</span>
0195 
0196 <span class="comment">%% Set color to Green</span>
0197 set(handles.popupmenu_command,<span class="string">'BackgroundColor'</span>,<span class="string">'green'</span>);
0198 
0199 contents  = get(hObject,<span class="string">'String'</span>);
0200 num       = get(hObject,<span class="string">'Value'</span>);
0201 command  = contents{num};
0202 
0203 setappdata(handles.figure1,<span class="string">'command'</span>, command);
0204 
0205 group     = getappdata(handles.figure1,<span class="string">'group'</span>);
0206 attribute = getappdata(handles.figure1,<span class="string">'attribute'</span>);
0207 AO        = getappdata(handles.figure1,<span class="string">'AO'</span>);
0208 
0209 <span class="comment">% Status one devices</span>
0210 valid  = find(AO.(group).Status);
0211 
0212 <span class="comment">% Construct DeviceName/AttributName list</span>
0213 <span class="comment">%host = getenv('TANGO_HOST'); %% TODO PAS PROPRE mais pour rester conforme avec archiving</span>
0214 <span class="comment">%fullTangoNames = strcat('//',host,'/',AO.(group).DeviceName(valid), '/', attribute);</span>
0215 fullTangoNames = strcat(AO.(group).DeviceName(valid), <span class="string">'/'</span>, attribute);
0216 archivingmanager = getappdata(handles.figure1,<span class="string">'archivingmanager'</span>);
0217 
0218 <span class="keyword">if</span> (get(handles.checkbox_all,<span class="string">'Value'</span>) == 0)
0219     <span class="comment">%% Get selected element</span>
0220     idx = get(handles.listbox_property,<span class="string">'Value'</span>);
0221     fullTangoNamesV = fullTangoNames(idx);
0222 <span class="keyword">else</span> <span class="comment">% All the same</span>
0223     fullTangoNamesV = fullTangoNames';
0224 <span class="keyword">end</span>
0225 
0226 <span class="comment">% Select database</span>
0227 <span class="keyword">switch</span> handles.database
0228     <span class="keyword">case</span> <span class="string">'HDB'</span>
0229         command = [command <span class="string">'Hdb'</span>];
0230     <span class="keyword">case</span> <span class="string">'TDB'</span>
0231         command = [command <span class="string">'Tdb'</span>];
0232 <span class="keyword">end</span>
0233 
0234 <span class="comment">% switchyard on commands</span>
0235 <span class="keyword">switch</span> command(1:end-3)
0236     <span class="keyword">case</span> {<span class="string">'IsArchived'</span>} <span class="comment">% check archiving state</span>
0237         argin = fullTangoNames';
0238         list = tango_command_inout2(archivingmanager,command,argin)';
0239         set(handles.listbox_property,<span class="string">'String'</span>,list);
0240 
0241     <span class="keyword">case</span> {<span class="string">'GetArchivingMode'</span>} <span class="comment">% Get archiving mode</span>
0242         list = [];
0243         <span class="keyword">for</span> k = 1:length(fullTangoNames)
0244             argin = fullTangoNames{k};
0245             answer = tango_command_inout2(archivingmanager,command,argin);
0246             list = [list ; <a href="#_sub30" class="code" title="subfunction list = format_output_list(varargin)">format_output_list</a>(answer)];
0247         <span class="keyword">end</span>
0248 
0249         <span class="comment">%% Format data for fast print out</span>
0250         Name = strcat(AO.(group).DeviceName(valid), <span class="string">'/'</span>, attribute);
0251         [n1 n2] = size(list);
0252         Strcell = cell(n2+1,n1);
0253         Strcell(<span class="keyword">end</span>,:) = Name;
0254         Strcell(1:end-1,:) = num2cell(list');
0255 
0256         <span class="comment">%% TODO: location for file, check fopen is OK</span>
0257         directory = getfamilydata(<span class="string">'Directory'</span>,<span class="string">'Archiving'</span>);
0258         filename = [directory <span class="string">'summarymodedata.txt'</span>];
0259         <span class="comment">%filename = tempname;</span>
0260         [fid message] = fopen(filename,<span class="string">'w'</span>);
0261         <span class="keyword">if</span> fid == -1
0262             message
0263             <span class="keyword">return</span>;
0264         <span class="keyword">end</span>
0265 
0266         fprintf(fid,[<span class="string">'# '</span>,handles.database <span class="string">' DATABASE: File generated on'</span> <span class="keyword">...</span>
0267             <span class="string">' %s\n'</span>],datestr(now));
0268         fprintf(fid,[<span class="string">'# Periodic Mode      Absolute Mode       '</span> <span class="keyword">...</span>
0269             <span class="string">'  Relative Mode       TANGO attribute Name   \n'</span>]);
0270         fprintf(fid,[<span class="string">'#      T(s)    T(s)     min      max     '</span> <span class="keyword">...</span>
0271             <span class="string">'T(s)     min      max    \n'</span>]);
0272         fprintf(fid,<span class="string">'    %7.1f %7.1f %8.2f %8.2f %7.1f %8.2f %8.2f  %s\n'</span>,Strcell{:});
0273         fclose(fid);
0274 
0275         <span class="comment">% edit 'modedata.txt'</span>
0276         <span class="keyword">if</span> isunix
0277             system([<span class="string">'nedit '</span>, filename, <span class="string">' &amp;'</span>]);  <span class="comment">% much faster</span>
0278 <span class="comment">%             eval(['edit ' filename])</span>
0279         <span class="keyword">else</span>
0280             eval([<span class="string">'edit '</span> filename])
0281         <span class="keyword">end</span>
0282 
0283     <span class="keyword">case</span> {<span class="string">'ArchivingStart'</span>}<span class="comment">% Start archiving</span>
0284 
0285         <span class="comment">%% Selects archiving mode</span>
0286         mode = <a href="archiving_panel_mode.html" class="code" title="function varargout = archiving_panel_mode(varargin)">archiving_panel_mode</a>(handles.database);
0287                
0288         <span class="keyword">if</span> isstruct(mode) <span class="comment">% means not canceled</span>
0289             <span class="comment">%% Build up the argument for sIntermediatetarting archiving</span>
0290             <span class="comment">%% Check for different modes selected by user</span>
0291             argin = <a href="#_sub8" class="code" title="subfunction argin = BuildArgin(fullTangoNames, mode, handles)">BuildArgin</a>(fullTangoNamesV, mode,handles);
0292             
0293             <span class="keyword">if</span> isnumeric(argin) &amp;&amp; argin == -1
0294                 disp(<span class="string">'No Archiving mode selected, does nothing'</span>);
0295                 <span class="keyword">return</span>;
0296             <span class="keyword">end</span>
0297             
0298             <a href="#_sub9" class="code" title="subfunction start_archiving(archivingmanager,command,argin,handles)">start_archiving</a>(archivingmanager,command,argin,handles);
0299 
0300             <span class="comment">%% Force a IsArchived call to check if everything as</span>
0301             <span class="comment">%% expected</span>
0302             set(handles.popupmenu_command,<span class="string">'Value'</span>,1);
0303             <a href="#_sub7" class="code" title="subfunction popupmenu_command_Callback(hObject, eventdata, handles)">popupmenu_command_Callback</a>(hObject, eventdata, handles);
0304         <span class="keyword">end</span>
0305 
0306     <span class="keyword">case</span> {<span class="string">'ArchivingStop'</span>}<span class="comment">% Stop archiving</span>
0307         argin = fullTangoNamesV';
0308         error = tango_command_inout2(archivingmanager,command,argin);
0309         <a href="#_sub10" class="code" title="subfunction display_archiving_error(error,handles)">display_archiving_error</a>(error,handles);
0310 
0311         set(handles.popupmenu_command,<span class="string">'Value'</span>,1);
0312         <a href="#_sub7" class="code" title="subfunction popupmenu_command_Callback(hObject, eventdata, handles)">popupmenu_command_Callback</a>(hObject, eventdata, handles);
0313 
0314     <span class="keyword">case</span> {<span class="string">'ArchivingModif'</span>}<span class="comment">% Get archiving mode</span>
0315         list = []; <span class="comment">% clear list</span>
0316         <span class="comment">% build list</span>
0317         <span class="keyword">for</span> k = 1:length(fullTangoNamesV) <span class="comment">% length(fullTangoNames) % Get the first one if a list</span>
0318             argin = fullTangoNamesV{k};
0319             answer = tango_command_inout2(archivingmanager,[<span class="string">'GetArchivingMode'</span> command(end-2:end)],argin);
0320             list = [list ; <a href="#_sub30" class="code" title="subfunction list = format_output_list(varargin)">format_output_list</a>(answer)];
0321         <span class="keyword">end</span>
0322 
0323         <span class="comment">% Selects archiving mode</span>
0324         <span class="comment">% List contains existing archiving modes to be modified</span>
0325         mode = <a href="archiving_panel_mode.html" class="code" title="function varargout = archiving_panel_mode(varargin)">archiving_panel_mode</a>(handles.database,list);
0326 
0327         <span class="keyword">if</span> isstruct(mode) <span class="comment">% means not canceled</span>
0328 
0329             <span class="comment">%% Build up the argument for starting archiving</span>
0330             <span class="comment">%% Check for different modes selected by user</span>
0331             argin = <a href="#_sub8" class="code" title="subfunction argin = BuildArgin(fullTangoNames, mode, handles)">BuildArgin</a>(fullTangoNamesV, mode,handles);
0332 
0333             <a href="#_sub9" class="code" title="subfunction start_archiving(archivingmanager,command,argin,handles)">start_archiving</a>(archivingmanager,command,argin,handles);
0334 
0335             <span class="comment">%% Force a IsArchived call to check if everything as</span>
0336             <span class="comment">%% expected</span>
0337             set(handles.popupmenu_command,<span class="string">'Value'</span>,1);
0338             <a href="#_sub7" class="code" title="subfunction popupmenu_command_Callback(hObject, eventdata, handles)">popupmenu_command_Callback</a>(hObject, eventdata, handles);
0339         <span class="keyword">end</span>
0340 
0341     <span class="keyword">otherwise</span>
0342         disp(<span class="string">'Command not implemented'</span>)
0343 <span class="keyword">end</span>
0344 
0345 <span class="comment">% Update handles structure</span>
0346 guidata(handles.figure1, handles);
0347 
0348 
0349 <a name="_sub8" href="#_subfunctions" class="code">function argin = BuildArgin(fullTangoNames, mode, handles)</a>
0350 <span class="comment">% Build up the argument for starting archiving</span>
0351 <span class="comment">% Check for different modes selected by user</span>
0352 
0353 [temp ismodeselected] = findkeyword(mode.selection,<span class="string">'1'</span>);
0354 <span class="keyword">if</span> ismodeselected == 0 <span class="comment">% no mode selected</span>
0355     argin = -1;
0356     <span class="keyword">return</span>;
0357     
0358 <span class="keyword">elseif</span> ismodeselected == 1 <span class="comment">% at least an archiving mode selected</span>
0359     
0360     <span class="comment">%Load balancing</span>
0361     
0362     <span class="comment">%% standard header</span>
0363     <span class="comment">% 1. archiver name for load balancing feature</span>
0364     <span class="comment">% 2. group feature true or false (not implemented to the end)</span>
0365     <span class="keyword">switch</span> mode.grouped
0366         <span class="keyword">case</span> <span class="string">'0'</span>
0367             header = {<span class="string">'toto'</span>, <span class="string">'false'</span>};
0368         <span class="keyword">case</span> <span class="string">'1'</span>
0369             <span class="comment">% Force to flase since not yet implemented in matlab gui</span>
0370             header = {<span class="string">'toto'</span>, <span class="string">'false'</span>};
0371             <span class="comment">% header = {'toto', 'true'};</span>
0372     <span class="keyword">end</span>
0373     
0374     <span class="comment">%% Not required fields set to default values</span>
0375     <span class="comment">% 1. data type</span>
0376     <span class="comment">% 2. data format</span>
0377     <span class="comment">% 3. writable</span>
0378     <span class="comment">% 4. device in charge</span>
0379     <span class="comment">% 5. Trigger time</span>
0380     
0381     header_attribute = { <span class="string">'0'</span>, <span class="string">'0'</span>, <span class="string">'0'</span>, <span class="string">''</span>,<span class="string">'NULL'</span>};
0382 
0383     <span class="comment">% header length for each attribut</span>
0384     <span class="comment">% depends on the mode selection</span>
0385     len = 6;
0386     len_mode = 0;
0387     
0388     <span class="comment">% number of attributes to archive</span>
0389     nb = length(fullTangoNames);
0390     
0391     <span class="comment">% mode parametrization</span>
0392     mode_P ={};
0393     mode_A ={};
0394     mode_R ={};
0395     mode_string = {};
0396 
0397     <span class="keyword">if</span> str2double(mode.selection{1}) == 1 <span class="comment">%% Periodic mode</span>
0398         len = len + 3;
0399         len_mode = len_mode + 2;
0400         <span class="keyword">if</span> strcmpi(handles.database,<span class="string">'HDB'</span>)
0401             mode.periodic.period = [mode.periodic.period <span class="string">'000'</span>]; <span class="comment">% ms</span>
0402         <span class="keyword">end</span>
0403         mode_P = {<span class="string">'MODE_P'</span>, mode.periodic.period};
0404     <span class="keyword">end</span>
0405 
0406     <span class="keyword">if</span> str2double(mode.selection{2}) == 1 <span class="comment">% Absolute mode</span>
0407         len = len + 4;
0408         len_mode = len_mode + 4;
0409         <span class="keyword">if</span> strcmpi(handles.database,<span class="string">'HDB'</span>)
0410             mode.absolute.period = [mode.absolute.period <span class="string">'000'</span>]; <span class="comment">% ms</span>
0411         <span class="keyword">end</span>
0412         mode_A = {<span class="string">'MODE_A'</span>, mode.absolute.period,<span class="keyword">...</span>
0413             mode.absolute.lowerlimit, mode.absolute.upperlimit};
0414     <span class="keyword">end</span>
0415 
0416     <span class="keyword">if</span> str2double(mode.selection{3}) == 1 <span class="comment">%Relative mode</span>
0417         len = len + 4;
0418         len_mode = len_mode + 4;
0419         <span class="keyword">if</span> strcmpi(handles.database,<span class="string">'HDB'</span>)
0420             mode.relative.period = [mode.relative.period <span class="string">'000'</span>]; <span class="comment">% ms</span>
0421         <span class="keyword">end</span>
0422         mode_R = {<span class="string">'MODE_R'</span>, mode.relative.period,<span class="keyword">...</span>
0423             mode.relative.lowerlimit,mode.relative.upperlimit};
0424     <span class="keyword">end</span>
0425 
0426     mode_string = {mode_P{:}, mode_R{:}, mode_A{:}};
0427     
0428     <span class="keyword">switch</span> handles.database <span class="comment">%% Select database</span>
0429         <span class="keyword">case</span> <span class="string">'TDB'</span> <span class="comment">%% Intermediate DATABASE</span>
0430             len = len +3;
0431             len_mode = len_mode + 3;
0432             mode_string = {mode_string{:}, <span class="string">'TDB_SPEC'</span>, <span class="keyword">...</span>
0433                 mode.exportwindow, mode.keepingwindow};
0434         <span class="keyword">case</span> <span class="string">'HDB'</span> <span class="comment">%% Historical DATABASE</span>
0435             <span class="comment">% No extra arguments</span>
0436     <span class="keyword">end</span>
0437     
0438     argin = header;
0439     
0440     <span class="comment">% loop over list of attributed to be archived</span>
0441     <span class="keyword">for</span> k = 1:nb        
0442         argin = {argin{:}, num2str(len), fullTangoNames{k}, <span class="keyword">...</span>
0443             header_attribute{:}, num2str(len_mode), mode_string{:}};
0444     <span class="keyword">end</span>
0445      
0446 <span class="keyword">end</span>
0447 
0448 <a name="_sub9" href="#_subfunctions" class="code">function start_archiving(archivingmanager,command,argin,handles)</a>
0449 <span class="comment">% START_ARCHIVING - Start or modify an archiving</span>
0450 <span class="comment">%</span>
0451 <span class="comment">% INPUTS</span>
0452 <span class="comment">% archivingmanager - TANGO name of the archiving manager</span>
0453 <span class="comment">% command - start or modify archiving, could be</span>
0454 <span class="comment">%         - ArchivingStart</span>
0455 <span class="comment">%         - ArchivingModif</span>
0456 <span class="comment">%         - ArchivingStartIntermediate</span>
0457 <span class="comment">%         - ArchivingModifIntermediate</span>
0458 <span class="comment">% argin - inputs arguments related to command (see archivingmanager doc )</span>
0459 <span class="comment">%</span>
0460 error = tango_command_inout2(archivingmanager,command,argin);
0461 
0462 <a href="#_sub10" class="code" title="subfunction display_archiving_error(error,handles)">display_archiving_error</a>(error,handles);
0463 
0464 <a name="_sub10" href="#_subfunctions" class="code">function display_archiving_error(error,handles)</a>
0465 <span class="comment">%DISPLAY_ARCHIVING_ERROR - Display error reason</span>
0466 <span class="comment">% Errorhandler</span>
0467 <span class="comment">% See archivingmanager documentation for details</span>
0468 
0469 <span class="keyword">switch</span> error
0470     <span class="keyword">case</span> 0
0471         <span class="comment">%% start succeeded</span>
0472         <span class="keyword">return</span>;
0473     <span class="keyword">case</span> 1
0474         disp(<span class="string">'All the given attribute already archiving process'</span>)
0475     <span class="keyword">case</span> 2
0476         disp(<span class="string">'start failed'</span>)
0477     <span class="keyword">case</span> 3
0478         <span class="comment">% stop succeeded</span>
0479         <span class="keyword">return</span>;
0480     <span class="keyword">case</span> 4
0481         disp(<span class="string">'All giving attributs are not in archiving process'</span>);
0482     <span class="keyword">case</span> 5
0483         disp(<span class="string">'Stop failed'</span>);
0484     <span class="keyword">case</span> 6
0485         <span class="comment">%% Modif succeeded</span>
0486         <span class="keyword">return</span>;
0487     <span class="keyword">case</span> 7
0488         disp(<span class="string">'All given attributes are not in historic archiving'</span>);
0489     <span class="keyword">case</span> 8
0490         disp(<span class="string">'modif failed'</span>);
0491     <span class="keyword">case</span> 9
0492         disp(<span class="string">'No running [H/T]dbArchiver'</span>)
0493     <span class="keyword">case</span> 10
0494         disp(<span class="string">'All the attribute do not exist in static DB'</span>)
0495     <span class="keyword">case</span> 11
0496         disp(<span class="string">'database not connected'</span>)
0497     <span class="keyword">case</span> 12
0498         disp(<span class="string">'device cannot talk to the database'</span>)
0499     <span class="keyword">otherwise</span>
0500         disp(<span class="string">'Unknown error'</span>)
0501 <span class="keyword">end</span>
0502 
0503 warning([<span class="string">'Error with '</span>, handles.database,<span class="string">' database'</span>]);
0504 
0505 
0506 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0507 <a name="_sub11" href="#_subfunctions" class="code">function popupmenu_command_CreateFcn(hObject, eventdata, handles)</a>
0508 <span class="comment">% hObject    handle to popupmenu_command (see GCBO)</span>
0509 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0510 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0511 
0512 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0513 <span class="comment">%       See ISPC and COMPUTER.</span>
0514 <span class="keyword">if</span> ispc
0515     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0516 <span class="keyword">else</span>
0517     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0518 <span class="keyword">end</span>
0519 
0520 <span class="comment">% --- Executes on selection change in listbox_group.</span>
0521 <a name="_sub12" href="#_subfunctions" class="code">function listbox_group_Callback(hObject, eventdata, handles)</a>
0522 <span class="comment">% hObject    handle to listbox_group (see GCBO)</span>
0523 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0524 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0525 
0526 <span class="comment">% Hints: contents = get(hObject,'String') returns listbox_group contents as cell array</span>
0527 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox_group</span>
0528 
0529 set(handles.listbox_property,<span class="string">'Value'</span>,get(hObject,<span class="string">'Value'</span>));
0530 set(handles.listbox_property,<span class="string">'ListboxTop'</span>,get(hObject,<span class="string">'ListboxTop'</span>));
0531 
0532 
0533 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0534 <a name="_sub13" href="#_subfunctions" class="code">function listbox_group_CreateFcn(hObject, eventdata, handles)</a>
0535 <span class="comment">% hObject    handle to listbox_group (see GCBO)</span>
0536 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0537 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0538 
0539 <span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
0540 <span class="comment">%       See ISPC and COMPUTER.</span>
0541 <span class="keyword">if</span> ispc
0542     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0543 <span class="keyword">else</span>
0544     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0545 <span class="keyword">end</span>
0546 
0547 
0548 <span class="comment">% --- Executes on selection change in listbox_property.</span>
0549 <a name="_sub14" href="#_subfunctions" class="code">function listbox_property_Callback(hObject, eventdata, handles)</a>
0550 <span class="comment">% hObject    handle to listbox_property (see GCBO)</span>
0551 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0552 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0553 
0554 <span class="comment">% Hints: contents = get(hObject,'String') returns listbox_property contents as cell array</span>
0555 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox_property</span>
0556 
0557 set(handles.listbox_group,<span class="string">'Value'</span>, get(hObject,<span class="string">'Value'</span>));
0558 set(handles.listbox_group,<span class="string">'ListboxTop'</span>, get(hObject,<span class="string">'ListboxTop'</span>));
0559 
0560 <span class="comment">%set(handles.edit_value,'String',contents{get(hObject,'Value')});</span>
0561 
0562 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0563 <a name="_sub15" href="#_subfunctions" class="code">function listbox_property_CreateFcn(hObject, eventdata, handles)</a>
0564 <span class="comment">% hObject    handle to listbox_property (see GCBO)</span>
0565 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0566 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0567 
0568 <span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
0569 <span class="comment">%       See ISPC and COMPUTER.</span>
0570 <span class="keyword">if</span> ispc
0571     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0572 <span class="keyword">else</span>
0573     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0574 <span class="keyword">end</span>
0575 
0576 
0577 <span class="comment">% --- Executes on button press in checkbox_all.</span>
0578 <a name="_sub16" href="#_subfunctions" class="code">function checkbox_all_Callback(hObject, eventdata, handles)</a>
0579 <span class="comment">% hObject    handle to checkbox_all (see GCBO)</span>
0580 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0581 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0582 
0583 <span class="comment">% Hint: get(hObject,'Value') returns toggle state of checkbox_all</span>
0584 
0585 <a name="_sub17" href="#_subfunctions" class="code">function edit_value_Callback(hObject, eventdata, handles)</a>
0586 <span class="comment">% hObject    handle to edit_value (see GCBO)</span>
0587 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0588 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0589 
0590 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_value as text</span>
0591 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_value as a double</span>
0592 
0593 value = get(hObject,<span class="string">'String'</span>);
0594 
0595 group     = getappdata(handles.figure1,<span class="string">'group'</span>);
0596 attribute = getappdata(handles.figure1,<span class="string">'attribute'</span>);
0597 property  = getappdata(handles.figure1,<span class="string">'property'</span>);
0598 AO        = getappdata(handles.figure1,<span class="string">'AO'</span>);
0599 
0600 <span class="comment">%% Status one devices</span>
0601 valid  = find(AO.(group).Status);
0602 
0603 <span class="keyword">if</span> (get(handles.checkbox_all,<span class="string">'Value'</span>) == 0)
0604     <span class="comment">%% Get selectedd element</span>
0605     idx = get(handles.listbox_property,<span class="string">'Value'</span>);
0606     tango_set_attribute_property(strcat(AO.(group).DeviceName{valid(idx)}, <span class="keyword">...</span>
0607         <span class="string">'/'</span>,attribute),property, value)
0608 <span class="keyword">else</span> <span class="comment">% All the same</span>
0609     tango_set_attribute_property(strcat(AO.(group).DeviceName(valid), <span class="keyword">...</span>
0610         <span class="string">'/'</span>,attribute),property, value)
0611 <span class="keyword">end</span>
0612 <span class="comment">%% Status one devices</span>
0613 valid  = find(AO.(group).Status);
0614 
0615 <span class="comment">%% refresh display</span>
0616 popupmenu_property_Callback(handles.popupmenu_command,eventdata, handles);
0617 
0618 
0619 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0620 <a name="_sub18" href="#_subfunctions" class="code">function edit_value_CreateFcn(hObject, eventdata, handles)</a>
0621 <span class="comment">% hObject    handle to edit_value (see GCBO)</span>
0622 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0623 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0624 
0625 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
0626 <span class="comment">%       See ISPC and COMPUTER.</span>
0627 <span class="keyword">if</span> ispc
0628     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0629 <span class="keyword">else</span>
0630     set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
0631 <span class="keyword">end</span>
0632 
0633 
0634 <span class="comment">% --------------------------------------------------------------------</span>
0635 <a name="_sub19" href="#_subfunctions" class="code">function uimenu_linac_Callback(hObject, eventdata, handles)</a>
0636 <span class="comment">% hObject    handle to uimenu_linac (see GCBO)</span>
0637 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0638 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0639 
0640 <a href="#_sub21" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0641 
0642 <span class="comment">% --------------------------------------------------------------------</span>
0643 <a name="_sub20" href="#_subfunctions" class="code">function uimenu_LT1_Callback(hObject, eventdata, handles)</a>
0644 <span class="comment">% hObject    handle to uimenu_LT1 (see GCBO)</span>
0645 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0646 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0647 
0648 <span class="keyword">if</span> ~strcmpi(getsubmachinename, <span class="string">'LT1'</span>)
0649     LT1init;
0650 <span class="keyword">end</span>
0651 handles = <a href="#_sub21" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0652 <span class="comment">% Update handles structure</span>
0653 guidata(hObject, handles);
0654 
0655 <span class="comment">%%%--------------------------------------------------------------------</span>
0656 <a name="_sub21" href="#_subfunctions" class="code">function handles = init_uimenu(hObject, eventdata, handles)</a>
0657 
0658 setappdata(handles.figure1,<span class="string">'AO'</span>, getao);
0659 
0660 <span class="comment">%% Checked box</span>
0661 all = findobj(get(hObject,<span class="string">'Parent'</span>),<span class="string">'Type'</span>,<span class="string">'UImenu'</span>);
0662 set(all, <span class="string">'Checked'</span>, <span class="string">'Off'</span>);
0663 set(hObject, <span class="string">'Checked'</span>, <span class="string">'On'</span>);
0664 
0665 <span class="comment">%% Initializes popupmenu w/ first element, first attribute, first property</span>
0666 listgroup = findmemberof(<span class="string">'Archivable'</span>);
0667 
0668 set(handles.popupmenu_group,<span class="string">'String'</span>,listgroup);
0669 setappdata(handles.figure1,<span class="string">'group'</span>, listgroup{1});
0670 
0671 <a href="#_sub3" class="code" title="subfunction popupmenu_group_Callback(hObject, eventdata, handles)">popupmenu_group_Callback</a>(handles.popupmenu_group, eventdata, handles);
0672 
0673 <span class="comment">%% Initializes command popup menu w/ list of archivingmanager available</span>
0674 <span class="comment">%% commands</span>
0675 <span class="comment">% res = tango_command_list_query(archivingmanager);</span>
0676 <span class="comment">% listcmd = {res.cmd_name};</span>
0677 listcmd = {<span class="string">'IsArchived'</span>,<span class="string">'GetArchivingMode'</span>, <span class="string">'ArchivingStart'</span>, <span class="keyword">...</span>
0678     <span class="string">'ArchivingStop'</span>,<span class="string">'ArchivingModif'</span>};
0679 set(handles.popupmenu_command,<span class="string">'String'</span>,listcmd);
0680 value = find(strcmp(listcmd,<span class="string">'IsArchived'</span>));
0681 set(handles.popupmenu_command,<span class="string">'Value'</span>,value);
0682 setappdata(handles.figure1,<span class="string">'command'</span>, value);
0683 
0684 <span class="comment">% --------------------------------------------------------------------</span>
0685 <a name="_sub22" href="#_subfunctions" class="code">function uimenu_booster_Callback(hObject, eventdata, handles)</a>
0686 <span class="comment">% hObject    handle to uimenu_booster (see GCBO)</span>
0687 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0688 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0689 
0690 <span class="keyword">if</span> ~strcmpi(getsubmachinename, <span class="string">'Booster'</span>)
0691     boosterinit
0692 <span class="keyword">end</span>
0693 <a href="#_sub21" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0694 
0695 <span class="comment">% --------------------------------------------------------------------</span>
0696 <a name="_sub23" href="#_subfunctions" class="code">function uimenu_LT2_Callback(hObject, eventdata, handles)</a>
0697 <span class="comment">% hObject    handle to uimenu_LT2 (see GCBO)</span>
0698 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0699 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0700 
0701 <span class="keyword">if</span> ~strcmpi(getsubmachinename, <span class="string">'LT2'</span>)
0702    LT2init;
0703 <span class="keyword">end</span>
0704 <a href="#_sub21" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0705 
0706 <span class="comment">% --------------------------------------------------------------------</span>
0707 <a name="_sub24" href="#_subfunctions" class="code">function uimenu_anneau_Callback(hObject, eventdata, handles)</a>
0708 <span class="comment">% hObject    handle to uimenu_anneau (see GCBO)</span>
0709 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0710 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0711 
0712 <span class="keyword">if</span> ~strcmpi(getsubmachinename, <span class="string">'StorageRing'</span>) 
0713     soleilinit;
0714 <span class="keyword">end</span>
0715 <a href="#_sub21" class="code" title="subfunction handles = init_uimenu(hObject, eventdata, handles)">init_uimenu</a>(hObject, eventdata, handles);
0716 
0717 <span class="comment">% --------------------------------------------------------------------</span>
0718 <a name="_sub25" href="#_subfunctions" class="code">function Untitled_1_Callback(hObject, eventdata, handles)</a>
0719 <span class="comment">% hObject    handle to Untitled_1 (see GCBO)</span>
0720 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0721 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0722 
0723 
0724 <span class="comment">% --------------------------------------------------------------------</span>
0725 <a name="_sub26" href="#_subfunctions" class="code">function hdbmenu_Callback(hObject, eventdata, handles)</a>
0726 <span class="comment">% hObject    handle to menuhdb (see GCBO)</span>
0727 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0728 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0729 set(handles.hdbmenu,<span class="string">'checked'</span>,<span class="string">'On'</span>);
0730 set(handles.tdbmenu,<span class="string">'checked'</span>,<span class="string">'Off'</span>);
0731 handles.database=<span class="string">'HDB'</span>;
0732 set(handles.mainuipanel,<span class="string">'Title'</span>,<span class="string">'TANGO HDB Configurator'</span>, <span class="keyword">...</span>
0733     <span class="string">'ForegroundColor'</span>,[0, 0.5, 0]);
0734 <span class="comment">% Update handles structure</span>
0735 guidata(hObject, handles);
0736 
0737 <span class="comment">% --------------------------------------------------------------------</span>
0738 <a name="_sub27" href="#_subfunctions" class="code">function tdbmenu_Callback(hObject, eventdata, handles)</a>
0739 <span class="comment">% hObject    handle to tdbmenu (see GCBO)</span>
0740 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0741 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0742 set(handles.tdbmenu,<span class="string">'checked'</span>,<span class="string">'On'</span>);
0743 set(handles.hdbmenu,<span class="string">'checked'</span>,<span class="string">'Off'</span>);
0744 handles.database=<span class="string">'TDB'</span>;
0745 set(handles.mainuipanel,<span class="string">'Title'</span>,<span class="string">'TANGO TDB Configurator'</span>,<span class="string">'ForegroundColor'</span>,<span class="string">'b'</span>);
0746 <span class="comment">% Update handles structure</span>
0747 guidata(hObject, handles);
0748 
0749 <span class="comment">% --------------------------------------------------------------------</span>
0750 <a name="_sub28" href="#_subfunctions" class="code">function Untitled_2_Callback(hObject, eventdata, handles)</a>
0751 <span class="comment">% hObject    handle to Untitled_2 (see GCBO)</span>
0752 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0753 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0754 
0755 
0756 <span class="comment">% --- Executes on button press in checkbox_loadbalancing.</span>
0757 <a name="_sub29" href="#_subfunctions" class="code">function checkbox_loadbalancing_Callback(hObject, eventdata, handles)</a>
0758 <span class="comment">% hObject    handle to checkbox_loadbalancing (see GCBO)</span>
0759 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0760 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0761 
0762 <span class="comment">% Hint: get(hObject,'Value') returns toggle state of checkbox_loadbalancing</span>
0763 
0764 <a name="_sub30" href="#_subfunctions" class="code">function list = format_output_list(varargin)</a>
0765 
0766 cellarray = varargin{:};
0767 
0768 list = zeros(1,7);
0769 
0770 <span class="comment">% Periodical mode: just get archiving period</span>
0771 [cellarray index] = findkeyword2(cellarray,<span class="string">'MODE_P'</span>);
0772 <span class="keyword">if</span> index ~= 0
0773     list(1) = str2double(cellarray(index))/1e3; <span class="comment">% seconds</span>
0774 <span class="keyword">end</span>
0775 
0776 <span class="comment">% Absolute mode: just get archiving period and variation limits</span>
0777 [cellarray index] = findkeyword2(cellarray,<span class="string">'MODE_A'</span>);
0778 <span class="keyword">if</span> index ~= 0
0779     list(2) = str2double(cellarray(index))/1e3; <span class="comment">% seconds</span>
0780     list(3) = str2double(cellarray(index+1)); <span class="comment">% decreasing variation (%)</span>
0781     list(4) = str2double(cellarray(index+2)); <span class="comment">% increasing variation (%)</span>
0782 <span class="keyword">end</span>
0783 
0784 <span class="comment">% Relative mode: just get archiving period and variation limits</span>
0785 [cellarray index] = findkeyword2(cellarray,<span class="string">'MODE_R'</span>);
0786 <span class="keyword">if</span> index ~= 0
0787     list(5) = str2double(cellarray(index))/1e3; <span class="comment">% seconds</span>
0788     list(6) = str2double(cellarray(index+1)); <span class="comment">% decreasing variation (%)</span>
0789     list(7) = str2double(cellarray(index+2)); <span class="comment">% increasing variation (%)</span>
0790 <span class="keyword">end</span>
0791 
0792 
0793 <span class="comment">% --- If Enable == 'on', executes on mouse press in 5 pixel border.</span>
0794 <span class="comment">% --- Otherwise, executes on mouse press in 5 pixel border or over listbox_group.</span>
0795 <a name="_sub31" href="#_subfunctions" class="code">function listbox_group_ButtonDownFcn(hObject, eventdata, handles)</a>
0796 <span class="comment">% hObject    handle to listbox_group (see GCBO)</span>
0797 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0798 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0799 
0800 <span class="comment">%% TODO: works only if right button pressed</span>
0801 <span class="comment">%       do not know how to do for left button</span>
0802 val = get(handles.listbox_group,<span class="string">'Value'</span>);
0803 set(handles.listbox_property,<span class="string">'Value'</span>,val);
0804 
0805 
0806 <span class="comment">% --------------------------------------------------------------------</span>
0807 <a name="_sub32" href="#_subfunctions" class="code">function menu_file_Callback(hObject, eventdata, handles)</a>
0808 <span class="comment">% hObject    handle to menu_file (see GCBO)</span>
0809 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0810 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0811 
0812 
0813 <span class="comment">% --------------------------------------------------------------------</span>
0814 <a name="_sub33" href="#_subfunctions" class="code">function savemenu_Callback(hObject, eventdata, handles)</a>
0815 <span class="comment">% hObject    handle to savemenu (see GCBO)</span>
0816 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0817 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0818 
0819 <a href="#_sub34" class="code" title="subfunction summarymenu_Callback(hObject, eventdata, handles)">summarymenu_Callback</a>(hObject, eventdata, handles);
0820 directory = getfamilydata(<span class="string">'Directory'</span>,<span class="string">'Archiving'</span>);
0821 filename1 = [directory appendtimestamp(<span class="string">'config'</span>)];
0822 filename0 = [directory <span class="string">'config.dat'</span>];
0823 copyfile(filename0,filename1);
0824 
0825 <span class="comment">% --------------------------------------------------------------------</span>
0826 <a name="_sub34" href="#_subfunctions" class="code">function summarymenu_Callback(hObject, eventdata, handles)</a>
0827 <span class="comment">% hObject    handle to summarymenu (see GCBO)</span>
0828 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0829 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0830 
0831 AO        = getappdata(handles.figure1,<span class="string">'AO'</span>);
0832 archivingmanager = getappdata(handles.figure1,<span class="string">'archivingmanager'</span>);
0833 
0834 <span class="comment">%grouplist = intersect(findmemberof('Magnet'),findmemberof('Archivable'));</span>
0835 grouplist = findmemberof(<span class="string">'Archivable'</span>);
0836 
0837 <span class="comment">% get database name</span>
0838 <span class="keyword">switch</span> handles.database
0839     <span class="keyword">case</span> <span class="string">'HDB'</span>
0840         dbName = <span class="string">'Hdb'</span>;
0841     <span class="keyword">case</span> <span class="string">'TDB'</span>
0842         dbName = <span class="string">'Tdb'</span>;
0843 <span class="keyword">end</span>
0844 
0845 directory = getfamilydata(<span class="string">'Directory'</span>,<span class="string">'Archiving'</span>);
0846 <span class="comment">%filename = [directory appendtimestamp('config')];</span>
0847 filename = [directory <span class="string">'config.dat'</span>];
0848 fid = fopen(filename,<span class="string">'w'</span>);
0849 
0850 fprintf(fid,[<span class="string">'# '</span>,handles.database <span class="string">' DATABASE: File generated on'</span> <span class="keyword">...</span>
0851     <span class="string">' %s\n'</span>],datestr(now));
0852 fprintf(fid,[<span class="string">'# Periodic Mode      Absolute Mode       '</span> <span class="keyword">...</span>
0853     <span class="string">'  Relative Mode       TANGO attribute Name   \n'</span>]);
0854 fprintf(fid,[<span class="string">'#      T(s)    T(s)     min      max     '</span> <span class="keyword">...</span>
0855     <span class="string">'T(s)     min      max    \n'</span>]);
0856 
0857 <span class="keyword">for</span> k1 = 1:length(grouplist),
0858     <span class="comment">% loop of group of devices</span>
0859     <span class="comment">%get attribut list</span>
0860     <span class="comment">% Status one devices</span>
0861     valid  = find(AO.(grouplist{k1}).Status);
0862 
0863     <span class="keyword">for</span> k2 = 1:length(valid)
0864         <span class="comment">% loop over devices</span>
0865         <span class="comment">% Builds up attribut list for selected groups</span>
0866         attributeList = tango_get_attribute_list(AO.(grouplist{k1}).DeviceName{valid(k2)});
0867         <span class="keyword">for</span> k3 = 1:length(attributeList),
0868             <span class="comment">% loop over attributes</span>
0869             <span class="comment">%check if archived</span>
0870             <span class="keyword">try</span>
0871                 argin = strcat(AO.(grouplist{k1}).DeviceName(valid(k2)), <span class="string">'/'</span>, attributeList{k3});
0872                 arstatus = tango_command_inout2(archivingmanager,[<span class="string">'IsArchived'</span> dbName], argin);
0873             <span class="keyword">catch</span>
0874                 fprintf(<span class="string">'Erreur with attribute %s\n Action aborted \n'</span>, attributeList{k3});
0875                 <span class="keyword">return</span>;
0876             <span class="keyword">end</span>
0877             <span class="keyword">if</span> arstatus
0878                 <span class="comment">%get Archiving modes</span>
0879                 answer = tango_command_inout2(archivingmanager,[<span class="string">'GetArchivingMode'</span> dbName], argin{:});
0880                 list = <a href="#_sub30" class="code" title="subfunction list = format_output_list(varargin)">format_output_list</a>(answer);
0881 
0882                 <span class="comment">%% Format data for fast print out</span>
0883 <span class="comment">%                 Name = strcat(AO.(groupLIST(k1)).DeviceName(valid(k2)), '/', attributelist{k3});</span>
0884                 Name = argin;
0885                 [n1 n2] = size(list);
0886                 Strcell = cell(n2+1,n1);
0887                 Strcell(<span class="keyword">end</span>,:) = Name;
0888                 Strcell(1:end-1,:) = num2cell(list');
0889                 fprintf(fid,<span class="string">'    %7.1f %7.1f %8.2f %8.2f %7.1f %8.2f %8.2f  %s\n'</span>,Strcell{:});
0890             <span class="keyword">end</span>
0891         <span class="keyword">end</span>
0892     <span class="keyword">end</span>
0893 <span class="keyword">end</span>
0894 
0895 fclose(fid);
0896 
0897 <span class="comment">% show file</span>
0898 <span class="keyword">if</span> isunix
0899     system([<span class="string">'nedit '</span>, filename, <span class="string">' &amp;'</span>]);  <span class="comment">% much faster</span>
0900 <span class="keyword">else</span>
0901     eval([<span class="string">'edit '</span> filename])
0902 <span class="keyword">end</span>
0903 
0904 
0905 <span class="comment">% --------------------------------------------------------------------</span>
0906 <a name="_sub35" href="#_subfunctions" class="code">function loadmenu_Callback(hObject, eventdata, handles)</a>
0907 <span class="comment">% hObject    handle to loadmenu (see GCBO)</span>
0908 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0909 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0910 
0911 disp(<span class="string">'Not implemented yet'</span>)</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>