<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of LT1init</title>
  <meta name="keywords" content="LT1init">
  <meta name="description" content="LT1INIT - Contructs an accelerator Object describing LT1">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="index.html">LT1</a> &gt; LT1init.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/LT1&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>LT1init
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>LT1INIT - Contructs an accelerator Object describing LT1</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function LT1init(OperationalMode) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> LT1INIT - Contructs an accelerator Object describing LT1

 Written by Laurent S. Nadolski, Synchrotron SOLEIL

==========================
 Accelerator Family Fields
==========================
 FamilyName            CH, CV, QP, Bend
 CommonNames           Shortcut name for each element
 DeviceList            [Sector, Number]
 ElementList           number in list
 Position              m, magnet center

 MONITOR FIELD
 Mode                  online/manual/special/simulator
 TangoNames            Tango device name for monitor
 Units                 Physics or HW
 HW2PhysicsFcn         function handle used to convert from hardware to physics units ==&gt; inline will not compile, see below
 HW2PhysicsParams      parameters used for conversion function
 Physics2HWFcn         function handle used to convert from physics to hardware units
 Physics2HWParams      parameters used for conversion function
 HWUnits               units for Hardware 'ampere';
 PhysicsUnits          units for physics 'Rad';
 Handles               monitor handle

 SETPOINT FIELDS
 Mode                  online/manual/special/simulator
 TangoNames            PV for monitor
 Units                 hardware or physics
 HW2PhysicsFcn         function handle used to convert from hardware to physics units
 HW2PhysicsParams      parameters used for conversion function
 Physics2HWFcn         function handle used to convert from physics to hardware units
 Physics2HWParams      parameters used for conversion function
 HWUnits               units for Hardware 'ampere';
 PhysicsUnits          units for physics 'Rad';
 Range                 minsetpoint, maxsetpoint;
 Tolerance             setpoint-monitor
 Handles               setpoint handle

=============================================
 Accelerator Toolbox Simulation Fields
=============================================
 ATType                Quad, Sext, etc
 ATIndex               index in THERING
 ATParameterGroup      parameter group

============
 Family List
============
    CH
    CV
    BEND
    QP
    Machine Parameters

  See Also <a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>, <a href="setoperationalmode.html" class="code" title="function setoperationalmode(ModeNumber)">setoperationalmode</a>, <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>, setpathsoleil</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="setoperationalmode.html" class="code" title="function setoperationalmode(ModeNumber)">setoperationalmode</a>	SETOPERATIONALMODE - Switches between the various operational modes</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="LT1setup.html" class="code" title="function LT1setup">LT1setup</a>	LT1SETUP - GUI for doing LT1 setup</li><li><a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>	AOINIT - Initialization function for the Matlab Middle Layer (MML)</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function LT1init(OperationalMode)</a>
0002 <span class="comment">% LT1INIT - Contructs an accelerator Object describing LT1</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Written by Laurent S. Nadolski, Synchrotron SOLEIL</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%==========================</span>
0007 <span class="comment">% Accelerator Family Fields</span>
0008 <span class="comment">%==========================</span>
0009 <span class="comment">% FamilyName            CH, CV, QP, Bend</span>
0010 <span class="comment">% CommonNames           Shortcut name for each element</span>
0011 <span class="comment">% DeviceList            [Sector, Number]</span>
0012 <span class="comment">% ElementList           number in list</span>
0013 <span class="comment">% Position              m, magnet center</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% MONITOR FIELD</span>
0016 <span class="comment">% Mode                  online/manual/special/simulator</span>
0017 <span class="comment">% TangoNames            Tango device name for monitor</span>
0018 <span class="comment">% Units                 Physics or HW</span>
0019 <span class="comment">% HW2PhysicsFcn         function handle used to convert from hardware to physics units ==&gt; inline will not compile, see below</span>
0020 <span class="comment">% HW2PhysicsParams      parameters used for conversion function</span>
0021 <span class="comment">% Physics2HWFcn         function handle used to convert from physics to hardware units</span>
0022 <span class="comment">% Physics2HWParams      parameters used for conversion function</span>
0023 <span class="comment">% HWUnits               units for Hardware 'ampere';</span>
0024 <span class="comment">% PhysicsUnits          units for physics 'Rad';</span>
0025 <span class="comment">% Handles               monitor handle</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% SETPOINT FIELDS</span>
0028 <span class="comment">% Mode                  online/manual/special/simulator</span>
0029 <span class="comment">% TangoNames            PV for monitor</span>
0030 <span class="comment">% Units                 hardware or physics</span>
0031 <span class="comment">% HW2PhysicsFcn         function handle used to convert from hardware to physics units</span>
0032 <span class="comment">% HW2PhysicsParams      parameters used for conversion function</span>
0033 <span class="comment">% Physics2HWFcn         function handle used to convert from physics to hardware units</span>
0034 <span class="comment">% Physics2HWParams      parameters used for conversion function</span>
0035 <span class="comment">% HWUnits               units for Hardware 'ampere';</span>
0036 <span class="comment">% PhysicsUnits          units for physics 'Rad';</span>
0037 <span class="comment">% Range                 minsetpoint, maxsetpoint;</span>
0038 <span class="comment">% Tolerance             setpoint-monitor</span>
0039 <span class="comment">% Handles               setpoint handle</span>
0040 <span class="comment">%</span>
0041 <span class="comment">%=============================================</span>
0042 <span class="comment">% Accelerator Toolbox Simulation Fields</span>
0043 <span class="comment">%=============================================</span>
0044 <span class="comment">% ATType                Quad, Sext, etc</span>
0045 <span class="comment">% ATIndex               index in THERING</span>
0046 <span class="comment">% ATParameterGroup      parameter group</span>
0047 <span class="comment">%</span>
0048 <span class="comment">%============</span>
0049 <span class="comment">% Family List</span>
0050 <span class="comment">%============</span>
0051 <span class="comment">%    CH</span>
0052 <span class="comment">%    CV</span>
0053 <span class="comment">%    BEND</span>
0054 <span class="comment">%    QP</span>
0055 <span class="comment">%    Machine Parameters</span>
0056 <span class="comment">%</span>
0057 <span class="comment">%  See Also aoinit, setoperationalmode, updateatindex, setpathsoleil</span>
0058 
0059 <span class="comment">%==============================</span>
0060 <span class="comment">%load AcceleratorData structure</span>
0061 <span class="comment">%==============================</span>
0062 
0063 <span class="keyword">if</span> nargin &lt; 1
0064     OperationalMode = 1;
0065 <span class="keyword">end</span>
0066 
0067 <span class="keyword">global</span> GLOBVAL THERING
0068 
0069 Mode             = <span class="string">'online'</span>;
0070 setad([]);       <span class="comment">%clear AcceleratorData memory</span>
0071 AD.SubMachine    = <span class="string">'LT1'</span>; <span class="comment">% Will already be defined if setpathmml was used</span>
0072 AD.Energy        = 0.110; <span class="comment">% Energy in GeV</span>
0073 
0074 setad(AD);   <span class="comment">%load AcceleratorData</span>
0075 
0076 <span class="comment">%%%%%%%%%%%%%%%%%%%%</span>
0077 <span class="comment">% ACCELERATOR OBJECT</span>
0078 <span class="comment">%%%%%%%%%%%%%%%%%%%%</span>
0079 
0080 setao([]);   <span class="comment">%clear previous AcceleratorObjects</span>
0081 
0082 <span class="comment">%% Dipole</span>
0083 ifam = <span class="string">'BEND'</span>;
0084 
0085 AO.(ifam).FamilyName             = <span class="string">'BEND'</span>;
0086 AO.(ifam).MemberOf               = {<span class="string">'MachineConfig'</span>; <span class="string">'Magnet'</span>; <span class="string">'BEND'</span>; <span class="string">'Archivable'</span>};
0087 AO.(ifam).Mode                   = Mode;
0088 AO.(ifam).DeviceName{1}          = <span class="string">'LT1/AE/D.1'</span>;
0089 AO.(ifam).CommonNames{1}         = <span class="string">'DIP'</span>;
0090 AO.(ifam).DeviceList(1,:)        = [1 1];
0091 AO.(ifam).ElementList            = 1;
0092 AO.(ifam).Status                 = 1;
0093 AO.(ifam).Monitor.TangoNames     = strcat(AO.(ifam).DeviceName, <span class="string">'/current'</span>);
0094 AO.(ifam).Monitor.ModelVal       = 0;
0095 AO.(ifam).Monitor.TangoVal       = 0;
0096 AO.(ifam).Monitor.Mode           = Mode;
0097 AO.(ifam).Monitor.Handles(:,1)   = NaN;
0098 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0099 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0100 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0101 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0102 AO.(ifam).Monitor.HW2PhysicsFcn  = @bend2gev;
0103 AO.(ifam).Monitor.Physics2HWFcn  = @gev2bend;
0104 setao(AO);
0105 [C Leff Type coefficients] = magnetcoefficients(AO.(ifam).FamilyName );
0106 AO.(ifam).Monitor.HW2PhysicsParams{1}(1,:) = coefficients;
0107 AO.(ifam).Monitor.Physics2HWParams = AO.(ifam).Monitor.HW2PhysicsParams;
0108 
0109 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0110 AO.(ifam).Desired  = AO.(ifam).Monitor;
0111 
0112 <span class="comment">%% Quadrupoles</span>
0113 ifam = <span class="string">'QP'</span>;
0114 
0115 AO.(ifam).FamilyName             = <span class="string">'QP'</span>;
0116 AO.(ifam).MemberOf               = {<span class="string">'MachineConfig'</span>; <span class="string">'Magnet'</span>; <span class="string">'QP'</span>; <span class="string">'Archivable'</span>};
0117 AO.(ifam).Mode                   = Mode;
0118 <span class="keyword">for</span> ik = 1:7    
0119     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT1/AE/Q.'</span> num2str(ik)];
0120     AO.(ifam).CommonNames{ik} = [<span class="string">'QP'</span> num2str(ik)];
0121     AO.(ifam).DeviceList(ik,:) = [1 ik];
0122 <span class="keyword">end</span>
0123 AO.(ifam).DeviceName             = AO.(ifam).DeviceName';
0124 AO.(ifam).CommonNames            = AO.(ifam).CommonNames';
0125 
0126 nb                               = length(AO.(ifam).DeviceName);
0127 AO.(ifam).Monitor.Range(:,:)     = repmat([-10 10],nb,1);
0128 AO.(ifam).Monitor.TangoNames     = strcat(AO.(ifam).DeviceName, <span class="string">'/current'</span>);
0129 AO.(ifam).Status                 = ones(nb,1);
0130 AO.(ifam).Monitor.ModelVal       = zeros(1,nb);
0131 AO.(ifam).Monitor.TangoVal       = AO.(ifam).Monitor.ModelVal;
0132 AO.(ifam).ElementList            = 1:nb;
0133 
0134 AO.(ifam).Monitor.Mode           = Mode;
0135 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(nb,1);
0136 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0137 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0138 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0139 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0140 AO.(ifam).Monitor.HW2PhysicsFcn = @amp2k;
0141 AO.(ifam).Monitor.Physics2HWFcn = @k2amp;
0142 
0143 <span class="comment">%C = magnetcoefficients4LT1(AO.(ifam).FamilyName);</span>
0144 C = magnetcoefficients(AO.(ifam).FamilyName);
0145 
0146 <span class="keyword">for</span> ii=1:nb,
0147     <span class="keyword">if</span> ii == 2 || ii == 3 || ii == 6
0148         <span class="comment">% Defocusing quads</span>
0149         AO.(ifam).Monitor.HW2PhysicsParams{1}(ii,:)  = C.*[1 -1 1 -1 1 -1 1 -1];
0150         AO.(ifam).Monitor.Physics2HWParams{1}(ii,:)  = C.*[1 -1 1 -1 1 -1 1 -1];
0151     <span class="keyword">else</span>
0152         <span class="comment">% Focusing quad</span>
0153         AO.(ifam).Monitor.HW2PhysicsParams{1}(ii,:)  = C;
0154         AO.(ifam).Monitor.Physics2HWParams{1}(ii,:)  = C;
0155     <span class="keyword">end</span>
0156 <span class="keyword">end</span>
0157 
0158 <span class="comment">%AO.(ifam).Monitor.Range(:,:) = repmat([-5 5],nb,1); % 10 A for 0.8 mrad</span>
0159 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0160 AO.(ifam).Desired = AO.(ifam).Monitor;
0161 
0162 
0163 
0164 <span class="comment">%% Horizontal Correctors</span>
0165 ifam = <span class="string">'CH'</span>;
0166 AO.(ifam).FamilyName           = <span class="string">'CH'</span>;
0167 AO.(ifam).MemberOf             = {<span class="string">'MachineConfig'</span>; <span class="string">'HCM'</span>; <span class="string">'Magnet'</span>; <span class="string">'CH'</span>; <span class="string">'Archivable'</span>};
0168 
0169 <span class="keyword">for</span> ik = 1:3    
0170     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT1/AE/CH.'</span> num2str(ik)];
0171     AO.(ifam).CommonNames{ik} = [<span class="string">'CH'</span> num2str(ik)];
0172     AO.(ifam).DeviceList(ik,:) = [1 ik];
0173 <span class="keyword">end</span>
0174 AO.(ifam).DeviceName               = AO.(ifam).DeviceName';
0175 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0176 
0177 nb                         = length(AO.(ifam).DeviceName);
0178 AO.(ifam).Monitor.Range(:,:)     = repmat([-1.5 1.5],nb,1);
0179 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/current'</span>);
0180 AO.(ifam).Status               = ones(nb,1);
0181 AO.(ifam).Monitor.ModelVal     = zeros(1,nb);
0182 AO.(ifam).Monitor.TangoVal     = AO.(ifam).Monitor.ModelVal;
0183 AO.(ifam).ElementList           = 1:nb;
0184 
0185 AO.(ifam).Monitor.Mode           = Mode;
0186 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(nb,1);
0187 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0188 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0189 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0190 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0191 AO.(ifam).Monitor.HW2PhysicsFcn  = @amp2k;
0192 AO.(ifam).Monitor.Physics2HWFcn  = @k2amp;
0193 [C Leff Type coefficients] = magnetcoefficients(AO.(ifam).FamilyName );
0194 AO.(ifam).Monitor.HW2PhysicsParams{1}(1,:) = coefficients;
0195 AO.(ifam).Monitor.Physics2HWParams = AO.(ifam).Monitor.HW2PhysicsParams;
0196 
0197 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0198 
0199 
0200 <span class="comment">%% Vertical Correctors</span>
0201 ifam = <span class="string">'CV'</span>;
0202 
0203 AO.(ifam).FamilyName           = <span class="string">'CV'</span>;
0204 AO.(ifam).MemberOf             = {<span class="string">'MachineConfig'</span>; <span class="string">'Magnet'</span>; <span class="string">'VCM'</span>; <span class="string">'CV'</span>; <span class="string">'Archivable'</span>};
0205 AO.(ifam).Mode                 = Mode;
0206 
0207 <span class="keyword">for</span> ik = 1:3    
0208     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT1/AE/CV.'</span> num2str(ik)];
0209     AO.(ifam).CommonNames{ik} = [<span class="string">'CV'</span> num2str(ik)];
0210     AO.(ifam).DeviceList(ik,:) = [1 ik];
0211 <span class="keyword">end</span>
0212 AO.(ifam).DeviceName               = AO.(ifam).DeviceName';
0213 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0214 
0215 nb                             = length(AO.(ifam).DeviceName);
0216 AO.(ifam).Monitor.Range(:,:)     = repmat([-1.5 1.5],nb,1);
0217 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/current'</span>);
0218 AO.(ifam).Status               = ones(nb,1);
0219 AO.(ifam).Monitor.ModelVal     = zeros(1,nb);
0220 AO.(ifam).Monitor.TangoVal     = AO.(ifam).Monitor.ModelVal;
0221 AO.(ifam).ElementList          = 1:nb;
0222 
0223 AO.(ifam).Monitor.Mode           = Mode;
0224 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(nb,1);
0225 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0226 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0227 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0228 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0229 AO.(ifam).Monitor.HW2PhysicsFcn  = @amp2k;
0230 AO.(ifam).Monitor.Physics2HWFcn  = @k2amp;
0231 [C Leff Type coefficients] = magnetcoefficients(AO.(ifam).FamilyName );
0232 AO.(ifam).Monitor.HW2PhysicsParams{1}(1,:) = coefficients;
0233 AO.(ifam).Monitor.Physics2HWParams = AO.(ifam).Monitor.HW2PhysicsParams;
0234 
0235 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0236 
0237 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0238 <span class="comment">%% cycleramp</span>
0239 <span class="comment">%%%%%%%%%%%%%%%%%</span>
0240 
0241 <span class="comment">%% cycleramp For dipole magnet</span>
0242 ifam = <span class="string">'CycleBEND'</span>;
0243 
0244 AO.(ifam).FamilyName             = <span class="string">'CycleBEND'</span>;
0245 AO.(ifam).MemberOf               = {<span class="string">'CycleBEND'</span>; <span class="string">'Cyclage'</span>};
0246 AO.(ifam).Mode                   = Mode;
0247 AO.(ifam).GroupId                = tango_group_create(<span class="string">'Dipole'</span>); 
0248 AO.(ifam).DeviceName             = <span class="string">'LT1/AE/cycleD.1'</span>;
0249 <span class="comment">%add devices to group</span>
0250 tango_group_add(AO.(ifam).GroupId, AO.(ifam).DeviceName);
0251 AO.(ifam).Inom = 180;
0252 AO.(ifam).Imax = 250;
0253 AO.(ifam).Status = 1;
0254 
0255 <span class="comment">%% cycleramp For H-corrector magnets</span>
0256 ifam = <span class="string">'CycleCH'</span>;
0257 
0258 AO.(ifam).FamilyName             = ifam;
0259 AO.(ifam).MemberOf               = {<span class="string">'CycleCOR'</span>; <span class="string">'CycleCH'</span>; <span class="string">'Cyclage'</span>};
0260 AO.(ifam).Mode                   = Mode;
0261 AO.(ifam).GroupId                = tango_group_create(<span class="string">'COR'</span>); 
0262 AO.(ifam).DeviceName             = {<span class="string">'LT1/AE/cycleCH.1'</span>; <span class="string">'LT1/AE/cycleCH.2'</span>; <span class="string">'LT1/AE/cycleCH.3'</span>};
0263 AO.(ifam).DeviceList             = [1 1; 1 2; 1 3];
0264 AO.(ifam).ElementList            = (1:3)';
0265 tango_group_add(AO.(ifam).GroupId, AO.(ifam).DeviceName');
0266 AO.(ifam).Inom = [1 2 3];
0267 AO.(ifam).Imax = 10*ones(1,3);
0268 AO.(ifam).Status = ones(3,1);
0269 AO.(ifam).Monitor.Mode           = Mode;
0270 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(3,1);
0271 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0272 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0273 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0274 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0275 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/totalProgression'</span>);
0276 
0277 <span class="comment">%% cycleramp For V-corrector magnets</span>
0278 ifam = <span class="string">'CycleCV'</span>;
0279 
0280 AO.(ifam).FamilyName             = ifam;
0281 AO.(ifam).MemberOf               = {<span class="string">'CycleCOR'</span>; <span class="string">'CycleCV'</span>; <span class="string">'Cyclage'</span>};
0282 AO.(ifam).Mode                   = Mode;
0283 AO.(ifam).GroupId                = tango_group_create(<span class="string">'COR'</span>); 
0284 AO.(ifam).DeviceName             = {<span class="string">'LT1/AE/cycleCV.1'</span>; <span class="string">'LT1/AE/cycleCV.2'</span>; <span class="string">'LT1/AE/cycleCV.3'</span>};
0285 AO.(ifam).DeviceList             = [1 1; 1 2; 1 3];
0286 AO.(ifam).ElementList            = [1 2 3]';
0287 <span class="comment">%add devices to group</span>
0288 tango_group_add(AO.(ifam).GroupId, AO.(ifam).DeviceName');
0289 AO.(ifam).Inom = [1 2 3];
0290 AO.(ifam).Imax = 10*ones(1,3);
0291 AO.(ifam).Status = ones(3,1);
0292 AO.(ifam).Monitor.Mode           = Mode;
0293 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(3,1);
0294 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0295 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0296 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0297 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0298 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/totalProgression'</span>);
0299 
0300 <span class="comment">%% cycleramp For quadrupoles magnets</span>
0301 ifam = <span class="string">'CycleQP'</span>;
0302 
0303 AO.(ifam).FamilyName             = ifam;
0304 AO.(ifam).MemberOf               = {<span class="string">'CycleQP'</span>; <span class="string">'Cyclage'</span>};
0305 AO.(ifam).Mode                   = Mode;
0306 AO.(ifam).GroupId                = tango_group_create(<span class="string">'Quadrupole'</span>); 
0307 AO.(ifam).DeviceList             = [1 1; 1 2; 1 3; 1 4; 1 5; 1 6; 1 7];
0308 AO.(ifam).ElementList            = (1:7)';
0309 AO.(ifam).DeviceName             = {<span class="string">'LT1/AE/cycleQ.1'</span>;<span class="string">'LT1/AE/cycleQ.2'</span>; <span class="keyword">...</span>
0310                                     <span class="string">'LT1/AE/cycleQ.3'</span>;<span class="string">'LT1/AE/cycleQ.4'</span>; <span class="keyword">...</span>
0311                                     <span class="string">'LT1/AE/cycleQ.5'</span>;<span class="string">'LT1/AE/cycleQ.6'</span>; <span class="keyword">...</span>
0312                                     <span class="string">'LT1/AE/cycleQ.7'</span>};
0313 <span class="comment">%add devices to group</span>
0314 tango_group_add(AO.(ifam).GroupId, AO.(ifam).DeviceName');
0315 <span class="comment">%AO.(ifam).Imax = 8*ones(1,7);</span>
0316 <span class="comment">% modification mars 2006</span>
0317 AO.(ifam).Imax = [8  -8  -8  8  8  -8  8 ];
0318 AO.(ifam).Status = ones(7,1);
0319 AO.(ifam).Monitor.Mode           = Mode;
0320 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(7,1);
0321 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0322 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0323 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0324 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0325 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/totalProgression'</span>);
0326 
0327 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0328 <span class="comment">%%% Diagnostics</span>
0329 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0330 
0331 <span class="comment">%% Charge Monitor - Moniteur de charge</span>
0332 ifam = <span class="string">'MC'</span>;
0333 
0334 AO.(ifam).FamilyName             = <span class="string">'MC'</span>;
0335 AO.(ifam).MemberOf               = {<span class="string">'Diag'</span>; <span class="string">'MC'</span>; <span class="string">'Archivable'</span>};
0336 AO.(ifam).Mode                   = Mode;
0337 AO.(ifam).DeviceName             = {<span class="string">'LT1/DG/MC'</span>; <span class="string">'LT1/DG/MC'</span>};
0338 AO.(ifam).CommonNames            = [<span class="string">'mc1'</span>;<span class="string">'mc2'</span>;];
0339 AO.(ifam).DeviceList(:,:)        = [1 1; 1 2];
0340 AO.(ifam).ElementList            = [1 2]';
0341 AO.(ifam).Status                 = [1 1]';
0342 AO.(ifam).Monitor.TangoNames     = [strcat(AO.(ifam).DeviceName(1,:), <span class="string">'/qIct1'</span>); <span class="keyword">...</span>
0343                                     strcat(AO.(ifam).DeviceName(2,:), <span class="string">'/qIct2'</span>)];
0344 AO.(ifam).Monitor.Mode           = Mode;
0345 AO.(ifam).Monitor.Handles(:,1)   = [NaN; NaN]';
0346 AO.(ifam).Monitor.DataType       = <span class="string">'Vector'</span>;
0347 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0348 AO.(ifam).Monitor.HWUnits        = <span class="string">'nC'</span>;
0349 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'nC'</span>;
0350 AO.(ifam).Monitor.HW2PhysicsParams = 1.0;
0351 AO.(ifam).Monitor.Physics2HWParams = 1.0;
0352 
0353 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0354 <span class="comment">%% Vacuum system</span>
0355 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0356 
0357 <span class="comment">%% IonPump</span>
0358 ifam = <span class="string">'PI'</span>;
0359 AO.(ifam).FamilyName           = <span class="string">'PI'</span>;
0360 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'IonPump'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0361 AO.(ifam).Monitor.Mode         = Mode;
0362 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0363 
0364 <span class="keyword">for</span> ik = 1:9    
0365     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT1/VI/PI55.'</span> num2str(ik)];
0366     AO.(ifam).CommonNames{ik} = [<span class="string">'PI'</span> num2str(ik)];
0367     AO.(ifam).DeviceList(ik,:) = [1 ik];
0368     <span class="keyword">if</span> (ik == 8)
0369         AO.(ifam).DeviceName{ik} = [<span class="string">'LT1/VI/PI150.'</span> num2str(ik)];
0370     <span class="keyword">end</span>
0371 <span class="keyword">end</span>
0372 nb = size(AO.(ifam).DeviceList,1);
0373 AO.(ifam).Status                   = ones(nb,1);
0374 AO.(ifam).DeviceName               = AO.(ifam).DeviceName';
0375 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0376 AO.(ifam).ElementList              = (1:nb)';
0377 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0378 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0379 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0380 AO.(ifam).Monitor.Physics2HWParams = 1;
0381 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0382 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0383 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0384 
0385 <span class="comment">%% PenningGauge</span>
0386 ifam = <span class="string">'JPEN'</span>;
0387 AO.(ifam).FamilyName           = <span class="string">'JPEN'</span>;
0388 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'PenningGauge'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0389 AO.(ifam).Monitor.Mode         = Mode;
0390 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0391 
0392 <span class="keyword">for</span> ik = 1:2    
0393     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT1/VI/JPEN.'</span> num2str(ik)];
0394     AO.(ifam).CommonNames{ik} = [<span class="string">'JPEN'</span> num2str(ik)];
0395     AO.(ifam).DeviceList(ik,:) = [1 ik];
0396 <span class="keyword">end</span>
0397 
0398 nb = size(AO.(ifam).DeviceList,1);
0399 AO.(ifam).Status                   = ones(nb,1);
0400 AO.(ifam).DeviceName               = AO.(ifam).DeviceName';
0401 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0402 AO.(ifam).ElementList              = (1:nb)';
0403 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0404 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0405 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0406 AO.(ifam).Monitor.Physics2HWParams = 1;
0407 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0408 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0409 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0410 
0411 <span class="comment">%% PenningGauge</span>
0412 ifam = <span class="string">'JPIR'</span>;
0413 AO.(ifam).FamilyName           = <span class="string">'JPIR'</span>;
0414 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'PiraniGauge'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0415 AO.(ifam).Monitor.Mode         = Mode;
0416 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0417 
0418 <span class="keyword">for</span> ik = 1:2    
0419     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT1/VI/JPIR.'</span> num2str(ik)];
0420     AO.(ifam).CommonNames{ik} = [<span class="string">'JPIR'</span> num2str(ik)];
0421     AO.(ifam).DeviceList(ik,:) = [1 ik];
0422 <span class="keyword">end</span>
0423 
0424 nb = size(AO.(ifam).DeviceList,1);
0425 AO.(ifam).Status                   = ones(nb,1);
0426 AO.(ifam).DeviceName               = AO.(ifam).DeviceName';
0427 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0428 AO.(ifam).ElementList              = (1:nb)';
0429 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0430 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0431 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0432 AO.(ifam).Monitor.Physics2HWParams = 1;
0433 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0434 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0435 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0436 
0437 <span class="comment">%% Synchronisation</span>
0438 <span class="comment">% ifam = 'SYNC'</span>
0439 <span class="comment">% AO.(ifam).FamilyName           = 'SYNC';</span>
0440 <span class="comment">% AO.(ifam).MemberOf             = {'Timing'};</span>
0441 <span class="comment">% AO.(ifam).Monitor.Mode         = Mode;</span>
0442 <span class="comment">% AO.(ifam).Monitor.DataType     = 'Scalar';</span>
0443 <span class="comment">%</span>
0444 <span class="comment">% AO.(ifam).DeviceName{ik}  = ['LT1/VI/JPIR.' num2str(ik)];</span>
0445 <span class="comment">%</span>
0446 <span class="comment">% AO.(ifam).Monitor.HWUnits      = 's';</span>
0447 
0448 setao(AO);
0449 
0450 <span class="comment">% The operational mode sets the path, filenames, and other important params</span>
0451 <span class="comment">% Run setoperationalmode after most of the AO is built so that the Units and Mode fields</span>
0452 <span class="comment">% can be set in setoperationalmode</span>
0453 
0454 <a href="setoperationalmode.html" class="code" title="function setoperationalmode(ModeNumber)">setoperationalmode</a>(OperationalMode);
0455 
0456 <span class="comment">%======================================================================</span>
0457 <span class="comment">%======================================================================</span>
0458 <span class="comment">%% Append Accelerator Toolbox information</span>
0459 <span class="comment">%======================================================================</span>
0460 <span class="comment">%======================================================================</span>
0461 disp(<span class="string">'** Initializing Accelerator Toolbox information'</span>);
0462 
0463 AO = getao;
0464 
0465 ATindx = atindex(THERING);  <span class="comment">%structure with fields containing indices</span>
0466 
0467 s = findspos(THERING,1:length(THERING)+1)';
0468 
0469 <span class="comment">%% HORIZONTAL CORRECTORS</span>
0470 ifam = <span class="string">'CH'</span>;
0471 AO.(ifam).AT.ATType  = ifam;
0472 AO.(ifam).AT.ATIndex = ATindx.(ifam)(:);
0473 AO.(ifam).AT.ATIndex = AO.(ifam).AT.ATIndex(AO.(ifam).ElementList);   <span class="comment">%not all correctors used</span>
0474 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0475 
0476 <span class="comment">%% VERTICAL CORRECTORS</span>
0477 ifam = <span class="string">'CV'</span>;
0478 AO.(ifam).AT.ATType  = ifam;
0479 AO.(ifam).AT.ATIndex = ATindx.(ifam)(:);
0480 AO.(ifam).AT.ATIndex = AO.(ifam).AT.ATIndex(AO.(ifam).ElementList);   <span class="comment">%not all correctors used</span>
0481 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex); 
0482 
0483 <span class="comment">%% BENDING magnets</span>
0484 ifam = <span class="string">'BEND'</span>;
0485 AO.(ifam).AT.ATType  = ifam;
0486 AO.(ifam).AT.ATIndex = ATindx.(ifam)(:);
0487 AO.(ifam).Position   = reshape(s(AO.(ifam).AT.ATIndex),1,2);
0488 
0489 <span class="comment">%% QUADRUPOLES</span>
0490 ifam = <span class="string">'QP'</span>;
0491 AO.(ifam).AT.ATType  = <span class="string">'QUAD'</span>;
0492 AO.(ifam).AT.ATIndex = eval([<span class="string">'ATindx.'</span> ifam <span class="string">'(:)'</span>]);
0493 AO.(ifam).AT.ATIndex = reshape(AO.(ifam).AT.ATIndex,2,7)';
0494 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0495 
0496 <span class="comment">% Save AO</span>
0497 setao(AO);
0498 
0499 <span class="keyword">if</span> iscontrolroom
0500     switch2online;
0501 <span class="keyword">else</span>
0502     switch2sim;
0503 <span class="keyword">end</span>
0504</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>