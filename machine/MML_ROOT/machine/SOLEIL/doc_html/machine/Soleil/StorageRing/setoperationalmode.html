<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setoperationalmode</title>
  <meta name="keywords" content="setoperationalmode">
  <meta name="description" content="SETOPERATIONALMODE - Switches between the various operational modes">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="index.html">StorageRing</a> &gt; setoperationalmode.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/StorageRing&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>setoperationalmode
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>SETOPERATIONALMODE - Switches between the various operational modes</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function setoperationalmode(ModeNumber) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">SETOPERATIONALMODE - Switches between the various operational modes
  setoperationalmode(ModeNumber)

  INPUTS
  1. ModeNumber = 1. 2.7391 GeV, lattice 18.2 10.3
                  2. 2.7391 GeV, Chasmann-Green

                100. Laurent's Mode

  See also <a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>, <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>, <a href="soleilinit.html" class="code" title="function soleilinit(OperationalMode)">soleilinit</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>	UPDATEATINDEX - Updates the AT indices in the MiddleLayer with the present AT lattice (THERING)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="soleilinit.html" class="code" title="function soleilinit(OperationalMode)">soleilinit</a>	SOLEILINIT - Initializes params for SOLEIL control in MATLAB</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function BuildOffsetAndGoldenOrbits</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function setoperationalmode(ModeNumber)</a>
0002 <span class="comment">%SETOPERATIONALMODE - Switches between the various operational modes</span>
0003 <span class="comment">%  setoperationalmode(ModeNumber)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  INPUTS</span>
0006 <span class="comment">%  1. ModeNumber = 1. 2.7391 GeV, lattice 18.2 10.3</span>
0007 <span class="comment">%                  2. 2.7391 GeV, Chasmann-Green</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%                100. Laurent's Mode</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%  See also aoinit, updateatindex, soleilinit</span>
0012 
0013 <span class="comment">%</span>
0014 <span class="comment">% Written by Laurent S. Nadolski</span>
0015 
0016 <span class="keyword">global</span> THERING
0017 
0018 <span class="comment">% Check if the AO exists</span>
0019 checkforao;
0020 
0021 
0022 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0023 <span class="comment">% Accelerator Dependent Modes %</span>
0024 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0025 <span class="keyword">if</span> nargin &lt; 1
0026     ModeNumber = [];
0027 <span class="keyword">end</span>
0028 <span class="keyword">if</span> isempty(ModeNumber)
0029     ModeCell = {<span class="string">'2.7391 GeV, 18.2 10.3'</span>, <span class="string">'2.7391 GeV, Chasmann-Green'</span>, <span class="keyword">...</span>
0030         <span class="string">'Laurent''s Mode'</span>};
0031     [ModeNumber, OKFlag] = listdlg(<span class="string">'Name'</span>,<span class="string">'SOLEIL'</span>,<span class="string">'PromptString'</span>,<span class="string">'Select the Operational Mode:'</span>, <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>, <span class="string">'ListString'</span>, ModeCell, <span class="string">'ListSize'</span>, [450 200]);
0032     <span class="keyword">if</span> OKFlag ~= 1
0033         fprintf(<span class="string">'   Operational mode not changed\n'</span>);
0034         <span class="keyword">return</span>
0035     <span class="keyword">elseif</span> ModeNumber == 3
0036         ModeNumber = 100;  <span class="comment">% Laurent</span>
0037     <span class="keyword">end</span>
0038 <span class="keyword">end</span>
0039 
0040 
0041 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0042 <span class="comment">% Accelerator Data Structure %</span>
0043 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0044 AD = getad;
0045 AD.Machine = <span class="string">'SOLEIL'</span>;            <span class="comment">% Will already be defined if setpathmml was used</span>
0046 AD.MachineType = <span class="string">'StorageRing'</span>;   <span class="comment">% Will already be defined if setpathmml was used</span>
0047 AD.SubMachine  = <span class="string">'StorageRing'</span>;   <span class="comment">% Will already be defined if setpathmml was used</span>
0048 AD.OperationalMode = <span class="string">''</span>;          <span class="comment">% Gets filled in later</span>
0049 AD.HarmonicNumber = 416;
0050 
0051 <span class="comment">% Defaults RF for dispersion and chromaticity measurements (must be in Hardware units)</span>
0052 AD.DeltaRFDisp = 100e-6;
0053 AD.DeltaRFChro = [-100 -50 0 50 150] * 1e-6;
0054 
0055 <span class="comment">% Tune processor delay: delay required to wait</span>
0056 <span class="comment">% to have a fresh tune measurement after changing</span>
0057 <span class="comment">% a variable like the RF frequency.  Setpv will wait</span>
0058 <span class="comment">% 2.2 * TuneDelay to be guaranteed a fresh data point.</span>
0059 AD.BPMDelay  = 0.25; <span class="comment">% use [N, BPMDelay]=getbpmsaverages (AD.BPMDelay will disappear)</span>
0060 AD.TuneDelay = 0.1;
0061 
0062 <span class="comment">% The offset and golden orbits are stored at the end of this file</span>
0063 <span class="comment">% TODO</span>
0064 <span class="comment">%BuildOffsetAndGoldenOrbits;  % Local function</span>
0065 
0066 
0067 <span class="comment">% SP-AM Error level</span>
0068 <span class="comment">% AD.ErrorWarningLevel = 0 -&gt; SP-AM errors are Matlab errors {Default}</span>
0069 <span class="comment">%                       -1 -&gt; SP-AM errors are Matlab warnings</span>
0070 <span class="comment">%                       -2 -&gt; SP-AM errors prompt a dialog box</span>
0071 <span class="comment">%                       -3 -&gt; SP-AM errors are ignored (ErrorFlag=-1 is returned)</span>
0072 AD.ErrorWarningLevel = 0;
0073 
0074 <span class="comment">%%%%%%%%%%%%%%%%%%%%%</span>
0075 <span class="comment">% Operational Modes %</span>
0076 <span class="comment">%%%%%%%%%%%%%%%%%%%%%</span>
0077 
0078 <span class="comment">% Mode setup variables (mostly path and file names)</span>
0079 <span class="comment">% AD.OperationalMode - String used in titles</span>
0080 <span class="comment">% ModeName - String used for mode directory name off DataRoot/MachineName</span>
0081 <span class="comment">% OpsFileExtension - string add to default file names</span>
0082 
0083 <span class="keyword">if</span> ModeNumber == 1
0084     <span class="comment">% User mode - High Tune, Top Off injection</span>
0085     AD.OperationalMode = <span class="string">'2.7391 GeV, 18.2 10.3'</span>;
0086     AD.Energy = 2.7391; <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0087     ModeName = <span class="string">'solamor2'</span>;
0088     OpsFileExtension = <span class="string">'_solamor2'</span>;
0089 
0090     <span class="comment">% AT lattice</span>
0091     AD.ATModel = <span class="string">'solamor2linb'</span>;
0092     eval(AD.ATModel);  <span class="comment">%run model for compilersolamor2linb;</span>
0093 
0094     <span class="comment">% Golden TUNE is with the TUNE family</span>
0095     <span class="comment">% 18.20 / 10.30</span>
0096     AO = getao;
0097     AO.TUNE.Monitor.Golden = [
0098         0.20
0099         0.30
0100         NaN];
0101     setao(AO);
0102 
0103     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0104     AD.Chromaticity.Golden = [2; 2]; 
0105 
0106     switch2hw;
0107 
0108 <span class="keyword">elseif</span> ModeNumber == 2
0109     <span class="comment">% User mode - High Tune, Top Off injection</span>
0110     AD.OperationalMode = <span class="string">'2.7391 GeV, 18.2 10.3'</span>;
0111     AD.Energy = 2.7391;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0112     ModeName = <span class="string">'chasmann_green'</span>;
0113     OpsFileExtension = <span class="string">'_chasmann_green'</span>;
0114 
0115     <span class="comment">% AT lattice</span>
0116     AD.ATModel = <span class="string">'chasman_green'</span>;
0117     eval(AD.ATModel);  <span class="comment">%run model for compilersolamor2linb;</span>
0118 
0119     <span class="comment">% Golden TUNE is with the TUNE family</span>
0120     <span class="comment">% 18.20 / 10.30</span>
0121     AO = getao;
0122     AO.TUNE.Monitor.Golden = [
0123         0.20
0124         0.30
0125         NaN];
0126     setao(AO);
0127 
0128     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0129     AD.Chromaticity.Golden = [2; 2]; 
0130 
0131     switch2hw;
0132 
0133 <span class="keyword">elseif</span> ModeNumber == 100
0134     <span class="comment">% User mode - High Tune, Top Off injection</span>
0135     AD.OperationalMode = <span class="string">'2.7391 GeV, 18.2 10.3'</span>;
0136     AD.Energy = 2.7391;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0137     ModeName = <span class="string">'chasmann_green'</span>;
0138     OpsFileExtension = <span class="string">'_chasmann_green'</span>;
0139 
0140     <span class="comment">% AT lattice</span>
0141     AD.ATModel = <span class="string">'chasman_green'</span>;
0142     chasman_green;
0143 
0144     <span class="comment">% Golden TUNE is with the TUNE family</span>
0145     <span class="comment">% 18.20 / 10.30</span>
0146     AO = getao;
0147     AO.TUNE.Monitor.Golden = [
0148         0.20
0149         0.30
0150         NaN];
0151     setao(AO);
0152 
0153     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0154     AD.Chromaticity.Golden = [2; 2]; 
0155 
0156     switch2hw;
0157 
0158 <span class="keyword">else</span>
0159     error(<span class="string">'Operational mode unknown'</span>);
0160 <span class="keyword">end</span>
0161 
0162 
0163 
0164 <span class="comment">% Set the AD directory path</span>
0165 setad(AD);
0166 MMLROOT = setmmldirectories(AD.Machine, AD.SubMachine, ModeName, OpsFileExtension);
0167 AD = getad;
0168 
0169 <span class="comment">% SOLEIL specific path changes</span>
0170 
0171  <span class="comment">% Top Level Directories</span>
0172 
0173 AD.Directory.DataRoot       = fullfile(MMLROOT, <span class="string">'measdata'</span>, <span class="string">'Ringdata'</span>, filesep);
0174 AD.Directory.OpsData        = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'StorageRingOpsData'</span>, filesep);
0175 AD.Directory.Lattice        = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'StorageRing'</span>, <span class="string">'Lattices'</span>, filesep);
0176 AD.Directory.Orbit          = fullfile(MMLROOT, <span class="string">'applications'</span>, <span class="string">'orbit'</span>, filesep);
0177 
0178 <span class="comment">% Data Archive Directories</span>
0179 AD.Directory.BPMData        = fullfile(AD.Directory.DataRoot, <span class="string">'BPM'</span>, filesep);
0180 AD.Directory.TuneData       = fullfile(AD.Directory.DataRoot, <span class="string">'Tune'</span>, filesep);
0181 AD.Directory.ChroData       = fullfile(AD.Directory.DataRoot, <span class="string">'Chromaticity'</span>, filesep);
0182 AD.Directory.DispData       = fullfile(AD.Directory.DataRoot, <span class="string">'Dispersion'</span>, filesep);
0183 AD.Directory.ConfigData     = fullfile(AD.Directory.DataRoot, <span class="string">'MachineConfig'</span>, filesep);
0184 AD.Directory.BumpData       = fullfile(AD.Directory.DataRoot, <span class="string">'Bumps'</span>, filesep);
0185 AD.Directory.Archiving      = fullfile(AD.Directory.DataRoot, <span class="string">'ArchivingData'</span>, filesep);
0186 AD.Directory.QUAD           = fullfile(AD.Directory.DataRoot, <span class="string">'QUAD'</span>, filesep);
0187 AD.Directory.BBA            = fullfile(AD.Directory.DataRoot, <span class="string">'BBA'</span>, filesep);
0188 AD.Directory.PINHOLE        = fullfile(AD.Directory.DataRoot, <span class="string">'PINHOLE'</span>, filesep);
0189 
0190 <span class="comment">% Insertion Devices</span>
0191 AD.Directory.HU80_TEMPO     = fullfile(getenv(<span class="string">'HOME'</span>), <span class="string">'GrpGMI'</span>, <span class="string">'HU80_TEMPO'</span>, filesep);
0192 AD.Directory.HU80_PLEIADES  = fullfile(getenv(<span class="string">'HOME'</span>), <span class="string">'GrpGMI'</span>, <span class="string">'HU80_PLEIADES'</span>, filesep);
0193 AD.Directory.HU80_CASSIOPEE = fullfile(getenv(<span class="string">'HOME'</span>), <span class="string">'GrpGMI'</span>, <span class="string">'HU80_CASSIOPEE'</span>, filesep);
0194 AD.Directory.U20_PROXIMA1   = fullfile(getenv(<span class="string">'HOME'</span>), <span class="string">'GrpGMI'</span>, <span class="string">'U20_PROXIMA1'</span>, filesep);
0195 AD.Directory.U20_SWING      = fullfile(getenv(<span class="string">'HOME'</span>), <span class="string">'GrpGMI'</span>, <span class="string">'U20_SWING'</span>, filesep);
0196 AD.Directory.U20_CRISTAL    = fullfile(getenv(<span class="string">'HOME'</span>), <span class="string">'GrpGMI'</span>, <span class="string">'U20_CRISTAL'</span>, filesep);
0197 AD.Directory.HU640_DESIRS   = fullfile(getenv(<span class="string">'HOME'</span>), <span class="string">'GrpGMI'</span>, <span class="string">'HU640_DESIRS'</span>, filesep);
0198 
0199 <span class="comment">% AD.Directory.InterlockData  = fullfile(AD.Directory.DataRoot, 'Interlock/'];</span>
0200 
0201 <span class="comment">%Response Matrix Directories</span>
0202 AD.Directory.BPMResponse    = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'BPM'</span>, filesep);
0203 AD.Directory.TuneResponse   = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'Tune'</span>, filesep);
0204 AD.Directory.ChroResponse   = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'Chrom'</span>, filesep);
0205 AD.Directory.DispResponse   = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'Disp'</span>, filesep);
0206 AD.Directory.SkewResponse   = fullfile(AD.Directory.DataRoot, <span class="string">'Response'</span>, <span class="string">'Skew'</span>, filesep);
0207 
0208 <span class="comment">% used by energytunette</span>
0209 AD.Directory.BPMTransport   = fullfile(AD.Directory.DataRoot, <span class="string">'Transport'</span>, <span class="string">'BPM'</span>, filesep);
0210 <span class="comment">% used by MAT's Steerette application</span>
0211 AD.Directory.Steerette     = fullfile(AD.Directory.DataRoot, <span class="string">'Transport'</span>, <span class="string">'Steerette'</span>, filesep);
0212 
0213 
0214 <span class="comment">%Default Data File Prefix</span>
0215 AD.Default.BPMArchiveFile      = <span class="string">'BPM'</span>;                <span class="comment">%file in AD.Directory.BPM               orbit data</span>
0216 AD.Default.TuneArchiveFile     = <span class="string">'Tune'</span>;               <span class="comment">%file in AD.Directory.Tune              tune data</span>
0217 AD.Default.ChroArchiveFile     = <span class="string">'Chro'</span>;               <span class="comment">%file in AD.Directory.Chromaticity       chromaticity data</span>
0218 AD.Default.DispArchiveFile     = <span class="string">'Disp'</span>;               <span class="comment">%file in AD.Directory.Dispersion       dispersion data</span>
0219 AD.Default.CNFArchiveFile      = <span class="string">'CNF'</span>;                <span class="comment">%file in AD.Directory.CNF               configuration data</span>
0220 AD.Default.QUADArchiveFile     = <span class="string">'QuadBeta'</span>;           <span class="comment">%file in AD.Directory.QUAD             betafunction for quadrupoles</span>
0221 AD.Default.PINHOLEArchiveFile  = <span class="string">'Pinhole'</span>;            <span class="comment">%file in AD.Directory.PINHOLE             pinhole data</span>
0222 AD.Default.SkewArchiveFile     = <span class="string">'SkewQuad'</span>;           <span class="comment">%file in AD.Directory.SkewQuad             SkewQuad data</span>
0223 AD.Default.BBAArchiveFile      = <span class="string">'BBA_DKmode'</span>;         <span class="comment">%file in AD.Directory.BBA             BBA DK mode data</span>
0224 
0225 <span class="comment">%Default Response Matrix File Prefix</span>
0226 AD.Default.BPMRespFile      = <span class="string">'BPMRespMat'</span>;         <span class="comment">%file in AD.Directory.BPMResponse       BPM response matrices</span>
0227 AD.Default.TuneRespFile     = <span class="string">'TuneRespMat'</span>;        <span class="comment">%file in AD.Directory.TuneResponse      tune response matrices</span>
0228 AD.Default.ChroRespFile     = <span class="string">'ChroRespMat'</span>;        <span class="comment">%file in AD.Directory.ChroResponse      chromaticity response matrices</span>
0229 AD.Default.DispRespFile     = <span class="string">'DispRespMat'</span>;        <span class="comment">%file in AD.Directory.DispResponse      dispersion response matrices</span>
0230 AD.Default.SkewRespFile     = <span class="string">'SkewRespMat'</span>;        <span class="comment">%file in AD.Directory.SkewResponse      skew quadrupole response matrices</span>
0231 
0232 <span class="comment">%Operational Files</span>
0233 AD.OpsData.LatticeFile       = <span class="string">'GoldenLattice'</span>;     <span class="comment">%Golden Lattice File (setup for users)</span>
0234 AD.OpsData.PhysDataFile      = <span class="string">'GoldenPhysData'</span>;
0235 AD.OpsData.BPMGoldenFile     = <span class="string">'GoldenBPMOrbit'</span>;
0236 AD.OpsData.BPMOffsetFile     = <span class="string">'OffsetBPMOrbit'</span>;
0237 AD.OpsData.BPMSigmaFile      = <span class="string">'BPMSigma'</span>;
0238 AD.OpsData.TuneFile          = <span class="string">'GoldenTune'</span>;
0239 AD.OpsData.ChroFile          = <span class="string">'GoldenChro'</span>;
0240 AD.OpsData.DispFile          = <span class="string">'GoldenDisp'</span>;
0241 
0242 <span class="comment">%Operational Response Files</span>
0243 AD.OpsData.BPMRespFile       = <span class="string">'GoldenBPMResp'</span>;     
0244 AD.OpsData.TuneRespFile      = <span class="string">'GoldenTuneResp'</span>;    
0245 AD.OpsData.ChroRespFile      = <span class="string">'GoldenChroResp'</span>; 
0246 AD.OpsData.DispRespFile      = <span class="string">'GoldenDispResp'</span>;
0247 AD.OpsData.SkewRespFile      = <span class="string">'GoldenSkewResp'</span>;
0248 AD.OpsData.RespFiles         = {AD.OpsData.BPMRespFile,  <span class="keyword">...</span>
0249                                 AD.OpsData.TuneRespFile, <span class="keyword">...</span>
0250                                 AD.OpsData.ChroRespFile, <span class="keyword">...</span>
0251                                 AD.OpsData.DispRespFile};
0252 
0253 <span class="comment">%Orbit Control and Feedback Files</span>
0254 AD.Restore.GlobalFeedback   = <span class="string">'Restore.m'</span>;
0255 <span class="comment">%AD.Restore.BeamlineFeedback = 'Restore.m';</span>
0256 
0257 
0258 <span class="comment">%Orbit Control and Feedback Files</span>
0259 AD.Restore.GlobalFeedback   = <span class="string">'Restore.m'</span>;
0260 
0261 <span class="comment">% Circumference</span>
0262 AD.Circumference = findspos(THERING,length(THERING)+1);
0263 setad(AD);
0264 
0265 <span class="comment">% Updates the AT indices in the MiddleLayer with the present AT lattice</span>
0266 <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>;
0267 
0268 <span class="comment">% Set the model energy</span>
0269 setenergymodel(AD.Energy);
0270 
0271 <span class="comment">% Cavity and radiation</span>
0272 <span class="comment">% setcavity off;</span>
0273 <span class="comment">% setradiation off;</span>
0274 <span class="comment">% fprintf('   Radiation and cavities are off.  Use setradiation / setcavity to modify. \n');</span>
0275 
0276 <span class="comment">% Momentum compaction factor</span>
0277 MCF = getmcf(<span class="string">'Model'</span>);
0278 <span class="keyword">if</span> isnan(MCF)
0279     AD.MCF = 4.498325442923014e-04;  
0280     fprintf(<span class="string">'   Model alpha calculation failed, middlelayer alpha set to  %f\n'</span>, AD.MCF);
0281 <span class="keyword">else</span>
0282     AD.MCF = MCF;
0283     fprintf(<span class="string">'   Middlelayer alpha set to %f (AT model).\n'</span>, AD.MCF);
0284 <span class="keyword">end</span>
0285 setad(AD);
0286 
0287 
0288 <span class="comment">% Add Gain &amp; Offsets for magnet family</span>
0289 fprintf(<span class="string">'   Setting magnet monitor gains based on the production lattice.\n'</span>);
0290 <span class="comment">%setgainsandoffsets;</span>
0291 
0292 
0293 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%</span>
0294 <span class="comment">% Final mode changes %</span>
0295 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%</span>
0296 <span class="keyword">if</span> any(ModeNumber == [1 2 3])
0297     <span class="comment">% User mode - 2.75 GeV, Nominal lattice</span>
0298 
0299     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0300     <span class="comment">% Add LOCO Parameters to AO and AT-Model %</span>
0301     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0302     <span class="comment">%     'Nominal'    - Sets nominal gains (1) / rolls (0) to the model.</span>
0303     <span class="comment">%     'SetGains'   - Set gains/coupling from a LOCO file.</span>
0304     <span class="comment">%     'SetModel'   - Set the model from a LOCO file.  But it only changes</span>
0305     <span class="comment">%                    the part of the model that does not get corrected</span>
0306     <span class="comment">%                    in 'Symmetrize' (also does a SetGains).</span>
0307     <span class="comment">%     'LOCO2Model' - Set the model from a LOCO file (also does a SetGains).</span>
0308     <span class="comment">%                    This sets all lattice machines fit in the LOCO run to the model.</span>
0309     <span class="comment">%</span>
0310     <span class="comment">% Basically, use 'SetGains' or 'SetModel' if the LOCO run was applied to the accelerator</span>
0311     <span class="comment">%            use 'LOCO2Model' if the LOCO run was made after the final setup</span>
0312 
0313     <span class="comment">% Store the LOCO file in the opsdata directory</span>
0314     <span class="comment">%AD.OpsData.LOCOFile = [getfamilydata('Directory','OpsData'),'LOCO_72SkewQuads_122BPMs'];</span>
0315     
0316     <span class="comment">%AD.OpsData.LOCOFile = [getfamilydata('Directory','OpsData'),'LOCO_AllQuads_1Bend_72SkewQuads'];</span>
0317     <span class="comment">%setad(AD);</span>
0318 
0319     <span class="comment">% MCF depends on optics !!!</span>
0320     
0321     <span class="comment">%try</span>
0322     <span class="comment">%    setlocodata('LOCO2Model', AD.OpsData.LOCOFile);</span>
0323     <span class="comment">%catch</span>
0324     <span class="comment">%    fprintf('\n%s\n\n', lasterr);</span>
0325     <span class="comment">%    fprintf('   WARNING: there was a problem calibrating the model based on LOCO file %s.\n', AD.OpsData.LOCOFile);</span>
0326     <span class="comment">%end</span>
0327 
0328 <span class="keyword">else</span>
0329     <span class="comment">%setlocodata('Nominal');</span>
0330 <span class="keyword">end</span>
0331 
0332 fprintf(<span class="string">'   lattice files have changed or if the AT lattice has changed.\n'</span>);
0333 fprintf(<span class="string">'   Middlelayer setup for operational mode: %s\n'</span>, AD.OperationalMode);
0334 
0335 setad(orderfields(AD));
0336 
0337 <a name="_sub1" href="#_subfunctions" class="code">function BuildOffsetAndGoldenOrbits</a>
0338 
0339 <span class="comment">%  2005-07-27 Changed the [5 11] &amp; [5 12] offset and golden orbits to values during a user run. (GJP)</span>
0340 <span class="comment">%             The offsets were zero and the golden values were:</span>
0341 <span class="comment">%             5  11   -2.371746    0.318056</span>
0342 <span class="comment">%             5  12   -1.915190    0.482681</span>
0343 <span class="comment">%</span>
0344 <span class="comment">%             The golden orbit agreement with the old middle layer is not as good as</span>
0345 <span class="comment">%             it needs to be.  For instance, [6 1] horizontal is .67 new and 1.016 old.</span>
0346 <span class="comment">%</span>
0347 <span class="comment">%  2006-01-06 New offsets measured.  The large difference in location 4 and 7 is due to new buttons.</span>
0348 <span class="comment">%</span>
0349 
0350 <span class="comment">% Note: you can view this by &gt;&gt; help setoperationalmode&gt;BuildOffsetAndGoldenOrbits</span>
0351 
0352 <span class="comment">%      DeviceList        Xnew      Ynew      Xold      Yold     Xdiff     Ydiff</span>
0353 Offset = [
0354     1.0000    2.0000   -0.3029    0.9601   -0.3332    0.9621    0.0303   -0.0020
0355     1.0000    3.0000   -0.0804   -0.1250   -0.0213   -0.1887   -0.0591    0.0637
0356     1.0000    4.0000    0.6410   -0.2695    0.6410   -0.7228         0    0.4533
0357     1.0000    5.0000   -0.3117    1.2317   -0.3117    1.2317         0         0
0358     1.0000    6.0000    0.2868    0.1347    0.2868    0.1347         0         0
0359     1.0000    7.0000    0.1294   -0.3856    0.1294    0.2557         0   -0.6413
0360     1.0000    8.0000   -0.2606   -0.3423   -0.2235   -0.1922   -0.0371   -0.1501
0361     1.0000    9.0000   -0.0144    0.3451   -0.0639    0.3583    0.0495   -0.0132
0362     1.0000   10.0000    1.4372   -0.1518    1.4372   -0.1518         0         0
0363     2.0000    1.0000    0.3365    0.0489    0.3365    0.0489         0         0
0364     2.0000    2.0000    0.3349   -0.4719    0.3029   -0.4988    0.0320    0.0269
0365     2.0000    3.0000    0.3260    0.2452    0.2920    0.1946    0.0340    0.0506
0366     2.0000    4.0000    0.3743   -0.1043    0.3743    0.5221         0   -0.6264
0367     2.0000    5.0000   -0.0128   -0.0542   -0.0128   -0.0542         0         0
0368     2.0000    6.0000    1.0025   -1.0075    1.0025   -1.0075         0         0
0369     2.0000    7.0000   -0.0173   -0.2703   -0.0173    0.5229         0   -0.7932
0370     2.0000    8.0000    0.1902   -0.2211    0.2433   -0.1423   -0.0531   -0.0788
0371     2.0000    9.0000   -0.2460    0.3486   -0.1620    0.2160   -0.0840    0.1326
0372     3.0000    2.0000   -0.3086    0.0952   -0.2826    0.1080   -0.0260   -0.0128
0373     3.0000    3.0000    0.3677    0.3745    0.3313    0.3497    0.0364    0.0248
0374     3.0000    4.0000   -0.3568   -0.8973   -0.3568    0.2155         0   -1.1128
0375     3.0000    5.0000   -0.0402    0.0603   -0.0402    0.0603         0         0
0376     3.0000    6.0000    0.2722    0.0824    0.2722    0.0824         0         0
0377     3.0000    7.0000    0.3131   -0.3190    0.3131    0.7647         0   -1.0837
0378     3.0000    8.0000   -0.1004    0.5151    0.0275    0.5267   -0.1279   -0.0116
0379     3.0000    9.0000    0.4228    0.1727    0.4782    0.0919   -0.0554    0.0808
0380     3.0000   10.0000    0.7001    0.2774    0.7001    0.2774         0         0
0381     3.0000   11.0000   -0.5243   -0.4578   -0.5243   -0.4578         0         0
0382     3.0000   12.0000   -0.1391    0.0454   -0.1391    0.0454         0         0
0383     4.0000    1.0000    0.9000    0.8040    0.9000    0.8040         0         0
0384     4.0000    2.0000   -0.2389    0.9517   -0.2736    1.0024    0.0347   -0.0507
0385     4.0000    3.0000    0.5399   -0.3708    0.5481   -0.3316   -0.0082   -0.0392
0386     4.0000    4.0000   -0.6150    0.4217   -0.6150    0.2945         0    0.1272
0387     4.0000    5.0000    0.1066   -0.1455   -0.1270    0.1668    0.2336   -0.3123
0388     4.0000    6.0000    1.0549    0.5268    0.8027    0.7899    0.2522   -0.2631
0389     4.0000    7.0000   -0.5092   -0.2730   -0.5092    0.1823         0   -0.4553
0390     4.0000    8.0000   -0.6119    0.6313   -0.4890    0.5291   -0.1229    0.1022
0391     4.0000    9.0000   -0.5624   -0.3060   -0.4998   -0.3415   -0.0626    0.0355
0392     4.0000   10.0000   -0.4352    1.3991   -0.4352    1.3991         0         0
0393     5.0000    1.0000    0.6527    0.2707    0.6527    0.2707         0         0
0394     5.0000    2.0000    0.0368    0.6351   -0.0318    0.6071    0.0686    0.0280
0395     5.0000    3.0000    0.2613    0.5279    0.1690    0.4812    0.0923    0.0467
0396     5.0000    4.0000   -0.2422    0.1545   -0.2422    0.6403         0   -0.4858
0397     5.0000    5.0000   -0.3649    0.5744   -0.3649    0.5744         0         0
0398     5.0000    6.0000   -0.3961    0.5409   -0.3961    0.5409         0         0
0399     5.0000    7.0000    0.1861   -0.6341    0.1861    0.4875         0   -1.1216
0400     5.0000    8.0000   -0.4308    0.6563   -0.4611    0.5928    0.0303    0.0635
0401     5.0000    9.0000    0.2031    0.9099    0.4392    0.7018   -0.2361    0.2081
0402     5.0000   10.0000    0.4052    0.9371    0.4052    0.9371         0         0
0403     5.0000   11.0000    0.2860    0.4667    0.2860    0.4667         0         0
0404     5.0000   12.0000    0.7625    0.4750    0.7625    0.4750         0         0
0405     6.0000    1.0000   -0.1765    0.4277   -0.1765    0.4277         0         0
0406     6.0000    2.0000   -0.5470    0.1162   -0.4925    0.1608   -0.0545   -0.0446
0407     6.0000    3.0000    0.5579   -0.0764    0.4926   -0.0228    0.0653   -0.0536
0408     6.0000    4.0000    0.1200    0.1259    0.1200    0.9682         0   -0.8423
0409     6.0000    5.0000    0.0815   -0.2318    0.0815   -0.2318         0         0
0410     6.0000    6.0000   -0.5071    0.4360   -0.5071    0.4360         0         0
0411     6.0000    7.0000   -0.0400   -0.3844   -0.0400    0.5079         0   -0.8923
0412     6.0000    8.0000    0.0326    0.8366    0.0851    0.7527   -0.0525    0.0839
0413     6.0000    9.0000   -0.3196    0.7598   -0.2962    0.7587   -0.0234    0.0011
0414     6.0000   10.0000    0.4473   -0.1545    0.4473   -0.1545         0         0
0415     7.0000    1.0000    0.6227    0.3264    0.6227    0.3264         0         0
0416     7.0000    2.0000   -0.1306    0.5463   -0.1513    0.6347    0.0207   -0.0884
0417     7.0000    3.0000    0.4098    0.6411    0.2288    0.5024    0.1810    0.1387
0418     7.0000    4.0000   -0.2808    0.0358   -0.2808    0.5664         0   -0.5306
0419     7.0000    5.0000    0.2972    0.3924    0.2972    0.3924         0         0
0420     7.0000    6.0000   -0.1378    0.6702   -0.1378    0.6702         0         0
0421     7.0000    7.0000    0.0613    0.5088    0.0613    0.8434         0   -0.3346
0422     7.0000    8.0000    0.0291    0.6676   -0.0196    0.6397    0.0487    0.0279
0423     7.0000    9.0000   -1.3782   -0.6406    0.1663    0.8314   -1.5445   -1.4720
0424     7.0000   10.0000    0.4593    0.2569    0.4593    0.2569         0         0
0425     8.0000    1.0000    0.2270    0.4960    0.2270    0.4960         0         0
0426     8.0000    2.0000   -0.1231    0.0635   -0.1059    0.0297   -0.0172    0.0338
0427     8.0000    3.0000    0.2116    1.3395    0.1908    1.0542    0.0208    0.2853
0428     8.0000    4.0000    0.0812   -0.5635    0.0812    0.6840         0   -1.2475
0429     8.0000    5.0000   -0.1798    0.4131   -0.0830    0.6125   -0.0968   -0.1994
0430     8.0000    6.0000   -0.1083    0.3420   -0.2474    0.8791    0.1391   -0.5371
0431     8.0000    7.0000    0.3828    0.0519    0.3828    1.7969         0   -1.7450
0432     8.0000    8.0000   -0.0812    1.6180   -0.0460    1.7202   -0.0352   -0.1022
0433     8.0000    9.0000   -1.6868   -0.3611   -1.5201   -0.3296   -0.1667   -0.0315
0434     8.0000   10.0000    0.5377   -0.0202    0.5377   -0.0202         0         0
0435     9.0000    1.0000    0.1161   -0.0240    0.1161   -0.0240         0         0
0436     9.0000    2.0000    1.7898    1.3374    0.4622    0.0734    1.3276    1.2640
0437     9.0000    3.0000    0.4083    0.5453    0.3516    0.4305    0.0567    0.1148
0438     9.0000    4.0000    0.1929   -0.3953    0.1929   -0.0981         0   -0.2972
0439     9.0000    5.0000   -0.3339    0.0797   -0.3339    0.0797         0         0
0440     9.0000    6.0000    0.1332   -0.0086    0.1332   -0.0086         0         0
0441     9.0000    7.0000    0.3534    0.5847    0.3534   -0.0021         0    0.5868
0442     9.0000    8.0000    1.0863    0.2838    1.0286    0.2349    0.0577    0.0489
0443     9.0000    9.0000    0.9717    0.2159    0.8841    0.3314    0.0876   -0.1155
0444     9.0000   10.0000    0.3272   -0.0581    0.3272   -0.0581         0         0
0445    10.0000    1.0000    0.4990    0.4044    0.4990    0.4044         0         0
0446    10.0000    2.0000    0.3332   -1.2594    0.3588   -1.2207   -0.0256   -0.0387
0447    10.0000    3.0000   -0.0812    0.2540    0.0714    0.1528   -0.1526    0.1012
0448    10.0000    4.0000   -0.2064    0.1349   -0.2064    0.9781         0   -0.8432
0449    10.0000    5.0000   -0.5240    0.7222   -0.5240    0.7222         0         0
0450    10.0000    6.0000    0.4499    0.7862    0.4499    0.7862         0         0
0451    10.0000    7.0000    0.3624   -0.2649    0.3624    0.5027         0   -0.7676
0452    10.0000    8.0000    0.7216    0.4301    0.7240    0.5122   -0.0024   -0.0821
0453    10.0000    9.0000    0.8702    0.4267    0.7826    0.4394    0.0876   -0.0127
0454    10.0000   10.0000    0.4979   -0.1694    0.4979   -0.1694         0         0
0455    10.0000   11.0000    0.6556   -0.4005    0.6556   -0.4005         0         0
0456    10.0000   12.0000    0.7335   -0.2444    0.7335   -0.2444         0         0
0457    11.0000    1.0000    0.6382   -0.2382    0.6382   -0.2382         0         0
0458    11.0000    2.0000    0.8438   -0.1025    0.8078   -0.1432    0.0360    0.0407
0459    11.0000    3.0000    0.1660    0.7432    0.2741    0.7241   -0.1081    0.0191
0460    11.0000    4.0000   -0.2598   -0.6969   -0.2598    0.3842         0   -1.0811
0461    11.0000    5.0000    0.0997    0.5364    0.0997    0.5364         0         0
0462    11.0000    6.0000    0.7115    0.5330    0.7115    0.5330         0         0
0463    11.0000    7.0000    0.5070   -0.2151    0.5070    0.5740         0   -0.7891
0464    11.0000    8.0000   -0.1281   -0.0106   -0.0038   -0.0113   -0.1243    0.0007
0465    11.0000    9.0000    0.0638   -0.5505   -0.0390   -0.5956    0.1028    0.0451
0466    11.0000   10.0000    0.7015   -0.2305    0.7015   -0.2305         0         0
0467    12.0000    1.0000   -0.2370   -0.4183   -0.2370   -0.4183         0         0
0468    12.0000    2.0000    0.1376   -1.0998    0.3036   -1.1286   -0.1660    0.0288
0469    12.0000    3.0000    0.1754    0.0098    0.3032   -0.0342   -0.1278    0.0440
0470    12.0000    4.0000   -0.0736   -1.7539   -0.0736   -0.7078         0   -1.0461
0471    12.0000    5.0000   -0.6584   -0.5037   -0.6623   -0.1190    0.0039   -0.3847
0472    12.0000    6.0000    0.4741    0.0259    0.2439    0.4729    0.2302   -0.4470
0473    12.0000    7.0000   -0.0655   -0.1893   -0.0655   -0.0279         0   -0.1614
0474    12.0000    8.0000    0.0293   -0.1884   -0.0317   -0.1047    0.0610   -0.0837
0475    12.0000    9.0000    0.2470   -0.2015    0.2964   -0.0672   -0.0494   -0.1343
0476    ];
0477 
0478 
0479 Golden = [
0480   1   2   -0.000000   -0.000000
0481   1   3   -0.000000   -0.000000
0482   1   4    0.000000    0.000000
0483   1   5   -0.000000   -0.000000
0484   1   6   -0.000000    0.000000
0485   1   7    0.000000   -0.000000
0486   2   1    0.000000    0.000000
0487   2   2    0.000000    0.000000
0488   2   3   -0.000000   -0.000000
0489   2   4    0.000000   -0.000000
0490   2   5   -0.000000    0.000000
0491   2   6    0.000000   -0.000000
0492   2   7    0.000000   -0.000000
0493   2   8    0.000000   -0.000000
0494   3   1    0.000000    0.000000
0495   3   2   -0.000000   -0.000000
0496   3   3    0.000000    0.000000
0497   3   4   -0.000000   -0.000000
0498   3   5    0.000000   -0.000000
0499   3   6    0.000000    0.000000
0500   3   7    0.000000   -0.000000
0501   3   8    0.000000    0.000000
0502   4   1    0.000000   -0.000000
0503   4   2    0.000000   -0.000000
0504   4   3   -0.000000   -0.000000
0505   4   4    0.000000    0.000000
0506   4   5    0.000000    0.000000
0507   4   6   -0.000000    0.000000
0508   4   7   -0.000000   -0.000000
0509   5   1   -0.000000    0.000000
0510   5   2   -0.000000    0.000000
0511   5   3    0.000000    0.000000
0512   5   4    0.000000   -0.000000
0513   5   5   -0.000000   -0.000000
0514   5   6    0.000000    0.000000
0515   5   7   -0.000000   -0.000000
0516   6   1   -0.000000    0.000000
0517   6   2    0.000000   -0.000000
0518   6   3    0.000000   -0.000000
0519   6   4   -0.000000    0.000000
0520   6   5    0.000000    0.000000
0521   6   6   -0.000000   -0.000000
0522   6   7   -0.000000    0.000000
0523   6   8    0.000000    0.000000
0524   7   1   -0.000000   -0.000000
0525   7   2   -0.000000   -0.000000
0526   7   3   -0.000000    0.000000
0527   7   4    0.000000   -0.000000
0528   7   5   -0.000000   -0.000000
0529   7   6    0.000000   -0.000000
0530   7   7    0.000000    0.000000
0531   7   8    0.000000    0.000000
0532   8   1   -0.000000   -0.000000
0533   8   2   -0.000000    0.000000
0534   8   3    0.000000   -0.000000
0535   8   4    0.000000   -0.000000
0536   8   5    0.000000   -0.000000
0537   8   6    0.000000   -0.000000
0538   8   7   -0.000000   -0.000000
0539   9   1   -0.000000   -0.000000
0540   9   2   -0.000000   -0.000000
0541   9   3    0.000000    0.000000
0542   9   4   -0.000000    0.000000
0543   9   5    0.000000   -0.000000
0544   9   6    0.000000    0.000000
0545   9   7   -0.000000    0.000000
0546  10   1    0.000000   -0.000000
0547  10   2    0.000000   -0.000000
0548  10   3   -0.000000    0.000000
0549  10   4   -0.000000    0.000000
0550  10   5   -0.000000    0.000000
0551  10   6   -0.000000   -0.000000
0552  10   7    0.000000   -0.000000
0553  10   8    0.000000    0.000000
0554  11   1    0.000000   -0.000000
0555  11   2    0.000000   -0.000000
0556  11   3    0.000000    0.000000
0557  11   4   -0.000000    0.000000
0558  11   5   -0.000000   -0.000000
0559  11   6    0.000000   -0.000000
0560  11   7   -0.000000   -0.000000
0561  11   8    0.000000   -0.000000
0562  12   1   -0.000000    0.000000
0563  12   2   -0.000000    0.000000
0564  12   3    0.000000    0.000000
0565  12   4    0.000000   -0.000000
0566  12   5   -0.000000    0.000000
0567  12   6    0.000000   -0.000000
0568  12   7    0.000000    0.000000
0569  13   1   -0.000000   -0.000000
0570  13   2    0.000000   -0.000000
0571  13   3   -0.000000    0.000000
0572  13   4    0.000000    0.000000
0573  13   5   -0.000000   -0.000000
0574  13   6    0.000000   -0.000000
0575  13   7    0.000000    0.000000
0576  14   1   -0.000000    0.000000
0577  14   2    0.000000   -0.000000
0578  14   3   -0.000000   -0.000000
0579  14   4    0.000000    0.000000
0580  14   5   -0.000000    0.000000
0581  14   6   -0.000000    0.000000
0582  14   7   -0.000000   -0.000000
0583  14   8    0.000000    0.000000
0584  15   1   -0.000000    0.000000
0585  15   2    0.000000    0.000000
0586  15   3   -0.000000   -0.000000
0587  15   4   -0.000000    0.000000
0588  15   5   -0.000000   -0.000000
0589  15   6    0.000000   -0.000000
0590  15   7    0.000000    0.000000
0591  15   8   -0.000000   -0.000000
0592  16   1   -0.000000   -0.000000
0593  16   2    0.000000    0.000000
0594  16   3   -0.000000   -0.000000
0595  16   4    0.000000    0.000000
0596  16   5   -0.000000   -0.000000
0597  16   6   -0.000000    0.000000
0598  16   7    0.000000   -0.000000
0599   1   1   -0.000000    0.000000
0600 ];
0601 
0602 <span class="comment">% Save the data</span>
0603 AO = getao;
0604 
0605 <span class="comment">% Offset orbits</span>
0606 [i, iNotFound, iFoundList] = findrowindex(Offset(:,1:2), AO.BPMx.DeviceList);
0607 <span class="keyword">if</span> ~isempty(iNotFound)
0608     fprintf(<span class="string">'\n   Warning:  BPMx offsets are specified that are not in the family (setoperationalmode)\n'</span>);
0609 <span class="keyword">end</span>
0610 <span class="keyword">if</span> size(AO.BPMx.DeviceList,1) ~= length(i)
0611     fprintf(<span class="string">'\n   Warning:  Not all the offsets in the BPMx family are being specified (setoperationalmode)\n'</span>);
0612 <span class="keyword">end</span>
0613 AO.BPMx.Offset    = zeros(size(AO.BPMx.DeviceList,1),1);
0614 AO.BPMx.Offset(i) = Offset(iFoundList,3);
0615 
0616 [i, iNotFound, iFoundList] = findrowindex(Offset(:,1:2), AO.BPMz.DeviceList);
0617 <span class="keyword">if</span> ~isempty(iNotFound)
0618     fprintf(<span class="string">'\n   Warning:  BPMz offsets are specified that are not in the family (setoperationalmode)\n'</span>);
0619 <span class="keyword">end</span>
0620 <span class="keyword">if</span> size(AO.BPMz.DeviceList,1) ~= length(i)
0621     fprintf(<span class="string">'\n   Warning:  Not all the offsets in the BPMz family are being specified (setoperationalmode)\n'</span>);
0622 <span class="keyword">end</span>
0623 AO.BPMz.Offset = zeros(size(AO.BPMz.DeviceList,1),1);
0624 AO.BPMz.Offset(i) = Offset(iFoundList,4);
0625 
0626 
0627 <span class="comment">% Golden orbits</span>
0628 [i, iNotFound, iFoundList] = findrowindex(Golden(:,1:2), AO.BPMx.DeviceList);
0629 <span class="keyword">if</span> ~isempty(iNotFound)
0630     fprintf(<span class="string">'\n   Warning:  BPMx golden values are specified that are not in the family (setoperationalmode)\n'</span>);
0631 <span class="keyword">end</span>
0632 <span class="keyword">if</span> size(AO.BPMx.DeviceList,1) ~= length(i)
0633     fprintf(<span class="string">'\n   Warning:  Not all the golden orbits in the BPMx family are being specified (setoperationalmode)\n'</span>);
0634 <span class="keyword">end</span>
0635 AO.BPMx.Golden = zeros(size(AO.BPMx.DeviceList,1),1);
0636 AO.BPMx.Golden(i) = Golden(iFoundList,3);
0637 
0638 [i, iNotFound, iFoundList] = findrowindex(Golden(:,1:2), AO.BPMz.DeviceList);
0639 <span class="keyword">if</span> ~isempty(iNotFound)
0640     fprintf(<span class="string">'\n   Warning:  BPMz golden values are specified that are not in the family (setoperationalmode)\n'</span>);
0641 <span class="keyword">end</span>
0642 <span class="keyword">if</span> size(AO.BPMz.DeviceList,1) ~= length(i)
0643     fprintf(<span class="string">'\n   Warning:  Not all the golden orbits in the BPMz family are being specified (setoperationalmode)\n'</span>);
0644 <span class="keyword">end</span>
0645 AO.BPMz.Golden = zeros(size(AO.BPMz.DeviceList,1),1);
0646 AO.BPMz.Golden(i) = Golden(iFoundList,4);
0647 
0648 setao(AO);</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>