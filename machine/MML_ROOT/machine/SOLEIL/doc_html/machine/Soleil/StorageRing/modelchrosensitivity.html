<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of modelchrosensitivity</title>
  <meta name="keywords" content="modelchrosensitivity">
  <meta name="description" content="modelchrosensitivity - Computes sextupole change for a given dxi">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="index.html">StorageRing</a> &gt; modelchrosensitivity.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/StorageRing&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>modelchrosensitivity
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>modelchrosensitivity - Computes sextupole change for a given dxi</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [DSx DSz DchroVal] = modelchrosensitivity(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">modelchrosensitivity - Computes sextupole change for a given dxi

  INPUTS 
  1. dxix - horizontal tune change
  2. dxiz - vertical tune change

  OUTPUTS
  1. DSx - sextupole change to get dxix
  2. DSz - sextupole change to get dxiz

  See Also <a href="modeltunesensitivity.html" class="code" title="function [DKx DKz DtuneVal]=modeltunesensitivity(varargin)">modeltunesensitivity</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [DSx DSz DchroVal] = modelchrosensitivity(varargin)</a>
0002 <span class="comment">%modelchrosensitivity - Computes sextupole change for a given dxi</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  INPUTS</span>
0005 <span class="comment">%  1. dxix - horizontal tune change</span>
0006 <span class="comment">%  2. dxiz - vertical tune change</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%  OUTPUTS</span>
0009 <span class="comment">%  1. DSx - sextupole change to get dxix</span>
0010 <span class="comment">%  2. DSz - sextupole change to get dxiz</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%  See Also modeltunesensitivity</span>
0013 
0014 <span class="comment">% TODO see modeltunesensitivity</span>
0015 
0016 <span class="comment">%</span>
0017 <span class="comment">%  Written by Laurent S. Nadolski</span>
0018 
0019 NumericFlag = 1;
0020 Unit = <span class="string">'Hardware'</span>;
0021 Mode = <span class="string">'Model'</span>;
0022 DebugFlag = 0;
0023 
0024 timeout = 1; <span class="comment">% second</span>
0025 
0026 DSx= NaN; DSz=NaN;
0027 
0028 <span class="comment">% Switchyard factory</span>
0029 <span class="keyword">for</span> i = length(varargin):-1:1
0030     <span class="keyword">if</span> strcmpi(varargin{i},<span class="string">'Model'</span>)
0031         Mode = <span class="string">'Model'</span>;
0032         varargin(i) = [];
0033     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Online'</span>)
0034         Mode = <span class="string">'Online'</span>;
0035         varargin(i) = [];
0036     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Simulator'</span>)
0037         Mode = <span class="string">'Simulator'</span>;
0038         varargin(i) = [];
0039     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Physics'</span>)
0040         Unit = <span class="string">'Physics'</span>;
0041         varargin(i) = [];
0042     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Hardware'</span>)
0043         Unit = <span class="string">'Hardware'</span>;
0044         varargin(i) = [];
0045     <span class="keyword">end</span>
0046 <span class="keyword">end</span>
0047 
0048 
0049 <span class="keyword">if</span> isempty(varargin)
0050     dxix = 1e-1;
0051     dxiz = 1e-1;
0052 <span class="keyword">elseif</span> nvargin == 1
0053     dxix = varargin{1};
0054     dxiz = dxix;
0055 <span class="keyword">end</span>
0056 
0057 <span class="keyword">global</span> GLOBVAL;
0058 
0059 fprintf(<span class="string">'   ******** Summary for ''%s'' ********\n'</span>, GLOBVAL.LatticeFile);
0060 
0061 <span class="comment">%fprintf('Sextupole change for dxix of %f and dxiz = %f \n',dxix,dxiz);</span>
0062 
0063 <span class="comment">% get all sextupoles</span>
0064 a = findmemberof(<span class="string">'SEXT'</span>);
0065 FamNb= length(a);
0066 
0067 <span class="keyword">if</span> ~NumericFlag
0068     <span class="keyword">for</span> k = 1:FamNb,
0069 
0070         Family = a{k};
0071 
0072         [bx bz] = modeltwiss(<span class="string">'beta'</span>,Family);
0073         [etax etaz] = modeldisp(Family);
0074 
0075         L = getleff(Family);
0076         NQ = length(getspos(Family));
0077 
0078         DSx(k) =  2*pi*dxix/bx(1)/etax(1)/NQ/L(1);
0079         DSz(k) = -2*pi*dxiz/bz(1)/etax(1)/NQ/L(1);
0080 
0081         fprintf(<span class="string">'%s : DSxL = %1.2e DSzL = %1.2e betax = %2.2f m betaz = %2.2f m etax = %2.2f m NQ = %2.0f  L= %1.2e m \n'</span>, <span class="keyword">...</span>
0082             Family, DSx(k)*L(1), DSz(k)*L(1), bx(1), bz(1), etax(1), NQ, L(1));
0083     <span class="keyword">end</span>
0084 <span class="keyword">else</span>
0085     DchroVal  = zeros(2,FamNb)*NaN;
0086 
0087     <span class="comment">% Quadrupole variation in Ampere</span>
0088     StepValue = [20 40 10 10 50 50 50 25 5 10]; <span class="comment">% A</span>
0089 
0090 
0091     <span class="keyword">for</span> k = 1:FamNb,
0092 
0093         Family = a{k};
0094 
0095         <span class="keyword">if</span> DebugFlag 
0096             fprintf(<span class="string">'%s changed by %f\n'</span>, Family,  0.5*StepValue(k));
0097         <span class="keyword">end</span>
0098         stepsp(Family, 0.5*StepValue(k), Mode, Unit); <span class="comment">% plus delta</span>
0099         <span class="keyword">if</span> strcmp(Mode, <span class="string">'Model'</span>)
0100             ChroValplus = modelchro;
0101         <span class="keyword">else</span>
0102             pause(timeout);
0103             ChroValplus = measchro(Mode, <span class="string">'NoDisplay'</span>);
0104         <span class="keyword">end</span>
0105         <span class="keyword">if</span> DebugFlag 
0106             fprintf(<span class="string">'Xix = %f Xiz = %f \n'</span>, ChroValplus);
0107         <span class="keyword">end</span>        
0108 
0109         <span class="keyword">if</span> DebugFlag 
0110             fprintf(<span class="string">'%s changed by %f\n'</span>, Family, -0.5*StepValue(k));
0111         <span class="keyword">end</span>
0112         stepsp(Family, -StepValue(k), Mode, Unit); <span class="comment">% minus delta</span>
0113         <span class="keyword">if</span> strcmp(Mode, <span class="string">'Model'</span>)
0114             ChroValminus = modelchro;
0115         <span class="keyword">else</span>
0116             pause(timeout);
0117             ChroValminus = measchro(Mode, <span class="string">'NoDisplay'</span>);
0118         <span class="keyword">end</span>
0119 
0120         <span class="keyword">if</span> DebugFlag
0121             fprintf(<span class="string">'Xix = %f Xiz = %f \n'</span>, ChroValminus);
0122         <span class="keyword">end</span>
0123 
0124         stepsp(Family, 0.5*StepValue(k), Mode, Unit); <span class="comment">% come back to nominal value</span>
0125 
0126         DchroVal(:,k) = (ChroValplus - ChroValminus) / StepValue(k);
0127 
0128     <span class="keyword">end</span>
0129 <span class="keyword">end</span>
0130 
0131 <span class="keyword">for</span> k = 1:FamNb,
0132     fprintf(<span class="string">'%3s (%3.1f A): Dxix = % 1.2e Dxiz = % 1.2e\n'</span>, <span class="keyword">...</span>
0133         a{k}, StepValue(k), DchroVal(1,k)*StepValue(k), DchroVal(2,k)*StepValue(k));
0134 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 23-Jul-2010 00:42:07 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>