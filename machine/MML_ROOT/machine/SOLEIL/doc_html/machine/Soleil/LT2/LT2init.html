<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of LT2init</title>
  <meta name="keywords" content="LT2init">
  <meta name="description" content="LT2INIT - Contructs an accelerator Object describing LT2">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="index.html">LT2</a> &gt; LT2init.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/LT2&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>LT2init
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>LT2INIT - Contructs an accelerator Object describing LT2</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function LT2init(OperationalMode) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> LT2INIT - Contructs an accelerator Object describing LT2

 Written by Laurent S. Nadolski, Synchrotron SOLEIL

==========================
 Accelerator Family Fields
==========================
 FamilyName            CH, CV, QP, Bend
 CommonNames           Shortcut name for each element
 DeviceList            [Sector, Number]
 ElementList           number in list
 Position              m, magnet center

 MONITOR FIELD
 Mode                  online/manual/special/simulator
 TangoNames            Tango device name for monitor
 Units                 Physics or HW
 HW2PhysicsFcn         function handle used to convert from hardware to physics units ==&gt; inline will not compile, see below
 HW2PhysicsParams      parameters used for conversion function
 Physics2HWFcn         function handle used to convert from physics to hardware units
 Physics2HWParams      parameters used for conversion function
 HWUnits               units for Hardware 'ampere';
 PhysicsUnits          units for physics 'Rad';
 Handles               monitor handle

 SETPOINT FIELDS
 Mode                  online/manual/special/simulator
 TangoNames            PV for monitor
 Units                 hardware or physics
 HW2PhysicsFcn         function handle used to convert from hardware to physics units
 HW2PhysicsParams      parameters used for conversion function
 Physics2HWFcn         function handle used to convert from physics to hardware units
 Physics2HWParams      parameters used for conversion function
 HWUnits               units for Hardware 'ampere';
 PhysicsUnits          units for physics 'Rad';
 Range                 minsetpoint, maxsetpoint;
 Tolerance             setpoint-monitor
 Handles               setpoint handle

=============================================
 Accelerator Toolbox Simulation Fields
=============================================
 ATType                Quad, Sext, etc
 ATIndex               index in THERING
 ATParameterGroup      parameter group

============
 Family List
============
    CH
    CV
    BEND
    QP
    Machine Parameters

  See Also <a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>, <a href="setoperationalmode.html" class="code" title="function setoperationalmode(ModeNumber)">setoperationalmode</a>, <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>, setpathsoleil</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="setoperationalmode.html" class="code" title="function setoperationalmode(ModeNumber)">setoperationalmode</a>	SETOPERATIONALMODE - Switches between the various operational modes</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="LT2setup.html" class="code" title="function LT2setup">LT2setup</a>	LT2SETUP - GUI for doing LT2 setup</li><li><a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>	AOINIT - Initialization function for the Matlab Middle Layer (MML)</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function LT2init(OperationalMode)</a>
0002 <span class="comment">% LT2INIT - Contructs an accelerator Object describing LT2</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Written by Laurent S. Nadolski, Synchrotron SOLEIL</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%==========================</span>
0007 <span class="comment">% Accelerator Family Fields</span>
0008 <span class="comment">%==========================</span>
0009 <span class="comment">% FamilyName            CH, CV, QP, Bend</span>
0010 <span class="comment">% CommonNames           Shortcut name for each element</span>
0011 <span class="comment">% DeviceList            [Sector, Number]</span>
0012 <span class="comment">% ElementList           number in list</span>
0013 <span class="comment">% Position              m, magnet center</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% MONITOR FIELD</span>
0016 <span class="comment">% Mode                  online/manual/special/simulator</span>
0017 <span class="comment">% TangoNames            Tango device name for monitor</span>
0018 <span class="comment">% Units                 Physics or HW</span>
0019 <span class="comment">% HW2PhysicsFcn         function handle used to convert from hardware to physics units ==&gt; inline will not compile, see below</span>
0020 <span class="comment">% HW2PhysicsParams      parameters used for conversion function</span>
0021 <span class="comment">% Physics2HWFcn         function handle used to convert from physics to hardware units</span>
0022 <span class="comment">% Physics2HWParams      parameters used for conversion function</span>
0023 <span class="comment">% HWUnits               units for Hardware 'ampere';</span>
0024 <span class="comment">% PhysicsUnits          units for physics 'Rad';</span>
0025 <span class="comment">% Handles               monitor handle</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% SETPOINT FIELDS</span>
0028 <span class="comment">% Mode                  online/manual/special/simulator</span>
0029 <span class="comment">% TangoNames            PV for monitor</span>
0030 <span class="comment">% Units                 hardware or physics</span>
0031 <span class="comment">% HW2PhysicsFcn         function handle used to convert from hardware to physics units</span>
0032 <span class="comment">% HW2PhysicsParams      parameters used for conversion function</span>
0033 <span class="comment">% Physics2HWFcn         function handle used to convert from physics to hardware units</span>
0034 <span class="comment">% Physics2HWParams      parameters used for conversion function</span>
0035 <span class="comment">% HWUnits               units for Hardware 'ampere';</span>
0036 <span class="comment">% PhysicsUnits          units for physics 'Rad';</span>
0037 <span class="comment">% Range                 minsetpoint, maxsetpoint;</span>
0038 <span class="comment">% Tolerance             setpoint-monitor</span>
0039 <span class="comment">% Handles               setpoint handle</span>
0040 <span class="comment">%</span>
0041 <span class="comment">%=============================================</span>
0042 <span class="comment">% Accelerator Toolbox Simulation Fields</span>
0043 <span class="comment">%=============================================</span>
0044 <span class="comment">% ATType                Quad, Sext, etc</span>
0045 <span class="comment">% ATIndex               index in THERING</span>
0046 <span class="comment">% ATParameterGroup      parameter group</span>
0047 <span class="comment">%</span>
0048 <span class="comment">%============</span>
0049 <span class="comment">% Family List</span>
0050 <span class="comment">%============</span>
0051 <span class="comment">%    CH</span>
0052 <span class="comment">%    CV</span>
0053 <span class="comment">%    BEND</span>
0054 <span class="comment">%    QP</span>
0055 <span class="comment">%    Machine Parameters</span>
0056 <span class="comment">%</span>
0057 <span class="comment">%  See Also aoinit, setoperationalmode, updateatindex, setpathsoleil</span>
0058 
0059 <span class="comment">%==============================</span>
0060 <span class="comment">%load AcceleratorData structure</span>
0061 <span class="comment">%==============================</span>
0062 
0063 <span class="keyword">if</span> nargin &lt; 1
0064     OperationalMode = 1;
0065 <span class="keyword">end</span>
0066 
0067 <span class="keyword">global</span> GLOBVAL THERING
0068 
0069 Mode             = <span class="string">'online'</span>;
0070 setad([]);       <span class="comment">%clear AcceleratorData memory</span>
0071 AD.SubMachine    = <span class="string">'LT2'</span>; <span class="comment">% Machine Name</span>
0072 AD.Energy        = 2.75 ; <span class="comment">% Energy in GeV</span>
0073 
0074 
0075 setad(AD);   <span class="comment">%load AcceleratorData</span>
0076 
0077 <span class="comment">%%%%%%%%%%%%%%%%%%%%</span>
0078 <span class="comment">% ACCELERATOR OBJECT</span>
0079 <span class="comment">%%%%%%%%%%%%%%%%%%%%</span>
0080 
0081 setao([]);   <span class="comment">%clear previous AcceleratorObjects</span>
0082 
0083 
0084 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0085 <span class="comment">%% BPM data</span>
0086 <span class="comment">% status field designates if BPM in use</span>
0087 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0088 ifam = <span class="string">'BPMx'</span>;
0089 AO.(ifam).FamilyName               = ifam;
0090 AO.(ifam).FamilyType               = <span class="string">'BPM'</span>;
0091 AO.(ifam).MemberOf                 = {<span class="string">'BPM'</span>; <span class="string">'HBPM'</span>; <span class="string">'PlotFamily'</span>; <span class="string">'Archivable'</span>};
0092 AO.(ifam).Monitor.Mode             = Mode;
0093 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;
0094 AO.(ifam).Monitor.HWUnits          = <span class="string">'mm'</span>;
0095 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'meter'</span>;
0096 
0097 nb = 3;
0098 AO.(ifam).DeviceList =[1 1; 1 2; 1 3]; 
0099 AO.(ifam).ElementList = (1:nb)';
0100 AO.(ifam).DeviceName(:,:)               = {<span class="string">'LT2/DG/BPM.1'</span>; <span class="string">'LT2/DG/BPM.2'</span>; <span class="string">'LT2/DG/BPM.3'</span>};
0101 AO.(ifam).Monitor.TangoNames(:,:)       = strcat(AO.(ifam).DeviceName, <span class="string">'/XPosSA'</span>);
0102 AO.(ifam).CommonNames(:,:)              = [repmat(<span class="string">'BPMx'</span>,nb,1) num2str((1:nb)',<span class="string">'%03d'</span>)];
0103 
0104 AO.(ifam).Status                        = ones(nb,1);
0105 AO.(ifam).Monitor.HW2PhysicsParams(:,:) = 1e-3*ones(nb,1);
0106 AO.(ifam).Monitor.Physics2HWParams(:,:) = 1e3*ones(nb,1);
0107 
0108 <span class="comment">% 2 lignes ajoutes pour test debug bpm versus le reste du monde</span>
0109 AO.(ifam).Monitor.Handles(:,1)       = NaN*ones(nb,1);
0110 AO.(ifam).Monitor.DataType         = <span class="string">'Scalar'</span>;
0111 
0112 
0113 <span class="comment">% Vertical plane</span>
0114 ifam = <span class="string">'BPMz'</span>; 
0115 AO.(ifam) = AO.BPMx; <span class="comment">% the same as BPMx</span>
0116 <span class="comment">% except those fields</span>
0117 AO.(ifam).MemberOf                 = {<span class="string">'BPM'</span>; <span class="string">'VBPM'</span>; <span class="string">'PlotFamily'</span>; <span class="string">'Archivable'</span>};
0118 AO.(ifam).FamilyName              = ifam;
0119 AO.(ifam).Monitor.TangoNames(:,:)  = strcat(AO.(ifam).DeviceName,<span class="string">'/ZPosSA'</span>);
0120 AO.(ifam).CommonNames(:,:) = [repmat(<span class="string">'BPMz'</span>,nb,1) num2str((1:nb)',<span class="string">'%03d'</span>)];
0121 
0122 <span class="comment">% 2 lignes ajoutes pour test debug bpm versus le reste du monde</span>
0123 AO.(ifam).Monitor.DataType         = <span class="string">'Scalar'</span>;
0124 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0125 
0126 AO.(ifam).Status = AO.(ifam).Status(:);
0127 AO.(ifam).Status = AO.(ifam).Status(:);
0128 
0129 
0130 setao(AO); <span class="comment">% mandatory to avoid empty AO message with magnetcoefficients</span>
0131 
0132 <span class="comment">%% Dipole</span>
0133 ifam = <span class="string">'BEND'</span>;
0134 
0135 AO.(ifam).FamilyName             = <span class="string">'BEND'</span>;
0136 AO.(ifam).MemberOf               = {<span class="string">'MachineConfig'</span>; <span class="string">'Magnet'</span>; <span class="string">'BEND'</span>; <span class="string">'Archivable'</span>};
0137 AO.(ifam).Mode                   = Mode;
0138 AO.(ifam).DeviceName{1}          = <span class="string">'LT2/AE/D.1'</span>;
0139 AO.(ifam).CommonNames{1}         = <span class="string">'DIP'</span>;
0140 AO.(ifam).Monitor.Range(:,:)     = [0 580];
0141 AO.(ifam).DeviceList(1,:)        = [1 1];
0142 AO.(ifam).ElementList            = 1;
0143 AO.(ifam).Status                 = 1;
0144 AO.(ifam).Monitor.TangoNames     = strcat(AO.(ifam).DeviceName, <span class="string">'/currentPM'</span>);
0145 AO.(ifam).Monitor.ModelVal       = 0;
0146 AO.(ifam).Monitor.TangoVal       = 0;
0147 AO.(ifam).Monitor.Mode           = Mode;
0148 AO.(ifam).Monitor.Handles(:,1)   = NaN;
0149 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0150 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0151 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0152 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0153 AO.(ifam).Monitor.HW2PhysicsFcn  = @bend2gev;
0154 AO.(ifam).Monitor.Physics2HWFcn  = @gev2bend;
0155 setao(AO);
0156 
0157 [C Leff Type coefficients] = magnetcoefficients(AO.(ifam).FamilyName );
0158 AO.(ifam).Monitor.HW2PhysicsParams{1}(1,:) = coefficients;
0159 AO.(ifam).Monitor.Physics2HWParams = AO.(ifam).Monitor.HW2PhysicsParams;
0160 
0161 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0162 AO.(ifam).Desired  = AO.(ifam).Monitor;
0163 
0164 <span class="comment">%% Quadrupoles QP</span>
0165 ifam = <span class="string">'QP'</span>;
0166 
0167 AO.(ifam).FamilyName             = ifam;
0168 AO.(ifam).MemberOf               = {<span class="string">'MachineConfig'</span>; <span class="string">'Magnet'</span>; <span class="string">'QUAD'</span>; <span class="string">'Archivable'</span>};
0169 AO.(ifam).Mode                   = Mode;
0170 
0171 <span class="keyword">for</span> ik = 1:7    
0172     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT2/AE/Q.'</span> num2str(ik)];
0173     AO.(ifam).CommonNames{ik} = [ifam num2str(ik)];
0174     AO.(ifam).DeviceList(ik,:) = [1 ik];
0175 <span class="keyword">end</span>
0176 AO.(ifam).DeviceName             = AO.(ifam).DeviceName';
0177 AO.(ifam).CommonNames            = AO.(ifam).CommonNames';
0178 AO.(ifam).Monitor.Range(:,:)     = [0 270;-270 0;-270 0;0 270;0 270;-270 0;0 270]; <span class="comment">%</span>
0179 nb                               = length(AO.(ifam).DeviceName);
0180 AO.(ifam).Monitor.TangoNames     = strcat(AO.(ifam).DeviceName, <span class="string">'/current'</span>);
0181 
0182 AO.(ifam).Status                 = ones(nb,1);
0183 AO.(ifam).Monitor.ModelVal       = zeros(1,nb);
0184 AO.(ifam).Monitor.TangoVal       = AO.(ifam).Monitor.ModelVal;
0185 AO.(ifam).ElementList            = 1:nb;
0186 
0187 AO.(ifam).Monitor.Mode           = Mode;
0188 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(nb,1);
0189 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0190 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0191 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0192 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0193 AO.(ifam).Monitor.HW2PhysicsFcn = @amp2k;
0194 AO.(ifam).Monitor.Physics2HWFcn = @k2amp;
0195 
0196 C = magnetcoefficients(AO.(ifam).FamilyName);
0197 
0198 <span class="keyword">for</span> ii=1:nb,
0199     <span class="keyword">if</span> ii == 2 || ii == 3 || ii == 6
0200         <span class="comment">% Defocusing quads</span>
0201         AO.(ifam).Monitor.HW2PhysicsParams{1}(ii,:)  = C.*[1 -1 1 -1 1 -1 1 -1];
0202         AO.(ifam).Monitor.Physics2HWParams{1}(ii,:)  = C.*[1 -1 1 -1 1 -1 1 -1];
0203     <span class="keyword">else</span>
0204         <span class="comment">% Focusing quad</span>
0205         AO.(ifam).Monitor.HW2PhysicsParams{1}(ii,:)  = C;
0206         AO.(ifam).Monitor.Physics2HWParams{1}(ii,:)  = C;
0207     <span class="keyword">end</span>
0208 <span class="keyword">end</span>
0209 
0210 <span class="comment">%AO.(ifam).Monitor.Range(:,:) = repmat([-5 5],nb,1); % 10 A for 0.8 mrad</span>
0211 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0212 AO.(ifam).Desired = AO.(ifam).Monitor;
0213 AO.(ifam).Setpoint.TangoNames(:,:)  = strcat(AO.(ifam).DeviceName,<span class="string">'/currentPM'</span>);
0214 
0215 
0216 <span class="comment">% %% Quadrupoles QF</span>
0217 <span class="comment">% ifam = 'QF';</span>
0218 <span class="comment">%</span>
0219 <span class="comment">% AO.(ifam).FamilyName             = ifam;</span>
0220 <span class="comment">% AO.(ifam).MemberOf               = {'MachineConfig'; 'Magnet'; 'QP'; 'Archivable'};</span>
0221 <span class="comment">% AO.(ifam).Mode                   = Mode;</span>
0222 <span class="comment">%</span>
0223 <span class="comment">% for ik = 1:7</span>
0224 <span class="comment">%     AO.(ifam).DeviceName{ik}  = ['LT2/AE/Q.' num2str(ik)];</span>
0225 <span class="comment">%     AO.(ifam).CommonNames{ik} = [ifam num2str(ik)];</span>
0226 <span class="comment">%     AO.(ifam).DeviceList(ik,:) = [1 ik];</span>
0227 <span class="comment">% end</span>
0228 <span class="comment">% AO.(ifam).DeviceName             = AO.(ifam).DeviceName';</span>
0229 <span class="comment">% AO.(ifam).CommonNames            = AO.(ifam).CommonNames';</span>
0230 <span class="comment">%</span>
0231 <span class="comment">% nb                               = length(AO.(ifam).DeviceName);</span>
0232 <span class="comment">% AO.(ifam).Monitor.TangoNames     = strcat(AO.(ifam).DeviceName, '/current');</span>
0233 <span class="comment">% AO.(ifam).Status                 = ones(nb,1);</span>
0234 <span class="comment">% AO.(ifam).Monitor.ModelVal       = zeros(1,nb);</span>
0235 <span class="comment">% AO.(ifam).Monitor.TangoVal       = AO.(ifam).Monitor.ModelVal;</span>
0236 <span class="comment">% AO.(ifam).ElementList            = 1:nb;</span>
0237 <span class="comment">%</span>
0238 <span class="comment">% AO.(ifam).Monitor.Mode           = Mode;</span>
0239 <span class="comment">% AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(nb,1);</span>
0240 <span class="comment">% AO.(ifam).Monitor.DataType       = 'Scalar';</span>
0241 <span class="comment">% AO.(ifam).Monitor.Units          = 'Hardware';</span>
0242 <span class="comment">% AO.(ifam).Monitor.HWUnits        = 'ampere';</span>
0243 <span class="comment">% AO.(ifam).Monitor.PhysicsUnits   = 'radian';</span>
0244 <span class="comment">% AO.(ifam).Monitor.HW2PhysicsFcn = @amp2k;</span>
0245 <span class="comment">% AO.(ifam).Monitor.Physics2HWFcn = @k2amp;</span>
0246 <span class="comment">%</span>
0247 <span class="comment">% C = magnetcoefficients(AO.(ifam).FamilyName);</span>
0248 <span class="comment">%</span>
0249 <span class="comment">% for ii=1:nb,</span>
0250 <span class="comment">%     if ii == 2 || ii == 3 || ii == 6</span>
0251 <span class="comment">%         % Defocusing quads</span>
0252 <span class="comment">%         AO.(ifam).Monitor.HW2PhysicsParams{1}(ii,:)  = C.*[1 -1 1 -1 1 -1 1 -1];</span>
0253 <span class="comment">%         AO.(ifam).Monitor.Physics2HWParams{1}(ii,:)  = C.*[1 -1 1 -1 1 -1 1 -1];</span>
0254 <span class="comment">%     else</span>
0255 <span class="comment">%         % Focusing quad</span>
0256 <span class="comment">%         AO.(ifam).Monitor.HW2PhysicsParams{1}(ii,:)  = C;</span>
0257 <span class="comment">%         AO.(ifam).Monitor.Physics2HWParams{1}(ii,:)  = C;</span>
0258 <span class="comment">%     end</span>
0259 <span class="comment">% end</span>
0260 <span class="comment">%</span>
0261 <span class="comment">% %AO.(ifam).Monitor.Range(:,:) = repmat([-5 5],nb,1); % 10 A for 0.8 mrad</span>
0262 <span class="comment">% AO.(ifam).Setpoint = AO.(ifam).Monitor;</span>
0263 <span class="comment">% AO.(ifam).Desired = AO.(ifam).Monitor;</span>
0264 <span class="comment">%</span>
0265 <span class="comment">%</span>
0266 <span class="comment">% %% Quadrupoles QD</span>
0267 <span class="comment">% ifam = 'QD';</span>
0268 <span class="comment">%</span>
0269 <span class="comment">% AO.(ifam).FamilyName             = ifam;</span>
0270 <span class="comment">% AO.(ifam).MemberOf               = {'MachineConfig'; 'Magnet'; 'QP'; 'Archivable'};</span>
0271 <span class="comment">% AO.(ifam).Mode                   = Mode;</span>
0272 <span class="comment">%</span>
0273 <span class="comment">% for ik = 1:7</span>
0274 <span class="comment">%     AO.(ifam).DeviceName{ik}  = ['LT2/AE/Q.' num2str(ik)];</span>
0275 <span class="comment">%     AO.(ifam).CommonNames{ik} = [ifam num2str(ik)];</span>
0276 <span class="comment">%     AO.(ifam).DeviceList(ik,:) = [1 ik];</span>
0277 <span class="comment">% end</span>
0278 <span class="comment">% AO.(ifam).DeviceName             = AO.(ifam).DeviceName';</span>
0279 <span class="comment">% AO.(ifam).CommonNames            = AO.(ifam).CommonNames';</span>
0280 <span class="comment">%</span>
0281 <span class="comment">% nb                               = length(AO.(ifam).DeviceName);</span>
0282 <span class="comment">% AO.(ifam).Monitor.TangoNames     = strcat(AO.(ifam).DeviceName, '/current');</span>
0283 <span class="comment">% AO.(ifam).Status                 = ones(nb,1);</span>
0284 <span class="comment">% AO.(ifam).Monitor.ModelVal       = zeros(1,nb);</span>
0285 <span class="comment">% AO.(ifam).Monitor.TangoVal       = AO.(ifam).Monitor.ModelVal;</span>
0286 <span class="comment">% AO.(ifam).ElementList            = 1:nb;</span>
0287 <span class="comment">%</span>
0288 <span class="comment">% AO.(ifam).Monitor.Mode           = Mode;</span>
0289 <span class="comment">% AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(nb,1);</span>
0290 <span class="comment">% AO.(ifam).Monitor.DataType       = 'Scalar';</span>
0291 <span class="comment">% AO.(ifam).Monitor.Units          = 'Hardware';</span>
0292 <span class="comment">% AO.(ifam).Monitor.HWUnits        = 'ampere';</span>
0293 <span class="comment">% AO.(ifam).Monitor.PhysicsUnits   = 'radian';</span>
0294 <span class="comment">% AO.(ifam).Monitor.HW2PhysicsFcn = @amp2k;</span>
0295 <span class="comment">% AO.(ifam).Monitor.Physics2HWFcn = @k2amp;</span>
0296 <span class="comment">%</span>
0297 <span class="comment">% C = magnetcoefficients(AO.(ifam).FamilyName);</span>
0298 <span class="comment">%</span>
0299 <span class="comment">% for ii=1:nb,</span>
0300 <span class="comment">%     if ii == 2 || ii == 3 || ii == 6</span>
0301 <span class="comment">%         % Defocusing quads</span>
0302 <span class="comment">%         AO.(ifam).Monitor.HW2PhysicsParams{1}(ii,:)  = C.*[1 -1 1 -1 1 -1 1 -1];</span>
0303 <span class="comment">%         AO.(ifam).Monitor.Physics2HWParams{1}(ii,:)  = C.*[1 -1 1 -1 1 -1 1 -1];</span>
0304 <span class="comment">%     else</span>
0305 <span class="comment">%         % Focusing quad</span>
0306 <span class="comment">%         AO.(ifam).Monitor.HW2PhysicsParams{1}(ii,:)  = C;</span>
0307 <span class="comment">%         AO.(ifam).Monitor.Physics2HWParams{1}(ii,:)  = C;</span>
0308 <span class="comment">%     end</span>
0309 <span class="comment">% end</span>
0310 <span class="comment">%</span>
0311 <span class="comment">% %AO.(ifam).Monitor.Range(:,:) = repmat([-5 5],nb,1); % 10 A for 0.8 mrad</span>
0312 <span class="comment">% AO.(ifam).Setpoint = AO.(ifam).Monitor;</span>
0313 <span class="comment">% AO.(ifam).Desired = AO.(ifam).Monitor;</span>
0314 <span class="comment">%</span>
0315 
0316 
0317 <span class="comment">%% Horizontal Correctors</span>
0318 ifam = <span class="string">'CH'</span>;
0319 AO.(ifam).FamilyName           = ifam;
0320 AO.(ifam).MemberOf             = {<span class="string">'MachineConfig'</span>; <span class="string">'Magnet'</span>; <span class="string">'HCM'</span>; <span class="string">'CH'</span>; <span class="string">'Archivable'</span>};
0321 
0322 <span class="keyword">for</span> ik = 1:3    
0323     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT2/AE/CH.'</span> num2str(ik)];
0324     AO.(ifam).CommonNames{ik} = [ifam num2str(ik)];
0325     AO.(ifam).DeviceList(ik,:) = [1 ik];
0326 <span class="keyword">end</span>
0327 AO.(ifam).DeviceName             = AO.(ifam).DeviceName';
0328 AO.(ifam).CommonNames            = AO.(ifam).CommonNames';
0329 
0330 
0331 nb                         = length(AO.(ifam).DeviceName);
0332 AO.(ifam).Monitor.Range(:,:)     = repmat([-10 10],nb,1);
0333 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/current'</span>);
0334 AO.(ifam).Status               = ones(nb,1);
0335 AO.(ifam).Monitor.ModelVal     = zeros(1,nb);
0336 AO.(ifam).Monitor.TangoVal     = AO.(ifam).Monitor.ModelVal;
0337 AO.(ifam).ElementList           = 1:nb;
0338 
0339 AO.(ifam).Monitor.Mode           = Mode;
0340 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(nb,1);
0341 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0342 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0343 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0344 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0345 AO.(ifam).Monitor.HW2PhysicsFcn  = @amp2k;
0346 AO.(ifam).Monitor.Physics2HWFcn  = @k2amp;
0347 [C Leff Type coefficients] = magnetcoefficients(AO.(ifam).FamilyName );
0348 AO.(ifam).Monitor.HW2PhysicsParams{1}(1,:) = coefficients;
0349 AO.(ifam).Monitor.Physics2HWParams = AO.(ifam).Monitor.HW2PhysicsParams;
0350 
0351 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0352 <span class="comment">%AO.(ifam).Monitor.TangoNames     = strcat(AO.(ifam).DeviceName, '/currentPM');</span>
0353 
0354 <span class="comment">%% Vertical Correctors</span>
0355 ifam = <span class="string">'CV'</span>;
0356 
0357 AO.(ifam).FamilyName           = ifam;
0358 AO.(ifam).MemberOf             = {<span class="string">'MachineConfig'</span>; <span class="string">'Magnet'</span>; <span class="string">'VCM'</span>; <span class="string">'CV'</span>; <span class="string">'Archivable'</span>};
0359 AO.(ifam).Mode                 = Mode;
0360 
0361 <span class="keyword">for</span> ik = 1:5,
0362     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT2/AE/CV.'</span> num2str(ik)];
0363     AO.(ifam).CommonNames{ik} = [ifam num2str(ik)];
0364     AO.(ifam).DeviceList(ik,:) = [1 ik];
0365 <span class="keyword">end</span>
0366 AO.(ifam).DeviceName             = AO.(ifam).DeviceName';
0367 AO.(ifam).CommonNames            = AO.(ifam).CommonNames';
0368 
0369 nb                             = length(AO.(ifam).DeviceName);
0370 AO.(ifam).Monitor.Range(:,:)     = repmat([-10 10],nb,1);
0371 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/current'</span>);
0372 AO.(ifam).Status               = ones(nb,1);
0373 AO.(ifam).Monitor.ModelVal     = zeros(1,nb);
0374 AO.(ifam).Monitor.TangoVal     = AO.(ifam).Monitor.ModelVal;
0375 AO.(ifam).ElementList          = 1:nb;
0376 
0377 AO.(ifam).Monitor.Mode           = Mode;
0378 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(nb,1);
0379 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0380 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0381 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0382 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0383 AO.(ifam).Monitor.HW2PhysicsFcn  = @amp2k;
0384 AO.(ifam).Monitor.Physics2HWFcn  = @k2amp;
0385 [C Leff Type coefficients] = magnetcoefficients(AO.(ifam).FamilyName );
0386 AO.(ifam).Monitor.HW2PhysicsParams{1}(1,:) = coefficients;
0387 AO.(ifam).Monitor.Physics2HWParams = AO.(ifam).Monitor.HW2PhysicsParams;
0388 
0389 AO.(ifam).Setpoint = AO.(ifam).Monitor;
0390 <span class="comment">%AO.(ifam).Monitor.TangoNames     = strcat(AO.(ifam).DeviceName, '/currentPM');</span>
0391 setao(AO);
0392 
0393 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0394 <span class="comment">%% CYCLAGE</span>
0395 <span class="comment">%%%%%%%%%%%%%%%%%</span>
0396 
0397 <span class="comment">%% cycleramp For dipole magnet</span>
0398 ifam = <span class="string">'CycleBEND'</span>;
0399 ifamQ = <span class="string">'BEND'</span>;
0400 
0401 AO.(ifam).FamilyName             = <span class="string">'CycleBEND'</span>;
0402 AO.(ifam).MemberOf               = {<span class="string">'CycleBEND'</span>; <span class="string">'Cyclage'</span>};
0403 AO.(ifam).Mode                   = Mode;
0404 dev = getfamilydata(ifamQ,<span class="string">'DeviceName'</span>);
0405 AO.(ifam).DeviceName             = regexprep(dev,<span class="string">'/D'</span>,<span class="string">'/cycleD'</span>);
0406 AO.(ifam).DeviceList             = family2dev(ifamQ);
0407 AO.(ifam).ElementList            = family2elem(ifamQ);
0408 AO.(ifam).GroupId                = tango_group_create(<span class="string">'Dipole'</span>); 
0409 AO.(ifam).DeviceName             = <span class="string">'LT2/AE/cycleD.1'</span>;
0410 <span class="comment">%add devices to group</span>
0411 tango_group_add(AO.(ifam).GroupId, AO.(ifam).DeviceName);
0412 <span class="comment">%AO.(ifam).Inom = 180;</span>
0413 AO.(ifam).Imax = 580;
0414 AO.(ifam).Status = 1;
0415 AO.(ifam).Monitor.Mode           = Mode;
0416 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(7,1);
0417 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0418 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0419 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0420 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0421 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/totalProgression'</span>);
0422 
0423 
0424 
0425 <span class="comment">%% cycleramp For H-corrector magnets</span>
0426 ifam = <span class="string">'CycleCH'</span>;
0427 ifamQ = <span class="string">'CH'</span>;
0428 
0429 AO.(ifam).FamilyName             = ifam;
0430 AO.(ifam).MemberOf               = {<span class="string">'CycleCOR'</span>; <span class="string">'CycleCH'</span>; <span class="string">'Cyclage'</span>};
0431 AO.(ifam).Mode                   = Mode;
0432 dev = getfamilydata(ifamQ,<span class="string">'DeviceName'</span>);
0433 AO.(ifam).DeviceName             = regexprep(dev,<span class="string">'/C'</span>,<span class="string">'/cycleC'</span>);
0434 AO.(ifam).DeviceList             = family2dev(ifamQ);
0435 AO.(ifam).ElementList            = family2elem(ifamQ);
0436 <span class="comment">%add devices to group</span>
0437 AO.(ifam).GroupId                = tango_group_create(<span class="string">'COR'</span>); 
0438 tango_group_add(AO.(ifam).GroupId, AO.(ifam).DeviceName');
0439 AO.(ifam).Inom = [1 2 3];
0440 AO.(ifam).Imax = 10*ones(1,3);
0441 AO.(ifam).Status = ones(3,1);
0442 AO.(ifam).Monitor.Mode           = Mode;
0443 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(3,1);
0444 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0445 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0446 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0447 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0448 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/totalProgression'</span>);
0449 
0450 <span class="comment">%% cycleramp For V-corrector magnets</span>
0451 ifam = <span class="string">'CycleCV'</span>;
0452 ifamQ = <span class="string">'CH'</span>;
0453 
0454 AO.(ifam).FamilyName             = ifam;
0455 AO.(ifam).MemberOf               = {<span class="string">'CycleCOR'</span>; <span class="string">'CycleCV'</span>; <span class="string">'Cyclage'</span>};
0456 AO.(ifam).Mode                   = Mode;
0457 dev = getfamilydata(ifamQ,<span class="string">'DeviceName'</span>);
0458 AO.(ifam).DeviceName             = regexprep(dev,<span class="string">'/C'</span>,<span class="string">'/cycleC'</span>);
0459 AO.(ifam).DeviceList             = family2dev(ifamQ);
0460 AO.(ifam).ElementList            = family2elem(ifamQ);
0461 <span class="comment">%add devices to group</span>
0462 AO.(ifam).GroupId                = tango_group_create(<span class="string">'COR'</span>); 
0463 tango_group_add(AO.(ifam).GroupId, AO.(ifam).DeviceName');
0464 AO.(ifam).Inom = [1 2 3];
0465 AO.(ifam).Imax = 10*ones(1,3);
0466 AO.(ifam).Status = ones(3,1);
0467 AO.(ifam).Monitor.Mode           = Mode;
0468 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(3,1);
0469 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0470 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0471 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0472 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0473 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/totalProgression'</span>);
0474 
0475 <span class="comment">%% cycleramp For quadrupoles magnets</span>
0476 ifam = <span class="string">'CycleQP'</span>;
0477 ifamQ = <span class="string">'QP'</span>;
0478 
0479 AO.(ifam).FamilyName             = ifam;
0480 AO.(ifam).MemberOf               = {<span class="string">'CycleQP'</span>; <span class="string">'Cyclage'</span>};
0481 AO.(ifam).Mode                   = Mode;
0482 dev = getfamilydata(ifamQ,<span class="string">'DeviceName'</span>);
0483 AO.(ifam).DeviceName             = regexprep(dev,<span class="string">'/Q'</span>,<span class="string">'/cycleQ'</span>);
0484 AO.(ifam).DeviceList             = family2dev(ifamQ);
0485 AO.(ifam).ElementList            = family2elem(ifamQ);
0486 <span class="comment">%add devices to group</span>
0487 AO.(ifam).GroupId                = tango_group_create(<span class="string">'Quadrupole'</span>); 
0488 tango_group_add(AO.(ifam).GroupId, AO.(ifam).DeviceName');
0489 nb = length(AO.(ifam).ElementList);
0490 AO.(ifam).Imax = [274  -349  -274  274  274  -274  274 ];
0491 AO.(ifam).Status = ones(7,1);
0492 AO.(ifam).Monitor.Mode           = Mode;
0493 AO.(ifam).Monitor.Handles(:,1)   = NaN*ones(7,1);
0494 AO.(ifam).Monitor.DataType       = <span class="string">'Scalar'</span>;
0495 AO.(ifam).Monitor.Units          = <span class="string">'Hardware'</span>;
0496 AO.(ifam).Monitor.HWUnits        = <span class="string">'ampere'</span>;
0497 AO.(ifam).Monitor.PhysicsUnits   = <span class="string">'radian'</span>;
0498 AO.(ifam).Monitor.TangoNames   = strcat(AO.(ifam).DeviceName, <span class="string">'/totalProgression'</span>);
0499 
0500 <span class="comment">% %%%%%%%%%%%%%%%%%%</span>
0501 <span class="comment">% %%% Diagnostics</span>
0502 <span class="comment">% %%%%%%%%%%%%%%%%%%</span>
0503 <span class="comment">%</span>
0504 <span class="comment">% %% Charge Monitor - Moniteur de charge</span>
0505 <span class="comment">% ifam = 'MC';</span>
0506 <span class="comment">%</span>
0507 <span class="comment">% AO.(ifam).FamilyName             = 'MC';</span>
0508 <span class="comment">% AO.(ifam).MemberOf               = {'Diag'; 'MC'; 'Archivable'};</span>
0509 <span class="comment">% AO.(ifam).Mode                   = Mode;</span>
0510 <span class="comment">% AO.(ifam).DeviceName             = {'LT2/DG/MC'; 'LT2/DG/MC'};</span>
0511 <span class="comment">% AO.(ifam).CommonNames            = ['mc1';'mc2';];</span>
0512 <span class="comment">% AO.(ifam).DeviceList(:,:)        = [1 1; 1 2];</span>
0513 <span class="comment">% AO.(ifam).ElementList            = [1 2]';</span>
0514 <span class="comment">% AO.(ifam).Status                 = [1 1]';</span>
0515 <span class="comment">% AO.(ifam).Monitor.TangoNames     = [strcat(AO.(ifam).DeviceName(1,:), '/qIct1'); ...</span>
0516 <span class="comment">%                                     strcat(AO.(ifam).DeviceName(2,:), '/qIct2')];</span>
0517 <span class="comment">% AO.(ifam).Monitor.Mode           = Mode;</span>
0518 <span class="comment">% AO.(ifam).Monitor.Handles(:,1)   = [NaN; NaN]';</span>
0519 <span class="comment">% AO.(ifam).Monitor.DataType       = 'Vector';</span>
0520 <span class="comment">% AO.(ifam).Monitor.Units          = 'Hardware';</span>
0521 <span class="comment">% AO.(ifam).Monitor.HWUnits        = 'nC';</span>
0522 <span class="comment">% AO.(ifam).Monitor.PhysicsUnits   = 'nC';</span>
0523 <span class="comment">% AO.(ifam).Monitor.HW2PhysicsParams = 1.0;</span>
0524 <span class="comment">% AO.(ifam).Monitor.Physics2HWParams = 1.0;</span>
0525 
0526 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0527 <span class="comment">%% Vacuum system</span>
0528 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
0529 
0530 <span class="comment">%% IonPump</span>
0531 ifam = <span class="string">'PI'</span>;
0532 AO.(ifam).FamilyName           = <span class="string">'PI'</span>;
0533 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'IonPump'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0534 AO.(ifam).Monitor.Mode         = Mode;
0535 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0536 
0537 <span class="keyword">for</span> ik = 1:15    
0538     <span class="keyword">if</span> ik &gt;= 10
0539         AO.(ifam).DeviceName{ik}  = [<span class="string">'LT2/VI/PI.'</span> num2str(ik)];
0540     <span class="keyword">else</span>
0541         AO.(ifam).DeviceName{ik}  = [<span class="string">'LT2/VI/PI.0'</span> num2str(ik)];
0542     <span class="keyword">end</span>
0543     AO.(ifam).CommonNames{ik} = [<span class="string">'PI'</span> num2str(ik)];
0544     AO.(ifam).DeviceList(ik,:) = [1 ik];
0545 <span class="keyword">end</span>
0546 
0547 nb = size(AO.(ifam).DeviceList,1);
0548 AO.(ifam).Status                   = ones(nb,1);
0549 AO.(ifam).DeviceName               = AO.(ifam).DeviceName';
0550 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0551 AO.(ifam).ElementList              = (1:nb)';
0552 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0553 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0554 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0555 AO.(ifam).Monitor.Physics2HWParams = 1;
0556 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0557 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0558 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0559 
0560 <span class="comment">%% PenningGauge</span>
0561 ifam = <span class="string">'JPEN'</span>;
0562 AO.(ifam).FamilyName           = <span class="string">'JPEN'</span>;
0563 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'PenningGauge'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0564 AO.(ifam).Monitor.Mode         = Mode;
0565 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0566 
0567 <span class="keyword">for</span> ik = 1:3 
0568     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT2/VI/JPEN.'</span> num2str(ik)];
0569     AO.(ifam).CommonNames{ik} = [<span class="string">'JPEN'</span> num2str(ik)];
0570     AO.(ifam).DeviceList(ik,:) = [1 ik];
0571 <span class="keyword">end</span>
0572 
0573 nb = size(AO.(ifam).DeviceList,1);
0574 AO.(ifam).Status                   = ones(nb,1);
0575 AO.(ifam).DeviceName               = AO.(ifam).DeviceName';
0576 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0577 AO.(ifam).ElementList              = (1:nb)';
0578 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0579 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0580 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0581 AO.(ifam).Monitor.Physics2HWParams = 1;
0582 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0583 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0584 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0585 
0586 <span class="comment">%% PenningGauge</span>
0587 ifam = <span class="string">'JPIR'</span>;
0588 AO.(ifam).FamilyName           = <span class="string">'JPIR'</span>;
0589 AO.(ifam).MemberOf             = {<span class="string">'PlotFamily'</span>; <span class="string">'PiraniGauge'</span>; <span class="string">'Pressure'</span>; <span class="string">'Archivable'</span>};
0590 AO.(ifam).Monitor.Mode         = Mode;
0591 AO.(ifam).Monitor.DataType     = <span class="string">'Scalar'</span>;
0592 
0593 <span class="keyword">for</span> ik = 1:3    
0594     AO.(ifam).DeviceName{ik}  = [<span class="string">'LT2/VI/JPIR.'</span> num2str(ik)];
0595     AO.(ifam).CommonNames{ik} = [<span class="string">'JPIR'</span> num2str(ik)];
0596     AO.(ifam).DeviceList(ik,:) = [1 ik];
0597 <span class="keyword">end</span>
0598 
0599 nb = size(AO.(ifam).DeviceList,1);
0600 AO.(ifam).Status                   = ones(nb,1);
0601 AO.(ifam).DeviceName               = AO.(ifam).DeviceName';
0602 AO.(ifam).CommonNames              = AO.(ifam).CommonNames';
0603 AO.(ifam).ElementList              = (1:nb)';
0604 AO.(ifam).Monitor.Handles(:,1)     = NaN*ones(nb,1);
0605 AO.(ifam).Monitor.TangoNames       = strcat(AO.(ifam).DeviceName, <span class="string">'/pressure'</span>);
0606 AO.(ifam).Monitor.HW2PhysicsParams = 1;
0607 AO.(ifam).Monitor.Physics2HWParams = 1;
0608 AO.(ifam).Monitor.Units            = <span class="string">'Hardware'</span>;   
0609 AO.(ifam).Monitor.HWUnits          = <span class="string">'mBar'</span>;
0610 AO.(ifam).Monitor.PhysicsUnits     = <span class="string">'mBar'</span>;
0611 
0612 <span class="comment">%% Synchronisation</span>
0613 <span class="comment">% ifam = 'SYNC'</span>
0614 <span class="comment">% AO.(ifam).FamilyName           = 'SYNC';</span>
0615 <span class="comment">% AO.(ifam).MemberOf             = {'Timing'};</span>
0616 <span class="comment">% AO.(ifam).Monitor.Mode         = Mode;</span>
0617 <span class="comment">% AO.(ifam).Monitor.DataType     = 'Scalar';</span>
0618 <span class="comment">%</span>
0619 <span class="comment">% AO.(ifam).DeviceName{ik}  = ['LT2/VI/JPIR.' num2str(ik)];</span>
0620 <span class="comment">%</span>
0621 <span class="comment">% AO.(ifam).Monitor.HWUnits      = 's';</span>
0622 
0623 setao(AO);
0624 
0625 <span class="comment">% The operational mode sets the path, filenames, and other important params</span>
0626 <span class="comment">% Run setoperationalmode after most of the AO is built so that the Units and Mode fields</span>
0627 <span class="comment">% can be set in setoperationalmode</span>
0628 
0629 <a href="setoperationalmode.html" class="code" title="function setoperationalmode(ModeNumber)">setoperationalmode</a>(OperationalMode);
0630 
0631 
0632 <span class="comment">%======================================================================</span>
0633 <span class="comment">%======================================================================</span>
0634 <span class="comment">%% Append Accelerator Toolbox information</span>
0635 <span class="comment">%======================================================================</span>
0636 <span class="comment">%======================================================================</span>
0637 disp(<span class="string">'** Initializing Accelerator Toolbox information'</span>);
0638 
0639 AO = getao;
0640 
0641 ATindx = atindex(THERING);  <span class="comment">%structure with fields containing indices</span>
0642 
0643 s = findspos(THERING,1:length(THERING)+1)';
0644 
0645 <span class="comment">%% HORIZONTAL CORRECTORS</span>
0646 ifam = (<span class="string">'CH'</span>);
0647 AO.(ifam).AT.ATType  = ifam;
0648 AO.(ifam).AT.ATIndex = ATindx.(ifam)(:);
0649 AO.(ifam).AT.ATIndex = AO.(ifam).AT.ATIndex(AO.(ifam).ElementList);   <span class="comment">%not all correctors used</span>
0650 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0651 
0652 <span class="comment">%% VERTICAL CORRECTORS</span>
0653 ifam = (<span class="string">'CV'</span>);
0654 AO.(ifam).AT.ATType  = ifam;
0655 AO.(ifam).AT.ATIndex = ATindx.(ifam)(:);
0656 AO.(ifam).AT.ATIndex = AO.(ifam).AT.ATIndex(AO.(ifam).ElementList);   <span class="comment">%not all correctors used</span>
0657 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex); 
0658 
0659 <span class="comment">%% BENDING magnets</span>
0660 ifam = (<span class="string">'BEND'</span>);
0661 AO.(ifam).AT.ATType  = ifam;
0662 AO.(ifam).AT.ATIndex = ATindx.(ifam)(:);
0663 AO.(ifam).Position   = reshape(s(AO.(ifam).AT.ATIndex),1,4);
0664 
0665 <span class="comment">%% QUADRUPOLES</span>
0666 ifam = <span class="string">'QP'</span>;
0667 AO.(ifam).AT.ATType  = <span class="string">'QUAD'</span>;
0668 AO.(ifam).AT.ATIndex = eval([<span class="string">'ATindx.'</span> ifam <span class="string">'(:)'</span>]);
0669 AO.(ifam).AT.ATIndex = reshape(AO.(ifam).AT.ATIndex,1,7)';
0670 AO.(ifam).Position   = s(AO.(ifam).AT.ATIndex);
0671 
0672 
0673 <span class="comment">% %% QUADRUPOLES</span>
0674 <span class="comment">% ifam = 'QF';</span>
0675 <span class="comment">% AT.(ifam).AT.ATType  = 'QUAD';</span>
0676 <span class="comment">% AT.(ifam).AT.ATIndex = eval(['ATindx.' ifam '(:)']);</span>
0677 <span class="comment">% AT.(ifam).AT.ATIndex = reshape(AT.(ifam).AT.ATIndex,1,4)';</span>
0678 <span class="comment">% AT.(ifam).Position   = s(AT.(ifam).AT.ATIndex);</span>
0679 <span class="comment">%</span>
0680 <span class="comment">% %% QUADRUPOLES</span>
0681 <span class="comment">% ifam = 'QD';</span>
0682 <span class="comment">% AT.(ifam).AT.ATType  = 'QUAD';</span>
0683 <span class="comment">% AT.(ifam).AT.ATIndex = eval(['ATindx.' ifam '(:)']);</span>
0684 <span class="comment">% AT.(ifam).AT.ATIndex = reshape(AT.(ifam).AT.ATIndex,1,3)';</span>
0685 <span class="comment">% AT.(ifam).Position   = s(AT.(ifam).AT.ATIndex);</span>
0686 
0687 <span class="comment">% Save AO</span>
0688 setao(AO);
0689 
0690 <span class="keyword">if</span> iscontrolroom
0691     switch2online;
0692 <span class="keyword">else</span>
0693     switch2sim;
0694 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>