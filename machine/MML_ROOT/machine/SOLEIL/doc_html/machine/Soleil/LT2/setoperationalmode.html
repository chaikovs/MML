<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setoperationalmode</title>
  <meta name="keywords" content="setoperationalmode">
  <meta name="description" content="SETOPERATIONALMODE - Switches between the various operational modes">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">machine</a> &gt; <a href="#">Soleil</a> &gt; <a href="index.html">LT2</a> &gt; setoperationalmode.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for machine/Soleil/LT2&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>setoperationalmode
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>SETOPERATIONALMODE - Switches between the various operational modes</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function setoperationalmode(ModeNumber) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">SETOPERATIONALMODE - Switches between the various operational modes
  setoperationalmode(ModeNumber)

  INPUTS
  1. ModeNumber = 1. 2.7391 GeV, multibunch

                100. Laurent's Mode

  See also <a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>, <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>, <a href="LT2init.html" class="code" title="function LT2init(OperationalMode)">LT2init</a>, setpathsoleil</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>	UPDATEATINDEX - Updates the AT indices in the MiddleLayer with the present AT lattice (THERING)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="LT2init.html" class="code" title="function LT2init(OperationalMode)">LT2init</a>	LT2INIT - Contructs an accelerator Object describing LT2</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function setoperationalmode(ModeNumber)</a>
0002 <span class="comment">%SETOPERATIONALMODE - Switches between the various operational modes</span>
0003 <span class="comment">%  setoperationalmode(ModeNumber)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  INPUTS</span>
0006 <span class="comment">%  1. ModeNumber = 1. 2.7391 GeV, multibunch</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%                100. Laurent's Mode</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%  See also aoinit, updateatindex, LT2init, setpathsoleil</span>
0011 
0012 <span class="comment">%</span>
0013 <span class="comment">% Written by Laurent S. Nadolski</span>
0014 
0015 <span class="keyword">global</span> THERING
0016 
0017 <span class="comment">% Check if the AO exists</span>
0018 checkforao;
0019 
0020 
0021 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0022 <span class="comment">% Accelerator Dependent Modes %</span>
0023 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0024 <span class="keyword">if</span> nargin &lt; 1
0025     ModeNumber = [];
0026 <span class="keyword">end</span>
0027 <span class="keyword">if</span> isempty(ModeNumber)
0028     ModeCell = {<span class="string">'2.7391 GeV, multibunch'</span>,  <span class="keyword">...</span>
0029         <span class="string">'Laurent''s Mode'</span>};
0030     [ModeNumber, OKFlag] = listdlg(<span class="string">'Name'</span>,<span class="string">'SOLEIL'</span>,<span class="string">'PromptString'</span>,<span class="string">'Select the Operational Mode:'</span>, <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>, <span class="string">'ListString'</span>, ModeCell, <span class="string">'ListSize'</span>, [450 200]);
0031     <span class="keyword">if</span> OKFlag ~= 1
0032         fprintf(<span class="string">'   Operational mode not changed\n'</span>);
0033         <span class="keyword">return</span>
0034     <span class="keyword">elseif</span> ModeNumber == 2
0035         ModeNumber = 100;  <span class="comment">% Laurent</span>
0036     <span class="keyword">end</span>
0037 <span class="keyword">end</span>
0038 
0039 
0040 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0041 <span class="comment">% Accelerator Data Structure %</span>
0042 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0043 AD = getad;
0044 AD.Machine = <span class="string">'SOLEIL'</span>;            <span class="comment">% Will already be defined if setpathmml was used</span>
0045 AD.MachineType = <span class="string">'StorageRing'</span>;   <span class="comment">% Will already be defined if setpathmml was used</span>
0046 AD.SubMachine  = <span class="string">'LT2'</span>;           <span class="comment">% Will already be defined if setpathmml was used</span>
0047 AD.OperationalMode = <span class="string">''</span>;          <span class="comment">% Gets filled in later</span>
0048 
0049 
0050 <span class="comment">% Tune processor delay: delay required to wait</span>
0051 <span class="comment">% to have a fresh tune measurement after changing</span>
0052 <span class="comment">% a variable like the RF frequency.  Setpv will wait</span>
0053 <span class="comment">% 2.2 * TuneDelay to be guaranteed a fresh data point.</span>
0054 AD.BPMDelay  = 0.25; <span class="comment">% use [N, BPMDelay]=getbpmsaverages (AD.BPMDelay will disappear)</span>
0055 AD.TuneDelay = 0.1;
0056 
0057 
0058 <span class="comment">% SP-AM Error level</span>
0059 <span class="comment">% AD.ErrorWarningLevel = 0 -&gt; SP-AM errors are Matlab errors {Default}</span>
0060 <span class="comment">%                       -1 -&gt; SP-AM errors are Matlab warnings</span>
0061 <span class="comment">%                       -2 -&gt; SP-AM errors prompt a dialog box</span>
0062 <span class="comment">%                       -3 -&gt; SP-AM errors are ignored (ErrorFlag=-1 is returned)</span>
0063 AD.ErrorWarningLevel = 0;
0064 
0065 <span class="comment">%%%%%%%%%%%%%%%%%%%%%</span>
0066 <span class="comment">% Operational Modes %</span>
0067 <span class="comment">%%%%%%%%%%%%%%%%%%%%%</span>
0068 
0069 <span class="comment">% Mode setup variables (mostly path and file names)</span>
0070 <span class="comment">% AD.OperationalMode - String used in titles</span>
0071 <span class="comment">% ModeName - String used for mode directory name off DataRoot/MachineName</span>
0072 <span class="comment">% OpsFileExtension - string add to default file names</span>
0073 
0074 <span class="keyword">if</span> ModeNumber == 1
0075     <span class="comment">% LT2 Nominal Lattice</span>
0076     AD.OperationalMode = <span class="string">'2.7391 GeV, multibunch'</span>;
0077     AD.Energy = 2.7391; <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0078     ModeName = <span class="string">'LT2lattice'</span>;
0079     OpsFileExtension = <span class="string">'_LT2lattice'</span>;
0080 
0081     <span class="comment">% AT lattice</span>
0082     AD.ATModel = <span class="string">'LT2lattice'</span>;
0083     eval(AD.ATModel);  <span class="comment">%run model for compilersolamor2linb;</span>
0084 
0085     switch2hw;
0086     
0087 <span class="keyword">elseif</span> ModeNumber == 100
0088     <span class="comment">% User mode - High Tune, Top Off injection</span>
0089     error(<span class="string">'To be completed'</span>);    
0090 
0091 <span class="keyword">else</span>
0092     error(<span class="string">'Operational mode unknown'</span>);
0093 <span class="keyword">end</span>
0094 
0095 
0096 
0097 <span class="comment">% Set the AD directory path</span>
0098 setad(AD);
0099 MMLROOT = setmmldirectories(AD.Machine, AD.SubMachine, ModeName, OpsFileExtension);
0100 AD = getad;
0101 
0102 <span class="comment">% SOLEIL specific path changes</span>
0103 
0104  <span class="comment">% Top Level Directories</span>
0105 
0106 AD.Directory.DataRoot       = fullfile(MMLROOT, <span class="string">'measdata'</span>, <span class="string">'LT2data'</span>, filesep);
0107 AD.Directory.OpsData        = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'LT2OpsData'</span>, filesep);
0108 AD.Directory.Lattice        = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'LT2'</span>, <span class="string">'Lattices'</span>, filesep);
0109 
0110 AD.Directory.EMITData       = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'LT2'</span>, <span class="string">'emittance'</span>, filesep); 
0111 AD.Directory.Timing         = fullfile(MMLROOT, <span class="string">'machine'</span>, <span class="string">'Soleil'</span>, <span class="string">'LT2'</span>, <span class="string">'Timing'</span>, filesep);
0112 
0113 AD.Directory.ConfigData     = fullfile(AD.Directory.DataRoot, <span class="string">'MachineConfig'</span>, filesep);
0114 AD.Directory.Archiving      = fullfile(AD.Directory.DataRoot, <span class="string">'ArchivingData'</span>, filesep);
0115 
0116 
0117 <span class="comment">%Operational Files</span>
0118 AD.OpsData.LatticeFile       = <span class="string">'GoldenLattice'</span>;     <span class="comment">%Golden Lattice File (setup for users)</span>
0119 AD.OpsData.PhysDataFile      = <span class="string">'GoldenPhysData'</span>;
0120 
0121 <span class="comment">% Circumference</span>
0122 AD.Circumference = findspos(THERING,length(THERING)+1);
0123 setad(AD);
0124 
0125 <span class="comment">% Updates the AT indices in the MiddleLayer with the present AT lattice</span>
0126 <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>;
0127 
0128 <span class="comment">% Set the model energy</span>
0129 setenergymodel(AD.Energy);
0130 
0131 fprintf(<span class="string">'   lattice files have changed or if the AT lattice has changed.\n'</span>);
0132 fprintf(<span class="string">'   Middlelayer setup for operational mode: %s\n'</span>, AD.OperationalMode);
0133 
0134 setad(orderfields(AD));</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:35:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>