function [MagnetType, Leff, MagnetMeasurementsData, CorrectionFactor] = magnetinterp(MagnetCoreType)
%MAGNETINTERP - Give data for conversion between Physics and Hardware units
%[MagnetType,Leff,MagnetMeasurementsData, CorrectionFactor ] = magnetinterp(MagnetCoreType)
%
% INPUTS
% 1. MagnetCoreType - Family name or type of magnet
%
% OUTPUTS
% 1. MagnetType
% 2. Leff - Magnet length (m)
% 3. MagnetMeasurementsData First column Amperes second column Tesla
% 4. CorrectionFactor - to make correction of G vector (in MagnetMeasurements) due to difference between measurement and model
%
%
% See Also amp2kInterp, k2ampInterp

%
% Written by A.Bence 20-06-2016


if nargin < 1
    error('MagnetCoreType input required');
end




% For a string matrix
if iscell(MagnetCoreType)
    for i = 1:size(MagnetCoreType,1)
        for j = 1:size(MagnetCoreType,2)
           [MagnetType{i,j}, Leff{i,j}, MagnetMeasurementsData{i,j}, CorrectionFactor{i,j}] = magnetinterpfile(MagnetCoreType{i});
        end
    end
    return
end
 
% For a string matrix
if size(MagnetCoreType,1) > 1
    MagnetType=[]; Leff=[];MagnetMeasurementsData=[]; CorrectionFactor=[]; 
    for i = 1:size(MagnetCoreType,1)
        [MType1,Leff1,Mag1, CF1] = magnetinterpfil(MagnetCoreType(i,:));
        MagnetType = strvcat(MagnetType, MType1);       
        Leff(i,:)=Leff1;
        MagnetMeasurementsData(i,:) = Mag1;
        CorrectionFactor(i,:)= CF1;
    end
    return
end

%% get accelerator name
AcceleratorName = getfamilydata('SubMachine');

switch AcceleratorName
    case 'StorageRing'
        %%%%
        % longueur des quadrupoles ajustee a Lintermediaire ente Lmag et Lcalc
        coeffQ =    0e-3   ;  %0e-3  ;  %  0e-3     %  0e-3 ;   %  0e-3      ;  %  8e-3  ;   % applique sur le premier faisceau           
        
        %correction offset capteur BMS -2.310-3 (P. Brunelle 30/05/06) 
        bob=0.9977*(1-coeffQ);

        switch upper(deblank(MagnetCoreType))        
            case {'Q1','Q6', 'Q11','Q8','Q9','Q3','Q4','Q5','Q10'}  
                MagnetType = 'quad';
                LtotQC = 0.3602  ; % 0.3602 ; %0.3539 ;%  0.3696   % 0.3539;   %  0.3695814 ;  % 0.320 ;   % longueur effective Qpole court         
                Leff=LtotQC;
                CorrectionFactor=1.003*bob; % To apply in G vector of MagnetMesurementsData Facteur de correction entre les Mesures Magnetiquse  et ce qui est attendu sur le modéle
                 %[I(A);G(T)]
                MagnetMeasurementsData=[249.022000000000,6.60116573900000;244.860000000000,6.53112104400000;239.713000000000,6.43757693900000;234.629000000000,6.33730488600000;229.587000000000,6.22982314100000;224.544000000000,6.11224784400000;219.512000000000,5.98986282900000;214.509000000000,5.86498050600000;209.481000000000,5.73699552000000;204.458000000000,5.60709419400000;199.441000000000,5.47599174000000;194.424000000000,5.34369142000000;189.397000000000,5.21026970100000;184.403000000000,5.07688339000000;179.386000000000,4.94224234700000;174.370000000000,4.80708262800000;169.357000000000,4.67158748400000;164.346000000000,4.53572394000000;159.327000000000,4.39930933400000;154.338000000000,4.26346072000000;149.330000000000,4.12677005100000;144.312000000000,3.98968228100000;139.313000000000,3.85294632900000;134.306000000000,3.71570913000000;129.295000000000,3.57841555900000;124.292000000000,3.44108930600000;119.299000000000,3.30405392300000;114.293000000000,3.16651217500000;109.290000000000,3.02929344700000;104.298000000000,2.89180764800000;99.2930000000000,2.75440476300000;94.2910000000000,2.61682725700000;89.3160000000000,2.47964983500000;84.3170000000000,2.34204177600000;79.3200000000000,2.20447235200000;74.3300000000000,2.06706398900000;69.3310000000000,1.92940869400000;64.3360000000000,1.79182219300000;59.3640000000000,1.65488925800000;54.3700000000000,1.51729132500000;49.3760000000000,1.37969451500000;39.3990000000000,1.10487615900000;29.4440000000000,0.830539398000000;19.4700000000000,0.555838050000000;9.51600000000000,0.281576044000000;-0.00100000000000000,0.0206998240000000;];
                     
                   
            case {'Q2', 'Q12','Q7'}                   
                MagnetType = 'quad';
                LtotQL = 0.4962  ; % 0.4962 ; %0.4917 ; %  0.5028   % 0.4917;   %  0.5027758 ;  %  0.460 ;   % longueur effective Qpole long       
                Leff=LtotQL;
                CorrectionFactor=1.0155*bob; % To apply in G vector of MagnetMesurementsData Facteur de correction entre les Mesures Magnetiques  et ce qui est attendu sur le modéle            
                %[I(A);G(T)]
                MagnetMeasurementsData=[249.342000000000,10.3702188100000;245.180000000000,10.2771299500000;240.027000000000,10.1538982500000;234.940000000000,10.0242566800000;229.886000000000,9.88712062300000;224.847000000000,9.73788344300000;219.815000000000,9.57921589100000;214.787000000000,9.41009466000000;209.755000000000,9.22889922300000;204.730000000000,9.03718155800000;199.704000000000,8.83766276700000;194.680000000000,8.63258357600000;189.654000000000,8.42340399900000;184.633000000000,8.21144522600000;179.611000000000,7.99713816500000;174.595000000000,7.78128532300000;169.570000000000,7.56350775200000;164.556000000000,7.34528351500000;159.536000000000,7.12585700200000;154.522000000000,6.90571866000000;149.508000000000,6.68504965700000;144.493000000000,6.46380567400000;139.482000000000,6.24224026200000;134.470000000000,6.02024467900000;129.460000000000,5.79806883400000;124.448000000000,5.57552361700000;119.446000000000,5.35324002000000;114.441000000000,5.13050614800000;109.434000000000,4.90769156100000;99.4240000000000,4.46167386300000;89.4210000000000,4.01568212000000;79.4190000000000,3.56954851800000;69.4180000000000,3.12337066100000;59.4200000000000,2.67726213300000;49.4230000000000,2.23125671800000;39.4340000000000,1.78537081700000;29.4520000000000,1.34004361600000;19.4750000000000,0.894954992000000;9.50300000000000,0.450483167000000;-0.00100000000000000,0.0281801690000000;];
                               
               
            case {'S1','S2','S3','S4','S5','S6','S7','S8','S9','S10', 'S11', 'S12'}                 
                MagnetType = 'SEXT';
                LtotSX = 1E-08; % longueur des sextupoles
                Leff=LtotSX;
                CorrectionFactor=1;  % To apply in G vector of MagnetMesurementsData Facteur de correction entre les Mesures Magnetiques  et ce qui est attendu sur le modéle             
                %[I(A);G(T)]
                MagnetMeasurementsData=[350.396000000000,53.0296977857377;340.391000000000,51.7835419864455;330.387000000000,50.4325672654671;320.373000000000,49.0254463303520;310.363000000000,47.5844693147649;300.354000000000,46.1223314238650;290.339000000000,44.6435586510521;280.332000000000,43.1538089281151;270.317000000000,41.6543971839885;260.304000000000,40.1486858767265;250.293000000000,38.6370474579634;240.282000000000,37.1216051416868;230.268000000000,35.6020323069321;220.259000000000,34.0799128424168;210.246000000000,32.5543607687761;200.233000000000,31.0279340079284;190.226000000000,29.4983699118888;180.216000000000,27.9675354516807;170.200000000000,26.4352910099812;160.187000000000,24.9012518564255;150.175000000000,23.3662079644416;140.161000000000,21.8295487060423;130.150000000000,20.2933557623513;120.136000000000,18.7544048550660;110.126000000000,17.2152582878153;100.107000000000,15.6748639611818;90.1030000000000,14.1345043947505;80.0800000000000,12.5929175784594;60.0570000000000,9.50837736350017;40.0340000000000,6.42162769151998;20.0010000000000,3.33286381197455;-0.00900000000000000,0.238835293248396;];
                
                
             otherwise
                error('MagnetCoreType %s is unknown or not manage by this function', MagnetCoreType);
                k = 0;
                MagnetType = '';
                return
        end     

        MagnetType = upper(MagnetType);        

        return;
   
    otherwise
        error('Unknown or Unmanage accelerator name %s', AcceleratorName);
end
