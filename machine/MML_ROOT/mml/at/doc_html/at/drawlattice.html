<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of drawlattice</title>
  <meta name="keywords" content="drawlattice">
  <meta name="description" content="DRAWLATTICE - Draws the AT lattice to a figure">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">at</a> &gt; drawlattice.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for at&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>drawlattice
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>DRAWLATTICE - Draws the AT lattice to a figure</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function drawlattice(Offset, Scaling, hAxes) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">DRAWLATTICE - Draws the AT lattice to a figure
  drawlattice(Offset {0}, Scaling {1}, hAxes {gca})

  Programmers Note: The AT index is stored in the Userdata of each symbol.

  Written by Greg Portmann</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="family2atindex.html" class="code" title="function [ATIndexList, ErrorFlag] = family2atindex(Family, varargin);">family2atindex</a>	FAMILY2ATINDEX - Returns the AT index for a given family</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="modeldisp.html" class="code" title="function [Dx, Dy, Sx, Sy] = modeldisp(varargin)">modeldisp</a>	MODELDISP - Returns the dispersion function of the model</li><li><a href="modeltwiss.html" class="code" title="function [TwissX, TwissY, Sx, Sy, Tune] = modeltwiss(varargin)">modeltwiss</a>	MODELTWISS - Returns a twiss function of the model</li><li><a href="plotbeta.html" class="code" title="function varargout = plotbeta(varargin)">plotbeta</a>	PLOTBETA - plots UNCOUPLED! beta-functions</li><li><a href="plotbeta_alex.html" class="code" title="function varargout = plotbeta(varargin)">plotbeta_alex</a>	PLOTBETA - plots UNCOUPLED! beta-functions</li><li><a href="ploteta.html" class="code" title="function varargout = plotbeta(varargin)">ploteta</a>	PLOTETA plots UNCOUPLED! eta-functions</li><li><a href="plotmodelorbit.html" class="code" title="function varargout = plotcod">plotmodelorbit</a>	PLOTMODELORBIT - Plot closed orbit distortion</li><li><a href="plottwiss.html" class="code" title="function plottwiss(varargin)">plottwiss</a>	PLOTTWISS - Plot the optical functions and tune of the present lattice</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function drawlattice(Offset, Scaling, hAxes)</a>
0002 <span class="comment">%DRAWLATTICE - Draws the AT lattice to a figure</span>
0003 <span class="comment">%  drawlattice(Offset {0}, Scaling {1}, hAxes {gca})</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  Programmers Note: The AT index is stored in the Userdata of each symbol.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%  Written by Greg Portmann</span>
0008 
0009 
0010 <span class="keyword">global</span> THERING
0011 
0012 
0013 <span class="comment">% Minimum icon width in meters</span>
0014 MinIconWidth = .09;
0015 
0016 <span class="keyword">if</span> nargin &lt; 1
0017     Offset = 0;
0018 <span class="keyword">end</span>
0019 Offset = Offset(1);
0020 <span class="keyword">if</span> nargin &lt; 2
0021     Scaling = 1;
0022 <span class="keyword">end</span>
0023 Scaling = Scaling(1);
0024 
0025 <span class="keyword">if</span> nargin &lt; 3
0026     hAxes = gca;
0027 <span class="keyword">end</span>
0028 
0029 
0030 
0031 SPositions = findspos(THERING, 1:length(THERING)+1);
0032 L = SPositions(end);
0033 plot(hAxes, [0 L], [0 0]+Offset, <span class="string">'k'</span>);
0034 
0035 <span class="comment">% Remember the hold state then turn hold on</span>
0036 HoldState = ishold(hAxes);
0037 hold(hAxes, <span class="string">'on'</span>);
0038 
0039 
0040 ATIndexHCM = <a href="family2atindex.html" class="code" title="function [ATIndexList, ErrorFlag] = family2atindex(Family, varargin);">family2atindex</a>(gethcmfamily);
0041 ATIndexVCM = <a href="family2atindex.html" class="code" title="function [ATIndexList, ErrorFlag] = family2atindex(Family, varargin);">family2atindex</a>(getvcmfamily);
0042 
0043 
0044 <span class="comment">% Make default icons for elements of different physical types</span>
0045 <span class="keyword">for</span> i = 1:length(THERING)
0046     NumberOfFinds = 0;
0047     
0048     SPos = SPositions(i);
0049     <span class="keyword">if</span> isfield(THERING{i},<span class="string">'BendingAngle'</span>) &amp;&amp; THERING{i}.BendingAngle
0050         <span class="comment">% make icons for bending magnets</span>
0051         NumberOfFinds = NumberOfFinds + 1;
0052         IconHeight = .3;
0053         IconColor = [1 1 0];
0054         IconWidth = THERING{i}.Length;
0055         <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0056             IconWidth = MinIconWidth;
0057             SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0058         <span class="keyword">end</span>
0059         vx = [SPos SPos+IconWidth SPos+IconWidth SPos];
0060         vy = [IconHeight IconHeight -IconHeight -IconHeight];
0061         h = patch(vx, Scaling*vy+Offset, IconColor,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0062         set(h, <span class="string">'UserData'</span>, i);
0063 
0064         <span class="comment">%if IconWidth &lt; .1 % meters</span>
0065         <span class="comment">%    set(h, 'EdgeColor', IconColor);</span>
0066         <span class="comment">%end</span>
0067 
0068     <span class="keyword">elseif</span> isfield(THERING{i},<span class="string">'K'</span>) &amp;&amp; THERING{i}.K
0069         <span class="comment">% Quadrupole</span>
0070         NumberOfFinds = NumberOfFinds + 1;
0071        <span class="keyword">if</span> THERING{i}.K &gt; 0
0072             <span class="comment">% Focusing quadrupole</span>
0073             IconHeight = .8;
0074             IconColor = [1 0 0];
0075             IconWidth = THERING{i}.Length;
0076             <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0077                 IconWidth = MinIconWidth;
0078                 SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0079             <span class="keyword">end</span>
0080             vx = [SPos SPos+IconWidth/2  SPos+IconWidth SPos+IconWidth/2 SPos];
0081             vy = [0          IconHeight               0      -IconHeight    0];
0082         <span class="keyword">else</span>
0083             <span class="comment">% Defocusing quadrupole</span>
0084             IconHeight = .7;
0085             IconColor = [0 0 1];
0086             IconWidth = THERING{i}.Length;
0087             <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0088                 <span class="comment">% Center about starting point</span>
0089                 IconWidth = MinIconWidth;
0090                 SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0091             <span class="keyword">end</span>
0092             vx = [SPos+.4*IconWidth    SPos    SPos+IconWidth  SPos+.6*IconWidth  SPos+IconWidth    SPos      SPos+.4*IconWidth];
0093             vy = [     0            IconHeight   IconHeight          0              -IconHeight  -IconHeight    0];
0094         <span class="keyword">end</span>
0095         h = patch(vx, Scaling*vy+Offset, IconColor,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0096         set(h, <span class="string">'UserData'</span>, i);
0097         <span class="comment">%if IconWidth &lt; .1 % meters</span>
0098         <span class="comment">%    set(h, 'EdgeColor', IconColor);</span>
0099         <span class="comment">%end</span>
0100 
0101     <span class="keyword">elseif</span> isfield(THERING{i},<span class="string">'PolynomB'</span>) &amp;&amp; length(THERING{i}.PolynomB)&gt;2 &amp;&amp; (THERING{i}.PolynomB(3) || any(strcmpi(THERING{i}.FamName,{<span class="string">'SF'</span>,<span class="string">'SFF'</span>,<span class="string">'SD'</span>,<span class="string">'SDD'</span>})))
0102         <span class="comment">% Sextupole</span>
0103         NumberOfFinds = NumberOfFinds + 1;
0104         <span class="keyword">if</span> THERING{i}.PolynomB(3)&gt;0 || any(strcmpi(THERING{i}.FamName,{<span class="string">'SF'</span>,<span class="string">'SFF'</span>}))
0105             <span class="comment">% Focusing sextupole</span>
0106             IconHeight = .6;
0107             IconColor = [1 0 1];
0108             IconWidth = THERING{i}.Length;
0109             <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0110                 IconWidth = MinIconWidth;
0111                 SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0112             <span class="keyword">end</span>
0113             vx = [SPos          SPos+.33*IconWidth  SPos+.66*IconWidth  SPos+IconWidth   SPos+IconWidth   SPos+.66*IconWidth  SPos+.33*IconWidth      SPos          SPos];
0114             vy = [IconHeight/3      IconHeight          IconHeight        IconHeight/3    -IconHeight/3      -IconHeight          -IconHeight     -IconHeight/3  IconHeight/3];
0115         <span class="keyword">else</span>
0116             <span class="comment">% Defocusing sextupole</span>
0117             IconHeight = .6;
0118             IconColor = [0 1 0];
0119             IconWidth = THERING{i}.Length;
0120             <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0121                 IconWidth = MinIconWidth;
0122                 SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0123             <span class="keyword">end</span>
0124             vx = [SPos          SPos+.33*IconWidth  SPos+.66*IconWidth  SPos+IconWidth   SPos+IconWidth   SPos+.66*IconWidth  SPos+.33*IconWidth      SPos          SPos];
0125             vy = [IconHeight/3      IconHeight          IconHeight        IconHeight/3    -IconHeight/3      -IconHeight          -IconHeight     -IconHeight/3  IconHeight/3];
0126         <span class="keyword">end</span>
0127         h = patch(vx, Scaling*vy+Offset, IconColor,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0128         set(h, <span class="string">'UserData'</span>, i);
0129         <span class="comment">%if IconWidth &lt; .1 % meters</span>
0130         <span class="comment">%    set(h, 'EdgeColor', IconColor);</span>
0131         <span class="comment">%end</span>
0132 
0133     <span class="keyword">elseif</span> isfield(THERING{i},<span class="string">'Frequency'</span>) &amp;&amp; isfield(THERING{i},<span class="string">'Voltage'</span>)
0134         <span class="comment">% RF cavity</span>
0135         NumberOfFinds = NumberOfFinds + 1;
0136         IconColor = [1 0.5 0];
0137         h = plot(hAxes, SPos, 0+Offset, <span class="string">'o'</span>, <span class="string">'MarkerFaceColor'</span>, IconColor, <span class="string">'Color'</span>, IconColor, <span class="string">'MarkerSize'</span>, 4);
0138         set(h, <span class="string">'UserData'</span>, i);
0139 
0140     <span class="keyword">elseif</span> strcmpi(THERING{i}.FamName,<span class="string">'BPM'</span>)
0141         <span class="comment">% BPM</span>
0142         NumberOfFinds = NumberOfFinds + 1;
0143         IconColor = <span class="string">'k'</span>;
0144         h = plot(hAxes, SPos, 0+Offset, <span class="string">'.'</span>, <span class="string">'Color'</span>, IconColor);
0145         <span class="comment">%h = plot(hAxes, SPos, 0, 'o', 'MarkerFaceColor', IconColor, 'Color', IconColor, 'MarkerSize', 1.5)</span>
0146         set(h, <span class="string">'UserData'</span>, i);
0147         
0148     <span class="keyword">elseif</span> strcmpi(THERING{i}.FamName,<span class="string">'TV'</span>)
0149         <span class="comment">% TV screen</span>
0150         NumberOfFinds = NumberOfFinds + 1;
0151         IconHeight = .7;
0152         IconColor = [.5 0 0];  <span class="comment">%'k';</span>
0153         <span class="comment">%h = plot(hAxes, SPos, 0+Offset, 'x', 'Color', IconColor);</span>
0154         h = plot(hAxes, SPos, Scaling*IconHeight+Offset, <span class="string">'Marker'</span>,<span class="string">'Square'</span>, <span class="string">'MarkerFaceColor'</span>, IconColor, <span class="string">'Color'</span>, IconColor, <span class="string">'MarkerSize'</span>, 3.5);
0155         set(h, <span class="string">'UserData'</span>, i);
0156     <span class="keyword">end</span>
0157     
0158     <span class="comment">% Since correctors could be a combined function magnet, test separately</span>
0159     <span class="keyword">if</span> any(strcmpi(THERING{i}.FamName,{<span class="string">'COR'</span>,<span class="string">'XCOR'</span>,<span class="string">'YCOR'</span>,<span class="string">'HCOR'</span>,<span class="string">'VCOR'</span>})) || isfield(THERING{i},<span class="string">'KickAngle'</span>)
0160         <span class="comment">% Corrector</span>
0161         NumberOfFinds = NumberOfFinds + 1;
0162         
0163         <span class="keyword">if</span> NumberOfFinds &gt; 1
0164             IconWidth = 0;
0165         <span class="keyword">else</span>
0166             IconWidth = THERING{i}.Length;
0167         <span class="keyword">end</span>
0168         IconHeight = 1.0;  <span class="comment">% was .8</span>
0169         vx = [SPos   SPos];
0170 
0171         <span class="comment">% Draw a line above for a HCM and below for a VCM</span>
0172         <span class="comment">% If it's not in the ML, then draw a line above and below</span>
0173         CMFound = 1;
0174         <span class="keyword">if</span> any(i == ATIndexVCM)
0175             IconColor = [0 0 0];
0176             vy = [-IconHeight 0];
0177             <span class="keyword">if</span> IconWidth &lt; MinIconWidth
0178                 h = plot(hAxes, vx, Scaling*vy+Offset, <span class="string">'Color'</span>, IconColor);
0179             <span class="keyword">else</span>
0180                 IconWidth = THERING{i}.Length;
0181                 vx = [SPos SPos+IconWidth SPos+IconWidth SPos];
0182                 vy = [0 0 -IconHeight -IconHeight];
0183                 <span class="comment">%vy = [IconHeight IconHeight -IconHeight -IconHeight];</span>
0184                 h = patch(vx, Scaling*vy+Offset, IconColor, <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0185                 <span class="keyword">if</span> IconWidth &lt; MinIconWidth*2 <span class="comment">% meters</span>
0186                     set(h, <span class="string">'EdgeColor'</span>, IconColor);
0187                 <span class="keyword">end</span>
0188             <span class="keyword">end</span>
0189             set(h, <span class="string">'UserData'</span>, i);
0190             CMFound = 0;
0191         <span class="keyword">end</span>
0192 
0193         <span class="keyword">if</span> any(i == ATIndexHCM)
0194             IconColor = [0 0 0];
0195             vy = [0 IconHeight];
0196             <span class="keyword">if</span> IconWidth &lt; MinIconWidth
0197                 h = plot(hAxes, vx, Scaling*vy+Offset, <span class="string">'Color'</span>, IconColor);
0198             <span class="keyword">else</span>
0199                 IconWidth = THERING{i}.Length;
0200                 vx = [SPos SPos+IconWidth SPos+IconWidth SPos];
0201                 vy = [IconHeight IconHeight 0 0];
0202                 <span class="comment">%vy = [IconHeight IconHeight -IconHeight -IconHeight];</span>
0203                 h = patch(vx, Scaling*vy+Offset, IconColor, <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0204                 <span class="keyword">if</span> IconWidth &lt; MinIconWidth*2 <span class="comment">% meters</span>
0205                     set(h, <span class="string">'EdgeColor'</span>, IconColor);
0206                 <span class="keyword">end</span>
0207             <span class="keyword">end</span>
0208             set(h, <span class="string">'UserData'</span>, i);
0209             CMFound = 0;
0210         <span class="keyword">end</span>
0211         
0212         <span class="keyword">if</span> CMFound
0213             IconColor = [0 0 0];
0214             vy = [-IconHeight IconHeight];
0215             <span class="keyword">if</span> IconWidth &lt; MinIconWidth
0216                 h = plot(hAxes, vx, Scaling*vy+Offset, <span class="string">'Color'</span>, IconColor);
0217             <span class="keyword">else</span>
0218                 IconWidth = THERING{i}.Length;
0219                 vx = [SPos SPos+IconWidth SPos+IconWidth SPos];
0220                 vy = [IconHeight IconHeight -IconHeight -IconHeight];
0221                 h = patch(vx, Scaling*vy+Offset, IconColor, <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0222                 <span class="keyword">if</span> IconWidth &lt; MinIconWidth*2 <span class="comment">% meters</span>
0223                     set(h, <span class="string">'EdgeColor'</span>, IconColor);
0224                 <span class="keyword">end</span>
0225             <span class="keyword">end</span>
0226             set(h, <span class="string">'UserData'</span>, i);
0227             CMFound = 0;
0228         <span class="keyword">end</span>
0229 
0230     <span class="keyword">end</span>
0231 <span class="keyword">end</span>
0232 
0233 
0234 <span class="comment">% Leave the hold state as it was at the start</span>
0235 <span class="keyword">if</span> ~HoldState
0236     hold(hAxes, <span class="string">'off'</span>);
0237 <span class="keyword">end</span>
0238 
0239 a = axis(hAxes);
0240 axis(hAxes, [0 L a(3:4)]);
0241</pre></div>
<hr><address>Generated on Fri 18-May-2007 17:13:39 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>