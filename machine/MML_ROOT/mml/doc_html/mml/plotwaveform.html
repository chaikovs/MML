<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of plotwaveform</title>
  <meta name="keywords" content="plotwaveform">
  <meta name="description" content="PJ BOussina waveform loader September 11, 2006">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; plotwaveform.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>plotwaveform
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>PJ BOussina waveform loader September 11, 2006</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function plotwaveform() </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> PJ BOussina waveform loader September 11, 2006
 Just for fun nothing serious 
 If you don't like it too bad, make it yourself
 Have FUN</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>	GETPV - Returns a variable from the online system or the model</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function launch_timer_callback(src,evt)</a></li><li><a href="#_sub2" class="code">function select_waveform_callback(src,evt)</a></li><li><a href="#_sub3" class="code">function process_selection_callback(src,evt)</a></li><li><a href="#_sub4" class="code">function update_channel_callback(src,evt)</a></li><li><a href="#_sub5" class="code">function trace2state_callback(src,evt)</a></li><li><a href="#_sub6" class="code">function update_source_callback(src,evt)</a></li><li><a href="#_sub7" class="code">function monitor2save_callback(src,evt)</a></li><li><a href="#_sub8" class="code">function monitor2save(src,evt)</a></li><li><a href="#_sub9" class="code">function save2file_callback(src,evt)</a></li><li><a href="#_sub10" class="code">function save2file(src,evt)</a></li><li><a href="#_sub11" class="code">function save2golden_callback(src,evt)</a></li><li><a href="#_sub12" class="code">function all_checkbox_callback(srv,evt)</a></li><li><a href="#_sub13" class="code">function all2workspace</a></li><li><a href="#_sub14" class="code">function write2workspace_callback(src,evt)</a></li><li><a href="#_sub15" class="code">function write2workspace(src,evt)</a></li><li><a href="#_sub16" class="code">function file2memory_callback(src,evt)</a></li><li><a href="#_sub17" class="code">function golden2memory_callback(src,evt)</a></li><li><a href="#_sub18" class="code">function golden2memory(src,evt)</a></li><li><a href="#_sub19" class="code">function single_shot_callback(src,evt)</a></li><li><a href="#_sub20" class="code">function single_shot(src,evt,irefresh)</a></li><li><a href="#_sub21" class="code">function getpv_spear3(iplot,iwfm)</a></li><li><a href="#_sub22" class="code">function plot_waveform(iplot,iwfm,tr)</a></li><li><a href="#_sub23" class="code">function update_display(src,evt)</a></li><li><a href="#_sub24" class="code">function display_waveform_callback(src,evt)</a></li><li><a href="#_sub25" class="code">function waveform_name(src,evt)</a></li><li><a href="#_sub26" class="code">function clear_plots_callback(src,evt)</a></li><li><a href="#_sub27" class="code">function clear_plot(iplot,iwfm)</a></li><li><a href="#_sub28" class="code">function delete_waveform_callback(src,evt)</a></li><li><a href="#_sub29" class="code">function wav2zero(ii,jj)</a></li><li><a href="#_sub30" class="code">function PlotWaveformGUI(src,evt)</a></li><li><a href="#_sub31" class="code">function masterbox_callback(src,evt)</a></li><li><a href="#_sub32" class="code">function iok=check_xunits(iplot,Family)</a></li><li><a href="#_sub33" class="code">function vertical_zoom_callback(src,evt)</a></li><li><a href="#_sub34" class="code">function vertical_offset_callback(src,evt)</a></li><li><a href="#_sub35" class="code">function horizontal_offset_callback(src,evt)</a></li><li><a href="#_sub36" class="code">function horizontal_zoom_callback(src,evt)</a></li><li><a href="#_sub37" class="code">function reset_horizontal_callback(src,evt)</a></li><li><a href="#_sub38" class="code">function autoscale_callback(src,evt)</a></li><li><a href="#_sub39" class="code">function graticule_callback(src,evt)</a></li><li><a href="#_sub40" class="code">function tracescale_callback(src,evt)</a></li><li><a href="#_sub41" class="code">function unitselect_callback(src,evt)</a></li><li><a href="#_sub42" class="code">function reset_waveform_scale(src,evt)</a></li><li><a href="#_sub43" class="code">function vertical_scale_single_callback(src,evt)</a></li><li><a href="#_sub44" class="code">function vertical_offset_single_callback(src,evt)</a></li><li><a href="#_sub45" class="code">function horizontal_offset_single_callback(src,evt)</a></li><li><a href="#_sub46" class="code">function makeSYSstruct</a></li><li><a href="#_sub47" class="code">function makeWAVstruct</a></li><li><a href="#_sub48" class="code">function show_state_callback(src,evt)</a></li><li><a href="#_sub49" class="code">function show_string(field)</a></li><li><a href="#_sub50" class="code">function show_index(field1,comment,field2)</a></li><li><a href="#_sub51" class="code">function closeplotwaveform(src,evt)</a></li><li><a href="#_sub52" class="code">function wavpsm2zero(ii,jj)</a></li><li><a href="#_sub53" class="code">function make_psm_display(src,evt)</a></li><li><a href="#_sub54" class="code">function close_psm(src,evt)</a></li><li><a href="#_sub55" class="code">function get_psm</a></li><li><a href="#_sub56" class="code">function psm_display_callback(src,evt)</a></li><li><a href="#_sub57" class="code">function psm_display(src,evt)</a></li><li><a href="#_sub58" class="code">function clear_psm_display</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% PJ BOussina waveform loader September 11, 2006</span>
0002 <span class="comment">% Just for fun nothing serious</span>
0003 <span class="comment">% If you don't like it too bad, make it yourself</span>
0004 <span class="comment">% Have FUN</span>
0005 
0006 <span class="comment">%==========================</span>
0007 <a name="_sub0" href="#_subfunctions" class="code">function plotwaveform()</a>
0008 <span class="comment">%==========================</span>
0009     <span class="comment">%declare main structures</span>
0010     SYS=[];  WAV=[];  AO=[];  AD=[]; 
0011 
0012     AO=plotwaveform_ao;   <span class="comment">%AO for plotwaveform</span>
0013     AD=plotwaveform_ad;   <span class="comment">%AD for plotwaveform</span>
0014     
0015     <span class="comment">%program parameters</span>
0016     traces={<span class="string">'Trace1'</span> <span class="string">'Trace2'</span>};                <span class="comment">%each waveform has Trace1, Trace2</span>
0017     channels={<span class="string">'ChannelA'</span> <span class="string">'ChannelB'</span>};          <span class="comment">%each trace has Channel A, Channel B</span>
0018     sources={<span class="string">'Monitor'</span> <span class="string">'Golden'</span> <span class="string">'Save'</span> <span class="string">'File'</span>};<span class="comment">%each Channel has 4 sources</span>
0019     <a href="#_sub46" class="code" title="subfunction makeSYSstruct">makeSYSstruct</a>;                             <span class="comment">%initialize SYS structure</span>
0020     nwfm=4;                                    <span class="comment">%number of plots per axis</span>
0021     <a href="#_sub47" class="code" title="subfunction makeWAVstruct">makeWAVstruct</a>;                             <span class="comment">%initialize WAV structure</span>
0022 
0023     background=[0.86 0.85 0.82];               <span class="comment">%graphics color scheme</span>
0024     df=1;                                      <span class="comment">%number of pixels to extend frame</span>
0025     <a href="#_sub30" class="code" title="subfunction PlotWaveformGUI(src,evt)    ">PlotWaveformGUI</a>                            <span class="comment">%build the main GUI</span>
0026     set(SYS.Handles.Figure,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>);
0027     <a href="#_sub53" class="code" title="subfunction make_psm_display(src,evt)">make_psm_display</a>                           <span class="comment">%pulsed-signal monitor system for SPEAR3</span>
0028  
0029     <span class="comment">%initialize timer</span>
0030     pwtimer=timer(<span class="string">'TimerFcn'</span>,@<a href="#_sub20" class="code" title="subfunction single_shot(src,evt,irefresh)   ">single_shot</a>, <span class="string">'Period'</span>, 1,<span class="string">'ExecutionMode'</span>,<span class="string">'fixedRate'</span>,<span class="string">'Tag'</span>,<span class="string">'PlotwaveformTimer'</span>);
0031      
0032 <span class="comment">%========================</span>
0033 <span class="comment">%=== BEGIN FUNCTIONS  ===</span>
0034 <span class="comment">%=========================================</span>
0035     <span class="keyword">function</span> <a href="#_sub1" class="code" title="subfunction launch_timer_callback(src,evt)        ">launch_timer_callback</a>(src,evt)        <span class="comment">%launch_timer_callback</span>
0036 <span class="comment">%=========================================</span>
0037         <span class="keyword">if</span> ~SYS.iLoad
0038             disp(<span class="string">'Load waveform first'</span>)
0039             <span class="keyword">return</span>
0040         <span class="keyword">end</span>
0041         <span class="keyword">if</span> strcmpi(get(src,<span class="string">'String'</span>),<span class="string">'Continuous'</span>)  <span class="comment">%showing 'Continous', turned to 'on'</span>
0042           <span class="keyword">try</span>
0043             start(pwtimer);
0044             set(SYS.Handles.Timer,<span class="string">'String'</span>,<span class="string">'Running'</span>);
0045           <span class="keyword">catch</span>
0046             warndlg(lasterr);
0047             a=timerfindall;
0048             stop(a);
0049             delete(a);
0050             <span class="keyword">return</span>;
0051           <span class="keyword">end</span>
0052         <span class="keyword">elseif</span> strcmpi(get(src,<span class="string">'String'</span>),<span class="string">'Running'</span>)
0053           <span class="keyword">try</span>
0054             stop(pwtimer);
0055             set(SYS.Handles.Timer,<span class="string">'String'</span>,<span class="string">'Continuous'</span>);
0056           <span class="keyword">catch</span>
0057             warndlg(lasterr);
0058             a=timerfindall;
0059             stop(a);
0060             delete(a);
0061             <span class="keyword">return</span>;
0062           <span class="keyword">end</span>
0063         <span class="keyword">end</span>
0064     <span class="keyword">end</span>
0065 
0066 <span class="comment">%======================================</span>
0067    <span class="keyword">function</span> <a href="#_sub2" class="code" title="subfunction select_waveform_callback(src,evt)   ">select_waveform_callback</a>(src,evt)   <span class="comment">%%%%%%%%  select_waveform_callback %%%%%%%%%</span>
0068 <span class="comment">%======================================</span>
0069     val=get(src,<span class="string">'Userdata'</span>);   <span class="comment">%callback of select waveform pushbuttons</span>
0070     SYS.iplot=val(1);  iplot=SYS.iplot;
0071     SYS.iwfm=val(2);   iwfm =SYS.iwfm;
0072     
0073     <span class="keyword">if</span> WAV(iplot,iwfm).iLoad   <span class="comment">%waveform already loaded</span>
0074         <a href="#_sub23" class="code" title="subfunction update_display(src,evt)">update_display</a>;
0075         <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0076             <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;  <span class="comment">%updates psm parameter window</span>
0077         <span class="keyword">end</span>
0078         <span class="keyword">return</span>
0079     <span class="keyword">end</span>
0080     
0081     <span class="comment">%generate figure for loading waveform</span>
0082     SYS.Handles.SelectFigure=figure(<span class="string">'Numbertitle'</span>,<span class="string">'off'</span>,<span class="string">'name'</span>,<span class="string">'Select Waveform'</span>,<span class="keyword">...</span>
0083        <span class="string">'Position'</span>, [112 500 920 300],<span class="string">'resize'</span>,<span class="string">'off'</span>,<span class="string">'Color'</span>,background);
0084         <span class="comment">%set(FigHandles,'Toolbar','none','menubar','none');</span>
0085             
0086     <span class="comment">%make listboxes</span>
0087     <span class="keyword">for</span> ii=1:length(SYS.Families)
0088     allmax=size(AO.(SYS.Families{ii}).Monitor.ChannelNames,1);
0089     SYS.Handles.(SYS.Families{ii})=<span class="keyword">...</span>
0090         uicontrol(<span class="string">'Style'</span>, <span class="string">'listbox'</span>,<span class="string">'BackgroundColor'</span>,background, <span class="string">'String'</span>, {<span class="string">'Select'</span>},<span class="keyword">...</span>
0091         <span class="string">'Position'</span>, [25+150*(ii-1) 60 135 200], <span class="string">'Enable'</span>, <span class="string">'on'</span>,<span class="string">'Value'</span>,[],<span class="string">'Max'</span>,allmax,<span class="string">'Min'</span>,0,<span class="keyword">...</span>
0092         <span class="string">'String'</span>,AO.(SYS.Families{ii}).Monitor.ChannelNames);
0093         uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background, <span class="string">'String'</span>, SYS.Families{ii},<span class="keyword">...</span>
0094         <span class="string">'Position'</span>, [25+150*(ii-1) 260 120 20], <span class="string">'Enable'</span>, <span class="string">'on'</span>,<span class="string">'Value'</span>,1);
0095     <span class="keyword">end</span>
0096     
0097     <span class="comment">%make 'Select' button</span>
0098      uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,background, <span class="string">'String'</span>, <span class="string">'Select'</span>,<span class="keyword">...</span>
0099      <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction process_selection_callback(src,evt)   ">process_selection_callback</a>,<span class="string">'Position'</span>, [300 20 80 20], <span class="string">'Enable'</span>, <span class="string">'on'</span>,<span class="string">'Value'</span>,0);
0100      set(SYS.Handles.SelectFigure,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>);
0101 
0102    <span class="keyword">end</span> <span class="comment">%end select_waveform_callback</span>
0103 
0104 <span class="comment">%======================================</span>
0105     <span class="keyword">function</span> <a href="#_sub3" class="code" title="subfunction process_selection_callback(src,evt)   ">process_selection_callback</a>(src,evt)   <span class="comment">%%%%%%%%  process_selection_callback %%%%%%%%%</span>
0106 <span class="comment">%======================================</span>
0107         <span class="comment">%callback of the 'Select' button on waveform selection subpanel</span>
0108         iplot=SYS.iplot; 
0109         iwfm=SYS.iwfm;
0110         
0111         <span class="comment">%initialize</span>
0112         waveforms=[];
0113         ifams=[];
0114         
0115         <span class="comment">%find which waveform selected</span>
0116         <span class="keyword">for</span> ii=1:length(SYS.Families)
0117         z=get(SYS.Handles.(SYS.Families{ii}),<span class="string">'String'</span>);  <span class="comment">%all strings in listbox</span>
0118         val=get(SYS.Handles.(SYS.Families{ii}),<span class="string">'value'</span>);
0119         str=z(val,:);  <span class="comment">%specific string if chosen</span>
0120         <span class="keyword">if</span> ~isempty(str)   <span class="comment">%found one</span>
0121             ival=val;
0122             ifams=[ifams; ii];
0123             waveforms=[waveforms; str];  <span class="comment">%string for selected value</span>
0124         <span class="keyword">end</span>
0125         <span class="keyword">end</span>
0126         <span class="keyword">if</span> size(waveforms,1)&gt;1  
0127             waveform=waveforms(<span class="keyword">end</span>,:);   <span class="comment">%later may have multiple waveforms</span>
0128             ifam=ifams(end);
0129         <span class="keyword">else</span>
0130             waveform=waveforms;
0131             ifam=ifams;
0132         <span class="keyword">end</span>
0133         
0134         <span class="comment">%check timebase is consistent with other waveforms in this graph</span>
0135         <span class="keyword">if</span> isempty(SYS.Families(ifam))
0136           errordlg(<span class="string">'Warning: No waveform selected'</span>,<span class="string">'plotwaveform'</span>)
0137         <span class="keyword">return</span>
0138         <span class="keyword">end</span>
0139 
0140         iok=<a href="#_sub32" class="code" title="subfunction iok=check_xunits(iplot,Family)">check_xunits</a>(iplot,SYS.Families(ifam));
0141         <span class="keyword">if</span> ~iok
0142           errordlg(<span class="string">'Invalid waveform selection - inconsistent time base. Choose again.'</span>,<span class="string">'Plotwaveform timebase error'</span>)
0143         <span class="keyword">return</span>
0144         <span class="keyword">end</span>
0145 
0146         <span class="comment">%build the WAV structure</span>
0147         <a href="#_sub27" class="code" title="subfunction clear_plot(iplot,iwfm)">clear_plot</a>(iplot,iwfm);
0148         <a href="#_sub29" class="code" title="subfunction wav2zero(ii,jj)">wav2zero</a>(iplot,iwfm);
0149         WAV(iplot,iwfm).ChannelName=deblank(waveform);  <span class="comment">%channel name</span>
0150         waveform=AO.(SYS.Families{ifam}).CommonNames(get(SYS.Handles.(SYS.Families{ifam}),<span class="string">'value'</span>),:); <span class="comment">%common name from AO</span>
0151         WAV(iplot,iwfm).Family=SYS.Families{ifam}; <span class="comment">%family</span>
0152         WAV(iplot,iwfm).FamilyType=SYS.FamilyTypes{ifam}; <span class="comment">%type e.g. PSM, MCORR, etc</span>
0153         WAV(iplot,iwfm).CommonName=deblank(AO.(SYS.Families{ifam}).CommonNames(ival,:)); <span class="comment">%common name</span>
0154         set(SYS.Handles.Select(iplot,iwfm),<span class="string">'String'</span>,waveform,<span class="string">'ForegroundColor'</span>,  WAV(iplot,iwfm).Color);  <span class="comment">%display common name</span>
0155         set(SYS.Handles.Display(iplot,iwfm),<span class="string">'Value'</span>,1) <span class="comment">%checkbox for display 'on'</span>
0156         WAV(iplot,iwfm).iLoad=1;       <span class="comment">%status bit for waveform load</span>
0157         WAV(iplot,iwfm).iDisplay=1;    <span class="comment">%status bit for display</span>
0158         WAV(iplot,iwfm).Monitor.XDataUnits=AO.(char(SYS.Families(ifam))).XUnits;  <span class="comment">%usec, etc</span>
0159         WAV(iplot,iwfm).Monitor.RawDataUnits=deblank(AO.(char(SYS.Families(ifam))).RawYUnits(ival,:));  <span class="comment">%units for raw signal (e.g. Volts)</span>
0160         WAV(iplot,iwfm).Monitor.EngDataUnits=deblank(AO.(char(SYS.Families(ifam))).EngYUnits(ival,:));  <span class="comment">%units for Eng signal (e.g. Pwr)</span>
0161 
0162         <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)   <span class="comment">%acquire conversion factors from PV's</span>
0163              <a href="#_sub52" class="code" title="subfunction wavpsm2zero(ii,jj)">wavpsm2zero</a>(iplot,iwfm);
0164              WAV(iplot,iwfm).Monitor.VoltOffset=<a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([WAV(iplot,iwfm).ChannelName <span class="string">'Conv.G'</span>]); 
0165              conv={<span class="string">'A'</span>; <span class="string">'B'</span>; <span class="string">'C'</span>; <span class="string">'D'</span>; <span class="string">'E'</span>; <span class="string">'F'</span>;};
0166              <span class="keyword">for</span> ii=1:6 <span class="comment">%A,B,C,D,E,F,G - Polynomial conversion factors from Volt to EGU (G=voltage offset)</span>
0167              WAV(iplot,iwfm).Monitor.PolyConv(ii)=<a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([WAV(iplot,iwfm).ChannelName <span class="string">'Conv.'</span> conv{ii}]); 
0168              <span class="keyword">end</span>
0169              WAV(iplot,iwfm).Monitor.RawSignal=AO.(char(SYS.Families(ifam))).RawSignal;  <span class="comment">%VoltFst</span>
0170              WAV(iplot,iwfm).Monitor.EngSignal=AO.(char(SYS.Families(ifam))).EngSignal;  <span class="comment">%Fst</span>
0171              WAV(iplot,iwfm).Monitor.XDataStep=AO.(WAV(iplot,iwfm).Family).Timebase(ival);
0172              NORD=<a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([WAV(iplot,iwfm).ChannelName <span class="string">'Waveform.NORD'</span>]);
0173              WAV(iplot,iwfm).Monitor.XData=WAV(iplot,iwfm).Monitor.XDataStep*[1:NORD]';
0174         <span class="keyword">else</span>
0175             errordlg([<span class="string">'Generate horizontal time base in select_waveform_callback for '</span> SYS.Machine])
0176             <span class="comment">%WAV(iplot,iwfm).Monitor.XData=  %needed for plotting</span>
0177             <span class="comment">%WAV(iplot,iwfm).Monitor.XDataStep=   %needed for horizontal scroll gui</span>
0178         <span class="keyword">end</span>
0179         
0180         SYS.iLoad=1;
0181         set(SYS.Handles.Source(1,1),<span class="string">'Value'</span>,1);      <span class="comment">%select radio button for Source(1)= 'Monitor'</span>
0182         set(SYS.Handles.Source(2,1),<span class="string">'Value'</span>,1);      <span class="comment">%select radio button for Source(2)= 'Monitor'</span>
0183         set(SYS.Handles.Trace1Channel(1),<span class="string">'Value'</span>,1);  <span class="comment">%select radio button for channel 'A'</span>
0184         set(SYS.Handles.Trace2State,<span class="string">'Value'</span>,0)
0185         t=SYS.Families(ifam);
0186         set(get(SYS.Handles.Plot(iplot),<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,[<span class="string">'Time ('</span> AO.(t{1}).XUnits <span class="string">' )'</span>])
0187         <a href="#_sub25" class="code" title="subfunction waveform_name(src,evt)    ">waveform_name</a>; <span class="comment">%displays waveform name</span>
0188        
0189         <a href="#_sub18" class="code" title="subfunction golden2memory(src,evt)  ">golden2memory</a>;  <span class="comment">%load Golden file if available</span>
0190         
0191         <span class="keyword">if</span> ishandle(SYS.Handles.SelectFigure)
0192         close(SYS.Handles.SelectFigure)
0193         <span class="keyword">end</span>
0194         
0195         <a href="#_sub20" class="code" title="subfunction single_shot(src,evt,irefresh)   ">single_shot</a>;
0196         <a href="#_sub8" class="code" title="subfunction monitor2save(src,evt)    ">monitor2save</a>;   <span class="comment">%save reference automatically at load time</span>
0197         <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0198           <span class="keyword">if</span> ~ishandle(SYS.PSMHandles.Figure)  <span class="comment">%if window does not exist make one</span>
0199              <a href="#_sub53" class="code" title="subfunction make_psm_display(src,evt)">make_psm_display</a>;
0200           <span class="keyword">end</span>
0201 
0202           <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;  <span class="comment">%updates psm parameter window, single_shot does not look at psm</span>
0203         <span class="keyword">end</span>
0204     <span class="keyword">end</span>
0205 
0206 <span class="comment">%======================================</span>
0207    <span class="keyword">function</span> <a href="#_sub4" class="code" title="subfunction update_channel_callback(src,evt)   ">update_channel_callback</a>(src,evt)   <span class="comment">%%%%%%%%  update_channel_callback %%%%%%%%%</span>
0208 <span class="comment">%======================================</span>
0209        <span class="comment">%radiobuttion selection of channel A, B or A-B for Trace1 or Trace2</span>
0210        val=get(src,<span class="string">'Userdata'</span>);
0211        tr=val(1);    <span class="comment">%1,2   = Trace1 or Trace2</span>
0212        ch=val(2);    <span class="comment">%1,2,3 = Channel A, B or A-B</span>
0213        iplot=SYS.iplot;
0214        iwfm=SYS.iwfm;
0215        <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; 
0216            errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Select Channel'</span>);  
0217            set(SYS.Handles.([traces{tr} <span class="string">'Channel'</span>])(ch),<span class="string">'Value'</span>,0);
0218            <span class="keyword">return</span>; 
0219        <span class="keyword">end</span>
0220    
0221        <span class="keyword">for</span> ii=1:3   <span class="comment">%turn off all Channel radiobuttons for selected Trace</span>
0222        set(SYS.Handles.([traces{tr} <span class="string">'Channel'</span>])(ii),<span class="string">'Value'</span>,0)
0223        <span class="keyword">end</span>
0224        <span class="keyword">if</span> tr==2 &amp;&amp; ~get(SYS.Handles.Trace2State,<span class="string">'Value'</span>)    <span class="comment">%user chose Trace2 with radio button 'off'</span>
0225            val=get(SYS.Handles.([traces{tr} <span class="string">'Channel'</span>])(ch),<span class="string">'Value'</span>);  <span class="comment">%find value of radiobutton pushed</span>
0226            set(SYS.Handles.([traces{tr} <span class="string">'Channel'</span>])(ch),<span class="string">'Value'</span>,mod(1,val));   <span class="comment">%put it back</span>
0227            WAV(iplot,iwfm).Trace2Channel=ch;  <span class="comment">%update channel selection</span>
0228            <span class="keyword">return</span>
0229        <span class="keyword">end</span>
0230 
0231        set(src,<span class="string">'Value'</span>,1)
0232        WAV(iplot,iwfm).([traces{tr} <span class="string">'Channel'</span>])=ch;  <span class="comment">%1,2 or 3 for A, B or A-B</span>
0233        WAV(iplot,iwfm).([traces{tr} <span class="string">'State'</span>])=1;
0234        <a href="#_sub19" class="code" title="subfunction single_shot_callback(src,evt)">single_shot_callback</a>;    <span class="comment">%defaults to update</span>
0235    <span class="keyword">end</span>
0236 
0237 <span class="comment">%========================================</span>
0238    <span class="keyword">function</span> <a href="#_sub5" class="code" title="subfunction trace2state_callback(src,evt)  ">trace2state_callback</a>(src,evt)  <span class="comment">%trace2state_callback</span>
0239 <span class="comment">%========================================</span>
0240         <span class="comment">%radio button toggle on/off for Trace2</span>
0241         iplot=SYS.iplot;
0242         iwfm=SYS.iwfm;
0243 
0244         <span class="keyword">if</span> WAV(iplot,iwfm).iDisplay==0 || WAV(iplot,iwfm).iLoad==0  <span class="comment">%flag to indicate waveform loaded)</span>
0245            errordlg(<span class="string">'Select or Load waveform first'</span>,<span class="string">'Load waveform'</span>)
0246            set(SYS.Handles.Trace2State,<span class="string">'Value'</span>,0);
0247            <span class="keyword">return</span>
0248         <span class="keyword">end</span>
0249 
0250         val=get(SYS.Handles.Trace2State,<span class="string">'Value'</span>);
0251         <span class="keyword">if</span> val   <span class="comment">%user turned it 'on'</span>
0252             WAV(iplot,iwfm).Trace2State=1;
0253             <a href="#_sub23" class="code" title="subfunction update_display(src,evt)">update_display</a>
0254         <span class="keyword">else</span>     <span class="comment">%user turned it 'off'</span>
0255           WAV(iplot,iwfm).Trace2State=0;
0256           set(SYS.Handles.Trace2(iplot,iwfm),<span class="string">'XData'</span>,[],<span class="string">'YData'</span>,[]);
0257 
0258         <span class="keyword">end</span>   
0259     <span class="keyword">end</span>
0260 
0261 <span class="comment">%======================================</span>
0262    <span class="keyword">function</span> <a href="#_sub6" class="code" title="subfunction update_source_callback(src,evt)    ">update_source_callback</a>(src,evt)    <span class="comment">%%%%%%%%  update_source_callback %%%%%%%%%</span>
0263 <span class="comment">%======================================</span>
0264        <span class="comment">%selects source (Monitor/Save/Golden/File) via radiobutton for Channel A or Channel B</span>
0265        val=get(src,<span class="string">'Userdata'</span>);  
0266        ch=val{1};    <span class="comment">%1,2   = ChannelA or ChannelB</span>
0267        isr=val{2};   <span class="comment">%index of source radio button</span>
0268        iplot=SYS.iplot;
0269        iwfm=SYS.iwfm;
0270 
0271        <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; 
0272            errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Select Channel'</span>);
0273            set(src,<span class="string">'Value'</span>,0)
0274            <span class="keyword">return</span>; 
0275        <span class="keyword">end</span>
0276 
0277 
0278        <span class="keyword">switch</span> isr
0279            <span class="keyword">case</span> 2 <span class="comment">%Golden</span>
0280                <span class="keyword">if</span> ~WAV(iplot,iwfm).iGolden
0281                errordlg(<span class="string">'Load golden waveform first'</span>,<span class="string">'Data from Golden'</span>)
0282                set(src,<span class="string">'Value'</span>,0)  <span class="comment">%put radio button back to zero</span>
0283                <span class="keyword">return</span>
0284                <span class="keyword">end</span>
0285            <span class="keyword">case</span> 3  <span class="comment">%Save</span>
0286                <span class="keyword">if</span> ~WAV(iplot,iwfm).iSave
0287                errordlg(<span class="string">'Save reference waveform first'</span>,<span class="string">'Saved data'</span>)
0288                set(src,<span class="string">'Value'</span>,0)  <span class="comment">%put radio button back to zero</span>
0289                <span class="keyword">return</span>
0290                <span class="keyword">end</span>
0291            <span class="keyword">case</span> 4 <span class="comment">%File</span>
0292                <span class="keyword">if</span> ~WAV(iplot,iwfm).iFile
0293                errordlg(<span class="string">'Load waveform from file first'</span>,<span class="string">'Data from file'</span>)
0294                set(src,<span class="string">'Value'</span>,0)  <span class="comment">%put radio button back to zero</span>
0295                <span class="keyword">return</span>
0296                <span class="keyword">end</span>
0297 
0298        <span class="keyword">end</span>
0299        
0300        <span class="keyword">for</span> ii=1:4   <span class="comment">%turn off all Source radiobuttons for selected Channel</span>
0301        set(SYS.Handles.Source(ch,ii),<span class="string">'Value'</span>,0)
0302        <span class="keyword">end</span>
0303 
0304        set(src,<span class="string">'Value'</span>,1)
0305        <span class="comment">%both Trace1 and Trace2 have same SourceA and SourceB</span>
0306        <span class="keyword">if</span> ch==1
0307        WAV(iplot,iwfm).ChannelA=isr;
0308        <span class="keyword">elseif</span> ch==2
0309        WAV(iplot,iwfm).ChannelB=isr;
0310        <span class="keyword">end</span>
0311        <a href="#_sub19" class="code" title="subfunction single_shot_callback(src,evt)">single_shot_callback</a>;  <span class="comment">%defaults to update</span>
0312    <span class="keyword">end</span>
0313 
0314 <span class="comment">%======================================</span>
0315    <span class="keyword">function</span> <a href="#_sub7" class="code" title="subfunction monitor2save_callback(src,evt)    ">monitor2save_callback</a>(src,evt)    <span class="comment">%%%%%%%%  monitor2save_callback %%%%%%%%%</span>
0316 <span class="comment">%======================================</span>
0317        <a href="#_sub8" class="code" title="subfunction monitor2save(src,evt)    ">monitor2save</a>(src,evt);
0318    <span class="keyword">end</span>
0319 
0320 <span class="comment">%======================================</span>
0321    <span class="keyword">function</span> <a href="#_sub8" class="code" title="subfunction monitor2save(src,evt)    ">monitor2save</a>(src,evt)    <span class="comment">%%%%%%%%  monitor2save %%%%%%%%%</span>
0322 <span class="comment">%======================================</span>
0323        iplot=SYS.iplot;
0324        iwfm=SYS.iwfm;
0325        <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Save Data'</span>);  <span class="keyword">return</span>; <span class="keyword">end</span>
0326        WAV(iplot,iwfm).Save=WAV(iplot,iwfm).Monitor;
0327        WAV(iplot,iwfm).Save.TimeStamp=sprintf(<span class="string">'%s'</span>, datestr(clock,31));
0328        disp([sprintf(<span class="string">'%s'</span>, datestr(clock,31)) <span class="string">' Waveform data '</span> WAV(iplot,iwfm).CommonName <span class="string">' saved to memory '</span>])
0329        WAV(iplot,iwfm).iSave=1;
0330        <span class="keyword">for</span> kk=1:2 set(SYS.Handles.Source(kk,3),<span class="string">'ToolTipString'</span>,[<span class="string">'Data saved: '</span> WAV(iplot,iwfm).Save.TimeStamp]); <span class="keyword">end</span>
0331    <span class="keyword">end</span>
0332 
0333 <span class="comment">%======================================</span>
0334    <span class="keyword">function</span> <a href="#_sub9" class="code" title="subfunction save2file_callback(src,evt)     ">save2file_callback</a>(src,evt)     <span class="comment">%%%%%%%%  save2file_callback %%%%%%%%%%</span>
0335 <span class="comment">%======================================</span>
0336        <a href="#_sub10" class="code" title="subfunction save2file(src,evt)     ">save2file</a>
0337    <span class="keyword">end</span>
0338 
0339 <span class="comment">%======================================</span>
0340    <span class="keyword">function</span> <a href="#_sub10" class="code" title="subfunction save2file(src,evt)     ">save2file</a>(src,evt)     <span class="comment">%%%%%%%%  save2file %%%%%%%%%%</span>
0341 <span class="comment">%======================================</span>
0342        iplot=SYS.iplot;
0343        iwfm=SYS.iwfm;
0344        <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Save to File'</span>);  <span class="keyword">return</span>; <span class="keyword">end</span>
0345 
0346        DirStart = pwd;
0347        Family=WAV(iplot,iwfm).Family;   <span class="comment">%family</span>
0348        DirectoryName=AD.Directory.PlotWaveform.(Family); <span class="comment">%directory</span>
0349        Name=WAV(iplot,iwfm).CommonName;     <span class="comment">%signal common name</span>
0350        FileName = appendtimestamp(Name, clock);
0351        cd(DirectoryName);
0352        
0353        Waveform.(Name)=WAV(iplot,iwfm).Monitor
0354        Waveform.(Name).TimeStamp=sprintf(<span class="string">'%s'</span>, datestr(clock,31));
0355        save(FileName, <span class="string">'Waveform'</span>);
0356        disp([sprintf(<span class="string">'%s'</span>, datestr(clock,31)) <span class="string">' Waveform File [ '</span> FileName <span class="string">' ] saved to directory '</span> DirectoryName])
0357        cd(DirStart);
0358    <span class="keyword">end</span>
0359 
0360 <span class="comment">%======================================</span>
0361    <span class="keyword">function</span> <a href="#_sub11" class="code" title="subfunction save2golden_callback(src,evt)   ">save2golden_callback</a>(src,evt)   <span class="comment">%%%%%%%%  save2golden_callback %%%%%%%%%%</span>
0362 <span class="comment">%======================================</span>
0363        iplot=SYS.iplot;
0364        iwfm=SYS.iwfm;
0365        <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Save to Golden'</span>);  <span class="keyword">return</span>; <span class="keyword">end</span>
0366        <a href="#_sub10" class="code" title="subfunction save2file(src,evt)     ">save2file</a>
0367        
0368        DirStart = pwd;
0369        Family=WAV(iplot,iwfm).Family;   <span class="comment">%family</span>
0370        DirectoryName=AD.Directory.PlotWaveform.(Family); <span class="comment">%directory</span>
0371        cd(DirectoryName) 
0372        Name=WAV(iplot,iwfm).CommonName;     <span class="comment">%signal common name</span>
0373        FileName = [<span class="string">'Golden_'</span> Name];
0374        
0375        iexist=exist([FileName <span class="string">'.mat'</span>],<span class="string">'file'</span>);
0376        <span class="keyword">if</span> iexist
0377            answer=questdlg([<span class="string">'Golden waveform file [ '</span> FileName <span class="string">'.mat ] already exists - overwrite?'</span>],<span class="string">'Golden file'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'Yes'</span>);
0378            <span class="keyword">if</span> strcmpi(answer,<span class="string">'no'</span>)
0379              disp([sprintf(<span class="string">'%s'</span>, datestr(clock,31)) <span class="string">' No Golden file written '</span> ]);
0380              <span class="keyword">return</span>
0381            <span class="keyword">end</span>
0382        <span class="keyword">end</span>
0383 
0384        Golden.(Name)=WAV(iplot,iwfm).Monitor;
0385        Golden.(Name).TimeStamp=sprintf(<span class="string">'%s'</span>, datestr(clock,31));
0386        save(FileName, <span class="string">'Golden'</span>);
0387        disp([sprintf(<span class="string">'%s'</span>, datestr(clock,31)) <span class="string">' Golden File [ '</span> FileName <span class="string">'.mat ] saved to directory '</span> DirectoryName])
0388        <span class="comment">%save a copy to backup</span>
0389        DirectoryName=[DirectoryName <span class="string">'Golden_Backup'</span>];
0390        cd([DirectoryName]);
0391        FileName=appendtimestamp(FileName, clock);
0392        save(FileName,<span class="string">'Golden'</span>)
0393        disp([sprintf(<span class="string">'%s'</span>, datestr(clock,31)) <span class="string">' Golden File [ '</span> FileName <span class="string">'.mat ] saved to directory '</span> DirectoryName])
0394        cd(DirStart);
0395    <span class="keyword">end</span>
0396 
0397 <span class="comment">%======================================</span>
0398    <span class="keyword">function</span> <a href="#_sub12" class="code" title="subfunction all_checkbox_callback(srv,evt)   ">all_checkbox_callback</a>(srv,evt)   <span class="comment">%all_checkbox_callback</span>
0399 <span class="comment">%======================================</span>
0400         iplot=SYS.iplot;
0401         iwfm=SYS.iwfm;
0402         <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; 
0403             errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Write All to Workspace'</span>);
0404             set(SYS.Handles.all2workspace,<span class="string">'Value'</span>,0);
0405         <span class="keyword">end</span>
0406    <span class="keyword">end</span>
0407 
0408  <span class="comment">%======================================</span>
0409   <span class="keyword">function</span> <a href="#_sub13" class="code" title="subfunction all2workspace">all2workspace</a>
0410  <span class="comment">%======================================</span>
0411        iplot=SYS.iplot;
0412         iwfm=SYS.iwfm;
0413         <span class="keyword">for</span> ii=1:2
0414             <span class="keyword">for</span> jj=1:nwfm
0415                 <span class="keyword">if</span> WAV(ii,jj).iLoad
0416                     SYS.iplot=ii;
0417                     SYS.iwfm=jj;
0418                     <a href="#_sub15" class="code" title="subfunction write2workspace(src,evt)     ">write2workspace</a>
0419                 <span class="keyword">end</span>
0420             <span class="keyword">end</span>
0421         <span class="keyword">end</span>
0422           SYS.iplot=iplot;
0423           SYS.iwfm=iwfm;
0424     <span class="keyword">end</span>
0425 
0426 <span class="comment">%=============================================</span>
0427     <span class="keyword">function</span> <a href="#_sub14" class="code" title="subfunction write2workspace_callback(src,evt)   ">write2workspace_callback</a>(src,evt)   <span class="comment">%write2workspace_callback</span>
0428 <span class="comment">%=============================================</span>
0429       <a href="#_sub15" class="code" title="subfunction write2workspace(src,evt)     ">write2workspace</a>(src,evt)
0430     <span class="keyword">end</span>
0431 
0432 <span class="comment">%======================================</span>
0433     <span class="keyword">function</span> <a href="#_sub15" class="code" title="subfunction write2workspace(src,evt)     ">write2workspace</a>(src,evt)     <span class="comment">%write2workspace</span>
0434 <span class="comment">%======================================</span>
0435        <span class="comment">%write waveform data structure to workspace</span>
0436         iplot=SYS.iplot;
0437         iwfm=SYS.iwfm;
0438         <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Write to Workspace'</span>);  <span class="keyword">return</span>; <span class="keyword">end</span>
0439 
0440         <span class="keyword">if</span> get(SYS.Handles.all2workspace,<span class="string">'Value'</span>)
0441             set(SYS.Handles.all2workspace,<span class="string">'Value'</span>,0)
0442             <a href="#_sub13" class="code" title="subfunction all2workspace">all2workspace</a>;
0443             set(SYS.Handles.all2workspace,<span class="string">'Value'</span>,1)
0444             <span class="keyword">return</span>
0445         <span class="keyword">end</span>
0446         
0447         Name=WAV(iplot,iwfm).CommonName;     <span class="comment">%signal common name</span>
0448         Struct.Family=WAV(iplot,iwfm).Family;
0449         Struct.CommonName=Name;
0450         source={<span class="string">'Monitor'</span>;};
0451         <span class="keyword">if</span> WAV(iplot,iwfm).iGolden; source=[source <span class="string">'Golden'</span>]; <span class="keyword">end</span>
0452         <span class="keyword">if</span> WAV(iplot,iwfm).iSave; source=[source <span class="string">'Save'</span>]; <span class="keyword">end</span>
0453         <span class="keyword">if</span> WAV(iplot,iwfm).iFile; source=[source <span class="string">'File'</span>]; <span class="keyword">end</span>
0454         <span class="keyword">for</span> kk=1:size(source,2)  <span class="comment">%loop over available sources (Monitor, Golden, Save, File</span>
0455            Struct.(source{kk})=WAV(iplot,iwfm).(source{kk});
0456            Struct.TimeStamp=sprintf(<span class="string">'%s'</span>, datestr(clock,31));
0457         <span class="keyword">end</span>                  
0458         assignin(<span class="string">'base'</span>,Name,Struct);
0459         disp([sprintf(<span class="string">'%s'</span>, datestr(clock,31)) <span class="string">' Waveform data for [ '</span> Name <span class="string">' ] written to MATLAB workspace'</span>])
0460     <span class="keyword">end</span>
0461 
0462 <span class="comment">%======================================</span>
0463   <span class="keyword">function</span> <a href="#_sub16" class="code" title="subfunction file2memory_callback(src,evt)    ">file2memory_callback</a>(src,evt)    <span class="comment">%%%%%%%%  file2memory_callback %%%%%%%%%</span>
0464 <span class="comment">%======================================</span>
0465        <span class="comment">%load the file</span>
0466        iplot=SYS.iplot;
0467        iwfm=SYS.iwfm;
0468        <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Load Data File'</span>);  <span class="keyword">return</span>; <span class="keyword">end</span>
0469 
0470        DirStart = pwd;
0471        Family=WAV(iplot,iwfm).Family;   <span class="comment">%family</span>
0472        DirectoryName=AD.Directory.PlotWaveform.(Family);  <span class="comment">%directory</span>
0473        CommonName=WAV(iplot,iwfm).CommonName;     <span class="comment">%signal common name</span>
0474        cd(DirectoryName)
0475        FileName=uigetfile([CommonName <span class="string">'*.mat'</span>], <span class="string">'Select file'</span>);
0476         <span class="keyword">try</span>
0477          load(FileName);
0478          WAV(iplot,iwfm).File=Waveform.(CommonName);
0479          WAV(iplot,iwfm).File.FileName=FileName;
0480          WAV(iplot,iwfm).iFile=1;
0481          disp([sprintf(<span class="string">'%s'</span>, datestr(clock,31)) <span class="string">' Waveform file [ '</span> FileName <span class="string">' ] loaded to memory'</span>])
0482          <span class="keyword">for</span> kk=1:2 
0483              set(SYS.Handles.Source(kk,4),<span class="string">'ToolTipString'</span>,[<span class="string">'File loaded: '</span> WAV(iplot,iwfm).File.FileName]); 
0484          <span class="keyword">end</span>
0485          <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0486            <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;  <span class="comment">%updates psm parameter window</span>
0487          <span class="keyword">end</span>
0488        <span class="keyword">catch</span>
0489          errordlg(<span class="string">'Warning: Problem with loading File'</span>, <span class="string">'Load File'</span>);
0490        <span class="keyword">end</span>
0491        cd(DirStart);
0492     <span class="keyword">end</span>         
0493                   
0494 <span class="comment">%======================================</span>
0495     <span class="keyword">function</span> <a href="#_sub17" class="code" title="subfunction golden2memory_callback(src,evt)  ">golden2memory_callback</a>(src,evt)  <span class="comment">%%%%%%%%  golden2memory_callback %%%%%%%</span>
0496 <span class="comment">%======================================</span>
0497       <a href="#_sub18" class="code" title="subfunction golden2memory(src,evt)  ">golden2memory</a>(src,evt)
0498     <span class="keyword">end</span>
0499 
0500 <span class="comment">%======================================</span>
0501     <span class="keyword">function</span> <a href="#_sub18" class="code" title="subfunction golden2memory(src,evt)  ">golden2memory</a>(src,evt)  <span class="comment">%%%%%%%%  golden2memory %%%%%%%</span>
0502 <span class="comment">%======================================</span>
0503 <span class="comment">%load  golden file</span>
0504        iplot=SYS.iplot;
0505        iwfm=SYS.iwfm;
0506        <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Load Golden'</span>);  <span class="keyword">return</span>; <span class="keyword">end</span>
0507 
0508        DirStart = pwd;
0509        Family=WAV(iplot,iwfm).Family;
0510        CommonName=WAV(iplot,iwfm).CommonName;
0511        DirectoryName=AD.Directory.PlotWaveform.(Family); <span class="comment">%directory</span>
0512 
0513        <span class="comment">%[DirectoryName, ErrorFlag] = gotodirectory(DirectoryName);</span>
0514        cd(DirectoryName)
0515        <span class="comment">%look for golden file</span>
0516        FileName = [<span class="string">'Golden_'</span> CommonName <span class="string">'.mat'</span>];
0517        <span class="keyword">if</span> exist(FileName,<span class="string">'file'</span>);
0518         <span class="keyword">try</span>
0519          load(FileName);
0520          WAV(iplot,iwfm).Golden=Golden.(CommonName);
0521          WAV(iplot,iwfm).iGolden=1;
0522          <span class="keyword">for</span> ii=1:4   <span class="comment">%turn off all Source radiobuttons for ChannelB</span>
0523            set(SYS.Handles.Source(2,ii),<span class="string">'Value'</span>,0)
0524          <span class="keyword">end</span>
0525          set(SYS.Handles.Source(2,2),<span class="string">'Value'</span>,1);      <span class="comment">%select radio button for Source(2)= 'Golden'</span>
0526          WAV(iplot,iwfm).ChannelB=2;  <span class="comment">%default Bhannel B to Golden</span>
0527          disp([<span class="string">'Golden Waveform file [ '</span> FileName <span class="string">' ] loaded to memory'</span>])
0528          <span class="keyword">for</span> kk=1:2 
0529              set(SYS.Handles.Source(kk,2),<span class="keyword">...</span>
0530                  <span class="string">'ToolTipString'</span>,[<span class="string">'Golden Timestamp '</span> WAV(iplot,iwfm).Golden.TimeStamp]); 
0531          <span class="keyword">end</span>
0532          <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0533            <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;  <span class="comment">%updates psm parameter window</span>
0534          <span class="keyword">end</span>
0535 
0536          <span class="keyword">catch</span>
0537            errordlg(<span class="string">'Warning: Problem with loading Golden File'</span>, <span class="string">'Load Golden File'</span>);
0538          <span class="keyword">end</span>
0539        <span class="keyword">else</span>
0540            disp([CommonName <span class="string">': No Golden file available'</span>])
0541        <span class="keyword">end</span>
0542        cd(DirStart);
0543     <span class="keyword">end</span>
0544  
0545 <span class="comment">%=========================================</span>
0546     <span class="keyword">function</span> <a href="#_sub19" class="code" title="subfunction single_shot_callback(src,evt)">single_shot_callback</a>(src,evt)
0547 <span class="comment">%=========================================</span>
0548 <span class="comment">%callback of single_shot pushbutton</span>
0549       <span class="keyword">if</span> strcmpi(pwtimer.Running,<span class="string">'on'</span>)  <span class="comment">%timer running</span>
0550           <span class="keyword">return</span>
0551       <span class="keyword">end</span>
0552       <a href="#_sub20" class="code" title="subfunction single_shot(src,evt,irefresh)   ">single_shot</a>;
0553       <a href="#_sub25" class="code" title="subfunction waveform_name(src,evt)    ">waveform_name</a>;
0554       iplot=SYS.iplot;
0555       iwfm=SYS.iwfm;
0556       <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0557           <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;  <span class="comment">%updates psm parameter window</span>
0558       <span class="keyword">end</span>
0559     <span class="keyword">end</span>
0560 
0561 <span class="comment">%=========================================</span>
0562    <span class="keyword">function</span> <a href="#_sub20" class="code" title="subfunction single_shot(src,evt,irefresh)   ">single_shot</a>(src,evt,irefresh)   <span class="comment">%%%%%%%%  single_shot %%%%%%%%%</span>
0563 <span class="comment">%=========================================</span>
0564 <span class="comment">%plot selected traces for selected signals on both axes</span>
0565        <span class="keyword">if</span> ~exist(<span class="string">'irefresh'</span>,<span class="string">'var'</span>); irefresh=1; <span class="keyword">end</span>  <span class="comment">%default to acquiring fresh data</span>
0566        <span class="keyword">for</span> ii=1:2   <span class="comment">%axes index</span>
0567          <span class="keyword">for</span> jj=1:nwfm  <span class="comment">%waveform index</span>
0568              <span class="keyword">if</span>   WAV(ii,jj).iDisplay
0569                 <span class="comment">%check to see if Monitor signal required</span>
0570                 sourceA=WAV(ii,jj).ChannelA;   <span class="comment">%sources are 1,2,3,4 (Monitor, Save, Golden, File)</span>
0571                 sourceB=WAV(ii,jj).ChannelB;
0572 
0573                 <span class="keyword">if</span> (sourceA==1 || sourceB==1) &amp;&amp; irefresh
0574                   <span class="keyword">if</span> strcmpi(WAV(ii,jj).FamilyType,<span class="string">'PSM'</span>)
0575                     <a href="#_sub21" class="code" title="subfunction getpv_spear3(iplot,iwfm)    ">getpv_spear3</a>(ii,jj);
0576                   <span class="keyword">else</span>
0577                     WAV(ii,jj).Monitor.RawData=<a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>(WAV(ii,jj).ChannelName);
0578                     <span class="keyword">if</span> SYS.Units
0579                         <span class="comment">%WAV(ii,jj).Monitor.EngData=convert to Engineering Units</span>
0580                     <span class="keyword">end</span>
0581                     WAV(ii,jj).Monitor.TimeStamp=sprintf(<span class="string">'%s'</span>, datestr(clock,31));
0582                   <span class="keyword">end</span>
0583                 <span class="keyword">end</span>
0584                 <span class="keyword">for</span> kk=1:2;  <span class="comment">%trace index</span>
0585                  <span class="keyword">if</span> WAV(ii,jj).([traces{kk} <span class="string">'State'</span>]);   <span class="comment">%trace is on for plotting</span>
0586                      <span class="keyword">switch</span> WAV(ii,jj).([traces{kk} <span class="string">'Channel'</span>])  <span class="comment">%which channel(s) for trace</span>
0587                          <span class="keyword">case</span> 1   <span class="comment">%A only</span>
0588                             <span class="keyword">if</span> SYS.Units==0   <span class="comment">%0 for raw units, 1 for converted/engineering units</span>
0589                             yd=WAV(ii,jj).(sources{sourceA}).RawData;
0590                             <span class="keyword">else</span>
0591                             yd=WAV(ii,jj).(sources{sourceA}).EngData;
0592                             <span class="keyword">end</span>
0593                          <span class="keyword">case</span> 2   <span class="comment">%B only</span>
0594                             <span class="keyword">if</span> SYS.Units==0
0595                             yd=WAV(ii,jj).(sources{sourceB}).RawData;
0596                             <span class="keyword">else</span>
0597                             yd=WAV(ii,jj).(sources{sourceB}).EngData;
0598                             <span class="keyword">end</span>
0599                          <span class="keyword">case</span> 3   <span class="comment">%A-B</span>
0600                             <span class="keyword">if</span> SYS.Units==0
0601                             yd=WAV(ii,jj).(sources{sourceA}).RawData-WAV(ii,jj).(sources{sourceB}).RawData;
0602                             <span class="keyword">else</span>
0603                             yd=WAV(ii,jj).(sources{sourceA}).EngData-WAV(ii,jj).(sources{sourceB}).EngData;
0604                             <span class="keyword">end</span>
0605                      <span class="keyword">end</span>  <span class="comment">%end trace display type switchyard</span>
0606                      WAV(ii,jj).(traces{kk}).YData=yd';
0607                      WAV(ii,jj).(traces{kk}).XData=WAV(ii,jj).Monitor.XData;
0608                      <a href="#_sub22" class="code" title="subfunction plot_waveform(iplot,iwfm,tr)">plot_waveform</a>(ii,jj,kk)
0609                   <span class="keyword">end</span>  <span class="comment">%end trace display condition</span>
0610                <span class="keyword">end</span>   <span class="comment">%end loop on traces</span>
0611              <span class="keyword">end</span>  <span class="comment">%end signal signal display condition</span>
0612           <span class="keyword">end</span>  <span class="comment">%end loop over signals</span>
0613        <span class="keyword">end</span>  <span class="comment">%end loop over axes</span>
0614    <span class="keyword">end</span>  <span class="comment">%end single_shot</span>
0615 
0616 
0617 <span class="comment">%======================================</span>
0618    <span class="keyword">function</span> <a href="#_sub21" class="code" title="subfunction getpv_spear3(iplot,iwfm)    ">getpv_spear3</a>(iplot,iwfm)    <span class="comment">%%%%%%%%  getpv_spear3  %%%%%%%%%</span>
0619 <span class="comment">%======================================</span>
0620 <span class="comment">%called from single_shot</span>
0621      ch=WAV(iplot,iwfm).ChannelName;
0622      RawPV=[ch deblank(WAV(iplot,iwfm).Monitor.RawSignal)];
0623      EngPV=[ch deblank(WAV(iplot,iwfm).Monitor.EngDataUnits) deblank(WAV(iplot,iwfm).Monitor.EngSignal)];
0624      disp([RawPV <span class="string">'    '</span>  EngPV])
0625      WAV(iplot,iwfm).Monitor.RawData=<a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>(RawPV);      
0626      WAV(iplot,iwfm).Monitor.EngData=<a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>(EngPV);
0627      WAV(iplot,iwfm).Monitor.TimeStamp=sprintf(<span class="string">'%s'</span>, datestr(clock,31));
0628        
0629        <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0630          <span class="keyword">if</span> strcmpi(pwtimer.Running,<span class="string">'off'</span>)  <span class="comment">%timer not running</span>
0631            <a href="#_sub55" class="code" title="subfunction get_psm">get_psm</a>;
0632          <span class="keyword">end</span>
0633        <span class="keyword">end</span>
0634 
0635    <span class="keyword">end</span>
0636 
0637 <span class="comment">%======================================</span>
0638   <span class="keyword">function</span> <a href="#_sub22" class="code" title="subfunction plot_waveform(iplot,iwfm,tr)">plot_waveform</a>(iplot,iwfm,tr)
0639 <span class="comment">%======================================</span>
0640      xd=WAV(iplot,iwfm).(traces{tr}).XData-WAV(iplot,iwfm).(traces{tr}).XOffset;
0641      yd=WAV(iplot,iwfm).(traces{tr}).YScale*WAV(iplot,iwfm).(traces{tr}).YData;
0642      yd=yd-WAV(iplot,iwfm).(traces{tr}).YOffset;
0643      set(SYS.Handles.(traces{tr})(iplot,iwfm),<span class="string">'xdata'</span>,xd,<span class="string">'ydata'</span>,yd);
0644      a=axis(SYS.Handles.Plot(iplot));
0645      set(SYS.Handles.Plot(iplot),<span class="string">'XLim'</span>,[a(1) a(2)]);
0646    <span class="keyword">end</span>
0647     
0648 <span class="comment">%==========================================</span>
0649     <span class="keyword">function</span> <a href="#_sub23" class="code" title="subfunction update_display(src,evt)">update_display</a>(src,evt)
0650 <span class="comment">%==========================================</span>
0651 <span class="comment">%updates graphical interface display but not plots</span>
0652         iplot=SYS.iplot;
0653         iwfm=SYS.iwfm;
0654                 
0655         <span class="keyword">for</span> kk=1:2      <span class="comment">%loop over traces</span>
0656             <span class="keyword">for</span> jj=1:3   <span class="comment">%loop over channel selection setting 'A', 'B', 'A-B' to radiobutton 'off'</span>
0657             set(SYS.Handles.([traces{kk} <span class="string">'Channel'</span>])(jj),<span class="string">'Value'</span>,0)
0658             <span class="keyword">end</span>
0659             ichan=WAV(iplot,iwfm).([traces{kk} <span class="string">'Channel'</span>]);  <span class="comment">%locate which radiobutton is active</span>
0660 
0661             <span class="keyword">if</span> ichan&gt;0   <span class="comment">%0 indicates no source selection</span>
0662             set(SYS.Handles.([traces{kk} <span class="string">'Channel'</span>])(ichan),<span class="string">'Value'</span>,1)  <span class="comment">%set active radiobutton</span>
0663             <span class="keyword">end</span>
0664         <span class="keyword">end</span>
0665         
0666         <span class="keyword">for</span> kk=1:2   <span class="comment">%loop over channel selections for A and B</span>
0667             <span class="keyword">for</span> jj=1:4   <span class="comment">%loop over source selection setting radiobuttons 'off'</span>
0668             set(SYS.Handles.Source(kk,jj),<span class="string">'Value'</span>,0)
0669             <span class="keyword">end</span>
0670             isrc=WAV(iplot,iwfm).(channels{kk});  <span class="comment">%value 1,2,3,4 for Monitor,Golden,Save,File</span>
0671             <span class="comment">%disp(num2str([kk isrc]));</span>
0672             set(SYS.Handles.Source(kk,isrc),<span class="string">'Value'</span>,1);
0673         <span class="keyword">end</span>
0674 
0675         set(SYS.Handles.Trace2State,<span class="string">'Value'</span>,WAV(iplot,iwfm).Trace2State)
0676 
0677         set(SYS.Date,<span class="string">'string'</span>,datestr(now,<span class="string">'HH:MM:SS PM'</span>));
0678 
0679         <span class="keyword">for</span> kk=1:2  <span class="comment">%loop over sources for channels A and B</span>
0680             <span class="keyword">if</span> WAV(iplot,iwfm).iGolden
0681             set(SYS.Handles.Source(kk,2),<span class="keyword">...</span>
0682                         <span class="string">'ToolTipString'</span>,[<span class="string">'Golden Timestamp '</span> WAV(iplot,iwfm).Golden.TimeStamp]);
0683             <span class="keyword">end</span>
0684             set(SYS.Handles.Source(kk,3),<span class="string">'ToolTipString'</span>,[<span class="string">'Data saved: '</span> WAV(iplot,iwfm).Save.TimeStamp]);
0685             <span class="keyword">if</span> WAV(iplot,iwfm).iFile
0686             set(SYS.Handles.Source(kk,4),<span class="string">'ToolTipString'</span>,[<span class="string">'File loaded: '</span> WAV(iplot,iwfm).File.FileName]);
0687             <span class="keyword">end</span>
0688         <span class="keyword">end</span>
0689         
0690         <span class="comment">%reset radio buttons for scaling and horizontal offset display</span>
0691         <span class="keyword">if</span> WAV(iplot,iwfm).TraceScale==1
0692           set(SYS.Handles.Trace1Scale,<span class="string">'Value'</span>,1)
0693           set(SYS.Handles.Trace2Scale,<span class="string">'Value'</span>,0)
0694           set(SYS.Handles.XOffsetDisplay,<span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(traces{1}).XOffset, <span class="string">'%6.3f'</span>))
0695         <span class="keyword">elseif</span> WAV(iplot,iwfm).TraceScale==2
0696           set(SYS.Handles.Trace1Scale,<span class="string">'Value'</span>,0)
0697           set(SYS.Handles.Trace2Scale,<span class="string">'Value'</span>,1)
0698           set(SYS.Handles.XOffsetDisplay,<span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(traces{2}).XOffset, <span class="string">'%6.3f'</span>))
0699         <span class="keyword">end</span>
0700      
0701     
0702         <a href="#_sub25" class="code" title="subfunction waveform_name(src,evt)    ">waveform_name</a>;
0703     <span class="keyword">end</span>
0704 
0705 <span class="comment">%==================================================</span>
0706      <span class="keyword">function</span> <a href="#_sub24" class="code" title="subfunction display_waveform_callback(src,evt)    ">display_waveform_callback</a>(src,evt)    <span class="comment">%%%%%%%%  display_waveform  %%%%%%%%%</span>
0707 <span class="comment">%==================================================</span>
0708        <span class="comment">%response to display checkbox for selected signal</span>
0709        <span class="comment">%check indicated waveform is displayed, no check not displayed</span>
0710        val=get(src,<span class="string">'userdata'</span>);
0711        SYS.iplot=val(1);   iplot=SYS.iplot;
0712        SYS.iwfm=val(2);    iwfm=SYS.iwfm;
0713 
0714        <span class="keyword">if</span>  ~WAV(iplot,iwfm).iLoad
0715            set(src,<span class="string">'value'</span>,0);
0716            <span class="keyword">return</span>
0717        <span class="keyword">end</span>
0718 
0719        <span class="keyword">if</span> get(src,<span class="string">'value'</span>)    <span class="comment">%toggle 'on'</span>
0720          WAV(iplot,iwfm).iDisplay=1;
0721          <a href="#_sub23" class="code" title="subfunction update_display(src,evt)">update_display</a>;
0722          <a href="#_sub20" class="code" title="subfunction single_shot(src,evt,irefresh)   ">single_shot</a>(0);  <span class="comment">%0=no update</span>
0723          <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0724            <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;  <span class="comment">%updates psm parameter window</span>
0725          <span class="keyword">end</span>
0726        <span class="keyword">else</span>                   <span class="comment">%toggle 'off'</span>
0727          WAV(iplot,iwfm).iDisplay=0;
0728          axes(SYS.Handles.Plot(iplot));
0729          set(SYS.Handles.Trace1(iplot,iwfm),<span class="string">'xdata'</span>,[],<span class="string">'ydata'</span>,[]);
0730          set(SYS.Handles.Trace2(iplot,iwfm),<span class="string">'xdata'</span>,[],<span class="string">'ydata'</span>,[]);
0731          str=[<span class="string">'Plot # '</span> num2str(SYS.iplot) <span class="string">'  Waveform: '</span>];
0732          set(SYS.Handles.Waveform,<span class="string">'String'</span>,str,<span class="string">'Foregroundcolor'</span>,<span class="string">'k'</span>);
0733          <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0734            <a href="#_sub58" class="code" title="subfunction clear_psm_display">clear_psm_display</a>
0735          <span class="keyword">end</span>
0736          
0737          <span class="comment">%look for another waveform to use in the same plot</span>
0738          ifound=0;
0739          <span class="keyword">for</span> ii=1:4
0740              <span class="keyword">if</span> WAV(SYS.iplot,ii).iDisplay
0741                  SYS.iwfm=ii;
0742                  ifound=1;
0743                  <a href="#_sub23" class="code" title="subfunction update_display(src,evt)">update_display</a>;
0744                  <a href="#_sub20" class="code" title="subfunction single_shot(src,evt,irefresh)   ">single_shot</a>(0);  <span class="comment">%0=no update</span>
0745                  <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0746                    <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;  <span class="comment">%updates psm parameter window</span>
0747                  <span class="keyword">end</span>
0748                  <span class="keyword">break</span>
0749              <span class="keyword">end</span>
0750          <span class="keyword">end</span>
0751          <span class="keyword">if</span> ~ifound <span class="comment">%look for another waveform to use in the other plot</span>
0752              SYS.iplot=rem(SYS.iplot,2)+1;
0753             <span class="keyword">for</span> ii=1:4
0754              <span class="keyword">if</span> WAV(SYS.iplot,ii).iDisplay
0755                  SYS.iwfm=ii;
0756                  ifound=1;
0757                  <a href="#_sub23" class="code" title="subfunction update_display(src,evt)">update_display</a>;
0758                  <a href="#_sub20" class="code" title="subfunction single_shot(src,evt,irefresh)   ">single_shot</a>(0);  <span class="comment">%0=no update</span>
0759                  <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0760                     <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;  <span class="comment">%updates psm parameter window</span>
0761                  <span class="keyword">end</span>
0762                  <span class="keyword">break</span>
0763              <span class="keyword">end</span>
0764             <span class="keyword">end</span>
0765          <span class="keyword">end</span>
0766          <span class="keyword">if</span> ~ifound  <span class="comment">%no signals selected in either plot</span>
0767              SYS.iplot=1;
0768              SYS.iwfm=1;
0769          <span class="keyword">end</span>
0770 
0771        <span class="keyword">end</span>  <span class="comment">%end turn-off</span>
0772      <span class="keyword">end</span>
0773 
0774 <span class="comment">%==========================================</span>
0775    <span class="keyword">function</span> <a href="#_sub25" class="code" title="subfunction waveform_name(src,evt)    ">waveform_name</a>(src,evt)    <span class="comment">%%%%%%%%  waveform name  %%%%%%%%%</span>
0776 <span class="comment">%==========================================</span>
0777        <span class="comment">%display waveform name and plot index</span>
0778         iplot=SYS.iplot; 
0779         iwfm=SYS.iwfm;
0780         <span class="keyword">if</span>    ~SYS.Units
0781             Units=WAV(iplot,iwfm).Monitor.RawDataUnits;
0782         <span class="keyword">elseif</span> SYS.Units
0783             Units=WAV(iplot,iwfm).Monitor.EngDataUnits;
0784         <span class="keyword">end</span>
0785         str=[<span class="string">'    Plot '</span> num2str(SYS.iplot) <span class="string">': '</span> WAV(iplot,iwfm).CommonName <span class="string">'  ['</span> Units <span class="string">']'</span>  ];
0786         set(SYS.Handles.Waveform,<span class="string">'String'</span>,str,<span class="string">'Foregroundcolor'</span>,  WAV(iplot,iwfm).Color);
0787         set(get(SYS.Handles.Plot(iplot),<span class="string">'Ylabel'</span>),<span class="string">'string'</span>,[char(WAV(iplot,iwfm).CommonName) <span class="string">'  ['</span> Units <span class="string">']'</span>  ])
0788 
0789    <span class="keyword">end</span>
0790   
0791 <span class="comment">%==========================================</span>
0792    <span class="keyword">function</span> <a href="#_sub26" class="code" title="subfunction clear_plots_callback(src,evt)                 ">clear_plots_callback</a>(src,evt)                 <span class="comment">%%%%%%%%  clear_plots_callback  %%%%%%%%%</span>
0793 <span class="comment">%==========================================</span>
0794        <span class="comment">%callback of Clear Plots pushbutton</span>
0795        <span class="comment">%clears all waveform loads for selected graph</span>
0796        iplot=get(src,<span class="string">'userdata'</span>);   <span class="comment">%graph index</span>
0797          axes(SYS.Handles.Plot(iplot));
0798          <span class="keyword">for</span> iwfm=1:nwfm
0799              <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0800                  <a href="#_sub52" class="code" title="subfunction wavpsm2zero(ii,jj)">wavpsm2zero</a>(iplot,iwfm)
0801              <span class="keyword">end</span>
0802              <a href="#_sub29" class="code" title="subfunction wav2zero(ii,jj)">wav2zero</a>(iplot,iwfm);
0803              <a href="#_sub27" class="code" title="subfunction clear_plot(iplot,iwfm)">clear_plot</a>(iplot,iwfm)
0804          <span class="keyword">end</span>
0805          
0806          SYS.iGrid(iplot)=0;
0807          set(get(SYS.Handles.Plot(iplot),<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,<span class="string">'Timebase'</span>)
0808          set(SYS.Handles.Waveform,<span class="string">'String'</span>,<span class="string">'no waveform selected'</span>,<span class="string">'Foregroundcolor'</span>,<span class="string">'k'</span>);
0809          <span class="keyword">for</span> kk=1:2 
0810             set(SYS.Handles.Source(kk,2),<span class="keyword">...</span>
0811                         <span class="string">'ToolTipString'</span>,[<span class="string">'Golden Timestamp '</span>]);
0812             set(SYS.Handles.Source(kk,3),<span class="string">'ToolTipString'</span>,[<span class="string">'Data save time'</span>]); 
0813             set(SYS.Handles.Source(kk,4),<span class="string">'ToolTipString'</span>,[<span class="string">'File load'</span>]); 
0814          <span class="keyword">end</span>
0815          SYS.iwfm=1;
0816          
0817          <span class="comment">%check if waveforms loaded in other plot</span>
0818          SYS.iLoad=0;
0819          ip=rem(iplot,2)+1;  <span class="comment">%other plot</span>
0820          <span class="keyword">for</span> iwfm=1:nwfm
0821              <span class="keyword">if</span> WAV(ip,iwfm).iLoad
0822                  SYS.iLoad=1;
0823              <span class="keyword">end</span>
0824          <span class="keyword">end</span>
0825    <span class="keyword">end</span>
0826 
0827 <span class="comment">%==========================================</span>
0828 <a name="_sub1" href="#_subfunctions" class="code">function clear_plot(iplot,iwfm)</a>
0829 <span class="comment">%==========================================</span>
0830 <span class="comment">%clear graphics for specific plot index, waveform index</span>
0831    set(SYS.Handles.Trace1(iplot,iwfm),<span class="string">'xdata'</span>,[],<span class="string">'ydata'</span>,[]);
0832    set(SYS.Handles.Trace2(iplot,iwfm),<span class="string">'xdata'</span>,[],<span class="string">'ydata'</span>,[]);
0833    set(SYS.Handles.Select(iplot,iwfm),<span class="string">'String'</span>,<span class="string">'Select'</span>,<span class="string">'ForegroundColor'</span>,<span class="string">'k'</span>);
0834    set(SYS.Handles.Display(iplot,iwfm),<span class="string">'Value'</span>,0);
0835    str=[<span class="string">'Plot # '</span> num2str(SYS.iplot) <span class="string">'  Waveform: '</span>];
0836    set(SYS.Handles.Master(iplot,iwfm),<span class="string">'Value'</span>,0);  <span class="comment">%turn off master button</span>
0837    WAV(iplot,iwfm).imaster=0;         <span class="comment">%waveform not master</span>
0838    set(SYS.Handles.Waveform,<span class="string">'String'</span>,str,<span class="string">'Foregroundcolor'</span>,<span class="string">'k'</span>);
0839    <span class="keyword">for</span> ii=1:2   <span class="comment">%turn off A,B,A-B radio button, turn on 'A'</span>
0840      <span class="keyword">for</span> jj=1:3
0841        set(SYS.Handles.([traces{ii} <span class="string">'Channel'</span>])(jj),<span class="string">'Value'</span>,0);
0842      <span class="keyword">end</span>
0843      set(SYS.Handles.([traces{ii} <span class="string">'Channel'</span>])(1), <span class="string">'Value'</span>,1);  <span class="comment">%1=radio button for channel 'A'</span>
0844    <span class="keyword">end</span>
0845            
0846    <span class="keyword">for</span> ii=1:2  <span class="comment">%turn off Channel A,B radio buttons, turn on 'Monitor</span>
0847      <span class="keyword">for</span> jj=1:4   <span class="comment">%Monitor,Golden,Save,File</span>
0848        set(SYS.Handles.Source(ii,jj),<span class="string">'Value'</span>,0);
0849      <span class="keyword">end</span>
0850      set(SYS.Handles.Source(ii,1), <span class="string">'Value'</span>,1);   <span class="comment">%Monitor</span>
0851    <span class="keyword">end</span>
0852    
0853    <span class="keyword">if</span> strcmpi(WAV(ii,jj).FamilyType,<span class="string">'PSM'</span>)
0854        <a href="#_sub58" class="code" title="subfunction clear_psm_display">clear_psm_display</a>
0855    <span class="keyword">end</span>
0856 <span class="keyword">end</span>
0857 
0858 <span class="comment">%==========================================</span>
0859 <a name="_sub2" href="#_subfunctions" class="code">function delete_waveform_callback(src,evt)   </a><span class="comment">%delete_waveform_callback</span>
0860 <span class="comment">%==========================================</span>
0861   val=get(src,<span class="string">'Userdata'</span>);
0862   iplot=val(1);
0863   iwfm=val(2);
0864   <a href="#_sub29" class="code" title="subfunction wav2zero(ii,jj)">wav2zero</a>(iplot,iwfm);
0865     <span class="keyword">if</span> strcmpi(WAV(iplot,iwfm).FamilyType,<span class="string">'PSM'</span>)
0866     <a href="#_sub52" class="code" title="subfunction wavpsm2zero(ii,jj)">wavpsm2zero</a>(iplot,iwfm);
0867     <span class="keyword">end</span>
0868   <a href="#_sub27" class="code" title="subfunction clear_plot(iplot,iwfm)">clear_plot</a>(iplot,iwfm)
0869 <span class="keyword">end</span>
0870 
0871 <span class="comment">%==========================================</span>
0872 <a name="_sub3" href="#_subfunctions" class="code">function wav2zero(ii,jj)</a>
0873 <span class="comment">%==========================================</span>
0874 <span class="comment">%initialize segment of WAV structure</span>
0875 <span class="comment">%ii=graph index</span>
0876 <span class="comment">%jj=waveform index</span>
0877 <span class="comment">%NOTE: Could also make 'SYS.WAV0' and set WAV(ii,jj)=SYS.WAV0 each time</span>
0878   WAV(ii,jj).Family=<span class="string">''</span>;
0879   WAV(ii,jj).FamilyType=<span class="string">''</span>;
0880   WAV(ii,jj).ChannelName=<span class="string">''</span>;  <span class="comment">%ChannelName of waveform</span>
0881   WAV(ii,jj).CommonName=<span class="string">''</span>;   <span class="comment">%CommonName of waveform</span>
0882   WAV(ii,jj).iLoad=0;  <span class="comment">%flag to indicate waveform loaded</span>
0883   <span class="keyword">for</span> kk=1:4    <span class="comment">%Monitor, Save, File, Golden</span>
0884     WAV(ii,jj).(sources{kk}).TimeStamp=[];    
0885     WAV(ii,jj).(sources{kk}).RawData=[];  WAV(ii,jj).(sources{kk}).RawDataUnits=[];
0886     WAV(ii,jj).(sources{kk}).EngData=[];  WAV(ii,jj).(sources{kk}).EngDataUnits=[];
0887     WAV(ii,jj).(sources{kk}).XData=[];    WAV(ii,jj).(sources{kk}).XDataUnits=[];
0888   <span class="keyword">end</span>
0889   WAV(ii,jj).iDisplay=0;  <span class="comment">%flag to indicate waveform displayed</span>
0890   WAV(ii,jj).iMaster=0;  <span class="comment">%master for plot scale</span>
0891   WAV(ii,jj).Color=SYS.colors{jj};
0892   WAV(ii,jj).iSave=0;  <span class="comment">%waveform saved memoryly</span>
0893   WAV(ii,jj).iFile=0;  <span class="comment">%waveform loaded from file</span>
0894   WAV(ii,jj).iGolden=0;  <span class="comment">%waveform loaded from golden</span>
0895   WAV(ii,jj).Trace1State=1; <span class="comment">%TraceA on for plotting (always)</span>
0896   WAV(ii,jj).Trace1Channel=1;  <span class="comment">%1,2 or 3 indicates A,B or A-B</span>
0897   WAV(ii,jj).Trace2State=0; <span class="comment">%TraceB on for plotting (optional)</span>
0898   WAV(ii,jj).Trace2Channel=1;
0899   WAV(ii,jj).ChannelA=1;  <span class="comment">%1,2,3 or 4 indicates Monitor,Save,Golden,File</span>
0900   WAV(ii,jj).ChannelB=1;  <span class="comment">%1,2,3 or 4 indicates Monitor,Save,Golden,File</span>
0901   WAV(ii,jj).TraceScale=1; <span class="comment">%Trace1 selected for scaling</span>
0902   WAV(ii,jj).Trace1.XOffset=0;  WAV(ii,jj).Trace2.XOffset=0;
0903   WAV(ii,jj).Trace1.YOffset=0;  WAV(ii,jj).Trace2.YOffset=0;
0904   WAV(ii,jj).Trace1.YScale=1;   WAV(ii,jj).Trace2.YScale=1; 
0905 <span class="keyword">end</span>
0906 
0907 <span class="comment">%==========================================</span>
0908    <span class="keyword">function</span> <a href="#_sub30" class="code" title="subfunction PlotWaveformGUI(src,evt)    ">PlotWaveformGUI</a>(src,evt)    <span class="comment">%%%%%%%%  PlotWaveformGUI  %%%%%%%%%</span>
0909 <span class="comment">%==========================================</span>
0910 
0911     <span class="comment">%figure</span>
0912     SYS.Handles.Figure=figure(<span class="string">'Numbertitle'</span>,<span class="string">'off'</span>,<span class="string">'name'</span>,<span class="string">'PlotWaveform'</span>,<span class="keyword">...</span>
0913        <span class="string">'Position'</span>, [112 400 900 700],<span class="string">'Color'</span>,background,<span class="string">'CloseRequestFcn'</span>,@<a href="#_sub51" class="code" title="subfunction closeplotwaveform(src,evt)">closeplotwaveform</a>);
0914     set(SYS.Handles.Figure,<span class="string">'Units'</span>,<span class="string">'character'</span>);
0915     set(SYS.Handles.Figure,<span class="string">'resize'</span>,<span class="string">'off'</span>);
0916     set(SYS.Handles.Figure,<span class="string">'Toolbar'</span>,<span class="string">'none'</span>,<span class="string">'menubar'</span>,<span class="string">'none'</span>);
0917     
0918     <span class="comment">%menus</span>
0919     h=uimenu(SYS.Handles.Figure,<span class="string">'Label'</span>,<span class="string">'Plot #1'</span>);
0920     uimenu(h,<span class="string">'Label'</span>,<span class="string">'Toggle Graticule'</span>,<span class="string">'Callback'</span>,@<a href="#_sub39" class="code" title="subfunction graticule_callback(src,evt)       ">graticule_callback</a>,<span class="string">'UserData'</span>,1);
0921     uimenu(h,<span class="string">'Label'</span>,<span class="string">'Pop Plot'</span>,<span class="string">'Callback'</span>,@pop_axes_callback,<span class="string">'UserData'</span>,1);
0922     
0923     h=uimenu(SYS.Handles.Figure,<span class="string">'Label'</span>,<span class="string">'Plot #2'</span>);
0924     uimenu(h,<span class="string">'Label'</span>,<span class="string">'Toggle Graticule'</span>,<span class="string">'Callback'</span>,@<a href="#_sub39" class="code" title="subfunction graticule_callback(src,evt)       ">graticule_callback</a>,<span class="string">'UserData'</span>,2);
0925     uimenu(h,<span class="string">'Label'</span>,<span class="string">'Pop Plot'</span>,<span class="string">'Callback'</span>,@pop_axes_callback,<span class="string">'UserData'</span>,2);
0926 
0927     <span class="comment">%axes</span>
0928     y=[0.66 0.29];
0929     <span class="keyword">for</span> ii=1:2  <span class="comment">%two axes</span>
0930       SYS.Handles.Plot(ii)=axes(<span class="string">'Box'</span>,<span class="string">'on'</span>,<span class="string">'Position'</span>,[0.1 y(ii) 0.72 0.3],<span class="string">'NextPlot'</span>,<span class="string">'add'</span>);
0931       <span class="comment">%set(SYS.Handles.Plot(ii),'xticklabelmode','manual','xticklabel',[],'NextPlot','add');</span>
0932       set(get(SYS.Handles.Plot(ii),<span class="string">'Xlabel'</span>),<span class="string">'string'</span>,<span class="string">'Timebase'</span>)
0933       set(get(SYS.Handles.Plot(ii),<span class="string">'Ylabel'</span>),<span class="string">'Interpreter'</span>,<span class="string">'None'</span>,<span class="string">'string'</span>,<span class="string">'Signal'</span>)
0934       SYS.iGrid(ii)=0;
0935     <span class="keyword">end</span>; clear y
0936   
0937     <span class="comment">%axes zoom and autoscale</span>
0938     uicontrol(<span class="string">'Style'</span>, <span class="string">'Frame'</span>,<span class="string">'Position'</span>, [105 12 187 130],<span class="string">'Backgroundcolor'</span>,background);
0939     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [110 95  43 27],<span class="string">'String'</span>, [<span class="string">'Graph  1'</span>; <span class="string">'Vertical'</span>],<span class="string">'Backgroundcolor'</span>,background)
0940     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [110 50  42 27],<span class="string">'String'</span>, [<span class="string">'Graph  2'</span>; <span class="string">'Vertical'</span>],<span class="string">'Backgroundcolor'</span>,background)
0941     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [155 120 32 17],<span class="string">'String'</span>, <span class="string">'Zoom'</span>,<span class="string">'Backgroundcolor'</span>,background)
0942     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [190 120 32 17],<span class="string">'String'</span>, <span class="string">'Offset'</span>,<span class="string">'Backgroundcolor'</span>,background)
0943     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [115 18  30 17],<span class="string">'String'</span>, <span class="string">'Horiz.'</span>,<span class="string">'Backgroundcolor'</span>,background)
0944 
0945     <span class="comment">%sliders for zoom</span>
0946     slim=2;  <span class="comment">%limit for zoom</span>
0947     uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[162 92 20 30],<span class="string">'Callback'</span>,@<a href="#_sub33" class="code" title="subfunction vertical_zoom_callback(src,evt)    ">vertical_zoom_callback</a>,<span class="keyword">...</span>
0948     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.01 0.01],<span class="string">'Value'</span>,0,<span class="string">'UserData'</span>,1);
0949     uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[162 50  20 30],<span class="string">'Callback'</span>,@<a href="#_sub33" class="code" title="subfunction vertical_zoom_callback(src,evt)    ">vertical_zoom_callback</a>,<span class="keyword">...</span>
0950     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.01 0.01],<span class="string">'Value'</span>,0,<span class="string">'UserData'</span>,2);
0951     uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[195 92 20 30],<span class="string">'Callback'</span>,@<a href="#_sub34" class="code" title="subfunction vertical_offset_callback(src,evt)    ">vertical_offset_callback</a>,<span class="keyword">...</span>
0952     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.01 0.01],<span class="string">'Value'</span>,0,<span class="string">'UserData'</span>,1);
0953     uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[195 50  20 30],<span class="string">'Callback'</span>,@<a href="#_sub34" class="code" title="subfunction vertical_offset_callback(src,evt)    ">vertical_offset_callback</a>,<span class="keyword">...</span>
0954     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.01 0.01],<span class="string">'Value'</span>,0,<span class="string">'UserData'</span>,2);
0955     uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[155 20  30 20],<span class="string">'Callback'</span>,@<a href="#_sub36" class="code" title="subfunction horizontal_zoom_callback(src,evt)    ">horizontal_zoom_callback</a>,<span class="keyword">...</span>
0956     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.01 0.01],<span class="string">'Value'</span>,0);
0957     uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[190 20  30 20],<span class="string">'Callback'</span>,@<a href="#_sub35" class="code" title="subfunction horizontal_offset_callback(src,evt)    ">horizontal_offset_callback</a>,<span class="keyword">...</span>
0958     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.01 0.01],<span class="string">'Value'</span>,0);
0959 
0960     <span class="comment">%pushbuttons for autoscale</span>
0961     uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="string">'Position'</span>,[225 95  60 20],<span class="string">'String'</span>, <span class="string">'Autoscale'</span>,<span class="string">'Callback'</span>,@<a href="#_sub38" class="code" title="subfunction autoscale_callback(src,evt)    ">autoscale_callback</a>,<span class="string">'Userdata'</span>,1,<span class="string">'Backgroundcolor'</span>,background);
0962     uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="string">'Position'</span>,[225 57  60 20],<span class="string">'String'</span>, <span class="string">'Autoscale'</span>,<span class="string">'Callback'</span>,@<a href="#_sub38" class="code" title="subfunction autoscale_callback(src,evt)    ">autoscale_callback</a>,<span class="string">'Userdata'</span>,2,<span class="string">'Backgroundcolor'</span>,background);
0963     uicontrol(<span class="string">'Style'</span>,<span class="string">'pushbutton'</span>,<span class="string">'Position'</span>,[225 20  60 20],<span class="string">'String'</span>, <span class="string">'Reset'</span>,<span class="string">'Callback'</span>,@<a href="#_sub37" class="code" title="subfunction reset_horizontal_callback(src,evt)   ">reset_horizontal_callback</a>,<span class="keyword">...</span>
0964         <span class="string">'ToolTipString'</span>,<span class="string">'Reset horizontal scale on both plots'</span>,<span class="string">'BackgroundColor'</span>,background )
0965 
0966     <span class="comment">%waveform selection</span>
0967     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [700 670 80 20],<span class="string">'String'</span>, <span class="string">'Master'</span>,<span class="string">'Backgroundcolor'</span>,background)
0968     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [760 670 40 20],<span class="string">'String'</span>, <span class="string">'Display'</span>,<span class="string">'Backgroundcolor'</span>,background)
0969     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [800 670 60 20],<span class="string">'String'</span>, <span class="string">'Waveform'</span>,<span class="string">'Backgroundcolor'</span>,background)
0970     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [860 670 40 20],<span class="string">'String'</span>, <span class="string">'Delete'</span>,<span class="string">'Backgroundcolor'</span>,background)
0971 
0972     uicontrol(<span class="string">'Style'</span>, <span class="string">'Frame'</span>,<span class="string">'Position'</span>, [296 12 115 130],<span class="string">'Backgroundcolor'</span>,background);
0973     uicontrol(<span class="string">'Style'</span>, <span class="string">'Frame'</span>,<span class="string">'Position'</span>, [415 12 163 130],<span class="string">'Backgroundcolor'</span>,background);
0974     uicontrol(<span class="string">'Style'</span>, <span class="string">'Frame'</span>,<span class="string">'Position'</span>, [582 12 130 130],<span class="string">'Backgroundcolor'</span>,background);
0975     uicontrol(<span class="string">'Style'</span>, <span class="string">'Frame'</span>,<span class="string">'Position'</span>, [716 12 175 130],<span class="string">'Backgroundcolor'</span>,background);
0976 
0977     <span class="comment">%trace line Handles, master, display box, edit box,</span>
0978     y =[650 395];                <span class="comment">%vertical offsets for axes in pixel</span>
0979     yc=[545 295];                <span class="comment">%vertical offsets for clear plot button</span>
0980     <span class="keyword">for</span> ii=1:2
0981       axes(SYS.Handles.Plot(ii));
0982       <span class="keyword">for</span> jj=1:nwfm
0983         <span class="comment">%master</span>
0984         SYS.Handles.Master(ii,jj)=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0985         <span class="string">'Callback'</span>,@<a href="#_sub31" class="code" title="subfunction masterbox_callback(src,evt)    ">masterbox_callback</a>,    <span class="string">'Position'</span>, [750 y(ii)-25*(jj-1) 17 17], <span class="string">'Enable'</span>, <span class="string">'on'</span>,<span class="string">'Userdata'</span>,[ii jj],<span class="string">'Backgroundcolor'</span>,background);    
0986         <span class="comment">%display</span>
0987          SYS.Handles.Display(ii,jj)=uicontrol(<span class="string">'Style'</span>, <span class="string">'checkbox'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0988          <span class="string">'Callback'</span>,@<a href="#_sub24" class="code" title="subfunction display_waveform_callback(src,evt)    ">display_waveform_callback</a>,<span class="string">'Position'</span>, [775 y(ii)-25*(jj-1) 17 17], <span class="string">'Enable'</span>, <span class="string">'on'</span>,<span class="string">'Userdata'</span>,[ii jj],<span class="string">'Backgroundcolor'</span>,background);
0989          <span class="comment">%select</span>
0990          SYS.Handles.Select(ii,jj)=uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>, <span class="string">'String'</span>, <span class="string">'Select'</span>,<span class="keyword">...</span>
0991         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction select_waveform_callback(src,evt)   ">select_waveform_callback</a>,<span class="string">'Position'</span>, [800 y(ii)-25*(jj-1) 60 20], <span class="string">'Enable'</span>, <span class="string">'on'</span>,<span class="string">'Userdata'</span>,[ii jj],<span class="string">'Backgroundcolor'</span>,background);       
0992         <span class="comment">%delete</span>
0993          SYS.Handles.Delete(ii,jj)=uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
0994          <span class="string">'Callback'</span>,@<a href="#_sub28" class="code" title="subfunction delete_waveform_callback(src,evt)   ">delete_waveform_callback</a>,<span class="string">'Position'</span>, [865 y(ii)-25*(jj-1) 25 20], <span class="string">'Enable'</span>, <span class="string">'on'</span>,<span class="string">'Userdata'</span>,[ii,jj],<span class="string">'Backgroundcolor'</span>,background);
0995         
0996         <span class="comment">%trace initialization (lines, sources, displays)</span>
0997          SYS.Handles.Trace1(ii,jj)=line(<span class="string">'XData'</span>,[],<span class="string">'YData'</span>,[],<span class="string">'Color'</span>,SYS.colors{jj});  <span class="comment">%'Linewidth',linewidth{1}</span>
0998          SYS.Handles.Trace2(ii,jj)=line(<span class="string">'XData'</span>,[],<span class="string">'YData'</span>,[],<span class="string">'Color'</span>,SYS.colors{jj},<span class="string">'Linestyle'</span>,<span class="string">':'</span>);
0999       <span class="keyword">end</span>  <span class="comment">%loop on waveforms</span>
1000       
1001         <span class="comment">%clear plot buttons</span>
1002         uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>, <span class="string">'String'</span>, <span class="string">'Clear Plots'</span>,<span class="keyword">...</span>
1003         <span class="string">'Position'</span>, [800  yc(ii)  90 20],<span class="string">'Callback'</span>,@<a href="#_sub26" class="code" title="subfunction clear_plots_callback(src,evt)                 ">clear_plots_callback</a>,<span class="string">'UserData'</span>,ii,<span class="string">'Backgroundcolor'</span>,background)
1004     <span class="keyword">end</span>; <span class="comment">%loop on axes</span>
1005     
1006     clear linewidth
1007 
1008     <span class="comment">%trace1 and trace2 (A, B, A-B) radiobuttons</span>
1009     y=[98 37];
1010     <span class="keyword">for</span> kk=1:2  <span class="comment">%loop over traces</span>
1011        uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [297 y(kk)+15 40 20],<span class="string">'String'</span>, traces{kk},<span class="string">'Backgroundcolor'</span>,background);
1012        SYS.Handles.([traces{kk} <span class="string">'Channel'</span>])(1)=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [300 y(kk)  30 17],<span class="keyword">...</span>
1013            <span class="string">'Callback'</span>,@<a href="#_sub4" class="code" title="subfunction update_channel_callback(src,evt)   ">update_channel_callback</a>,<span class="string">'String'</span>, <span class="string">'A'</span>,  <span class="string">'Userdata'</span>,[kk 1],<span class="string">'Value'</span>,0,<span class="string">'Backgroundcolor'</span>,background);
1014        SYS.Handles.([traces{kk} <span class="string">'Channel'</span>])(2)=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [330 y(kk)  30 17],<span class="keyword">...</span>
1015            <span class="string">'Callback'</span>,@<a href="#_sub4" class="code" title="subfunction update_channel_callback(src,evt)   ">update_channel_callback</a>,<span class="string">'String'</span>, <span class="string">'B'</span>,  <span class="string">'Userdata'</span>,[kk 2],<span class="string">'Value'</span>,0,<span class="string">'Backgroundcolor'</span>,background);
1016        SYS.Handles.([traces{kk} <span class="string">'Channel'</span>])(3)=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [360 y(kk)  40 17],<span class="keyword">...</span>
1017            <span class="string">'Callback'</span>,@<a href="#_sub4" class="code" title="subfunction update_channel_callback(src,evt)   ">update_channel_callback</a>,<span class="string">'String'</span>, <span class="string">'A-B'</span>,<span class="string">'Userdata'</span>,[kk 3],<span class="string">'Value'</span>,0,<span class="string">'Backgroundcolor'</span>,background);
1018     <span class="keyword">end</span>;  clear y
1019     
1020     <span class="comment">%trace2 on/off selection</span>
1021        SYS.Handles.Trace2State=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="keyword">...</span>
1022             <span class="string">'Position'</span>, [360 58  50 17],<span class="string">'Callback'</span>,@<a href="#_sub5" class="code" title="subfunction trace2state_callback(src,evt)  ">trace2state_callback</a>,<span class="string">'String'</span>, <span class="string">'on/off'</span>,<span class="string">'Value'</span>,0,<span class="string">'Backgroundcolor'</span>,background);
1023 
1024     <span class="comment">%waveform name display</span>
1025        uicontrol(<span class="string">'Style'</span>,<span class="string">'Frame'</span>,<span class="string">'Position'</span>, [298-df 150-df 280+2*df 17+2*df])
1026        SYS.Handles.Waveform=uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [298 150 280 17],<span class="string">'String'</span>, <span class="string">'Waveform Name'</span>,<span class="keyword">...</span>
1027            <span class="string">'Backgroundcolor'</span>,background,<span class="string">'fontsize'</span>,10,<span class="string">'HorizontalAlignment'</span>,<span class="string">'Center'</span>);   
1028      
1029     <span class="comment">%raw/eng units selection</span>
1030        SYS.Handles.RawUnits=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'String'</span>, <span class="string">'Raw Units'</span>,<span class="string">'Value'</span>,0,<span class="string">'UserData'</span>,0,<span class="keyword">...</span>
1031         <span class="string">'Position'</span>, [590 150 65 17],<span class="string">'Callback'</span>,@<a href="#_sub41" class="code" title="subfunction unitselect_callback(src,evt)        ">unitselect_callback</a>,<span class="string">'Backgroundcolor'</span>,background,<span class="string">'FontSize'</span>,7);
1032        SYS.Handles.EngUnits=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'String'</span>, <span class="string">'Eng Units'</span>,<span class="string">'Value'</span>,1,<span class="string">'UserData'</span>,1,<span class="keyword">...</span>
1033         <span class="string">'Position'</span>, [650 150 65 17],<span class="string">'Callback'</span>,@<a href="#_sub41" class="code" title="subfunction unitselect_callback(src,evt)        ">unitselect_callback</a>,<span class="string">'Backgroundcolor'</span>,background,<span class="string">'FontSize'</span>,7);
1034     
1035     <span class="comment">%ChannelA and ChannelB source selection (Monitor/Golden/Saved/File) Userdata contains {Channel #, source}</span>
1036        uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [419 118 50 17],<span class="string">'String'</span>, <span class="string">'Channel A'</span>,<span class="string">'Backgroundcolor'</span>,background);
1037        uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [497 118 50 17],<span class="string">'String'</span>, <span class="string">'Channel B'</span>,<span class="string">'Backgroundcolor'</span>,background);
1038        x=[420 497];
1039        <span class="keyword">for</span> kk=1:2   <span class="comment">%loop over channels A,B</span>
1040         SYS.Handles.Source(kk,1)=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [x(kk) 98 75 17],<span class="keyword">...</span>
1041         <span class="string">'Callback'</span>,@<a href="#_sub6" class="code" title="subfunction update_source_callback(src,evt)    ">update_source_callback</a>,<span class="string">'String'</span>,<span class="string">'Monitor'</span>   ,<span class="string">'Userdata'</span>,{kk 1},<span class="string">'Backgroundcolor'</span>,background);
1042         SYS.Handles.Source(kk,2)=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [x(kk) 78 75 17],<span class="keyword">...</span>
1043         <span class="string">'Callback'</span>,@<a href="#_sub6" class="code" title="subfunction update_source_callback(src,evt)    ">update_source_callback</a>,<span class="string">'String'</span>,<span class="string">'Golden'</span>    ,<span class="string">'Userdata'</span>,{kk 2},<span class="string">'Backgroundcolor'</span>,background,<span class="string">'ToolTipString'</span>,<span class="string">'Golden Waveform'</span>);
1044         SYS.Handles.Source(kk,3)=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [x(kk) 58 75 17],<span class="keyword">...</span>
1045         <span class="string">'Callback'</span>,@<a href="#_sub6" class="code" title="subfunction update_source_callback(src,evt)    ">update_source_callback</a>,<span class="string">'String'</span>,<span class="string">'Saved Data'</span>,<span class="string">'Userdata'</span>,{kk 3},<span class="string">'Backgroundcolor'</span>,background',<span class="string">'ToolTipString'</span>,<span class="string">'Saved Waveform'</span>);
1046         SYS.Handles.Source(kk,4)=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [x(kk) 38 75 17],<span class="keyword">...</span>
1047         <span class="string">'Callback'</span>,@<a href="#_sub6" class="code" title="subfunction update_source_callback(src,evt)    ">update_source_callback</a>,<span class="string">'String'</span>,<span class="string">'File'</span>      ,<span class="string">'Userdata'</span>,{kk 4},<span class="string">'Backgroundcolor'</span>,background',<span class="string">'ToolTipString'</span>,<span class="string">'File Waveform'</span>);
1048        <span class="keyword">end</span>; clear x
1049      
1050     <span class="comment">%scale single waveform</span>
1051      slim=2;  <span class="comment">%limit for sliders</span>
1052      uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'String'</span>, <span class="string">'Scale'</span>,<span class="string">'Position'</span>,  [615 100 30 17],<span class="string">'Backgroundcolor'</span>,background)
1053      uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'String'</span>, <span class="string">'Offset'</span>,<span class="string">'Position'</span>,[650 100 40 17],<span class="string">'Backgroundcolor'</span>,background)
1054      uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'String'</span>, <span class="string">'Vert.'</span>,<span class="string">'Position'</span>,  [590 80  25 17],<span class="string">'Backgroundcolor'</span>,background)
1055      uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'String'</span>, <span class="string">'Horizontal'</span>,<span class="string">'Position'</span>,  [590 50  55 17],<span class="string">'Backgroundcolor'</span>,background)
1056      SYS.Handles.Trace1Scale=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'String'</span>, <span class="string">'Trace1'</span>,<span class="string">'Value'</span>,1,<span class="string">'Userdata'</span>,1,<span class="keyword">...</span>
1057         <span class="string">'Position'</span>, [590 120 55 17],<span class="string">'Callback'</span>,@<a href="#_sub40" class="code" title="subfunction tracescale_callback(src,evt)      ">tracescale_callback</a>,<span class="string">'Backgroundcolor'</span>,background);
1058      SYS.Handles.Trace2Scale=uicontrol(<span class="string">'Style'</span>, <span class="string">'radiobutton'</span>,<span class="string">'String'</span>, <span class="string">'Trace2'</span>,<span class="string">'Value'</span>,0,<span class="string">'Userdata'</span>,2,<span class="keyword">...</span>
1059         <span class="string">'Position'</span>, [650 120 55 17],<span class="string">'Callback'</span>,@<a href="#_sub40" class="code" title="subfunction tracescale_callback(src,evt)      ">tracescale_callback</a>,<span class="string">'Backgroundcolor'</span>,background);
1060      uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'String'</span>, <span class="string">'Reset'</span>,<span class="keyword">...</span>
1061         <span class="string">'Position'</span>, [625 18  50 17],<span class="string">'Callback'</span>,@<a href="#_sub42" class="code" title="subfunction reset_waveform_scale(src,evt)">reset_waveform_scale</a>,<span class="keyword">...</span>
1062         <span class="string">'ToolTipString'</span>,<span class="string">'Reset x/y scale - this trace, this waveform only'</span>,<span class="string">'Backgroundcolor'</span>,background)
1063      uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[622 74 20 30],<span class="string">'Callback'</span>,@<a href="#_sub43" class="code" title="subfunction vertical_scale_single_callback(src,evt)   ">vertical_scale_single_callback</a>,<span class="keyword">...</span>
1064     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.01 0.01],<span class="string">'Value'</span>,0,<span class="string">'UserData'</span>,1);
1065      uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[660 74 20 30],<span class="string">'Callback'</span>,@<a href="#_sub44" class="code" title="subfunction vertical_offset_single_callback(src,evt)     ">vertical_offset_single_callback</a>,<span class="keyword">...</span>
1066     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.01 0.01],<span class="string">'Value'</span>,0,<span class="string">'UserData'</span>,1);
1067     uicontrol(<span class="string">'Style'</span>,<span class="string">'slider'</span>,<span class="string">'Position'</span>,[655 50  30 20],<span class="string">'Callback'</span>,@<a href="#_sub45" class="code" title="subfunction horizontal_offset_single_callback(src,evt)    ">horizontal_offset_single_callback</a>,<span class="keyword">...</span>
1068     <span class="string">'Max'</span>,slim,<span class="string">'Min'</span>,-slim,<span class="string">'SliderStep'</span>,[0.25 0.25],<span class="string">'Value'</span>,0);
1069     SYS.Handles.XOffsetDisplay=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'Position'</span>,[605 38 35 15],<span class="string">'String'</span>,<span class="string">'0'</span>);
1070 
1071     <span class="comment">%save and load data</span>
1072      uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'String'</span>, <span class="string">'Save Data'</span>,<span class="keyword">...</span>
1073         <span class="string">'Position'</span>, [720 110 80 17],<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction monitor2save_callback(src,evt)    ">monitor2save_callback</a>,<span class="string">'ToolTipString'</span>,<span class="string">'store waveform in memory'</span>,<span class="string">'Backgroundcolor'</span>,background)
1074      uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'String'</span>, <span class="string">'Save to File'</span>,<span class="keyword">...</span>
1075         <span class="string">'Position'</span>, [720 80  80 17],<span class="string">'Callback'</span>,@<a href="#_sub9" class="code" title="subfunction save2file_callback(src,evt)     ">save2file_callback</a>,<span class="string">'ToolTipString'</span>,<span class="string">'write waveform to file'</span>,<span class="string">'Backgroundcolor'</span>,background)
1076      uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'String'</span>, <span class="string">'Save to Golden'</span>,<span class="keyword">...</span>
1077         <span class="string">'Position'</span>, [720 50  80 17],<span class="string">'Callback'</span>,@<a href="#_sub11" class="code" title="subfunction save2golden_callback(src,evt)   ">save2golden_callback</a>,<span class="string">'ToolTipString'</span>,<span class="string">'write waveform to golden'</span>,<span class="string">'Backgroundcolor'</span>,background)
1078      uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'String'</span>, <span class="string">'Load Data File'</span>,<span class="keyword">...</span>
1079         <span class="string">'Position'</span>, [805 80  80 17],<span class="string">'Callback'</span>,@<a href="#_sub16" class="code" title="subfunction file2memory_callback(src,evt)    ">file2memory_callback</a>,<span class="string">'ToolTipString'</span>,<span class="string">'read waveform from file'</span>,<span class="string">'Backgroundcolor'</span>,background)
1080      uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'String'</span>, <span class="string">'Load Golden'</span>,<span class="keyword">...</span>
1081         <span class="string">'Position'</span>, [805 50  80 17],<span class="string">'Callback'</span>,@<a href="#_sub17" class="code" title="subfunction golden2memory_callback(src,evt)  ">golden2memory_callback</a>,<span class="string">'ToolTipString'</span>,<span class="string">'golden file to memory'</span>,<span class="string">'Backgroundcolor'</span>,background)
1082     
1083 
1084     <span class="comment">%data transfer to file, workspace</span>
1085     SYS.Handles.all2workspace=uicontrol(<span class="string">'Style'</span>, <span class="string">'checkbox'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>, <span class="string">'String'</span>, <span class="string">'All'</span>,<span class="keyword">...</span>
1086         <span class="string">'Position'</span>, [830 20 35 17],<span class="string">'Callback'</span>,@<a href="#_sub12" class="code" title="subfunction all_checkbox_callback(srv,evt)   ">all_checkbox_callback</a>,<span class="string">'Backgroundcolor'</span>,background);
1087     uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>, <span class="string">'String'</span>, <span class="string">'Write to Workspace'</span>,<span class="keyword">...</span>
1088         <span class="string">'Position'</span>, [720 20  100 17],<span class="string">'Callback'</span>,@<a href="#_sub14" class="code" title="subfunction write2workspace_callback(src,evt)   ">write2workspace_callback</a>,<span class="string">'Backgroundcolor'</span>,background)
1089     
1090     <span class="comment">%trigger controls</span>
1091     uicontrol(<span class="string">'Style'</span>, <span class="string">'Frame'</span>,<span class="string">'Position'</span>, [10 35 90 107],<span class="string">'Backgroundcolor'</span>,background);
1092     uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [25 118 60 20],<span class="string">'String'</span>, <span class="string">'Trigger'</span>,<span class="string">'Backgroundcolor'</span>,background)
1093     uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>, <span class="string">'String'</span>, <span class="string">'One Shot'</span>,<span class="keyword">...</span>
1094         <span class="string">'Position'</span>, [15 100 80 17],<span class="string">'Callback'</span>,@<a href="#_sub19" class="code" title="subfunction single_shot_callback(src,evt)">single_shot_callback</a>,<span class="string">'Backgroundcolor'</span>,background);
1095     SYS.Handles.Timer=uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>, <span class="string">'String'</span>, <span class="string">'Continuous'</span>,<span class="keyword">...</span>
1096         <span class="string">'Position'</span>, [15 70 80 17],<span class="string">'Callback'</span>,@<a href="#_sub1" class="code" title="subfunction launch_timer_callback(src,evt)        ">launch_timer_callback</a>,<span class="string">'Backgroundcolor'</span>,background);
1097     
1098     <span class="comment">%debug</span>
1099     uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [375 680 60 20],<span class="string">'String'</span>, <span class="string">'Debug'</span>,<span class="keyword">...</span>
1100         <span class="string">'Callback'</span>,@<a href="#_sub48" class="code" title="subfunction show_state_callback(src,evt)   ">show_state_callback</a>',<span class="string">'Backgroundcolor'</span>,background,<span class="string">'fontsize'</span>,10,<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>);        
1101    
1102     <span class="comment">%update PSM display</span>
1103     <span class="keyword">if</span> strcmpi(SYS.Machine,<span class="string">'SPEAR3'</span>)
1104         uicontrol(<span class="string">'Style'</span>, <span class="string">'pushbutton'</span>,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'Position'</span>, [475 680 150 20],<span class="string">'String'</span>, <span class="string">'Update PSM Display'</span>,<span class="keyword">...</span>
1105         <span class="string">'Callback'</span>,@<a href="#_sub56" class="code" title="subfunction psm_display_callback(src,evt)     ">psm_display_callback</a>',<span class="string">'Backgroundcolor'</span>,background,<span class="string">'fontsize'</span>,10,<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>);        
1106     <span class="keyword">end</span>
1107     
1108     <span class="comment">%date</span>
1109     SYS.Date = uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'FontSize'</span>,8,<span class="string">'BackgroundColor'</span>,<span class="string">'w'</span>,<span class="string">'string'</span>,datestr(now,<span class="string">'HH:MM:SS PM'</span>  ),<span class="keyword">...</span>
1110         <span class="string">'Position'</span>, [15 40 80 17],<span class="string">'Backgroundcolor'</span>,background);
1111 
1112 <span class="keyword">end</span> <span class="comment">%end PlotWaveformGUI</span>
1113 
1114 <span class="comment">%==========================================</span>
1115    <span class="keyword">function</span> <a href="#_sub31" class="code" title="subfunction masterbox_callback(src,evt)    ">masterbox_callback</a>(src,evt)    <span class="comment">%%%%%%%%  masterbox_callback  %%%%%%%%%</span>
1116 <span class="comment">%==========================================</span>
1117    <span class="keyword">end</span>
1118 
1119 <span class="comment">%==========================================</span>
1120     <span class="keyword">function</span> iok=<a href="#_sub32" class="code" title="subfunction iok=check_xunits(iplot,Family)">check_xunits</a>(iplot,Family)
1121 <span class="comment">%==========================================</span>
1122         <span class="comment">%check family has same time base as other waveforms in plot</span>
1123         iok=1;
1124         ii=iplot;
1125         xunits=AO.(Family{1}).XUnits;
1126         <span class="keyword">for</span> jj=1:nwfm
1127             <span class="keyword">if</span>   WAV(ii,jj).iLoad
1128                 Family=WAV(ii,jj).Family;
1129                 <span class="keyword">if</span> ~(strcmpi(AO.(Family).XUnits,xunits))
1130                     iok=0;   <span class="comment">%found a disagreement in units</span>
1131                     <span class="keyword">for</span> kk=1:length(SYS.Families)
1132                       set(SYS.Handles.(SYS.Families{kk}),<span class="string">'value'</span>,[])
1133                     <span class="keyword">end</span>
1134                     <span class="keyword">return</span>
1135                 <span class="keyword">end</span> 
1136             <span class="keyword">end</span>
1137         <span class="keyword">end</span>
1138     <span class="keyword">end</span>
1139 
1140 <span class="comment">%==========================================</span>
1141 <a name="_sub4" href="#_subfunctions" class="code">function vertical_zoom_callback(src,evt)    </a><span class="comment">%%%%%%%%  vertical_zoom_callback %%%%%%%%%</span>
1142 <span class="comment">%==========================================</span>
1143       h=SYS.Handles.Plot(get(src,<span class="string">'Userdata'</span>));   <span class="comment">%plot Handles</span>
1144       xlim=get(h,<span class="string">'XLim'</span>);
1145       ylim=get(h,<span class="string">'YLim'</span>);
1146       factor = 1.1;
1147       <span class="keyword">if</span> get(src,<span class="string">'Value'</span>) &lt; 0     <span class="comment">%increase size</span>
1148         del = (factor-1)*(ylim(2)-ylim(1));
1149       <span class="keyword">else</span>                        <span class="comment">%decrease size</span>
1150         del = (1/factor-1)*(ylim(2)-ylim(1));
1151       <span class="keyword">end</span>
1152       set(h,<span class="string">'XLim'</span>,xlim,<span class="string">'YLim'</span>,[ylim(1)-del/2 ylim(2)+del/2]);
1153       set(src, <span class="string">'Value'</span>, 0)
1154    <span class="keyword">end</span>
1155 
1156 
1157 <span class="comment">%==========================================</span>
1158    <span class="keyword">function</span> <a href="#_sub34" class="code" title="subfunction vertical_offset_callback(src,evt)    ">vertical_offset_callback</a>(src,evt)    <span class="comment">%%%%%%%%  vertical_offset_callback %%%%%%%%%</span>
1159 <span class="comment">%==========================================</span>
1160 <span class="comment">%vertically offsets Plot 1 or Plot 2</span>
1161       h=SYS.Handles.Plot(get(src,<span class="string">'Userdata'</span>));   <span class="comment">%plot Handles</span>
1162       xlim=get(h,<span class="string">'XLim'</span>);
1163       ylim=get(h,<span class="string">'YLim'</span>);
1164       factor = 1.1;
1165       <span class="keyword">if</span> get(src,<span class="string">'Value'</span>) &lt; 0     <span class="comment">%raise scale</span>
1166         del = (factor-1)*(ylim(2)-ylim(1));
1167       <span class="keyword">else</span>                        <span class="comment">%lower scale</span>
1168         del = (1/factor-1)*(ylim(2)-ylim(1));
1169       <span class="keyword">end</span>
1170       set(h,<span class="string">'XLim'</span>,xlim,<span class="string">'YLim'</span>,[ylim(1)+del/2 ylim(2)+del/2]);
1171       set(src, <span class="string">'Value'</span>, 0)
1172    <span class="keyword">end</span>
1173 <span class="comment">%==========================================</span>
1174   <span class="keyword">function</span> <a href="#_sub35" class="code" title="subfunction horizontal_offset_callback(src,evt)    ">horizontal_offset_callback</a>(src,evt)    <span class="comment">%%%%%%%%  horizontal_offset_callback %%%%%%%%%</span>
1175 <span class="comment">%==========================================</span>
1176 <span class="comment">%horizontal offset Plot 1 and Plot 2</span>
1177       factor = 1.1;
1178       <span class="keyword">for</span> ii=1:2
1179       h=SYS.Handles.Plot(ii);
1180       xlim=get(h,<span class="string">'XLim'</span>);
1181       ylim=get(h,<span class="string">'YLim'</span>);
1182       <span class="keyword">if</span> get(src,<span class="string">'Value'</span>) &lt; 0     <span class="comment">%raise scale</span>
1183         del = (factor-1)*(xlim(2)-xlim(1));
1184       <span class="keyword">else</span>                        <span class="comment">%lower scale</span>
1185         del = (1/factor-1)*(xlim(2)-xlim(1));
1186       <span class="keyword">end</span>
1187       set(SYS.Handles.Plot(ii),<span class="string">'XLim'</span>,[xlim(1)+del/2 xlim(2)+del/2],<span class="string">'YLim'</span>,ylim);
1188       <span class="keyword">end</span>
1189       set(src, <span class="string">'Value'</span>, 0)
1190    <span class="keyword">end</span>
1191 
1192 <span class="comment">%==========================================</span>
1193    <span class="keyword">function</span> <a href="#_sub36" class="code" title="subfunction horizontal_zoom_callback(src,evt)    ">horizontal_zoom_callback</a>(src,evt)    <span class="comment">%%%%%%%%  horizontal_zoom_callback %%%%%%%%%</span>
1194 <span class="comment">%==========================================</span>
1195 <span class="comment">%horizontal zoom Plot 1 and Plot 2</span>
1196       factor = 1.1;
1197       <span class="keyword">for</span> ii=1:2
1198       h=SYS.Handles.Plot(ii);
1199       xlim=get(h,<span class="string">'XLim'</span>);
1200       ylim=get(h,<span class="string">'YLim'</span>);
1201       <span class="keyword">if</span> get(src,<span class="string">'Value'</span>) &lt; 0     <span class="comment">%increase size</span>
1202         del = (factor-1)*(xlim(2)-xlim(1));
1203       <span class="keyword">else</span>                        <span class="comment">%decrease size</span>
1204         del = (1/factor-1)*(xlim(2)-xlim(1));
1205       <span class="keyword">end</span>
1206       set(SYS.Handles.Plot(ii),<span class="string">'XLim'</span>,[xlim(1)-del/2 xlim(2)+del/2],<span class="string">'YLim'</span>,ylim);
1207       <span class="keyword">end</span>
1208       set(src, <span class="string">'Value'</span>, 0)
1209    <span class="keyword">end</span>
1210 
1211 <span class="comment">%===============================================</span>
1212     <span class="keyword">function</span> <a href="#_sub37" class="code" title="subfunction reset_horizontal_callback(src,evt)   ">reset_horizontal_callback</a>(src,evt)   <span class="comment">%reset_horizontal_callback</span>
1213 <span class="comment">%===============================================</span>
1214       <span class="keyword">for</span> ii=1:2
1215         <span class="keyword">for</span> jj=1:nwfm
1216           <span class="keyword">if</span> WAV(ii,jj).iLoad
1217             <span class="keyword">for</span> kk=1:2   <span class="comment">%loop over traces</span>
1218               <span class="keyword">if</span> WAV(ii,jj).iLoad
1219                 xmin=WAV(ii,jj).(traces{kk}).XData(1);
1220                 xmax=WAV(ii,jj).(traces{kk}).XData(end);
1221                 <span class="keyword">break</span>
1222               <span class="keyword">end</span>
1223             <span class="keyword">end</span>
1224           <span class="keyword">break</span>
1225           <span class="keyword">end</span>
1226         <span class="keyword">end</span>
1227         set(SYS.Handles.Plot(ii),<span class="string">'XLim'</span>,[xmin xmax]);
1228       <span class="keyword">end</span>
1229      
1230     <span class="keyword">end</span>
1231 
1232 <span class="comment">%==========================================</span>
1233     <span class="keyword">function</span> <a href="#_sub38" class="code" title="subfunction autoscale_callback(src,evt)    ">autoscale_callback</a>(src,evt)    <span class="comment">%%%%%%%%  autoscale_callback %%%%%%%%%</span>
1234 <span class="comment">%==========================================</span>
1235 <span class="comment">%autoscales selected plot</span>
1236       ii=get(src,<span class="string">'Userdata'</span>);
1237       ymax=-1e6;
1238       ymin=1e6;
1239       <span class="keyword">for</span> jj=1:nwfm
1240       <span class="keyword">if</span>   WAV(ii,jj).iDisplay   <span class="comment">%check if waveform is displayed</span>
1241           <span class="comment">%Trace1</span>
1242             y=get(SYS.Handles.Trace1(ii,jj),<span class="string">'ydata'</span>);
1243             ymax1=max(y);
1244             ymin1=min(y);
1245             <span class="keyword">if</span> ymax1&gt;ymax
1246               ymax=ymax1;
1247             <span class="keyword">end</span>
1248             <span class="keyword">if</span> ymin1&lt;ymin
1249               ymin=ymin1;
1250             <span class="keyword">end</span>
1251             
1252           <span class="comment">%Trace2</span>
1253           <span class="keyword">if</span> WAV(ii,jj).Trace2State
1254             y=get(SYS.Handles.Trace2(ii,jj),<span class="string">'ydata'</span>);
1255             ymax1=max(y);
1256             ymin1=min(y);
1257             <span class="keyword">if</span> ymax1&gt;ymax
1258               ymax=ymax1;
1259             <span class="keyword">end</span>
1260             <span class="keyword">if</span> ymin1&lt;ymin
1261               ymin=ymin1;
1262             <span class="keyword">end</span>
1263           <span class="keyword">end</span>
1264       <span class="keyword">end</span>  <span class="comment">%end condition on display</span>
1265       <span class="keyword">end</span>  <span class="comment">%end loop on waveforms</span>
1266 
1267       ymin=ymin-0.05*abs(ymin);
1268       ymax=ymax+0.05*abs(ymax);
1269       <span class="keyword">if</span> ymin&gt;ymax
1270           t=ymin;
1271           ymin=ymax;
1272           ymax=t;
1273       <span class="keyword">end</span>
1274       <span class="keyword">if</span> ymin==0 &amp;&amp; ymax==0
1275           ymax=1;
1276       <span class="keyword">end</span>
1277 <span class="comment">%       disp(num2str(ymin))</span>
1278 <span class="comment">%       disp(num2str(ymax))</span>
1279 
1280       a=axis(SYS.Handles.Plot(ii));
1281       set(SYS.Handles.Plot(ii),<span class="string">'xlim'</span>,[a(1) a(2)],<span class="string">'ylim'</span>,[ymin ymax])
1282       <span class="keyword">end</span> <span class="comment">%end function</span>
1283 
1284  <span class="comment">%==========================================</span>
1285     <span class="keyword">function</span> <a href="#_sub39" class="code" title="subfunction graticule_callback(src,evt)       ">graticule_callback</a>(src,evt)       <span class="comment">%graticule_callback</span>
1286  <span class="comment">%==========================================</span>
1287         iplot=get(gcbo,<span class="string">'Userdata'</span>);
1288         <span class="keyword">if</span> SYS.iGrid(iplot)==0
1289           set(SYS.Handles.Plot(iplot),<span class="string">'XGrid'</span>,<span class="string">'On'</span>, <span class="string">'YGrid'</span>,<span class="string">'On'</span>)
1290           SYS.iGrid(iplot)=1;
1291         <span class="keyword">else</span>
1292           set(SYS.Handles.Plot(iplot),<span class="string">'XGrid'</span>,<span class="string">'Off'</span>, <span class="string">'YGrid'</span>,<span class="string">'Off'</span>)
1293           SYS.iGrid(SYS.iplot)=0;
1294         <span class="keyword">end</span>
1295         clear iplot
1296     <span class="keyword">end</span>
1297 
1298 
1299  <span class="comment">%==========================================</span>
1300    <span class="keyword">function</span> <a href="#_sub40" class="code" title="subfunction tracescale_callback(src,evt)      ">tracescale_callback</a>(src,evt)      <span class="comment">%tracescale_callback</span>
1301  <span class="comment">%==========================================</span>
1302 <span class="comment">%radio buttons to control scaling of Trace1 or Trace2</span>
1303         tr=get(src,<span class="string">'Userdata'</span>);
1304         iplot=SYS.iplot;
1305         iwfm=SYS.iwfm;
1306           <span class="keyword">if</span> ~get(SYS.Handles.Trace2State,<span class="string">'Value'</span>)   <span class="comment">%trace2 not selected</span>
1307              set(SYS.Handles.Trace2Scale,<span class="string">'Value'</span>,0)  <span class="comment">%put back radio button</span>
1308              <span class="keyword">return</span>
1309           <span class="keyword">end</span>
1310 
1311         <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; 
1312             set(SYS.Handles.Trace1Scale,<span class="string">'Value'</span>,1)
1313             set(SYS.Handles.Trace2Scale,<span class="string">'Value'</span>,0)
1314             errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Trace Selection'</span>);  
1315             <span class="keyword">return</span>; 
1316         <span class="keyword">end</span>
1317         <span class="comment">%toggle radio buttons</span>
1318         <span class="keyword">if</span> tr==1
1319           val=get(SYS.Handles.Trace1Scale,<span class="string">'Value'</span>)
1320           <span class="keyword">if</span> val  <span class="comment">%user turned Trace1 on</span>
1321              set(SYS.Handles.Trace2Scale,<span class="string">'Value'</span>,0)
1322              WAV(iplot,iwfm).TraceScale=1; <span class="comment">%Trace1 selected for scaling</span>
1323              set(SYS.Handles.XOffsetDisplay,<span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(traces{1}).XOffset, <span class="string">'%6.3f'</span>))
1324           <span class="keyword">else</span>  <span class="comment">%user turned Trace1 off</span>
1325              set(SYS.Handles.Trace2Scale,<span class="string">'Value'</span>,1)
1326              WAV(iplot,iwfm).TraceScale=2; <span class="comment">%Trace2 selected for scaling</span>
1327              set(SYS.Handles.XOffsetDisplay,<span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(traces{2}).XOffset, <span class="string">'%6.3f'</span>))
1328           <span class="keyword">end</span>
1329         <span class="keyword">elseif</span> tr==2
1330           val=get(SYS.Handles.Trace1Scale,<span class="string">'Value'</span>)
1331           <span class="keyword">if</span> val  <span class="comment">%user turned Trace2 on</span>
1332              set(SYS.Handles.Trace1Scale,<span class="string">'Value'</span>,0)
1333              WAV(iplot,iwfm).TraceScale=2; <span class="comment">%Trace2 selected for scaling</span>
1334              set(SYS.Handles.XOffsetDisplay,<span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(traces{2}).XOffset, <span class="string">'%6.3f'</span>))
1335           <span class="keyword">else</span>  <span class="comment">%user turned Trace2 off</span>
1336              set(SYS.Handles.Trace1Scale,<span class="string">'Value'</span>,1)
1337              WAV(iplot,iwfm).TraceScale=1; <span class="comment">%Trace1 selected for scaling</span>
1338              set(SYS.Handles.XOffsetDisplay,<span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(traces{1}).XOffset, <span class="string">'%6.3f'</span>))
1339           <span class="keyword">end</span>
1340         <span class="keyword">end</span>
1341      
1342     <span class="keyword">end</span>
1343 
1344  <span class="comment">%==========================================</span>
1345    <span class="keyword">function</span> <a href="#_sub41" class="code" title="subfunction unitselect_callback(src,evt)        ">unitselect_callback</a>(src,evt)        <span class="comment">%unitselect_callback</span>
1346  <span class="comment">%==========================================</span>
1347       <span class="comment">%radio buttons to control display of Raw and Eng Units</span>
1348         iplot=SYS.iplot;
1349         iwfm=SYS.iwfm;
1350 
1351         <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; 
1352             set(SYS.Handles.RawUnits,<span class="string">'Value'</span>,0)
1353             set(SYS.Handles.EngUnits,<span class="string">'Value'</span>,1)
1354             errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Unit Selection'</span>);  
1355             <span class="keyword">return</span>; 
1356         <span class="keyword">end</span>
1357         
1358         <span class="comment">%toggle radio buttons</span>
1359           btn=get(src,<span class="string">'UserData'</span>);
1360           val=get(src,<span class="string">'Value'</span>);
1361           <span class="keyword">if</span>     ~btn &amp;&amp; val  <span class="comment">%Raw turned on</span>
1362              set(SYS.Handles.EngUnits,<span class="string">'Value'</span>,0)
1363              SYS.Units=0; <span class="comment">%Raw Units</span>
1364           <span class="keyword">elseif</span> ~btn &amp;&amp; ~val  <span class="comment">%Raw turned off</span>
1365              set(SYS.Handles.EngUnits,<span class="string">'Value'</span>,1)
1366              SYS.Units=1; <span class="comment">%Eng Units</span>
1367           <span class="keyword">elseif</span> btn &amp;&amp; val  <span class="comment">%Eng turned on</span>
1368              set(SYS.Handles.RawUnits,<span class="string">'Value'</span>,0)
1369              SYS.Units=1;
1370           <span class="keyword">elseif</span> btn &amp;&amp; ~val  <span class="comment">%Eng turned off</span>
1371              set(SYS.Handles.RawUnits,<span class="string">'Value'</span>,1)
1372              SYS.Units=0;
1373           <span class="keyword">end</span>   
1374           <span class="keyword">if</span> strcmpi(pwtimer.Running,<span class="string">'off'</span>)  <span class="comment">%timer not running</span>
1375               <a href="#_sub19" class="code" title="subfunction single_shot_callback(src,evt)">single_shot_callback</a>;
1376               <a href="#_sub25" class="code" title="subfunction waveform_name(src,evt)    ">waveform_name</a>;
1377           <span class="keyword">end</span>
1378     <span class="keyword">end</span>
1379 
1380   <span class="comment">%==========================================</span>
1381   <span class="keyword">function</span> <a href="#_sub42" class="code" title="subfunction reset_waveform_scale(src,evt)">reset_waveform_scale</a>(src,evt)
1382   <span class="comment">%==========================================</span>
1383       <span class="comment">%reset scaling of single waveform</span>
1384         iplot=SYS.iplot;
1385         iwfm=SYS.iwfm;
1386         tr=WAV(iplot,iwfm).TraceScale;
1387         <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad; errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Reset'</span>);  <span class="keyword">return</span>; <span class="keyword">end</span>
1388         WAV(iplot,iwfm).(traces{tr}).YScale=1;
1389         WAV(iplot,iwfm).(traces{tr}).YOffset=0;
1390         WAV(iplot,iwfm).(traces{tr}).XOffset=0;
1391         set(SYS.Handles.XOffsetDisplay,<span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(traces{tr}).XOffset, <span class="string">'%6.3f'</span>))
1392         <a href="#_sub22" class="code" title="subfunction plot_waveform(iplot,iwfm,tr)">plot_waveform</a>(iplot,iwfm,tr);
1393     <span class="keyword">end</span>
1394 
1395   <span class="comment">%===============================================</span>
1396   <span class="keyword">function</span> <a href="#_sub43" class="code" title="subfunction vertical_scale_single_callback(src,evt)   ">vertical_scale_single_callback</a>(src,evt)   <span class="comment">%vertical_scale_single_callback</span>
1397   <span class="comment">%===============================================</span>
1398       <span class="comment">%scale single waveform vertical</span>
1399         iplot=SYS.iplot;
1400         iwfm=SYS.iwfm;
1401         tr=WAV(iplot,iwfm).TraceScale;
1402         <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad
1403             errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Vertical Scale'</span>)
1404         <span class="keyword">end</span>
1405         val=get(src,<span class="string">'Value'</span>);
1406         <span class="keyword">if</span> val&gt;0
1407             del=0.05;
1408         <span class="keyword">elseif</span> val&lt;0
1409             del=-0.05;
1410         <span class="keyword">end</span>
1411         WAV(iplot,iwfm).(traces{tr}).YScale=WAV(iplot,iwfm).(traces{tr}).YScale+del;
1412         <span class="keyword">if</span> WAV(iplot,iwfm).(traces{tr}).YScale&lt;0
1413             WAV(iplot,iwfm).(traces{tr}).YScale=0;
1414         <span class="keyword">end</span>
1415         <a href="#_sub22" class="code" title="subfunction plot_waveform(iplot,iwfm,tr)">plot_waveform</a>(iplot,iwfm,tr);
1416         set(src, <span class="string">'Value'</span>, 0)
1417     <span class="keyword">end</span>
1418 
1419  <span class="comment">%==========================================</span>
1420    <span class="keyword">function</span> <a href="#_sub44" class="code" title="subfunction vertical_offset_single_callback(src,evt)     ">vertical_offset_single_callback</a>(src,evt)     <span class="comment">%vertical_offset_single_callback</span>
1421  <span class="comment">%==========================================</span>
1422       <span class="comment">%vertical offset for single waveform</span>
1423         iplot=SYS.iplot;
1424         iwfm=SYS.iwfm;
1425         <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad
1426           errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Vertical Offset'</span>)
1427         <span class="keyword">end</span>
1428         tr=WAV(iplot,iwfm).TraceScale;
1429         val=get(src,<span class="string">'Value'</span>);
1430         
1431         h=SYS.Handles.Plot(iplot);   <span class="comment">%plot Handles</span>
1432         xlim=get(h,<span class="string">'XLim'</span>);
1433         ylim=get(h,<span class="string">'YLim'</span>);
1434         factor = 1.1;
1435         <span class="comment">%get(src,'Value')</span>
1436         <span class="keyword">if</span> get(src,<span class="string">'Value'</span>) &lt; 0     <span class="comment">%raise scale</span>
1437           del = (factor-1)*(ylim(2)-ylim(1));
1438         <span class="keyword">else</span>                        <span class="comment">%lower scale</span>
1439           del = (1/factor-1)*(ylim(2)-ylim(1));
1440         <span class="keyword">end</span>
1441         WAV(iplot,iwfm).(traces{tr}).YOffset=WAV(iplot,iwfm).(traces{tr}).YOffset+del;
1442         <a href="#_sub22" class="code" title="subfunction plot_waveform(iplot,iwfm,tr)">plot_waveform</a>(iplot,iwfm,tr);
1443         set(h,<span class="string">'XLim'</span>,xlim,<span class="string">'YLim'</span>,ylim);   <span class="comment">%return plot coordinates to original value</span>
1444         set(src, <span class="string">'Value'</span>, 0)
1445 
1446     <span class="keyword">end</span>
1447 
1448   <span class="comment">%==========================================</span>
1449   <span class="keyword">function</span> <a href="#_sub45" class="code" title="subfunction horizontal_offset_single_callback(src,evt)    ">horizontal_offset_single_callback</a>(src,evt)    <span class="comment">%horizontal_offset_single_callback</span>
1450   <span class="comment">%==========================================</span>
1451       <span class="comment">%horizontal offset for single waveform</span>
1452         iplot=SYS.iplot;
1453         iwfm=SYS.iwfm;
1454         <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad
1455           errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'Horizontal Offset'</span>)
1456          <span class="keyword">end</span>
1457         tr=WAV(iplot,iwfm).TraceScale;
1458         val=get(src,<span class="string">'Value'</span>);
1459         nstep=2;
1460         WAV(iplot,iwfm).(traces{tr}).XOffset=<span class="keyword">...</span>
1461         WAV(iplot,iwfm).(traces{tr}).XOffset+val*nstep*WAV(iplot,iwfm).Monitor.XDataStep;
1462         <a href="#_sub22" class="code" title="subfunction plot_waveform(iplot,iwfm,tr)">plot_waveform</a>(iplot,iwfm,tr);
1463         set(src, <span class="string">'Value'</span>, 0)
1464         set(SYS.Handles.XOffsetDisplay,<span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(traces{tr}).XOffset, <span class="string">'%6.3f'</span>))
1465     <span class="keyword">end</span>
1466 
1467 <span class="comment">%==========================================</span>
1468 <a name="_sub5" href="#_subfunctions" class="code">function makeSYSstruct</a>
1469 <span class="comment">%==========================================</span>
1470  SYS=[]; 
1471  SYS.Families=fieldnames(AO);  <span class="comment">%check to see if Families are MemberOf 'PlotWaveform'</span>
1472  <span class="keyword">for</span> ii=1:size(SYS.Families,1)
1473  SYS.FamilyTypes{ii}=AO.(SYS.Families{ii}).FamilyType;  
1474  <span class="keyword">end</span>
1475  SYS.Machine=<span class="string">'SPEAR3'</span>;
1476  SYS.iplot=1;
1477  SYS.iwfm=1;
1478  SYS.colors={<span class="string">'b'</span>,<span class="string">'r'</span>,<span class="string">'k'</span>,<span class="string">'m'</span>};   <span class="comment">%colors for plots</span>
1479  SYS.iLoad=0;
1480  SYS.Units=1;  <span class="comment">%0 for raw data (.RawData), 1 for converted data (.EngData)</span>
1481 <span class="keyword">end</span>
1482 
1483 <span class="comment">%==========================================</span>
1484 <a name="_sub6" href="#_subfunctions" class="code">function makeWAVstruct</a>
1485 <span class="comment">%==========================================</span>
1486  <span class="comment">%initialize WAV structure for program PlotWaveform</span>
1487   WAV=[];
1488   <span class="keyword">for</span> ii=1:2  <span class="comment">%plots</span>
1489     <span class="keyword">for</span> jj=1:nwfm  <span class="comment">%waveforms</span>
1490       <a href="#_sub29" class="code" title="subfunction wav2zero(ii,jj)">wav2zero</a>(ii,jj)
1491     <span class="keyword">end</span>
1492   <span class="keyword">end</span>
1493 <span class="keyword">end</span>
1494 
1495 <span class="comment">%==========================================</span>
1496 <span class="comment">%     function pop_axes_callback(src,evt)</span>
1497 <span class="comment">%==========================================</span>
1498 <span class="comment">%      SYS.iplot=get(gcbo,'Userdata');</span>
1499 <span class="comment">%      a=figure;</span>
1500 <span class="comment">%      myplot=gca;</span>
1501 <span class="comment">%      b=copyobj(gca, a);</span>
1502 <span class="comment">%      for ii=1:4</span>
1503 <span class="comment">%        if WAV(SYS.iplot,ii).iplot==1;</span>
1504 <span class="comment">%            h=WAV(SYS.iplot,ii).Line.Handles;</span>
1505 <span class="comment">%            copyobj(h,b);</span>
1506 <span class="comment">%        end</span>
1507 <span class="comment">%      end</span>
1508 <span class="comment">%      clear h</span>
1509 <span class="comment">%</span>
1510 <span class="comment">%      t=axis(gca);</span>
1511 <span class="comment">%      axis(t)</span>
1512 <span class="comment">%      set(b, 'Position',[0.13 0.11 0.775 0.815]);</span>
1513 <span class="comment">%      set(b, 'ButtonDownFcn','');</span>
1514 <span class="comment">%      set(b, 'XAxisLocation','Bottom');</span>
1515 <span class="comment">%      set(b,'XTick',[]);</span>
1516 <span class="comment">%      set(b,'XTick',get(SYS.Handles.Plot(iplot),'XTick'));</span>
1517 <span class="comment">%</span>
1518 <span class="comment">%</span>
1519 <span class="comment">% %      set(b,'YTickLabel',[]);</span>
1520 <span class="comment">% %      axis(b,[get(SYS.Handles.Plot(iplot),'XLim') get(SYS.Handles.Plot(iplot),'YLim')]);</span>
1521 <span class="comment">%      xlabel('Time [microsec]');</span>
1522 <span class="comment">%      orient portrait</span>
1523 <span class="comment">%     end</span>
1524 
1525 <span class="comment">%==========================================</span>
1526 <a name="_sub7" href="#_subfunctions" class="code">function show_state_callback(src,evt)   </a><span class="comment">%%%%%%%%  show_state_callback %%%</span>
1527 <span class="comment">%==========================================</span>
1528 disp([<span class="string">'Machine: '</span> SYS.Machine])
1529 disp([<span class="string">'Graph '</span> num2str(SYS.iplot)])
1530 disp([<span class="string">'Waveform '</span> num2str(SYS.iwfm)])
1531 disp(<span class="string">' '</span>)
1532 <a href="#_sub49" class="code" title="subfunction show_string(field)">show_string</a>(<span class="string">'Family'</span>)
1533 <a href="#_sub49" class="code" title="subfunction show_string(field)">show_string</a>(<span class="string">'ChannelName'</span>)
1534 <a href="#_sub49" class="code" title="subfunction show_string(field)">show_string</a>(<span class="string">'CommonName'</span>)
1535 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'iLoad'</span>,<span class="string">'waveform loaded'</span>)
1536 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'iDisplay'</span>,<span class="string">'selected for display'</span>)
1537 <span class="comment">%show_index('iMaster')</span>
1538 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'iSave'</span>,<span class="string">'memory save'</span>)
1539 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'iFile'</span>,<span class="string">'file loaded'</span>)
1540 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'iGolden'</span>,<span class="string">'Golden loaded'</span>)
1541 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace1State'</span>,<span class="string">'on or off'</span>)
1542 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace1Channel'</span>,<span class="string">'A,B or A-B'</span>)
1543 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace2State'</span>,<span class="string">'on or off'</span>)
1544 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace2Channel'</span>,<span class="string">'A,B or A-B'</span>)
1545 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'ChannelA'</span>,<span class="string">'Monitor, Golden, Save, File'</span>)
1546 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'ChannelB'</span>,<span class="string">'Monitor, Golden, Save, File'</span>)
1547 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'TraceScale'</span>,<span class="string">'horizontal waveform offset'</span>)
1548 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace1'</span>,<span class="string">'horizontal waveform offset'</span>,<span class="string">'XOffset'</span>)
1549 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace2'</span>,<span class="string">'horizontal waveform offset'</span>,<span class="string">'XOffset'</span>)
1550 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace1'</span>,<span class="string">'vertical waveform offset'</span>,<span class="string">'YOffset'</span>)
1551 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace2'</span>,<span class="string">'vertical waveform offset'</span>,<span class="string">'YOffset'</span>)
1552 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace1'</span>,<span class="string">'vertical waveform scaling'</span>,<span class="string">'YScale'</span>)
1553 <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(<span class="string">'Trace2'</span>,<span class="string">'vertical waveform scaling'</span>,<span class="string">'YScale'</span>)
1554 <span class="comment">%show_index('YOffset','vertical waveform offset')</span>
1555 
1556 <span class="comment">%==========================================</span>
1557     <span class="keyword">function</span> <a href="#_sub49" class="code" title="subfunction show_string(field)">show_string</a>(field)
1558 <span class="comment">%==========================================</span>
1559      disp(field)
1560      <span class="keyword">for</span> ii=1:2
1561       t=[];
1562        <span class="keyword">for</span> jj=1:nwfm
1563         <span class="keyword">if</span> isempty(WAV(ii,jj).(field)); 
1564             txt=<span class="string">'None'</span>; 
1565         <span class="keyword">else</span>
1566             txt=WAV(ii,jj).(field);
1567         <span class="keyword">end</span>
1568         t=[t txt <span class="string">'   '</span>];
1569       <span class="keyword">end</span>
1570       disp(t)
1571      <span class="keyword">end</span>
1572      disp(<span class="string">' '</span>)
1573     <span class="keyword">end</span>
1574 
1575  <span class="comment">%==========================================</span>
1576    <span class="keyword">function</span> <a href="#_sub50" class="code" title="subfunction show_index(field1,comment,field2)">show_index</a>(field1,comment,field2)
1577  <span class="comment">%==========================================</span>
1578     ifield2=0;
1579      <span class="keyword">if</span> ~exist(<span class="string">'field2'</span>,<span class="string">'var'</span>)
1580        disp([field1   <span class="string">' [  '</span> comment <span class="string">' ]'</span>])
1581      <span class="keyword">else</span>
1582        ifield2=1;
1583        disp([field1 <span class="string">'.'</span> field2 <span class="string">'   ['</span> comment <span class="string">' ]'</span>])
1584      <span class="keyword">end</span>
1585      
1586      <span class="keyword">for</span> ii=1:2
1587       t=[];
1588        <span class="keyword">for</span> jj=1:nwfm
1589             <span class="keyword">if</span> ~ifield2
1590             t=[t WAV(ii,jj).(field1)];
1591             <span class="keyword">else</span>
1592             t=[t WAV(ii,jj).(field1).(field2)];   
1593             <span class="keyword">end</span>
1594        <span class="keyword">end</span>
1595       disp(t)
1596      <span class="keyword">end</span>
1597       disp(<span class="string">' '</span>)
1598     <span class="keyword">end</span>
1599   <span class="keyword">end</span>  <span class="comment">%show_state_callback</span>
1600 
1601 <span class="comment">%==========================================</span>
1602     <span class="keyword">function</span> <a href="#_sub51" class="code" title="subfunction closeplotwaveform(src,evt)">closeplotwaveform</a>(src,evt)
1603 <span class="comment">%==========================================</span>
1604 <span class="comment">%callback of closewindow</span>
1605         <span class="comment">%kill the timer</span>
1606           <span class="keyword">if</span> exist(<span class="string">'pwtimer'</span>,<span class="string">'var'</span>)
1607             stop(pwtimer);
1608             delete(pwtimer);
1609             clear pwtimer
1610           <span class="keyword">end</span>
1611           t=timerfind;
1612           <span class="keyword">for</span> k=1:length(t)
1613             <span class="keyword">if</span> strcmpi(t(k).Tag,<span class="string">'PlotwaveformTimer'</span>)
1614               stop(t(k));
1615               delete(t(k));
1616             <span class="keyword">end</span>
1617           <span class="keyword">end</span>
1618           delete(SYS.Handles.Figure);
1619           <span class="comment">%if  exist('SYS.PSMHandles.Figure')</span>
1620              <span class="keyword">if</span>  ishandle(SYS.PSMHandles.Figure)
1621               delete(SYS.PSMHandles.Figure);
1622              <span class="keyword">end</span>
1623           <span class="comment">%end</span>
1624       <span class="comment">%clear global SYS WAV AO AD;</span>
1625     <span class="keyword">end</span>
1626 
1627 <span class="comment">%==========================================</span>
1628 <a name="_sub8" href="#_subfunctions" class="code">function wavpsm2zero(ii,jj)</a>
1629 <span class="comment">%==========================================</span>
1630  <span class="keyword">for</span> kk=1:4
1631   WAV(ii,jj).(sources{kk}).XDataStep=[];
1632   WAV(ii,jj).(sources{kk}).VoltOffset=[]; <span class="comment">%Voltage offset</span>
1633   WAV(ii,jj).(sources{kk}).PolyConv=[]; <span class="comment">%Polynomial conversion factors</span>
1634   WAV(ii,jj).(sources{kk}).RawSignal=<span class="string">''</span>;  WAV(ii,jj).(sources{kk}).EngSignal=<span class="string">''</span>;  <span class="comment">%VoltFst, Fst</span>
1635   WAV(ii,jj).(sources{kk}).EngAvg=[];        WAV(ii,jj).(sources{kk}).EngFstAvg=[];
1636   WAV(ii,jj).(sources{kk}).EngCtr=[];        WAV(ii,jj).(sources{kk}).EngFstCtr=[];
1637   WAV(ii,jj).(sources{kk}).EngMax=[];        WAV(ii,jj).(sources{kk}).EngFstMax=[];
1638   WAV(ii,jj).(sources{kk}).EngMin=[];        WAV(ii,jj).(sources{kk}).EngFstMin=[];
1639   WAV(ii,jj).(sources{kk}).EngSum=[];        WAV(ii,jj).(sources{kk}).EngFstSum=[];
1640   WAV(ii,jj).(sources{kk}).EngInt=[];        WAV(ii,jj).(sources{kk}).EngFstInt=[];  <span class="comment">%&lt;Charge or Ener&gt;  (Int value - &quot;Charge&quot; for Curr, &quot;Ener&quot; for Pwr, &quot;Intgrl&quot; for Load)</span>
1641   WAV(ii,jj).(sources{kk}).RawAvg=[];        WAV(ii,jj).(sources{kk}).RawFstAvg=[];
1642   WAV(ii,jj).(sources{kk}).RawCtr=[];        WAV(ii,jj).(sources{kk}).RawFstCtr=[];
1643   WAV(ii,jj).(sources{kk}).RawMax=[];        WAV(ii,jj).(sources{kk}).RawFstMax=[];
1644   WAV(ii,jj).(sources{kk}).RawMin=[];        WAV(ii,jj).(sources{kk}).RawFstMin=[];
1645   WAV(ii,jj).(sources{kk}).RawSum=[];        WAV(ii,jj).(sources{kk}).RawFstSum=[];
1646   WAV(ii,jj).(sources{kk}).RawInt=[];        WAV(ii,jj).(sources{kk}).RawFstInt=[];  <span class="comment">%&lt;Charge or Ener&gt;  (Int value - &quot;Charge&quot; for Curr, &quot;Ener&quot; for Pwr, &quot;Intgrl&quot; for Load)</span>
1647  <span class="keyword">end</span>
1648 <span class="keyword">end</span>
1649 
1650 <span class="comment">%======================================</span>
1651     <span class="keyword">function</span> <a href="#_sub53" class="code" title="subfunction make_psm_display(src,evt)">make_psm_display</a>(src,evt)
1652 <span class="comment">%======================================</span>
1653     <span class="comment">%generate figure to display SPEAR3 psm parameters</span>
1654     SYS.PSMHandles.Figure=figure(<span class="string">'Numbertitle'</span>,<span class="string">'off'</span>,<span class="string">'name'</span>,<span class="string">'SPEAR3 PSM Parameters'</span>,<span class="keyword">...</span>
1655        <span class="string">'Position'</span>, [110 300 500 200],<span class="string">'resize'</span>,<span class="string">'off'</span>,<span class="string">'Color'</span>,background,<span class="string">'CloseRequestFcn'</span>,@<a href="#_sub54" class="code" title="subfunction close_psm(src,evt)">close_psm</a>);
1656       
1657     <span class="comment">%Source headers (Monitor, Save, File, Golden)</span>
1658     uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background, <span class="string">'String'</span>, <span class="string">'Monitor'</span>,<span class="string">'Position'</span>, [105 180 50 17]);
1659     uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background, <span class="string">'String'</span>, <span class="string">'Golden'</span>, <span class="string">'Position'</span>, [205 180 50 17]);
1660     uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background, <span class="string">'String'</span>, <span class="string">'Save'</span>,   <span class="string">'Position'</span>, [305 180 50 17]);
1661     uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background, <span class="string">'String'</span>, <span class="string">'File'</span>,   <span class="string">'Position'</span>, [405 180 50 17]);
1662     calcname={<span class="string">'Avg'</span> <span class="string">'Ctr'</span> <span class="string">'Max'</span> <span class="string">'Min'</span> <span class="string">'Sum'</span> <span class="string">'Int'</span>};
1663 
1664     dx=100; dy=20;
1665     <span class="keyword">for</span> ii=1:size(calcname,2)  <span class="comment">%calculated number titles</span>
1666       uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background, <span class="string">'String'</span>, [calcname{ii} <span class="string">' / Fast'</span>],<span class="keyword">...</span>
1667                 <span class="string">'Position'</span>,[30 180-dy*(ii) 50 17],<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>);
1668       uicontrol(<span class="string">'Style'</span>,<span class="string">'frame'</span>,<span class="string">'BackgroundColor'</span>,background,<span class="string">'Position'</span>,[95 179-dy*(ii) 400 22]);
1669 
1670       <span class="keyword">for</span> jj=1:4  <span class="comment">%make text fields for calculated numbers</span>
1671         SYS.PSMHandles.(sources{jj}).(calcname{ii})= uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background,<span class="keyword">...</span>
1672             <span class="string">'Position'</span>, [100+dx*(jj-1) 180-dy*(ii) 30 17],<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>,<span class="string">'String'</span>, <span class="string">'2Hz'</span>);
1673         SYS.PSMHandles.(sources{jj}).([calcname{ii} <span class="string">'Fst'</span>])= uicontrol(<span class="string">'Style'</span>, <span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background,<span class="keyword">...</span>
1674             <span class="string">'Position'</span>, [135+dx*(jj-1) 180-dy*(ii) 30 17],<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>,<span class="string">'String'</span>, <span class="string">'Fast'</span>);
1675       <span class="keyword">end</span>
1676     <span class="keyword">end</span>
1677        SYS.PSMHandles.Units=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background,<span class="keyword">...</span>
1678                                             <span class="string">'String'</span>, <span class="string">'Units'</span>,<span class="string">'Position'</span>, [50 5 80 17]);
1679        SYS.PSMHandles.Waveform=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background,<span class="keyword">...</span>
1680                                             <span class="string">'String'</span>, <span class="string">'Waveform Name'</span>,<span class="string">'Position'</span>, [150 5 200 17]);
1681        SYS.PSMHandles.Time=uicontrol(<span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'BackgroundColor'</span>,background,<span class="keyword">...</span>
1682                                             <span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>, datestr(clock,31)),<span class="string">'Position'</span>, [350 5 150 17]);
1683        uicontrol(<span class="string">'Style'</span>,<span class="string">'Pushbutton'</span>,<span class="string">'BackgroundColor'</span>,background,<span class="keyword">...</span>
1684                  <span class="string">'Position'</span>, [220 30 60 17],<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>,<span class="string">'String'</span>, <span class="string">'Update'</span>,<span class="string">'Callback'</span>,@<a href="#_sub56" class="code" title="subfunction psm_display_callback(src,evt)     ">psm_display_callback</a>);
1685     
1686        set(SYS.PSMHandles.Figure,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>);
1687 
1688 <span class="keyword">end</span>  <span class="comment">%end make_psm_display</span>
1689 
1690 <span class="comment">%======================================</span>
1691     <span class="keyword">function</span> <a href="#_sub54" class="code" title="subfunction close_psm(src,evt)">close_psm</a>(src,evt)
1692 <span class="comment">%======================================</span>
1693         <span class="comment">%question whether user wants to close SPEAR3 PSM parameter display window</span>
1694         answer=questdlg(<span class="string">'Close parameter display window?'</span>,<span class="string">'Close display window'</span>);
1695         <span class="keyword">if</span> strcmpi(answer,<span class="string">'yes'</span>)
1696             delete(SYS.PSMHandles.Figure)
1697         <span class="keyword">end</span>
1698     <span class="keyword">end</span>
1699 
1700 <span class="comment">%======================================</span>
1701     <span class="keyword">function</span> <a href="#_sub55" class="code" title="subfunction get_psm">get_psm</a>
1702 <span class="comment">%======================================</span>
1703       iplot=SYS.iplot;
1704       iwfm=SYS.iwfm;
1705       <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad
1706           errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'SPEAR3 PSM Parameter display'</span>)
1707           <span class="keyword">return</span>
1708       <span class="keyword">end</span>
1709       calcname={<span class="string">'Avg'</span> <span class="string">'Ctr'</span> <span class="string">'Max'</span> <span class="string">'Min'</span> <span class="string">'Sum'</span> <span class="string">'Int'</span>};
1710       ch=WAV(iplot,iwfm).ChannelName;
1711       <span class="comment">%tic</span>
1712       WAV(iplot,iwfm).Monitor.EngAvg =    <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'Avg'</span>]);       
1713       WAV(iplot,iwfm).Monitor.EngFstAvg = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'FstAvg'</span>]);
1714       WAV(iplot,iwfm).Monitor.EngCtr =    <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'Centroid'</span>]);        
1715       WAV(iplot,iwfm).Monitor.EngFstCtr = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'FstCentroid'</span>]);
1716       WAV(iplot,iwfm).Monitor.EngMax =    <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'Max'</span>]);        
1717       WAV(iplot,iwfm).Monitor.EngFstMax = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'FstMax'</span>]);
1718       WAV(iplot,iwfm).Monitor.EngMin =    <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'Min'</span>]);        
1719       WAV(iplot,iwfm).Monitor.EngFstMin = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'FstMin'</span>]);
1720       WAV(iplot,iwfm).Monitor.EngSum =    <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'Sum'</span>]);        
1721       WAV(iplot,iwfm).Monitor.EngFstSum = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>([ch WAV(iplot,iwfm).Monitor.EngDataUnits <span class="string">'FstSum'</span>]);
1722      <span class="comment">%WAV(iplot,iwfm).Monitor.EngInt =    getpv([ch WAV(iplot,iwfm).EngDataUnits 'Avg'];</span>
1723      <span class="comment">%WAV(iplot,iwfm).Monitor.EngFstInt='';  %&lt;Charge or Ener&gt;  (Int value</span>
1724      <span class="comment">%- &quot;Charge&quot; for Curr, &quot;Ener&quot; for Pwr, &quot;Intgrl&quot; for Load)      WAV(iplot,iwfm).Monitor.EngAvg =    getpv([ch WAV(iplot,iwfm).Monitor.EngDataUnits 'Avg']);</span>
1725 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawFstAvg = getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'FstAvg']);</span>
1726 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawCtr =    getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'Centroid']);</span>
1727 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawFstCtr = getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'FstCentroid']);</span>
1728 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawMax =    getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'Max']);</span>
1729 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawFstMax = getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'FstMax']);</span>
1730 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawMin =    getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'Min']);</span>
1731 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawFstMin = getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'FstMin']);</span>
1732 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawSum =    getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'Sum']);</span>
1733 <span class="comment">% % %       WAV(iplot,iwfm).Monitor.RawFstSum = getpv([ch WAV(iplot,iwfm).Monitor.RawDataUnits 'FstSum']);</span>
1734 <span class="comment">% % %      %WAV(iplot,iwfm).Monitor.RawInt =    getpv([ch WAV(iplot,iwfm).RawDataUnits 'Avg'];</span>
1735 <span class="comment">% % %      %WAV(iplot,iwfm).Monitor.RawFstInt='';  %&lt;Charge or Ener&gt;  (Int value</span>
1736 <span class="comment">% % %      %- &quot;Charge&quot; for Curr, &quot;Ener&quot; for Pwr, &quot;Intgrl&quot; for Load)</span>
1737       <span class="comment">%load the raw parameters here</span>
1738       <span class="comment">%toc</span>
1739 
1740     <span class="keyword">end</span>
1741 
1742 <span class="comment">%======================================</span>
1743 <a name="_sub9" href="#_subfunctions" class="code">function psm_display_callback(src,evt)     </a><span class="comment">%psm_display_callback</span>
1744 <span class="comment">%======================================</span>
1745   <a href="#_sub55" class="code" title="subfunction get_psm">get_psm</a>;
1746   <a href="#_sub57" class="code" title="subfunction psm_display(src,evt)">psm_display</a>;
1747 <span class="keyword">end</span>
1748 
1749 <span class="comment">%======================================</span>
1750 <a name="_sub10" href="#_subfunctions" class="code">function psm_display(src,evt)</a>
1751 <span class="comment">%======================================</span>
1752       <span class="comment">%acquire SPEAR3 data and update display</span>
1753           <span class="keyword">if</span> ~ishandle(SYS.PSMHandles.Figure)  <span class="comment">%if window does not exist make one</span>
1754               <a href="#_sub53" class="code" title="subfunction make_psm_display(src,evt)">make_psm_display</a>;
1755           <span class="keyword">end</span>
1756 
1757       iplot=SYS.iplot;
1758       iwfm=SYS.iwfm;
1759       <span class="keyword">if</span> ~WAV(iplot,iwfm).iLoad
1760            errordlg(<span class="string">'Select waveform first'</span>,<span class="string">'SPEAR3 PSM Parameter display'</span>)
1761            <span class="keyword">return</span>
1762       <span class="keyword">end</span>
1763 
1764       calcname={<span class="string">'Avg'</span> <span class="string">'Ctr'</span> <span class="string">'Max'</span> <span class="string">'Min'</span> <span class="string">'Sum'</span>} ; <span class="comment">% 'Int'};</span>
1765 
1766       <span class="keyword">for</span> ii=1:4 <span class="comment">%loop over sources (Monitor, Golden, Save, File)</span>
1767           <span class="comment">%disp(sources{ii})</span>
1768         <span class="keyword">for</span> jj=1:size(calcname,2)  <span class="comment">%loop over calculated values for each source</span>
1769             str=num2str(WAV(iplot,iwfm).(sources{ii}).([<span class="string">'Eng'</span> calcname{jj}]), <span class="string">'%8.2f'</span>);
1770             <span class="comment">%disp(str)</span>
1771          set(SYS.PSMHandles.(sources{ii}).(calcname{jj}),<span class="keyword">...</span><span class="comment">        </span>
1772          <span class="string">'String'</span>,str);
1773          set(SYS.PSMHandles.(sources{ii}).([calcname{jj} <span class="string">'Fst'</span>]),<span class="keyword">...</span>
1774          <span class="string">'String'</span>,num2str(WAV(iplot,iwfm).(sources{ii}).([<span class="string">'Eng'</span> <span class="string">'Fst'</span> calcname{jj} ]), <span class="string">'%8.2f'</span>));
1775         <span class="keyword">end</span>
1776       <span class="keyword">end</span>
1777         <span class="keyword">if</span>    ~SYS.Units
1778             Units=WAV(iplot,iwfm).Monitor.RawDataUnits;
1779             set(SYS.PSMHandles.Units,<span class="string">'String'</span>,<span class="string">'Raw Units'</span>,<span class="string">'Foregroundcolor'</span>,  WAV(iplot,iwfm).Color);
1780         <span class="keyword">elseif</span> SYS.Units
1781             Units=WAV(iplot,iwfm).Monitor.EngDataUnits;
1782             set(SYS.PSMHandles.Units,<span class="string">'String'</span>,<span class="string">'Eng Units'</span>,<span class="string">'Foregroundcolor'</span>,  WAV(iplot,iwfm).Color);
1783         <span class="keyword">end</span>
1784         str=[<span class="string">'    Plot '</span> num2str(SYS.iplot) <span class="string">': '</span> WAV(iplot,iwfm).CommonName <span class="string">'  ['</span> Units <span class="string">']'</span>  ];
1785         set(SYS.PSMHandles.Waveform,<span class="string">'String'</span>,str,<span class="string">'Foregroundcolor'</span>,  WAV(iplot,iwfm).Color);
1786         set(SYS.PSMHandles.Time,<span class="string">'String'</span>,sprintf(<span class="string">'%s'</span>, datestr(clock,31)));
1787 <span class="keyword">end</span>  <span class="comment">%end psm_display</span>
1788 
1789 <span class="comment">%======================================</span>
1790     <span class="keyword">function</span> <a href="#_sub58" class="code" title="subfunction clear_psm_display">clear_psm_display</a>
1791 <span class="comment">%======================================</span>
1792       calcname={<span class="string">'Avg'</span> <span class="string">'Ctr'</span> <span class="string">'Max'</span> <span class="string">'Min'</span> <span class="string">'Sum'</span> <span class="string">'Int'</span>};
1793       <span class="keyword">for</span> ii=1:4 <span class="comment">%loop over sources (Monitor, Golden, Save, File)</span>
1794         <span class="keyword">for</span> jj=1:size(calcname,2)  <span class="comment">%loop over calculated values for each source</span>
1795          set(SYS.PSMHandles.(sources{ii}).(calcname{jj}),        <span class="string">'String'</span>,<span class="string">' '</span>);
1796          set(SYS.PSMHandles.(sources{ii}).([calcname{jj} <span class="string">'Fst'</span>]),<span class="string">'String'</span>,<span class="string">' '</span>);
1797         <span class="keyword">end</span>
1798       <span class="keyword">end</span>
1799       set(SYS.PSMHandles.Units,<span class="string">'String'</span>,<span class="string">'Units'</span>,<span class="string">'Foregroundcolor'</span>,<span class="string">'k'</span>);
1800       set(SYS.PSMHandles.Waveform,<span class="string">'String'</span>,<span class="string">'Waveform'</span>,<span class="string">'Foregroundcolor'</span>,<span class="string">'k'</span>);
1801       set(SYS.PSMHandles.Time,<span class="string">'String'</span>,sprintf(<span class="string">'%s'</span>, datestr(clock,31)));
1802     <span class="keyword">end</span>
1803 
1804 
1805 <span class="keyword">end</span>  <span class="comment">%program</span></pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>