<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setgolden</title>
  <meta name="keywords" content="setgolden">
  <meta name="description" content="SETGOLDEN - Set the golden values">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; setgolden.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>setgolden
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>SETGOLDEN - Set the golden values</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = setgolden(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">SETGOLDEN - Set the golden values
  [DataStruct, ...] = setgolden(FamilyName, Data, DeviceList)
  [DataStruct, ...] = setgolden(FamilyName, FileName, DeviceList)
  [DataStruct, ...] = setgolden(FileName)
  [DataStruct, ...] = setgolden(DataStruct)
  [DataStruct, ...] = setgolden(DataStruct1, DataStruct2, ...)

  INPUTS
  1. FamilyName - Family to set the offset field {Default: BPM families}
                  (can be a cell array of families)
     DataStruct - Data structure input (.FamilyName, .Data, and .DeviceList fields are used)
     FileName - Data structure input can be in a file
  2. Data - Data vector to set
  3. DeviceList - Device list to change of the golden parameters

  OUTPUTS
  1. DataStruct - The data structure with the new golden parameters in the .Data field

  NOTES
  1. The golden values are changed for the present Matlab session only.  They are
     not saved for future sessions.  The golden orbit is usually set in the 
     one of the initialization files (like setoperationalmode).
  2. This function calls setfamilydata.

  See Also <a href="savegoldenorbit.html" class="code" title="function savegoldenorbit(FileName)">savegoldenorbit</a>, <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>, <a href="plotgoldenorbit.html" class="code" title="function plotgoldenorbit(varargin)">plotgoldenorbit</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>	FINDMEMBEROF - Finds all family members</li><li><a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>	GETDATA - Searches through a file (or group of files) for a data structure which matches the family name</li><li><a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>	GETFAMILYDATA - Gets data associated with the accelerator control</li><li><a href="gethbpmfamily.html" class="code" title="function Family = gethbpmfamily">gethbpmfamily</a>	GETHBPMFAMILY - Return the default horizontal BPM family</li><li><a href="getvbpmfamily.html" class="code" title="function Family = getvbpmfamily">getvbpmfamily</a>	GETVBPMFAMILY - Return the default vertical BPM family</li><li><a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>	ISFAMILY - True for family names</li><li><a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>	SETFAMILYDATA - Sets data associated with accelerator control</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = setgolden(varargin)</a>
0002 <span class="comment">%SETGOLDEN - Set the golden values</span>
0003 <span class="comment">%  [DataStruct, ...] = setgolden(FamilyName, Data, DeviceList)</span>
0004 <span class="comment">%  [DataStruct, ...] = setgolden(FamilyName, FileName, DeviceList)</span>
0005 <span class="comment">%  [DataStruct, ...] = setgolden(FileName)</span>
0006 <span class="comment">%  [DataStruct, ...] = setgolden(DataStruct)</span>
0007 <span class="comment">%  [DataStruct, ...] = setgolden(DataStruct1, DataStruct2, ...)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%  INPUTS</span>
0010 <span class="comment">%  1. FamilyName - Family to set the offset field {Default: BPM families}</span>
0011 <span class="comment">%                  (can be a cell array of families)</span>
0012 <span class="comment">%     DataStruct - Data structure input (.FamilyName, .Data, and .DeviceList fields are used)</span>
0013 <span class="comment">%     FileName - Data structure input can be in a file</span>
0014 <span class="comment">%  2. Data - Data vector to set</span>
0015 <span class="comment">%  3. DeviceList - Device list to change of the golden parameters</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%  OUTPUTS</span>
0018 <span class="comment">%  1. DataStruct - The data structure with the new golden parameters in the .Data field</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%  NOTES</span>
0021 <span class="comment">%  1. The golden values are changed for the present Matlab session only.  They are</span>
0022 <span class="comment">%     not saved for future sessions.  The golden orbit is usually set in the</span>
0023 <span class="comment">%     one of the initialization files (like setoperationalmode).</span>
0024 <span class="comment">%  2. This function calls setfamilydata.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%  See Also savegoldenorbit, getgolden, plotgoldenorbit</span>
0027 
0028 <span class="comment">%</span>
0029 <span class="comment">%  Written by Gregory J. Portmann</span>
0030 <span class="comment">%  Modifid by Laurent S. Nadolski</span>
0031 
0032 
0033 
0034 Family = <span class="string">''</span>;
0035 FileName = <span class="string">''</span>;
0036 
0037 <span class="keyword">if</span> nargin == 0
0038     DirName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'BPMData'</span>);
0039     [FileName, DirName] = uigetfile([DirName,filesep,<span class="string">'BPMGolden*.mat'</span>], <span class="string">'Select a data file:'</span>);
0040 
0041     <span class="keyword">if</span> FileName == 0
0042         <span class="keyword">return</span>;
0043     <span class="keyword">end</span>
0044 
0045     FileName = [DirName, FileName];
0046 <span class="keyword">end</span>
0047 
0048 
0049 <span class="keyword">if</span> nargin &gt;= 1
0050     <span class="keyword">if</span> iscell(varargin{1})
0051         Family = varargin{1};
0052     <span class="keyword">elseif</span> isstruct(varargin{1})
0053         Family = {varargin{1}.FamilyName};
0054         varargout{1} = varargin{1};
0055     <span class="keyword">elseif</span> <a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>(varargin{1})
0056         Family{1} = {varargin{1}};
0057         varargout{1}.FamilyName = varargin{1};
0058     <span class="keyword">elseif</span> isstr(varargin{1})
0059         FileName = varargin{1};
0060     <span class="keyword">else</span>
0061         error(<span class="string">'Input #1 unknown type: Family or Filename expected.'</span>);
0062     <span class="keyword">end</span>
0063 <span class="keyword">end</span>
0064 
0065 <span class="keyword">if</span> nargin &gt;= 2
0066     <span class="keyword">if</span> isstruct(varargin{2})
0067         Family = [Family; {varargin{2}.FamilyName}];
0068         varargout{2} = varargin{2};
0069     <span class="keyword">elseif</span> isstr(varargin{2})
0070         FileName = varargin{2};
0071     <span class="keyword">elseif</span> isnumeric(varargin{2})
0072         varargout{1}.Data = varargin{2};
0073     <span class="keyword">elseif</span> isempty(varargin{2})
0074         <span class="comment">%DirName = getfamilydata('Directory','BPMData');</span>
0075         DirName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'DataRoot'</span>);
0076         [FileName, DirName] = uigetfile([DirName,filesep,<span class="string">'*.mat'</span>], <span class="string">'Select data file:'</span>);
0077         <span class="keyword">if</span> FileName == 0
0078             <span class="keyword">return</span>;
0079         <span class="keyword">end</span>
0080         FileName = [DirName, FileName];
0081     <span class="keyword">else</span>
0082         error(<span class="string">'Input #2 unknown type: Data or Filename expected.'</span>);
0083     <span class="keyword">end</span>
0084 <span class="keyword">end</span>
0085 
0086 
0087 DeviceListFlag = 0;
0088 <span class="keyword">if</span> nargin &gt;= 3
0089     <span class="keyword">if</span> isstruct(varargin{3})
0090         Family = [Family; {varargin{3}.FamilyName}];
0091         varargout{3} = varargin{3};
0092     <span class="keyword">elseif</span> isnumeric(varargin{3})
0093         DeviceList = varargin{3};
0094         <span class="keyword">if</span> ~isfield(varargin{1}, <span class="string">'DeviceList'</span>)
0095             <span class="comment">% Laurent ligne commente la suivante</span>
0096             <span class="comment">% varargin{1}.DeviceList = varargin{3};</span>
0097             <span class="comment">% Laurent ligne suivante</span>
0098             varargout{1}.DeviceList = varargin{3};
0099         <span class="keyword">end</span>
0100         DeviceListFlag = 1;
0101     <span class="keyword">else</span>
0102         error(<span class="string">'Input #3 unknown type: DeviceList expected.'</span>);
0103     <span class="keyword">end</span>
0104 <span class="keyword">end</span>
0105 
0106 
0107 <span class="comment">% Extra structures can be passed on</span>
0108 <span class="keyword">for</span> i = 4:nargin
0109     <span class="keyword">if</span> isstruct(varargin{i})
0110         Family = [Family; {varargin{i}.FamilyName}];
0111         varargout{i} = varargin{i};
0112     <span class="keyword">end</span>
0113 <span class="keyword">end</span>
0114 
0115     
0116 <span class="keyword">if</span> ~isempty(FileName)
0117     <span class="keyword">if</span> isempty(Family)
0118         Family = <a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>(<span class="string">'BPM'</span>);
0119         <span class="keyword">if</span> isempty(Family)
0120             Family = {<a href="gethbpmfamily.html" class="code" title="function Family = gethbpmfamily">gethbpmfamily</a>; <a href="getvbpmfamily.html" class="code" title="function Family = getvbpmfamily">getvbpmfamily</a>};
0121         <span class="keyword">end</span>
0122     <span class="keyword">end</span>
0123 <span class="keyword">end</span>
0124 
0125 
0126 <span class="keyword">for</span> i = 1:length(Family)
0127     <span class="keyword">if</span> ~isempty(FileName)
0128         <span class="keyword">if</span> DeviceListFlag
0129             varargout{i} = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(Family{i}, DeviceList, <span class="string">'Struct'</span>, FileName);
0130         <span class="keyword">else</span>
0131             varargout{i} = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(Family{i}, <span class="string">'Struct'</span>, FileName);
0132         <span class="keyword">end</span>
0133     <span class="keyword">end</span>
0134 
0135     <span class="keyword">if</span> DeviceListFlag
0136         [iFound, iNotFound] = findrowindex(DeviceList, varargout{i}.DeviceList);
0137         <span class="keyword">if</span> ~isempty(iNotFound)
0138             error(<span class="string">'Not all the devices are in the data set.'</span>);
0139         <span class="keyword">end</span>
0140         varargout{i}.Data = varargout{i}.Data(iFound,:);
0141         varargout{i}.DeviceList = varargout{i}.DeviceList(iFound,:);
0142     <span class="keyword">end</span>
0143 
0144     <span class="keyword">if</span> size(varargout{i}.Data,1) ~= size(varargout{i}.DeviceList,1)
0145         error(<span class="string">'The size of the data does not equal the number of devices.'</span>);
0146     <span class="keyword">end</span>
0147     
0148     <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(varargout{i}.Data, varargout{i}.FamilyName, <span class="string">'Golden'</span>, varargout{i}.DeviceList);
0149 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>