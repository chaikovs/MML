<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of addmenuao</title>
  <meta name="keywords" content="addmenuao">
  <meta name="description" content="ADDMENUAO - Menu to tune AO parameters">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; addmenuao.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>addmenuao
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>ADDMENUAO - Menu to tune AO parameters</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = addmenuao(h, Command) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">  ADDMENUAO - Menu to tune AO parameters

  INPUTS
  1. h - handles to the parent figure
  2. Command - Build {Default} builds menu
               Action used for callback (edition, ...)
               NoAction
  3. LabelString - if Build command
  4. ParentLabelString - if Build command

  OUPUTS
  1. hmenu - handles to admenu

  See Also <a href="addmenuao.html" class="code" title="function varargout = addmenuao(h, Command)">addmenuao</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="getao.html" class="code" title="function  AO = getao(FileName)">getao</a>	GETAO - returns the AcceleratorObject (AO)</li><li><a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>	GETFAMILYDATA - Gets data associated with the accelerator control</li><li><a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>	SETFAMILYDATA - Sets data associated with accelerator control</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = addmenuao(h, Command)</a>
0002 <span class="comment">%  ADDMENUAO - Menu to tune AO parameters</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  INPUTS</span>
0005 <span class="comment">%  1. h - handles to the parent figure</span>
0006 <span class="comment">%  2. Command - Build {Default} builds menu</span>
0007 <span class="comment">%               Action used for callback (edition, ...)</span>
0008 <span class="comment">%               NoAction</span>
0009 <span class="comment">%  3. LabelString - if Build command</span>
0010 <span class="comment">%  4. ParentLabelString - if Build command</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%  OUPUTS</span>
0013 <span class="comment">%  1. hmenu - handles to admenu</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%  See Also addmenuao</span>
0016 
0017 <span class="keyword">if</span> nargin &lt; 1
0018     h = gcf;
0019 <span class="keyword">end</span>
0020 <span class="keyword">if</span> nargin &lt; 2
0021     Command = <span class="string">'Build'</span>;
0022 <span class="keyword">end</span>
0023 
0024 <span class="keyword">switch</span> lower(Command)
0025     <span class="keyword">case</span> <span class="string">'build'</span>
0026         
0027         <span class="keyword">if</span> nargin &lt; 3
0028             LabelString = <span class="string">'Middle Layer Family Setup'</span>;
0029         <span class="keyword">end</span>
0030         <span class="keyword">if</span> nargin &lt; 4
0031             ParentLabelString = <span class="string">'MiddleLayer'</span>;
0032         <span class="keyword">end</span>
0033         
0034         <span class="keyword">if</span> strcmpi(get(h,<span class="string">'Type'</span>), <span class="string">'figure'</span>)
0035             h_childen = get(gcf,<span class="string">'children'</span>);
0036             EditMenuFlag = 0;
0037             <span class="keyword">for</span> i = 1:length(h_childen)
0038                 <span class="keyword">if</span> strcmpi(get(h_childen,<span class="string">'label'</span>), ParentLabelString)
0039                     EditMenuFlag = 1;
0040                     h = h_childen(i);
0041                     <span class="keyword">break</span>;
0042                 <span class="keyword">end</span>
0043             <span class="keyword">end</span>
0044             <span class="keyword">if</span> ~EditMenuFlag
0045                 <span class="comment">% Make an edit menu</span>
0046                 h = uimenu(h, <span class="string">'Label'</span>, ParentLabelString, <span class="string">'Callback'</span>,<span class="string">''</span>);
0047             <span class="keyword">end</span>
0048             hmenu = uimenu(h, <span class="string">'Label'</span>, LabelString, <span class="string">'Callback'</span>,<span class="string">''</span>);
0049         <span class="keyword">elseif</span> strcmpi(get(h,<span class="string">'Type'</span>), <span class="string">'uimenu'</span>)
0050             <span class="keyword">if</span> isempty(findstr(get(h, <span class="string">'Label'</span>), <span class="string">'Middle Layer'</span>))
0051                 hmenu = uimenu(h, <span class="string">'Label'</span>, LabelString, <span class="string">'Callback'</span>,<span class="string">''</span>);    
0052             <span class="keyword">else</span>
0053                 hmenu = h;
0054             <span class="keyword">end</span>
0055         <span class="keyword">else</span>
0056             hmenu = h;
0057         <span class="keyword">end</span>
0058         
0059         varargout{1} = hmenu;
0060         
0061         DataStructure0 = <a href="getao.html" class="code" title="function  AO = getao(FileName)">getao</a>;
0062         <span class="keyword">if</span> isempty(DataStructure0)
0063             error(<span class="string">'Middle layer initialization needed'</span>);
0064         <span class="keyword">end</span>
0065         
0066         
0067         <span class="comment">% Build middle menu tree</span>
0068         DataStructFieldName1 = fieldnames(DataStructure0);
0069         <span class="keyword">for</span> i = 1:length(DataStructFieldName1)   
0070             DataStructure1 = DataStructure0.(DataStructFieldName1{i});
0071             <span class="keyword">if</span> isstruct(DataStructure1)
0072                 hmenu1 = uimenu(hmenu, <span class="string">'Label'</span>,DataStructFieldName1{i}, <span class="string">'Callback'</span>,<span class="string">''</span>);       
0073                 DataStructFieldName2 = fieldnames(DataStructure1);
0074                 <span class="keyword">for</span> j = 1:length(DataStructFieldName2)
0075                     DataStructure2 = DataStructure1.(DataStructFieldName2{j});
0076                     <span class="keyword">if</span> isstruct(DataStructure2)
0077                         hmenu2 = uimenu(hmenu1, <span class="string">'Label'</span>,DataStructFieldName2{j}, <span class="string">'Callback'</span>,<span class="string">''</span>);       
0078                         DataStructFieldName3 = fieldnames(DataStructure2);
0079                         <span class="keyword">for</span> k = 1:length(DataStructFieldName3)
0080                             DataStructure3 = DataStructure2.(DataStructFieldName3{k});
0081                             <span class="keyword">if</span> isstruct(DataStructure3)
0082                                 hmenu3 = uimenu(hmenu2, <span class="string">'Label'</span>,DataStructFieldName3{k}, <span class="string">'Callback'</span>,<span class="string">''</span>);
0083                                 DataStructFieldName4 = fieldnames(DataStructure3);
0084                                 <span class="keyword">for</span> l = 1:length(DataStructFieldName4)
0085                                     hmenu4 = uimenu(hmenu3, <span class="string">'Label'</span>, DataStructFieldName4{l});
0086                                     set(hmenu4,<span class="string">'UserData'</span>, {DataStructure3.(DataStructFieldName4{l}) , DataStructFieldName1{l}, DataStructFieldName2{k}, DataStructFieldName3{k}, DataStructFieldName4{i}});      
0087                                     set(hmenu4,<span class="string">'Callback'</span>, <span class="string">'addmenuao(gcbo,''Action'')'</span>);
0088                                 <span class="keyword">end</span>
0089                             <span class="keyword">else</span>
0090                                 hmenu3 = uimenu(hmenu2, <span class="string">'Label'</span>,DataStructFieldName3{k});
0091                                 set(hmenu3,<span class="string">'UserData'</span>, {DataStructure3, DataStructFieldName1{i}, DataStructFieldName2{j}, DataStructFieldName3{k}});      
0092                                 set(hmenu3,<span class="string">'Callback'</span>, <span class="string">'addmenuao(gcbo,''Action'')'</span>);
0093                             <span class="keyword">end</span>
0094                         <span class="keyword">end</span>
0095                     <span class="keyword">else</span>
0096                         hmenu2 = uimenu(hmenu1, <span class="string">'Label'</span>,DataStructFieldName2{j});
0097                         set(hmenu2,<span class="string">'UserData'</span>, {DataStructure2, DataStructFieldName1{i}, DataStructFieldName2{j}});      
0098                         set(hmenu2,<span class="string">'Callback'</span>, <span class="string">'addmenuao(gcbo,''Action'')'</span>);
0099                     <span class="keyword">end</span>
0100                 <span class="keyword">end</span>
0101             <span class="keyword">else</span>
0102                 hmenu1 = uimenu(hmenu, <span class="string">'Label'</span>, DataStructFieldName1{i});                   
0103                 set(hmenu1,<span class="string">'UserData'</span>, {DataStructure1, DataStructFieldName1{i}});      
0104                 set(hmenu1,<span class="string">'Callback'</span>, <span class="string">'addmenuao(gcbo,''Action'')'</span>);
0105             <span class="keyword">end</span>
0106         <span class="keyword">end</span>
0107         
0108     <span class="keyword">case</span> <span class="string">'action'</span>
0109         
0110         Data = get(h, <span class="string">'UserData'</span>);
0111 
0112         <span class="comment">% Get up-to-date data</span>
0113         Data{1} = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(Data{2:end});
0114         
0115         <span class="comment">%Label = get(h, 'Label');</span>
0116         TitleString = sprintf(<span class="string">'%s '</span>,Data{2:end});
0117         AddOpts.Resize=<span class="string">'on'</span>;
0118         AddOpts.WindowStyle=<span class="string">'normal'</span>;
0119         AddOpts.Interpreter=<span class="string">'tex'</span>;
0120  
0121         <span class="keyword">if</span> length(Data) &gt;= 3 &amp; (strcmpi(deblank(Data{3}),<span class="string">'Status'</span>) | strcmpi(deblank(Data{3}),<span class="string">'DeviceList'</span>) | strcmpi(deblank(Data{3}),<span class="string">'ElementList'</span>)) 
0122             <span class="keyword">if</span> strcmpi(deblank(Data{3}),<span class="string">'ElementList'</span>)
0123                 DeviceList = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(deblank(Data{2}), <span class="string">'ElementList'</span>);
0124             <span class="keyword">else</span>
0125                 DeviceList = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(deblank(Data{2}), <span class="string">'DeviceList'</span>);
0126             <span class="keyword">end</span>
0127             Status = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(deblank(Data{2}), <span class="string">'Status'</span>);
0128             DeviceListNew = editlist(DeviceList, deblank(Data{2}), Status);
0129             [i, iNotFound] = findrowindex(DeviceListNew, DeviceList);
0130             Status = 0 * Status;
0131             Status(i) = 1;
0132             <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(Status, deblank(Data{2}), <span class="string">'Status'</span>); 
0133             
0134         <span class="keyword">elseif</span> isnumeric(Data{1})
0135             answer = inputdlg({sprintf(<span class="string">'Change %s '</span>,TitleString)}, <span class="string">'Edit Middle Layer Family'</span>, size(Data{1},1), {num2str(Data{1})}, AddOpts);
0136             <span class="keyword">if</span> isempty(answer)
0137                 <span class="keyword">return</span>
0138             <span class="keyword">end</span>
0139             Data{1} = str2num(answer{1});
0140             set(h, <span class="string">'UserData'</span>, Data);
0141             <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(Data{1:end});
0142         <span class="keyword">elseif</span> strcmpi(Data{2},<span class="string">'Directory'</span>)
0143             answer = uigetdir(Data{1}, sprintf(<span class="string">'Change directory location for %s'</span>, Data{3}));
0144             <span class="keyword">if</span> answer == 0
0145                 <span class="keyword">return</span>
0146             <span class="keyword">end</span>
0147             Data{1} = answer;
0148             set(h, <span class="string">'UserData'</span>, Data);
0149             <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(Data{1:end});    
0150             
0151         <span class="keyword">elseif</span> ischar(Data{1})
0152             answer = inputdlg({sprintf(<span class="string">'Change %s '</span>,TitleString)}, <span class="string">'Edit Middle Layer Family'</span>, size(Data{1},1), {num2str(Data{1})}, AddOpts);
0153             <span class="keyword">if</span> isempty(answer)
0154                 <span class="keyword">return</span>
0155             <span class="keyword">end</span>
0156             Data{1} = answer{1};
0157             set(h, <span class="string">'UserData'</span>, Data);
0158             <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(Data{1:end});
0159         <span class="keyword">end</span>
0160         
0161     <span class="keyword">case</span> {<span class="string">'noaction'</span>, <span class="string">'no action'</span>}
0162     <span class="keyword">otherwise</span>
0163         disp(<span class="string">'Unknown action'</span>)
0164 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>