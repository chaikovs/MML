<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getrespmat</title>
  <meta name="keywords" content="getrespmat">
  <meta name="description" content="GETRESPMAT - Get response matrix data from a file">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; getrespmat.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>getrespmat
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>GETRESPMAT - Get response matrix data from a file</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [S, FileName] = getrespmat(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">GETRESPMAT - Get response matrix data from a file
  For Family, DeviceList inputs:
  [S, FileName] = getrespmat(MonitorFamily, MonitorDeviceList, ActuatorFamily, ActuatorDeviceList, FileName, GeV)

  For structure inputs:
  [S, FileName] = getrespmat(MonitorStruct, ActuatorStruct, FileName, GeV)

  INPUTS
  1. MonitorFamily  (or substitute MonitorStruct  for MonitorFamily  and MonitorDeviceList)
  2. MonitorDeviceList
  3. ActuatorFamily (or substitute ActuatorStruct for ActuatorFamily and ActuatorDeviceList)
  4. ActuatorDeviceList
     (Inputs 1-4 can be cell arrays)
  5. FileName - File name for response matrix (or cell array of file names) {Default: use AD.OpsData.RespFiles}
                [] or '' - prompt the user to choose a response matrix file
  6. GeV is the energy that the response matrix will be used at {Default or []: getenergy}.
     It's not always desirable to scale by the energy, so the following keywords can be used.
     'EnergyScaling' - Scale the response matrix by energy (getenergy / measured energy) {Default}
     'NoEnergyScaling' - Don't scale with energy
  7. 'Struct'  will return the response matrix structure {default for data structure inputs}
     'Numeric' will return a numeric matrix {default for non-data structure inputs}

  OUTPUTS
  1. S - the response matrix, empty if not found
  2. FileName - filename where the response matrix was found

  NOTES
  1. If the DeviceList is empty, [], or not present, all the device in that response matrix will be returned.
     This is different from most functions that return everything in family (family2dev).
  2. For Chromacity:  MonitorFamily = 'Chromaticity' and DeviceList = [1 1;1 2]
  3. For Tune:  MonitorFamily = 'TUNE' and DeviceList = [1 1;1 2]
  4. AccObj objects are converted to cell arrays.

  EXAMPLES
  1. Get a BPM response matrix 
     S = getrespmat('BPMx', [1 1;1 2; 1 3], 'HCOR', [1 1;2 1;2 3;4 1]);

  2. Get a BPM response matrix but return as a structure 
     S = getrespmat('BPMx', [1 1;1 2; 1 3], 'HCOR', [1 1;2 1;2 3;4 1],'struct');

  3. Get a 2x2 response matrix, form the coupled response matrix, and plot
     S = getrespmat({'BPMx','BPMz'}, {'HCOR','VCOR'});
     mesh(S);

  4. Structure inputs:
     Ymon = getz([1 1;1 2; 1 3],'struct'); 
     Yact = getsp('VCOR', [1 1;2 1;2 2;4 1],'struct');
     S = getrespmat(Ymon, Yact);
     Returns the same matrix as in Example 1.

  See Also <a href="getbpmresp.html" class="code" title="function [S, FileName] = getbpmresp(varargin)">getbpmresp</a>, <a href="gettuneresp.html" class="code" title="function [TuneMatrix, FileName] = gettuneresp(varargin)">gettuneresp</a>, <a href="getchroresp.html" class="code" title="function [ChromaticityMatrix, FileName] = getchroresp(varargin)">getchroresp</a>, <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="elem2dev.html" class="code" title="function Output = elem2dev(Family, ElementList)">elem2dev</a>	ELEM2DEV - Converts a device list to an element list</li><li><a href="getenergy.html" class="code" title="function [Energy, HCMEnergy] = getenergy(varargin)">getenergy</a>	GETENERGY - Returns the beam energy base on the bend magnet</li><li><a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>	GETFAMILYDATA - Gets data associated with the accelerator control</li><li><a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>	GETRESPMAT - Get response matrix data from a file</li><li><a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>	HW2PHYSICS - Converts from 'Hardware' units to 'Physics' units</li><li><a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>	PHYSICS2HW - Converts from 'Physics' units to 'Hardware' units</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="amp2mm.html" class="code" title="function mm = amp2mm(CMfamily, Amps, CMDevList, varargin)">amp2mm</a>	AMPS2MM - Returns the maximum millimeter orbit change per change in corrector</li><li><a href="getbpmresp.html" class="code" title="function [S, FileName] = getbpmresp(varargin)">getbpmresp</a>	GETBPMRESP - Returns the BPM response matrix in the horizontal and vertical planes</li><li><a href="getchro.html" class="code" title="function [Data, FileName] = getchro(varargin)">getchro</a>	GETCHRO - Return the chromaticity function (from file)</li><li><a href="getchroresp.html" class="code" title="function [ChromaticityMatrix, FileName] = getchroresp(varargin)">getchroresp</a>	GETCHRORESP - Loads the chromaticity response vector (or matrix) for multiple sextupole families</li><li><a href="getdisp.html" class="code" title="function [Data, FileName] = getdisp(varargin)">getdisp</a>	GETDISP - Returns the dispersion for a family (from file)</li><li><a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>	GETRESPMAT - Get response matrix data from a file</li><li><a href="gettuneresp.html" class="code" title="function [TuneMatrix, FileName] = gettuneresp(varargin)">gettuneresp</a>	GETTUNERESP - Loads the tune response vector (or matrix) for multiple quadrupole families</li><li><a href="mm2amp.html" class="code" title="function Amps = mm2amp(CMfamily, mm, CMDevList, varargin)">mm2amp</a>	MM2AMPS - Returns the change in corrector need for a maximum orbit change</li><li><a href="orbitcorrectionmethods.html" class="code" title="function [OCS, SmatNoWeights, S, U, V] = orbitcorrectionmethods(OCS, Smat, S, U, V)">orbitcorrectionmethods</a>	ORBITCORRECTIONMETHODS - Some the orbit correction methods used on light sources</li><li><a href="plotorbitdata.html" class="code" title="function [BPMx, BPMy] = plotorbitdata(varargin)">plotorbitdata</a>	PLOTORBITDATA - Plots BPM statistics</li><li><a href="quadcenter.html" class="code" title="function [QMS1, QMS2] = quadcenter(QuadFamily, QuadDev, XYPlane, FigureHandle)">quadcenter</a>	QUADCENTER - Measure the magnet center of a quadrupole magnet</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [S, FileName] = getrespmat(varargin)</a>
0002 <span class="comment">%GETRESPMAT - Get response matrix data from a file</span>
0003 <span class="comment">%  For Family, DeviceList inputs:</span>
0004 <span class="comment">%  [S, FileName] = getrespmat(MonitorFamily, MonitorDeviceList, ActuatorFamily, ActuatorDeviceList, FileName, GeV)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%  For structure inputs:</span>
0007 <span class="comment">%  [S, FileName] = getrespmat(MonitorStruct, ActuatorStruct, FileName, GeV)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%  INPUTS</span>
0010 <span class="comment">%  1. MonitorFamily  (or substitute MonitorStruct  for MonitorFamily  and MonitorDeviceList)</span>
0011 <span class="comment">%  2. MonitorDeviceList</span>
0012 <span class="comment">%  3. ActuatorFamily (or substitute ActuatorStruct for ActuatorFamily and ActuatorDeviceList)</span>
0013 <span class="comment">%  4. ActuatorDeviceList</span>
0014 <span class="comment">%     (Inputs 1-4 can be cell arrays)</span>
0015 <span class="comment">%  5. FileName - File name for response matrix (or cell array of file names) {Default: use AD.OpsData.RespFiles}</span>
0016 <span class="comment">%                [] or '' - prompt the user to choose a response matrix file</span>
0017 <span class="comment">%  6. GeV is the energy that the response matrix will be used at {Default or []: getenergy}.</span>
0018 <span class="comment">%     It's not always desirable to scale by the energy, so the following keywords can be used.</span>
0019 <span class="comment">%     'EnergyScaling' - Scale the response matrix by energy (getenergy / measured energy) {Default}</span>
0020 <span class="comment">%     'NoEnergyScaling' - Don't scale with energy</span>
0021 <span class="comment">%  7. 'Struct'  will return the response matrix structure {default for data structure inputs}</span>
0022 <span class="comment">%     'Numeric' will return a numeric matrix {default for non-data structure inputs}</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%  OUTPUTS</span>
0025 <span class="comment">%  1. S - the response matrix, empty if not found</span>
0026 <span class="comment">%  2. FileName - filename where the response matrix was found</span>
0027 <span class="comment">%</span>
0028 <span class="comment">%  NOTES</span>
0029 <span class="comment">%  1. If the DeviceList is empty, [], or not present, all the device in that response matrix will be returned.</span>
0030 <span class="comment">%     This is different from most functions that return everything in family (family2dev).</span>
0031 <span class="comment">%  2. For Chromacity:  MonitorFamily = 'Chromaticity' and DeviceList = [1 1;1 2]</span>
0032 <span class="comment">%  3. For Tune:  MonitorFamily = 'TUNE' and DeviceList = [1 1;1 2]</span>
0033 <span class="comment">%  4. AccObj objects are converted to cell arrays.</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%  EXAMPLES</span>
0036 <span class="comment">%  1. Get a BPM response matrix</span>
0037 <span class="comment">%     S = getrespmat('BPMx', [1 1;1 2; 1 3], 'HCOR', [1 1;2 1;2 3;4 1]);</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%  2. Get a BPM response matrix but return as a structure</span>
0040 <span class="comment">%     S = getrespmat('BPMx', [1 1;1 2; 1 3], 'HCOR', [1 1;2 1;2 3;4 1],'struct');</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%  3. Get a 2x2 response matrix, form the coupled response matrix, and plot</span>
0043 <span class="comment">%     S = getrespmat({'BPMx','BPMz'}, {'HCOR','VCOR'});</span>
0044 <span class="comment">%     mesh(S);</span>
0045 <span class="comment">%</span>
0046 <span class="comment">%  4. Structure inputs:</span>
0047 <span class="comment">%     Ymon = getz([1 1;1 2; 1 3],'struct');</span>
0048 <span class="comment">%     Yact = getsp('VCOR', [1 1;2 1;2 2;4 1],'struct');</span>
0049 <span class="comment">%     S = getrespmat(Ymon, Yact);</span>
0050 <span class="comment">%     Returns the same matrix as in Example 1.</span>
0051 <span class="comment">%</span>
0052 <span class="comment">%  See Also getbpmresp, gettuneresp, getchroresp, getdata</span>
0053 
0054 <span class="comment">%</span>
0055 <span class="comment">%  Written by Gregory J. Portmann</span>
0056 <span class="comment">%  Modified By Laurent S. Nadolski</span>
0057 
0058 <span class="keyword">if</span> length(varargin) &lt; 2
0059     error(<span class="string">'getrespmat must have at least a Monitor input and a Actuator input'</span>);
0060 <span class="keyword">end</span>
0061 
0062 
0063 <span class="comment">% Defaults</span>
0064 StructOutputFlag = 0;
0065 NumericOutputFlag = 0;
0066 EnergyScalingFlag = 1;
0067 ChangeUnitsFlag = <span class="string">''</span>;
0068 MonitorDeviceList = [];
0069 ActuatorDeviceList = [];
0070 GeVGoal = [];
0071 
0072 <span class="comment">% Look for input flags</span>
0073 InputFlags = {};
0074 <span class="keyword">for</span> i = length(varargin):-1:1
0075     <span class="keyword">if</span> isstruct(varargin{i})
0076         <span class="comment">% Ignore structures</span>
0077     <span class="keyword">elseif</span> iscell(varargin{i})
0078         <span class="comment">% Ignore cells</span>
0079     <span class="keyword">elseif</span> isa(varargin{i},<span class="string">'AccObj'</span>)
0080         AccObj1 = struct(varargin{i});
0081         Families = fieldnames(AccObj1);
0082         j = 0;
0083         <span class="keyword">for</span> k = 1:length(Families)
0084             <span class="keyword">if</span> ~isempty(AccObj1.(Families{k}))
0085                 j = j + 1;
0086                 tmpcell{j} = AccObj1.(Families{k});
0087             <span class="keyword">end</span>
0088         <span class="keyword">end</span>
0089         <span class="comment">%if length(tmpcell) == 1</span>
0090         <span class="comment">%    varargin{i} = tmpcell{1};</span>
0091         <span class="comment">%else</span>
0092             varargin{i} = tmpcell;
0093         <span class="comment">%end</span>
0094         
0095         <span class="keyword">if</span> ~StructOutputFlag
0096             NumericOutputFlag = 1;
0097         <span class="keyword">end</span>
0098     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Struct'</span>)
0099         StructOutputFlag = 1;
0100         varargin(i) = [];
0101     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Numeric'</span>)
0102         NumericOutputFlag = 1;
0103         StructOutputFlag = 0;
0104         varargin(i) = [];
0105     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Online'</span>)
0106         varargin(i) = [];
0107     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Simulator'</span>)
0108         varargin(i) = [];
0109     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Model'</span>)
0110         fprintf(<span class="string">'WARNING: ''Model'' input ignored use measbpmresp(''Model'') (getrespmat)'</span>);
0111         varargin(i) = [];
0112     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Physics'</span>)
0113         ChangeUnitsFlag = <span class="string">'Physics'</span>;
0114         InputFlags = [InputFlags varargin(i)];
0115         varargin(i) = [];
0116     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Hardware'</span>)
0117         ChangeUnitsFlag = <span class="string">'Hardware'</span>;
0118         InputFlags = [InputFlags varargin(i)];
0119         varargin(i) = [];
0120     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'EnergyScaling'</span>)
0121         EnergyScalingFlag = 1;
0122         GeVGoal = [];
0123         InputFlags = [InputFlags varargin(i)];
0124         varargin(i) = [];
0125     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'NoEnergyScaling'</span>)
0126         EnergyScalingFlag = 0;
0127         GeVGoal = <span class="string">'NoEnergyScaling'</span>;
0128         InputFlags = [InputFlags varargin(i)];
0129         varargin(i) = [];
0130     <span class="keyword">end</span>
0131 <span class="keyword">end</span>
0132 
0133 
0134 <span class="comment">% Cell array inputs</span>
0135 <span class="keyword">if</span> iscell(varargin{1})
0136     <span class="comment">% All remaining inputs except filename must be a cell array</span>
0137     <span class="keyword">if</span> ~iscell(varargin{2})
0138         error(<span class="string">'Input 2 must also be a cell or an AccObj'</span>);
0139     <span class="keyword">end</span>
0140     
0141     Ncell = 0;
0142     <span class="keyword">for</span> i = 1:length(varargin)
0143         <span class="keyword">if</span> iscell(varargin{i})
0144             Ncell = Ncell + 1;
0145         <span class="keyword">end</span>
0146     <span class="keyword">end</span>
0147     
0148     MonitorCell = varargin{1};
0149     MonitorDeviceListCell = [];
0150     ActuatorDeviceCell = [];
0151     <span class="keyword">if</span> Ncell == 2
0152         ActuatorCell = varargin{2};
0153     <span class="keyword">elseif</span> Ncell &gt;= 3
0154         MonitorDeviceListCell = varargin{2};
0155         ActuatorCell = varargin{3};
0156     <span class="keyword">end</span>
0157     <span class="keyword">if</span> Ncell &gt;= 4
0158         ActuatorDeviceCell = varargin{4};
0159     <span class="keyword">end</span>
0160     
0161     <span class="comment">% Remove the cell inputs from varargin</span>
0162     <span class="keyword">for</span> i = 1:Ncell
0163         varargin(1) = [];
0164     <span class="keyword">end</span> 
0165     
0166     <span class="keyword">if</span> isempty(MonitorDeviceListCell)
0167         <span class="keyword">for</span> i = 1:length(MonitorCell)
0168             MonitorDeviceListCell{i} = [];
0169         <span class="keyword">end</span>
0170     <span class="keyword">end</span>
0171     <span class="keyword">if</span> isempty(ActuatorDeviceCell)
0172         <span class="keyword">for</span> i = 1:length(ActuatorCell)
0173             ActuatorDeviceCell{i} = [];
0174         <span class="keyword">end</span>
0175     <span class="keyword">end</span>
0176     
0177     <span class="comment">% Force column for monitors and rows for actuators</span>
0178     MonitorCell = MonitorCell(:);
0179     MonitorDeviceListCell = MonitorDeviceListCell(:);
0180     ActuatorCell = ActuatorCell(:)';
0181     ActuatorDeviceCell = ActuatorDeviceCell(:)';
0182     
0183     <span class="keyword">if</span> isstruct(MonitorCell{1})
0184         <span class="keyword">if</span> ~NumericOutputFlag
0185             StructOutputFlag = 1; <span class="comment">% Only change StructOutputFlag if 'Numeric' is not on the input line</span>
0186         <span class="keyword">end</span>
0187     <span class="keyword">end</span>
0188     
0189     <span class="comment">% Main cell array loop</span>
0190     <span class="keyword">for</span> i = 1:length(MonitorCell)
0191         <span class="keyword">for</span> j = 1:length(ActuatorCell)
0192             <span class="keyword">if</span> isempty(MonitorDeviceListCell{i})
0193                 [Smat, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorCell{i}, ActuatorCell{j}, ActuatorDeviceCell{j}, <span class="string">'Struct'</span>, InputFlags{:}, varargin{:});
0194             <span class="keyword">elseif</span> isempty(MonitorDeviceListCell{i}) &amp;&amp; isempty(ActuatorDeviceCell{i})
0195                 [Smat, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorCell{i}, ActuatorCell{j}, <span class="string">'Struct'</span>, InputFlags{:}, varargin{:});
0196             <span class="keyword">elseif</span> isempty(ActuatorDeviceCell{j})
0197                 [Smat, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorCell{i}, MonitorDeviceListCell{i}, ActuatorCell{j}, <span class="string">'Struct'</span>, InputFlags{:}, varargin{:});
0198             <span class="keyword">else</span>
0199                 [Smat, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorCell{i}, MonitorDeviceListCell{i}, ActuatorCell{j}, ActuatorDeviceCell{j}, <span class="string">'Struct'</span>, InputFlags{:}, varargin{:});
0200             <span class="keyword">end</span>
0201             <span class="keyword">if</span> isempty(Smat)
0202                 S = [];
0203                 <span class="keyword">return</span>;
0204             <span class="keyword">else</span>
0205                 S(i,j) = Smat;
0206             <span class="keyword">end</span>
0207         <span class="keyword">end</span>    
0208     <span class="keyword">end</span>    
0209     
0210     <span class="keyword">if</span> ~StructOutputFlag
0211         Smat = [];
0212         <span class="keyword">for</span> i = 1:length(MonitorCell)
0213             SmatRow = [];
0214             <span class="keyword">for</span> j = 1:length(ActuatorCell)
0215                 SmatRow = [SmatRow S(i,j).Data];
0216             <span class="keyword">end</span>
0217             Smat = [Smat; SmatRow];
0218         <span class="keyword">end</span>
0219         S = Smat;
0220     <span class="keyword">end</span>
0221     
0222     <span class="keyword">return</span>
0223 <span class="keyword">end</span> <span class="comment">% Cell Input</span>
0224 
0225 
0226 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0227 <span class="comment">% Parse Non-cell Inputs %</span>
0228 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0229 
0230 <span class="comment">% Look for Monitor family info (string or structure)</span>
0231 <span class="keyword">if</span> length(varargin) &gt;= 1
0232     <span class="keyword">if</span> isstruct(varargin{1})
0233         MonitorFamilyString = varargin{1}.FamilyName;
0234         MonitorDeviceList = varargin{1}.DeviceList;
0235 
0236         <span class="comment">% For structure inputs, units are determined the BPM input (unless there was an override)</span>
0237         <span class="keyword">if</span> isempty(ChangeUnitsFlag)
0238             ChangeUnitsFlag = varargin{1}.Units;
0239         <span class="keyword">end</span>
0240 
0241         <span class="comment">% Only change StructOutputFlag if 'Numeric' is not on the input line</span>
0242         <span class="keyword">if</span> ~NumericOutputFlag
0243             StructOutputFlag = 1;
0244         <span class="keyword">end</span>
0245         varargin(1) = [];
0246     <span class="keyword">elseif</span> ischar(varargin{1})
0247         MonitorFamilyString = varargin{1};
0248         varargin(1) = [];
0249         <span class="keyword">if</span> length(varargin) &gt;= 1
0250             <span class="keyword">if</span> isnumeric(varargin{1})
0251                 MonitorDeviceList = varargin{1};
0252                 varargin(1) = [];
0253             <span class="keyword">end</span>
0254         <span class="keyword">end</span>
0255     <span class="keyword">elseif</span> isnumeric(varargin{1})
0256         MonitorDeviceList = varargin{1};
0257         varargin(1) = [];
0258     <span class="keyword">end</span>
0259 <span class="keyword">end</span>
0260 
0261 <span class="comment">% Look for Actuator family info (string or structure)</span>
0262 <span class="keyword">if</span> length(varargin) &gt;= 1
0263     <span class="keyword">if</span> isstruct(varargin{1})
0264         ActuatorFamilyString = varargin{1}.FamilyName;
0265         ActuatorDeviceList = varargin{1}.DeviceList;
0266 
0267         <span class="comment">% For structure inputs, units are determined the first input</span>
0268         <span class="keyword">if</span> isempty(ChangeUnitsFlag)
0269             ChangeUnitsFlag = varargin{1}.Units;
0270         <span class="keyword">end</span>
0271 
0272         <span class="keyword">if</span> ~NumericOutputFlag
0273             StructOutputFlag = 1; <span class="comment">% Only change StructOutputFlag if 'Numeric' is not on the input line</span>
0274         <span class="keyword">end</span>
0275         varargin(1) = [];
0276     <span class="keyword">elseif</span> ischar(varargin{1})
0277         ActuatorFamilyString = varargin{1};
0278         varargin(1) = [];
0279         <span class="keyword">if</span> length(varargin) &gt;= 1
0280             <span class="keyword">if</span> isnumeric(varargin{1})
0281                 ActuatorDeviceList = varargin{1};
0282                 varargin(1) = [];
0283             <span class="keyword">end</span>
0284         <span class="keyword">end</span>
0285     <span class="keyword">elseif</span> isnumeric(varargin{1})
0286         ActuatorDeviceList = varargin{1};
0287         varargin(1) = [];
0288     <span class="keyword">end</span>
0289 <span class="keyword">end</span>
0290 
0291 <span class="keyword">if</span> isempty(MonitorFamilyString) || isempty(ActuatorFamilyString)
0292     S = [];
0293     <span class="keyword">return</span>
0294 <span class="keyword">end</span>
0295 
0296 <span class="keyword">if</span> length(varargin) &gt;= 1 &amp;&amp; ischar(varargin{1})
0297         FileName = varargin{1};
0298         varargin(1) = [];
0299 <span class="keyword">else</span>
0300     FileName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'OpsData'</span>,<span class="string">'RespFiles'</span>);
0301 <span class="keyword">end</span>
0302 <span class="keyword">if</span> length(varargin) &gt;= 1
0303     GeVGoal = varargin{1};
0304 <span class="keyword">end</span>
0305 
0306 <span class="keyword">if</span> isempty(FileName)
0307     FileName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'OpsData'</span>, <span class="string">'RespFiles'</span>);
0308     FilePromptFlag = 1;
0309 <span class="keyword">else</span>    
0310     FilePromptFlag = 0;
0311 <span class="keyword">end</span>
0312 
0313 
0314 <span class="comment">% Force ResponseMatrixFiles to be a cell</span>
0315 <span class="keyword">if</span> iscell(FileName)
0316     ResponseMatrixFiles = FileName;
0317 <span class="keyword">else</span>
0318     ResponseMatrixFiles = {FileName};
0319 <span class="keyword">end</span>
0320 
0321 Found = 0;
0322 <span class="keyword">for</span> i = 1:length(ResponseMatrixFiles)
0323     <span class="comment">%   try</span>
0324     <span class="comment">% FileStruct is a structure of all the variable inside ResponseMatrixFiles</span>
0325     
0326     <span class="keyword">if</span> exist([ResponseMatrixFiles{i}],<span class="string">'file'</span>) || exist([ResponseMatrixFiles{i} <span class="string">'.mat'</span>],<span class="string">'file'</span>)
0327         FileStruct = load(ResponseMatrixFiles{i});
0328         
0329         <span class="comment">% VarCell is a cell array of the field names of FileStruct</span>
0330         VarCell = fieldnames(FileStruct);   <span class="comment">% who('-file', ResponseMatrixFiles{i});</span>
0331         
0332         <span class="keyword">for</span> j = 1:length(VarCell)
0333             <span class="comment">% OneField is one of the fields of FileStruct</span>
0334             OneField = FileStruct.(VarCell{j});
0335             
0336             <span class="comment">% Look through all the variable to find a structure with Monitor, Actuator, and Data fields</span>
0337             <span class="keyword">for</span> ii = 1:size(OneField,1)
0338                 <span class="keyword">for</span> jj = 1:size(OneField,2)
0339                     
0340                     <span class="keyword">if</span> iscell(OneField)
0341                         
0342                         <span class="comment">% If OneField is a cell</span>
0343                         OneCell = OneField{ii,jj};
0344                         <span class="keyword">for</span> mm = 1:size(OneCell,1)
0345                             <span class="keyword">for</span> nn = 1:size(OneCell,2)
0346                                 <span class="comment">% If OneCell is an array, look through OneCell to find a structure with Monitor, Actuator, and Data</span>
0347                                 <span class="keyword">if</span> isfield(OneCell(mm,nn),<span class="string">'Monitor'</span>) &amp;&amp; isfield(OneCell(mm,nn),<span class="string">'Actuator'</span>) &amp;&amp; isfield(OneCell(mm,nn),<span class="string">'Data'</span>)
0348                                     <span class="keyword">if</span> isfield(OneCell(mm,nn).Monitor,<span class="string">'FamilyName'</span>) &amp;&amp; isfield(OneCell(mm,nn).Actuator,<span class="string">'FamilyName'</span>)
0349                                         <span class="comment">% Look for Monitor.FamilyName == MonitorFamilyString</span>
0350                                         <span class="keyword">if</span> strcmp(OneCell(mm,nn).Monitor.FamilyName, MonitorFamilyString)
0351                                             <span class="comment">% Look for Actuator.FamilyName == ActuatorFamilyString</span>
0352                                             <span class="keyword">if</span> strcmp(OneCell(mm,nn).Actuator.FamilyName, ActuatorFamilyString)
0353                                                 S = OneCell(mm,nn);
0354                                                 <span class="comment">%S = OneCell(mm,nn).Data;</span>
0355                                                 
0356                                                 <span class="keyword">if</span> isfield(OneCell(mm,nn).Monitor,<span class="string">'DeviceList'</span>)
0357                                                     <span class="comment">% Monitor field could be a data structure</span>
0358                                                     MonitorDeviceListTotal  = OneCell(mm,nn).Monitor.DeviceList;
0359                                                 <span class="keyword">else</span>
0360                                                     <span class="comment">% Monitor field could be another response matrix structure (like chromaticity)</span>
0361                                                     MonitorDeviceListTotal  = OneCell(mm,nn).Monitor.Monitor.DeviceList;
0362                                                 <span class="keyword">end</span>
0363                                                 
0364                                                 ActuatorDeviceListTotal = OneCell(mm,nn).Actuator.DeviceList;
0365                                                 Found = 1;
0366                                                 <span class="keyword">if</span> FilePromptFlag
0367                                                     <span class="comment">% Ask if found file is OK to use</span>
0368                                                     <span class="keyword">if</span> strcmpi(ResponseMatrixFiles{i}(end-3:end),<span class="string">'.mat'</span>)
0369                                                         [FileName, DirectoryName, FilterIndex] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a Response Matrix File'</span>, [ResponseMatrixFiles{i}]);
0370                                                     <span class="keyword">else</span>
0371                                                         [FileName, DirectoryName, FilterIndex] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a Response Matrix File'</span>, [ResponseMatrixFiles{i} <span class="string">'.mat'</span>]);
0372                                                     <span class="keyword">end</span>
0373                                                     <span class="keyword">if</span> FilterIndex == 0
0374                                                         fprintf(<span class="string">'   Warning: No response matrix loaded\n'</span>);
0375                                                         S=[]; FileName=[];
0376                                                         <span class="keyword">return</span>
0377                                                     <span class="keyword">end</span>
0378                                                     <span class="keyword">if</span> StructOutputFlag
0379                                                         [S, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorFamilyString, MonitorDeviceList, ActuatorFamilyString, ActuatorDeviceList, [DirectoryName FileName], GeVGoal, <span class="string">'struct'</span>);
0380                                                     <span class="keyword">else</span>
0381                                                         [S, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorFamilyString, MonitorDeviceList, ActuatorFamilyString, ActuatorDeviceList, [DirectoryName FileName], GeVGoal);
0382                                                     <span class="keyword">end</span>
0383                                                     <span class="keyword">return</span>    
0384                                                 <span class="keyword">end</span>
0385                                                 <span class="keyword">break</span>
0386                                             <span class="keyword">end</span>
0387                                         <span class="keyword">end</span>
0388                                     <span class="keyword">end</span>
0389                                 <span class="keyword">end</span>
0390                             <span class="keyword">end</span>
0391                         <span class="keyword">end</span>
0392                         
0393                     <span class="keyword">else</span>
0394                         
0395                         <span class="comment">% If OneField is an array, look through OneField to find a structure with Monitor, Actuator, and Data</span>
0396                         <span class="keyword">if</span> isfield(OneField(ii,jj),<span class="string">'Monitor'</span>) &amp;&amp; isfield(OneField(ii,jj),<span class="string">'Actuator'</span>) &amp;&amp; isfield(OneField(ii,jj),<span class="string">'Data'</span>)
0397                             <span class="comment">% Look for Monitor.FamilyName == MonitorFamilyString</span>
0398                             <span class="keyword">if</span> isfield(OneField(ii,jj).Monitor,<span class="string">'FamilyName'</span>) &amp;&amp; isfield(OneField(ii,jj).Actuator,<span class="string">'FamilyName'</span>)
0399                                 <span class="keyword">if</span> strcmp(OneField(ii,jj).Monitor.FamilyName, MonitorFamilyString)
0400                                     <span class="comment">% Look for Actuator.FamilyName == ActuatorFamilyString</span>
0401                                     <span class="keyword">if</span> strcmp(OneField(ii,jj).Actuator.FamilyName, ActuatorFamilyString)
0402                                         S = OneField(ii,jj);
0403                                         <span class="comment">%S = OneField(ii,jj).Data;</span>
0404                                         
0405                                         <span class="keyword">if</span> isfield(OneField(ii,jj).Monitor,<span class="string">'DeviceList'</span>)
0406                                             <span class="comment">% Monitor field could be a data structure</span>
0407                                             MonitorDeviceListTotal = OneField(ii,jj).Monitor.DeviceList;
0408                                         <span class="keyword">else</span>
0409                                             <span class="comment">% Monitor field could be another response matrix structure (like chromaticity)</span>
0410                                             MonitorDeviceListTotal = OneField(ii,jj).Monitor.Monitor.DeviceList;
0411                                         <span class="keyword">end</span>
0412                                         
0413                                         ActuatorDeviceListTotal = OneField(ii,jj).Actuator.DeviceList;
0414                                         Found = 1;
0415                                         <span class="keyword">if</span> FilePromptFlag
0416                                             <span class="comment">% Ask if found file is OK to use</span>
0417                                             <span class="keyword">if</span> strcmpi(ResponseMatrixFiles{i}(end-3:end),<span class="string">'.mat'</span>)
0418                                                 [FileName, DirectoryName, FilterIndex] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a Response Matrix File'</span>, [ResponseMatrixFiles{i}]);
0419                                             <span class="keyword">else</span>
0420                                                 [FileName, DirectoryName, FilterIndex] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a Response Matrix File'</span>, [ResponseMatrixFiles{i} <span class="string">'.mat'</span>]);
0421                                             <span class="keyword">end</span>
0422                                             <span class="keyword">if</span> FilterIndex == 0
0423                                                 fprintf(<span class="string">'   Warning: No response matrix loaded\n'</span>);
0424                                                 S=[]; FileName=[];
0425                                                 <span class="keyword">return</span>
0426                                             <span class="keyword">end</span>
0427                                             <span class="keyword">if</span> StructOutputFlag
0428                                                 [S, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorFamilyString, MonitorDeviceList, ActuatorFamilyString, ActuatorDeviceList, [DirectoryName FileName], GeVGoal, <span class="string">'struct'</span>);
0429                                             <span class="keyword">else</span>
0430                                                 [S, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorFamilyString, MonitorDeviceList, ActuatorFamilyString, ActuatorDeviceList, [DirectoryName FileName], GeVGoal);
0431                                             <span class="keyword">end</span>
0432                                             <span class="keyword">return</span>    
0433                                         <span class="keyword">end</span>                                        
0434                                         <span class="keyword">break</span>
0435                                     <span class="keyword">end</span>
0436                                 <span class="keyword">end</span>
0437                             <span class="keyword">end</span>
0438                         <span class="keyword">end</span>
0439                         
0440                     <span class="keyword">end</span>
0441                     
0442                 <span class="keyword">end</span>
0443                 <span class="keyword">if</span> Found
0444                     <span class="keyword">break</span>;
0445                 <span class="keyword">end</span>
0446             <span class="keyword">end</span>
0447             <span class="keyword">if</span> Found
0448                 <span class="keyword">break</span>;
0449             <span class="keyword">end</span>
0450             
0451         <span class="keyword">end</span>
0452         <span class="comment">%     catch</span>
0453         <span class="comment">%         fprintf('   Warning: Response matrix file could not be found\n');</span>
0454         <span class="comment">%         S=[]; FileName=[];</span>
0455         <span class="comment">%         return</span>
0456         <span class="comment">%     end</span>
0457         <span class="keyword">if</span> Found
0458             <span class="keyword">break</span>;
0459         <span class="keyword">end</span>
0460     <span class="keyword">end</span>
0461     <span class="keyword">if</span> Found
0462         <span class="keyword">break</span>;
0463     <span class="keyword">end</span>
0464 <span class="keyword">end</span>
0465 
0466 <span class="keyword">if</span> ~Found
0467     <span class="keyword">if</span> FilePromptFlag
0468         <span class="comment">% Ask if found file is OK to use</span>
0469         [FileName, DirectoryName, FilterIndex] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a Response Matrix File'</span>);
0470         <span class="keyword">if</span> FilterIndex == 0
0471             fprintf(<span class="string">'   Warning: No response matrix loaded\n'</span>);
0472             S=[]; FileName=[];
0473             <span class="keyword">return</span>
0474         <span class="keyword">end</span>
0475         <span class="keyword">if</span> StructOutputFlag
0476             [S, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorFamilyString, MonitorDeviceList, ActuatorFamilyString, ActuatorDeviceList, [DirectoryName FileName], GeVGoal, <span class="string">'struct'</span>);
0477         <span class="keyword">else</span>
0478             [S, FileName] = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(MonitorFamilyString, MonitorDeviceList, ActuatorFamilyString, ActuatorDeviceList, [DirectoryName FileName], GeVGoal);
0479         <span class="keyword">end</span>
0480         <span class="keyword">return</span>
0481     <span class="keyword">else</span>
0482         error(<span class="string">'Could not find the proper response matrix'</span>);
0483     <span class="keyword">end</span>
0484 <span class="keyword">end</span>
0485 
0486 
0487 FileName = ResponseMatrixFiles{i};
0488 <span class="comment">%fprintf('   %s response matrix file was created on %s.\n', FileName, datestr(datenum(S.TimeStamp)));</span>
0489 
0490 
0491 <span class="comment">% Scale the response matrix to the present energy (If it's in Hardware units.  Physics units don't get scaled.)</span>
0492 <span class="keyword">if</span> EnergyScalingFlag
0493     <span class="keyword">if</span> isfield(S, <span class="string">'Units'</span>)
0494         <span class="keyword">if</span> strcmpi(S.Units,<span class="string">'Hardware'</span>)
0495             <span class="keyword">if</span> isempty(GeVGoal)
0496                 GeVGoal = <a href="getenergy.html" class="code" title="function [Energy, HCMEnergy] = getenergy(varargin)">getenergy</a>;  <span class="comment">% bend2gev</span>
0497             <span class="keyword">end</span>
0498             <span class="keyword">if</span> abs(S.GeV-GeVGoal)&gt;1e-3 &amp;&amp; ~isnan(S.GeV) &amp;&amp; ~isnan(GeVGoal)
0499                 <span class="keyword">if</span> ~strcmpi(ChangeUnitsFlag,<span class="string">'Physics'</span>)
0500                     <span class="comment">% Don't scale if in physics units</span>
0501                     <span class="comment">%fprintf('   Response matrix scaled to %.3f GeV using R(%.3f) = %.3f * R(%.3f) / %.3f\n', GeVGoal, GeVGoal, S.GeV, S.GeV, GeVGoal);</span>
0502                     S.Data = S.GeV * S.Data / GeVGoal;
0503                 <span class="keyword">end</span>
0504                 S.GeV = GeVGoal;
0505             <span class="keyword">end</span>
0506         <span class="keyword">end</span>
0507     <span class="keyword">end</span>
0508 <span class="keyword">end</span>
0509 
0510 
0511 <span class="keyword">if</span> strcmpi(ChangeUnitsFlag,<span class="string">'Physics'</span>)
0512     S = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(S);
0513 <span class="keyword">elseif</span> strcmpi(ChangeUnitsFlag,<span class="string">'Hardware'</span>)
0514     S = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(S);
0515 <span class="keyword">end</span>
0516 
0517 
0518 <span class="comment">% Index the response matrix</span>
0519 <span class="keyword">if</span> isempty(ActuatorDeviceList)
0520     ActuatorDeviceList = S.Actuator.DeviceList;
0521 <span class="keyword">elseif</span> size(ActuatorDeviceList,2) == 1
0522     <span class="comment">% Convert element list to a device list</span>
0523     ActuatorDeviceList = <a href="elem2dev.html" class="code" title="function Output = elem2dev(Family, ElementList)">elem2dev</a>(S.Actuator.FamilyName, ActuatorDeviceList);
0524 <span class="keyword">end</span>
0525 
0526 <span class="keyword">if</span> isempty(MonitorDeviceList)
0527     MonitorDeviceList = S.Monitor.DeviceList;
0528 <span class="keyword">elseif</span> size(MonitorDeviceList,2) == 1
0529     <span class="comment">% Convert element list to a device list</span>
0530     MonitorDeviceList = <a href="elem2dev.html" class="code" title="function Output = elem2dev(Family, ElementList)">elem2dev</a>(S.Monitor.FamilyName, MonitorDeviceList);
0531 <span class="keyword">end</span>
0532 [MonitorIndex, iNotFound, iMonitor] = findrowindex(MonitorDeviceList,  MonitorDeviceListTotal);
0533 <span class="keyword">if</span> ~isempty(iNotFound)
0534     <span class="comment">% Error if a monitor is not found</span>
0535     <span class="comment">%for i = iNotFound(:)'</span>
0536     <span class="comment">%    fprintf('   %s(%d,%d) not found\n', S.Monitor.FamilyName, MonitorDeviceList(i,1), MonitorDeviceList(i,2));</span>
0537     <span class="comment">%end</span>
0538     <span class="comment">%error('Monitor not found');</span>
0539     
0540     <span class="comment">% Fill the missing data with NaN</span>
0541     Data = NaN * ones(size(MonitorDeviceList,1), size(S.Data,2));
0542     Data(iMonitor,:) = S.Data(MonitorIndex,:);
0543     S.Data = Data;
0544     
0545     <span class="comment">% Fill the missing .Monitor with NaN</span>
0546     Data = NaN * ones(size(MonitorDeviceList,1),1);
0547     Data(iMonitor) = S.Monitor.Data(MonitorIndex);
0548     S.Monitor.Data = Data;
0549     S.Monitor.DeviceList = MonitorDeviceList;
0550 
0551     <span class="comment">% Fill the missing .Status with zeros</span>
0552     Data = zeros(size(MonitorDeviceList,1),1);
0553     Data(iMonitor) = S.Monitor.Status(MonitorIndex);
0554     S.Monitor.Status = Data;
0555 
0556     <span class="comment">% Fill the missing .Monitor1 with NaN</span>
0557     <span class="keyword">if</span> isfield(S, <span class="string">'Monitor1'</span>)
0558         Data = NaN * ones(size(MonitorDeviceList,1),size(S.Monitor1,2));
0559         Data(iMonitor,:) = S.Monitor1(MonitorIndex,:);
0560         S.Monitor1 = Data;
0561     <span class="keyword">end</span>
0562     
0563     <span class="comment">% Fill the missing .Monitor1 with NaN</span>
0564     <span class="keyword">if</span> isfield(S, <span class="string">'Monitor2'</span>)
0565         Data = NaN * ones(size(MonitorDeviceList,1),size(S.Monitor2,2));
0566         Data(iMonitor,:) = S.Monitor2(MonitorIndex,:);
0567         S.Monitor2 = Data;
0568     <span class="keyword">end</span>
0569     
0570 <span class="keyword">else</span>
0571     S.Data = S.Data(MonitorIndex, :);
0572     S.Monitor.Data = S.Monitor.Data(MonitorIndex, :);
0573     S.Monitor.DeviceList = MonitorDeviceList;
0574     <span class="keyword">if</span> isfield(S.Monitor, <span class="string">'Status'</span>)
0575         S.Monitor.Status = S.Monitor.Status(MonitorIndex, :);
0576     <span class="keyword">end</span>    
0577     <span class="keyword">if</span> isfield(S, <span class="string">'Monitor1'</span>)
0578         S.Monitor1 = S.Monitor1(MonitorIndex, :);
0579     <span class="keyword">end</span>
0580     <span class="keyword">if</span> isfield(S, <span class="string">'Monitor2'</span>)
0581         S.Monitor2 = S.Monitor2(MonitorIndex, :);
0582     <span class="keyword">end</span>
0583 <span class="keyword">end</span>
0584 
0585 
0586 [ActuatorIndex, iNotFound, iActuator] = findrowindex(ActuatorDeviceList, ActuatorDeviceListTotal);
0587 <span class="keyword">if</span> ~isempty(iNotFound)
0588     <span class="comment">% Error if a Actuator is not found</span>
0589     <span class="comment">%for i = iNotFound(:)'</span>
0590     <span class="comment">%    fprintf('   %s(%d,%d) not found\n', S.Actuator.FamilyName, ActuatorDeviceList(i,1), ActuatorDeviceList(i,2));</span>
0591     <span class="comment">%end</span>
0592     <span class="comment">%error('Actuator not found');</span>
0593     
0594     <span class="comment">% Fill the missing .Data with NaN</span>
0595     Data = NaN * ones(size(MonitorDeviceList,1), size(ActuatorDeviceList,1));
0596     Data(:, iActuator) = S.Data(:,ActuatorIndex);
0597     S.Data = Data;
0598 
0599     <span class="comment">% Fill the missing .Actuator with NaN</span>
0600     Data = NaN * ones(size(ActuatorDeviceList,1),1);
0601     Data(iActuator) = S.Actuator.Data(ActuatorIndex);
0602     S.Actuator.Data = Data;
0603     S.Actuator.DeviceList = ActuatorDeviceList;
0604     
0605     <span class="comment">% Fill the missing .Status with zeros</span>
0606     Data = zeros(size(ActuatorDeviceList,1),1);
0607     Data(iActuator) = S.Actuator.Status(ActuatorIndex);
0608     S.Actuator.Status = Data;
0609 <span class="keyword">else</span>
0610     S.Data = S.Data(:, ActuatorIndex);
0611     S.Actuator.Data = S.Actuator.Data(ActuatorIndex);
0612     S.Actuator.DeviceList = ActuatorDeviceList;
0613     <span class="keyword">if</span> isfield(S.Actuator, <span class="string">'Status'</span>)
0614         S.Actuator.Status = S.Actuator.Status(ActuatorIndex);
0615     <span class="keyword">end</span>    
0616 <span class="keyword">end</span>
0617 
0618 
0619 <span class="keyword">if</span> StructOutputFlag    
0620     S.FileName = FileName;
0621 <span class="keyword">else</span>
0622     S = S.Data;
0623 <span class="keyword">end</span>
0624 
0625 
0626 
0627</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>