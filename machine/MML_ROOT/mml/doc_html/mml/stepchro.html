<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of stepchro</title>
  <meta name="keywords" content="stepchro">
  <meta name="description" content="STEPCHRO - Incremental change in the chromaticity (Delta Tune / Delta RF)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; stepchro.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>stepchro
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>STEPCHRO - Incremental change in the chromaticity (Delta Tune / Delta RF)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function  [DelSext, ActuatorFamily] = stepchro(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">STEPCHRO - Incremental change in the chromaticity (Delta Tune / Delta RF)
  [DelSext, SextFamily] = stepchro(DeltaChromaticity, ChroResponseMatrix)

  Step change in storage ring chromaticity using the default chromaticty correctors (findmemberof('Chromaticity Corrector'))

  INPUTS
  1.                     | Change in Horizontal Chromaticity |
     DeltaChromaticity = |                                   | 
                         | Change in Vertical Chromaticity   |
  2. ChroResponseMatrix - Chromaticity response matrix {Default: getchroresp}
  3. ActuatorFamily -  Sextupoles to vary, ex {'S9', 'S10'} {Default: findmemberof('Chromaticity Corrector')'}
  4. Optional override of the units:
     'Physics'  - Use physics  units
     'Hardware' - Use hardware units
  5. Optional override of the mode:
     'Online'    - Set/Get data online  
     'Model'     - Set/Get data on the simulated accelerator using AT
     'Simulator' - Set/Get data on the simulated accelerator using AT
     'Manual'    - Set/Get data manually


  OUTPUTS
  1. DelSext
  2. SextFamily - Families used (cell array)

  ALGORITHM  
     SVD method
  DelSext = inv(CHROMATICITY_RESP_MATRIX) * DeltaChromaticity

  NOTES
  1. Beware of what units you are working in.  The default units for chromaticity
     are physics units.  This is an exception to the normal middle layer convention.
     Hardware units for &quot;chromaticity&quot; is in tune change per change in RF frequency.  
     Since this is an unusual unit to work with, the default units for chromaticity
     is physics units.  Note that goal chromaticity is also stored in physics units.
  2. The actuator family comes from findmemberof('Chromaticity Corrector') or 'SF','SD' if empty
  
  EXAMPLES
  1. use default families 
      stepchro([1 0.5])
  2. use 10 families
    Sfam = {'S1','S2','S3','S4','S5','S6','S7','S8','S9','S10'}; 
    B = measchroresp('Model','Display',Sfam);
    stepchro([1 0.5],'Model',B,Sfam)

  See Also <a href="setchro.html" class="code" title="function [DelSext, ActuatorFamily] = setchro(varargin)">setchro</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>	FINDMEMBEROF - Finds all family members</li><li><a href="getchroresp.html" class="code" title="function [ChromaticityMatrix, FileName] = getchroresp(varargin)">getchroresp</a>	GETCHRORESP - Loads the chromaticity response vector (or matrix) for multiple sextupole families</li><li><a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>	GETSP - Gets setpoint channels</li><li><a href="setsp.html" class="code" title="function ErrorFlag = setsp(Family, varargin)">setsp</a>	SETSP - Makes an absolute setpoint change to the 'Setpoint' field</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="setchro.html" class="code" title="function [DelSext, ActuatorFamily] = setchro(varargin)">setchro</a>	SETCHRO - Measures then sets the chromaticity</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function  [DelSext, ActuatorFamily] = stepchro(varargin)</a>
0002 <span class="comment">%STEPCHRO - Incremental change in the chromaticity (Delta Tune / Delta RF)</span>
0003 <span class="comment">%  [DelSext, SextFamily] = stepchro(DeltaChromaticity, ChroResponseMatrix)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  Step change in storage ring chromaticity using the default chromaticty correctors (findmemberof('Chromaticity Corrector'))</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%  INPUTS</span>
0008 <span class="comment">%  1.                     | Change in Horizontal Chromaticity |</span>
0009 <span class="comment">%     DeltaChromaticity = |                                   |</span>
0010 <span class="comment">%                         | Change in Vertical Chromaticity   |</span>
0011 <span class="comment">%  2. ChroResponseMatrix - Chromaticity response matrix {Default: getchroresp}</span>
0012 <span class="comment">%  3. ActuatorFamily -  Sextupoles to vary, ex {'S9', 'S10'} {Default: findmemberof('Chromaticity Corrector')'}</span>
0013 <span class="comment">%  4. Optional override of the units:</span>
0014 <span class="comment">%     'Physics'  - Use physics  units</span>
0015 <span class="comment">%     'Hardware' - Use hardware units</span>
0016 <span class="comment">%  5. Optional override of the mode:</span>
0017 <span class="comment">%     'Online'    - Set/Get data online</span>
0018 <span class="comment">%     'Model'     - Set/Get data on the simulated accelerator using AT</span>
0019 <span class="comment">%     'Simulator' - Set/Get data on the simulated accelerator using AT</span>
0020 <span class="comment">%     'Manual'    - Set/Get data manually</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%  OUTPUTS</span>
0024 <span class="comment">%  1. DelSext</span>
0025 <span class="comment">%  2. SextFamily - Families used (cell array)</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%  ALGORITHM</span>
0028 <span class="comment">%     SVD method</span>
0029 <span class="comment">%  DelSext = inv(CHROMATICITY_RESP_MATRIX) * DeltaChromaticity</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%  NOTES</span>
0032 <span class="comment">%  1. Beware of what units you are working in.  The default units for chromaticity</span>
0033 <span class="comment">%     are physics units.  This is an exception to the normal middle layer convention.</span>
0034 <span class="comment">%     Hardware units for &quot;chromaticity&quot; is in tune change per change in RF frequency.</span>
0035 <span class="comment">%     Since this is an unusual unit to work with, the default units for chromaticity</span>
0036 <span class="comment">%     is physics units.  Note that goal chromaticity is also stored in physics units.</span>
0037 <span class="comment">%  2. The actuator family comes from findmemberof('Chromaticity Corrector') or 'SF','SD' if empty</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%  EXAMPLES</span>
0040 <span class="comment">%  1. use default families</span>
0041 <span class="comment">%      stepchro([1 0.5])</span>
0042 <span class="comment">%  2. use 10 families</span>
0043 <span class="comment">%    Sfam = {'S1','S2','S3','S4','S5','S6','S7','S8','S9','S10'};</span>
0044 <span class="comment">%    B = measchroresp('Model','Display',Sfam);</span>
0045 <span class="comment">%    stepchro([1 0.5],'Model',B,Sfam)</span>
0046 <span class="comment">%</span>
0047 <span class="comment">%  See Also setchro</span>
0048 
0049 <span class="comment">%</span>
0050 <span class="comment">%  Written by Gregory J. Portmann</span>
0051 <span class="comment">%  Modifed by Laurent S. Nadolski</span>
0052 <span class="comment">%  add ActuatorFamily as optional input</span>
0053 
0054 ModeFlag = {};
0055 UnitsFlag = {<span class="string">'Physics'</span>}; 
0056 
0057 <span class="keyword">for</span> i = length(varargin):-1:1
0058     <span class="keyword">if</span> strcmpi(varargin{i},<span class="string">'Physics'</span>)
0059         UnitsFlag = varargin(i);
0060         varargin(i) = [];
0061     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Hardware'</span>)
0062         UnitsFlag = varargin(i);
0063         varargin(i) = [];
0064     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Simulator'</span>) | strcmpi(varargin{i},<span class="string">'Model'</span>)
0065         ModeFlag = varargin(i);
0066         varargin(i) = [];
0067     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Online'</span>)
0068         ModeFlag = varargin(i);
0069         varargin(i) = [];
0070     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Manual'</span>)
0071         ModeFlag = varargin(i);
0072         varargin(i) = [];
0073     <span class="keyword">end</span>        
0074 <span class="keyword">end</span>
0075 
0076 
0077 <span class="keyword">if</span> length(varargin) &gt;= 1
0078     DeltaChrom = varargin{1};
0079 <span class="keyword">else</span>
0080     DeltaChrom = [];    
0081 <span class="keyword">end</span>
0082 <span class="keyword">if</span> isempty(DeltaChrom)
0083     answer = inputdlg({<span class="string">'Change the horizontal chromaticity by'</span>, <span class="string">'Change the vertical chromaticity by'</span>},<span class="string">'STEPCHRO'</span>,1,{<span class="string">'0'</span>,<span class="string">'0'</span>});
0084     <span class="keyword">if</span> isempty(answer)
0085         <span class="keyword">return</span>
0086     <span class="keyword">end</span>
0087     DeltaChrom(1,1) = str2num(answer{1});
0088     DeltaChrom(2,1) = str2num(answer{2});
0089 <span class="keyword">end</span>
0090 DeltaChrom = DeltaChrom(:);
0091 <span class="keyword">if</span> size(DeltaChrom,1) ~= 2
0092     error(<span class="string">'Input must be a 2x1 column vector.'</span>);
0093 <span class="keyword">end</span>
0094 <span class="keyword">if</span> DeltaChrom(1)==0 &amp;&amp; DeltaChrom(2)==0
0095     <span class="keyword">return</span>
0096 <span class="keyword">end</span>
0097 
0098 <span class="keyword">if</span> length(varargin) &gt;= 2
0099     ChroResponseMatrix = varargin{2};
0100 <span class="keyword">else</span>
0101     ChroResponseMatrix = [];    
0102 <span class="keyword">end</span>
0103 <span class="keyword">if</span> isempty(ChroResponseMatrix)
0104     ChroResponseMatrix = <a href="getchroresp.html" class="code" title="function [ChromaticityMatrix, FileName] = getchroresp(varargin)">getchroresp</a>(UnitsFlag{:});
0105 <span class="keyword">end</span>
0106 <span class="keyword">if</span> isempty(ChroResponseMatrix)
0107     error(<span class="string">'The chromaticity response matrix must be an input or available in one of the default response matrix files.'</span>);
0108 <span class="keyword">end</span>
0109 
0110 <span class="keyword">if</span> length(varargin) &gt;= 3
0111     ActuatorFamily = varargin{3};
0112 <span class="keyword">else</span>
0113     ActuatorFamily = <a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>(<span class="string">'Chromaticity Corrector'</span>)';
0114     <span class="keyword">if</span> isempty(ActuatorFamily)
0115         ActuatorFamily = {<span class="string">'S9'</span>,<span class="string">'S10'</span>};
0116     <span class="keyword">end</span>
0117 <span class="keyword">end</span>
0118 
0119 <span class="comment">% 1. SVD Tune Correction</span>
0120 <span class="comment">% Decompose the chromaticity response matrix:</span>
0121 [U, S, V] = svd(ChroResponseMatrix, <span class="string">'econ'</span>);
0122 <span class="comment">% ChroResponseMatrix = U*S*V'</span>
0123 <span class="comment">%</span>
0124 <span class="comment">% The V matrix columns are the singular vectors in the sextupole magnet space</span>
0125 <span class="comment">% The U matrix columns are the singular vectors in the chromaticity space</span>
0126 <span class="comment">% U'*U=I and V*V'=I</span>
0127 <span class="comment">%</span>
0128 <span class="comment">% CHROCoef is the projection onto the columns of ChroResponseMatrix*V(:,Ivec) (same space as spanned by U)</span>
0129 <span class="comment">% Sometimes it's interesting to look at the size of these coefficients with singular value number.</span>
0130 CHROCoef = diag(diag(S).^(-1)) * U' * DeltaChrom;
0131 <span class="comment">%</span>
0132 <span class="comment">% Convert the vector CHROCoef back to coefficents of ChroResponseMatrix</span>
0133 DelSext = V * CHROCoef;
0134 
0135 
0136 <span class="comment">% 2. Square matrix solution</span>
0137 <span class="comment">%DelSext = inv(ChroResponseMatrix) * DeltaChrom;</span>
0138 
0139 
0140 SP = <a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>(ActuatorFamily, UnitsFlag{:}, ModeFlag{:});
0141 
0142 <span class="keyword">if</span> iscell(SP)
0143     <span class="keyword">for</span> i = 1:length(SP)
0144         SP{i} = SP{i} + DelSext(i);
0145     <span class="keyword">end</span>
0146 <span class="keyword">else</span>
0147     SP = SP + DelSext;
0148 <span class="keyword">end</span>
0149 
0150 
0151 <a href="setsp.html" class="code" title="function ErrorFlag = setsp(Family, varargin)">setsp</a>(ActuatorFamily, SP, UnitsFlag{:}, ModeFlag{:});
0152</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>