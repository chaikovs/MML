<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of drawlattice</title>
  <meta name="keywords" content="drawlattice">
  <meta name="description" content="DRAWLATTICE - Draws the AT lattice to a figure">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">mml</a> &gt; <a href="index.html">at</a> &gt; drawlattice.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml/at&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>drawlattice
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>DRAWLATTICE - Draws the AT lattice to a figure</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function drawlattice(Offset, Scaling, hAxes) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">DRAWLATTICE - Draws the AT lattice to a figure
  drawlattice(Offset {0}, Scaling {1}, hAxes {gca})

  Programmers Note: The AT index is stored in the Userdata of each symbol.

  Written by Greg Portmann</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="family2atindex.html" class="code" title="function [ATIndexList, ErrorFlag] = family2atindex(Family, varargin);">family2atindex</a>	FAMILY2ATINDEX - Returns the AT index for a given family</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="modeldisp.html" class="code" title="function [Dx, Dy, Sx, Sy] = modeldisp(varargin)">modeldisp</a>	MODELDISP - Returns the dispersion function of the model</li><li><a href="modeltwiss.html" class="code" title="function [TwissX, TwissY, Sx, Sy, Tune] = modeltwiss(varargin)">modeltwiss</a>	MODELTWISS - Returns a twiss function of the model</li><li><a href="plotbeta.html" class="code" title="function varargout = plotbeta(varargin)">plotbeta</a>	PLOTBETA - plots UNCOUPLED! beta-functions</li><li><a href="plotbeta_alex.html" class="code" title="function varargout = plotbeta(varargin)">plotbeta_alex</a>	PLOTBETA - plots UNCOUPLED! beta-functions</li><li><a href="ploteta.html" class="code" title="function varargout = plotbeta(varargin)">ploteta</a>	PLOTETA plots UNCOUPLED! eta-functions</li><li><a href="plotmodelorbit.html" class="code" title="function varargout = plotcod">plotmodelorbit</a>	PLOTMODELORBIT - Plot closed orbit distortion</li><li><a href="plottwiss.html" class="code" title="function plottwiss(varargin)">plottwiss</a>	PLOTTWISS - Plot the optical functions and tune of the present lattice</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function drawlattice(Offset, Scaling, hAxes)</a>
0002 <span class="comment">%DRAWLATTICE - Draws the AT lattice to a figure</span>
0003 <span class="comment">%  drawlattice(Offset {0}, Scaling {1}, hAxes {gca})</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  Programmers Note: The AT index is stored in the Userdata of each symbol.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%  Written by Greg Portmann</span>
0008 
0009 
0010 <span class="keyword">global</span> THERING
0011 
0012 
0013 <span class="comment">% Minimum icon width in meters</span>
0014 MinIconWidth = .09;
0015 
0016 <span class="keyword">if</span> nargin &lt; 1
0017     Offset = 0;
0018 <span class="keyword">end</span>
0019 Offset = Offset(1);
0020 <span class="keyword">if</span> nargin &lt; 2
0021     Scaling = 1;
0022 <span class="keyword">end</span>
0023 Scaling = Scaling(1);
0024 
0025 <span class="keyword">if</span> nargin &lt; 3
0026     hAxes = gca;
0027 <span class="keyword">end</span>
0028 
0029 SPositions = findspos(THERING, 1:length(THERING)+1);
0030 L = SPositions(end);
0031 plot(hAxes, [0 L], [0 0]+Offset, <span class="string">'k'</span>);
0032 
0033 <span class="comment">% Remember the hold state then turn hold on</span>
0034 HoldState = ishold(hAxes);
0035 hold(hAxes, <span class="string">'on'</span>);
0036 
0037 
0038 ATIndexHCM = <a href="family2atindex.html" class="code" title="function [ATIndexList, ErrorFlag] = family2atindex(Family, varargin);">family2atindex</a>(gethcmfamily);
0039 ATIndexVCM = <a href="family2atindex.html" class="code" title="function [ATIndexList, ErrorFlag] = family2atindex(Family, varargin);">family2atindex</a>(getvcmfamily);
0040 
0041 
0042 <span class="comment">% Make default icons for elements of different physical types</span>
0043 <span class="keyword">for</span> i = 1:length(THERING)
0044     NumberOfFinds = 0;
0045     
0046     SPos = SPositions(i);
0047     <span class="keyword">if</span> isfield(THERING{i},<span class="string">'BendingAngle'</span>) &amp;&amp; THERING{i}.BendingAngle
0048         <span class="comment">% make icons for bending magnets</span>
0049         NumberOfFinds = NumberOfFinds + 1;
0050         IconHeight = .3;
0051         IconColor = [1 1 0];
0052         IconWidth = THERING{i}.Length;
0053         <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0054             IconWidth = MinIconWidth;
0055             SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0056         <span class="keyword">end</span>
0057         vx = [SPos SPos+IconWidth SPos+IconWidth SPos];
0058         vy = [IconHeight IconHeight -IconHeight -IconHeight];
0059         h = patch(vx, Scaling*vy+Offset, IconColor,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0060         set(h, <span class="string">'UserData'</span>, i);
0061 
0062         <span class="comment">%if IconWidth &lt; .1 % meters</span>
0063         <span class="comment">%    set(h, 'EdgeColor', IconColor);</span>
0064         <span class="comment">%end</span>
0065 
0066     <span class="keyword">elseif</span> isfield(THERING{i},<span class="string">'K'</span>) &amp;&amp; THERING{i}.K
0067         <span class="comment">% Quadrupole</span>
0068         NumberOfFinds = NumberOfFinds + 1;
0069        <span class="keyword">if</span> THERING{i}.K &gt; 0
0070             <span class="comment">% Focusing quadrupole</span>
0071             IconHeight = .8;
0072             IconColor = [1 0 0];
0073             IconWidth = THERING{i}.Length;
0074             <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0075                 IconWidth = MinIconWidth;
0076                 SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0077             <span class="keyword">end</span>
0078             vx = [SPos SPos+IconWidth/2  SPos+IconWidth SPos+IconWidth/2 SPos];
0079             vy = [0          IconHeight               0      -IconHeight    0];
0080         <span class="keyword">else</span>
0081             <span class="comment">% Defocusing quadrupole</span>
0082             IconHeight = .7;
0083             IconColor = [0 0 1];
0084             IconWidth = THERING{i}.Length;
0085             <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0086                 <span class="comment">% Center about starting point</span>
0087                 IconWidth = MinIconWidth;
0088                 SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0089             <span class="keyword">end</span>
0090             vx = [SPos+.4*IconWidth    SPos    SPos+IconWidth  SPos+.6*IconWidth  SPos+IconWidth    SPos      SPos+.4*IconWidth];
0091             vy = [     0            IconHeight   IconHeight          0              -IconHeight  -IconHeight    0];
0092         <span class="keyword">end</span>
0093         h = patch(vx, Scaling*vy+Offset, IconColor,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0094         set(h, <span class="string">'UserData'</span>, i);
0095         <span class="comment">%if IconWidth &lt; .1 % meters</span>
0096         <span class="comment">%    set(h, 'EdgeColor', IconColor);</span>
0097         <span class="comment">%end</span>
0098 
0099     <span class="keyword">elseif</span> isfield(THERING{i},<span class="string">'PolynomB'</span>) &amp;&amp; length(THERING{i}.PolynomB)&gt;2 &amp;&amp; (THERING{i}.PolynomB(3) || any(strcmpi(THERING{i}.FamName,{<span class="string">'SF'</span>,<span class="string">'SFF'</span>,<span class="string">'SD'</span>,<span class="string">'SDD'</span>})))
0100         <span class="comment">% Sextupole</span>
0101         NumberOfFinds = NumberOfFinds + 1;
0102         <span class="keyword">if</span> THERING{i}.PolynomB(3)&gt;0 || any(strcmpi(THERING{i}.FamName,{<span class="string">'SF'</span>,<span class="string">'SFF'</span>}))
0103             <span class="comment">% Focusing sextupole</span>
0104             IconHeight = .6;
0105             IconColor = [1 0 1];
0106             IconWidth = THERING{i}.Length;
0107             <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0108                 IconWidth = MinIconWidth;
0109                 SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0110             <span class="keyword">end</span>
0111             vx = [SPos          SPos+.33*IconWidth  SPos+.66*IconWidth  SPos+IconWidth   SPos+IconWidth   SPos+.66*IconWidth  SPos+.33*IconWidth      SPos          SPos];
0112             vy = [IconHeight/3      IconHeight          IconHeight        IconHeight/3    -IconHeight/3      -IconHeight          -IconHeight     -IconHeight/3  IconHeight/3];
0113         <span class="keyword">else</span>
0114             <span class="comment">% Defocusing sextupole</span>
0115             IconHeight = .6;
0116             IconColor = [0 1 0];
0117             IconWidth = THERING{i}.Length;
0118             <span class="keyword">if</span> IconWidth &lt; MinIconWidth <span class="comment">% meters</span>
0119                 IconWidth = MinIconWidth;
0120                 SPos = SPos - IconWidth/2 + THERING{i}.Length/2;
0121             <span class="keyword">end</span>
0122             vx = [SPos          SPos+.33*IconWidth  SPos+.66*IconWidth  SPos+IconWidth   SPos+IconWidth   SPos+.66*IconWidth  SPos+.33*IconWidth      SPos          SPos];
0123             vy = [IconHeight/3      IconHeight          IconHeight        IconHeight/3    -IconHeight/3      -IconHeight          -IconHeight     -IconHeight/3  IconHeight/3];
0124         <span class="keyword">end</span>
0125         h = patch(vx, Scaling*vy+Offset, IconColor,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0126         set(h, <span class="string">'UserData'</span>, i);
0127         <span class="comment">%if IconWidth &lt; .1 % meters</span>
0128         <span class="comment">%    set(h, 'EdgeColor', IconColor);</span>
0129         <span class="comment">%end</span>
0130 
0131     <span class="keyword">elseif</span> isfield(THERING{i},<span class="string">'Frequency'</span>) &amp;&amp; isfield(THERING{i},<span class="string">'Voltage'</span>)
0132         <span class="comment">% RF cavity</span>
0133         NumberOfFinds = NumberOfFinds + 1;
0134         IconColor = [1 0.5 0];
0135         h = plot(hAxes, SPos, 0+Offset, <span class="string">'o'</span>, <span class="string">'MarkerFaceColor'</span>, IconColor, <span class="string">'Color'</span>, IconColor, <span class="string">'MarkerSize'</span>, 4);
0136         set(h, <span class="string">'UserData'</span>, i);
0137 
0138     <span class="keyword">elseif</span> strcmpi(THERING{i}.FamName,<span class="string">'BPM'</span>)
0139         <span class="comment">% BPM</span>
0140         NumberOfFinds = NumberOfFinds + 1;
0141         IconColor = <span class="string">'k'</span>;
0142         h = plot(hAxes, SPos, 0+Offset, <span class="string">'.'</span>, <span class="string">'Color'</span>, IconColor);
0143         <span class="comment">%h = plot(hAxes, SPos, 0, 'o', 'MarkerFaceColor', IconColor, 'Color', IconColor, 'MarkerSize', 1.5)</span>
0144         set(h, <span class="string">'UserData'</span>, i);
0145         
0146     <span class="keyword">elseif</span> strcmpi(THERING{i}.FamName,<span class="string">'TV'</span>)
0147         <span class="comment">% TV screen</span>
0148         NumberOfFinds = NumberOfFinds + 1;
0149         IconHeight = .7;
0150         IconColor = [.5 0 0];  <span class="comment">%'k';</span>
0151         <span class="comment">%h = plot(hAxes, SPos, 0+Offset, 'x', 'Color', IconColor);</span>
0152         h = plot(hAxes, SPos, Scaling*IconHeight+Offset, <span class="string">'Marker'</span>,<span class="string">'Square'</span>, <span class="string">'MarkerFaceColor'</span>, IconColor, <span class="string">'Color'</span>, IconColor, <span class="string">'MarkerSize'</span>, 3.5);
0153         set(h, <span class="string">'UserData'</span>, i);
0154     <span class="keyword">end</span>
0155     
0156     <span class="comment">% Since correctors could be a combined function magnet, test separately</span>
0157     <span class="keyword">if</span> any(strcmpi(THERING{i}.FamName,{<span class="string">'COR'</span>,<span class="string">'XCOR'</span>,<span class="string">'YCOR'</span>,<span class="string">'HCOR'</span>,<span class="string">'VCOR'</span>})) || isfield(THERING{i},<span class="string">'KickAngle'</span>)
0158         <span class="comment">% Corrector</span>
0159         NumberOfFinds = NumberOfFinds + 1;
0160         
0161         <span class="keyword">if</span> NumberOfFinds &gt; 1
0162             IconWidth = 0;
0163         <span class="keyword">else</span>
0164             IconWidth = THERING{i}.Length;
0165         <span class="keyword">end</span>
0166         IconHeight = 1.0;  <span class="comment">% was .8</span>
0167         vx = [SPos   SPos];
0168 
0169         <span class="comment">% Draw a line above for a HCM and below for a VCM</span>
0170         <span class="comment">% If it's not in the ML, then draw a line above and below</span>
0171         CMFound = 1;
0172         <span class="keyword">if</span> any(i == ATIndexVCM)
0173             IconColor = [0 0 0];
0174             vy = [-IconHeight 0];
0175             <span class="keyword">if</span> IconWidth &lt; MinIconWidth
0176                 h = plot(hAxes, vx, Scaling*vy+Offset, <span class="string">'Color'</span>, IconColor);
0177             <span class="keyword">else</span>
0178                 IconWidth = THERING{i}.Length;
0179                 vx = [SPos SPos+IconWidth SPos+IconWidth SPos];
0180                 vy = [0 0 -IconHeight -IconHeight];
0181                 <span class="comment">%vy = [IconHeight IconHeight -IconHeight -IconHeight];</span>
0182                 h = patch(vx, Scaling*vy+Offset, IconColor, <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0183                 <span class="keyword">if</span> IconWidth &lt; MinIconWidth*2 <span class="comment">% meters</span>
0184                     set(h, <span class="string">'EdgeColor'</span>, IconColor);
0185                 <span class="keyword">end</span>
0186             <span class="keyword">end</span>
0187             set(h, <span class="string">'UserData'</span>, i);
0188             CMFound = 0;
0189         <span class="keyword">end</span>
0190 
0191         <span class="keyword">if</span> any(i == ATIndexHCM)
0192             IconColor = [0 0 0];
0193             vy = [0 IconHeight];
0194             <span class="keyword">if</span> IconWidth &lt; MinIconWidth
0195                 h = plot(hAxes, vx, Scaling*vy+Offset, <span class="string">'Color'</span>, IconColor);
0196             <span class="keyword">else</span>
0197                 IconWidth = THERING{i}.Length;
0198                 vx = [SPos SPos+IconWidth SPos+IconWidth SPos];
0199                 vy = [IconHeight IconHeight 0 0];
0200                 <span class="comment">%vy = [IconHeight IconHeight -IconHeight -IconHeight];</span>
0201                 h = patch(vx, Scaling*vy+Offset, IconColor, <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0202                 <span class="keyword">if</span> IconWidth &lt; MinIconWidth*2 <span class="comment">% meters</span>
0203                     set(h, <span class="string">'EdgeColor'</span>, IconColor);
0204                 <span class="keyword">end</span>
0205             <span class="keyword">end</span>
0206             set(h, <span class="string">'UserData'</span>, i);
0207             CMFound = 0;
0208         <span class="keyword">end</span>
0209         
0210         <span class="keyword">if</span> CMFound
0211             IconColor = [0 0 0];
0212             vy = [-IconHeight IconHeight];
0213             <span class="keyword">if</span> IconWidth &lt; MinIconWidth
0214                 h = plot(hAxes, vx, Scaling*vy+Offset, <span class="string">'Color'</span>, IconColor);
0215             <span class="keyword">else</span>
0216                 IconWidth = THERING{i}.Length;
0217                 vx = [SPos SPos+IconWidth SPos+IconWidth SPos];
0218                 vy = [IconHeight IconHeight -IconHeight -IconHeight];
0219                 h = patch(vx, Scaling*vy+Offset, IconColor, <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="string">'Parent'</span>,hAxes);
0220                 <span class="keyword">if</span> IconWidth &lt; MinIconWidth*2 <span class="comment">% meters</span>
0221                     set(h, <span class="string">'EdgeColor'</span>, IconColor);
0222                 <span class="keyword">end</span>
0223             <span class="keyword">end</span>
0224             set(h, <span class="string">'UserData'</span>, i);
0225             CMFound = 0;
0226         <span class="keyword">end</span>
0227 
0228     <span class="keyword">end</span>
0229 <span class="keyword">end</span>
0230 
0231 
0232 <span class="comment">% Leave the hold state as it was at the start</span>
0233 <span class="keyword">if</span> ~HoldState
0234     hold(hAxes, <span class="string">'off'</span>);
0235 <span class="keyword">end</span>
0236 
0237 a = axis(hAxes);
0238 axis(hAxes, [0 L a(3:4)]);
0239</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>