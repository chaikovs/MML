<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getenveloppe</title>
  <meta name="keywords" content="getenveloppe">
  <meta name="description" content="%">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">mml</a> &gt; <a href="index.html">at</a> &gt; getenveloppe.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml/at&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>getenveloppe
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>%</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">%</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%%</span>
0002 solamor2
0003 BENDINDEX = findcells(THERING,<span class="string">'PassMethod'</span>,<span class="string">'BndMPoleSymplectic4RadPass'</span>);
0004 QUADSEXTINDEX = findcells(THERING,<span class="string">'PassMethod'</span>,<span class="string">'StrMPoleSymplectic4RadPass'</span>);
0005 RADELEMINDEX = sort([BENDINDEX QUADSEXTINDEX]);
0006 
0007 <span class="comment">%% Set tilt error</span>
0008 <span class="comment">% Find  indexes of elements in different families</span>
0009 Q1I = findcells(THERING,<span class="string">'FamName'</span>,<span class="string">'Q1'</span>);
0010 <span class="comment">% Select some of them to randomly tilt</span>
0011 TILTI = Q1I;
0012 
0013 <span class="comment">% NOTE: How to introduce random coupling and misalignment errors:</span>
0014 <span class="comment">% s-rotations(tilts) and transverse displacements (shifts)</span>
0015 
0016 <span class="comment">% 1.generate random  rotations</span>
0017 tilterr = 0.2*pi/180;            <span class="comment">% RMS tilt error [radians]</span>
0018 qftilts = tilterr*randn(1,length(TILTI));
0019 
0020 <span class="comment">% 2. rotate elements</span>
0021 settilt(TILTI,qftilts);
0022 
0023 <span class="comment">%%</span>
0024 [ENV, DP, DL] = ohmienvelope(THERING,RADELEMINDEX, 1:length(THERING)+1)
0025 
0026 <span class="comment">%%</span>
0027 sigmas = cat(2,ENV.Sigma);
0028 tilt = cat(2,ENV.Tilt);
0029 spos = findspos(THERING,1:length(THERING)+1);
0030 
0031 figure(1)
0032 plot(spos,tilt*180/pi,<span class="string">'.-'</span>)
0033 set(gca,<span class="string">'XLim'</span>,[0 spos(end)])
0034 title(<span class="string">'Rotation angle of the beam ellipse [degrees]'</span>);
0035 xlabel(<span class="string">'s - position [m]'</span>);
0036 grid on
0037 
0038 figure(2)
0039 [A, H1, H2] = plotyy(spos,sigmas(1,:)*1e6,spos,sigmas(2,:)*1e6);
0040 
0041 set([H1 H2],<span class="string">'Marker'</span>,<span class="string">'.'</span>)
0042 set(A,<span class="string">'XLim'</span>,[0 spos(end)])
0043 title(<span class="string">'Principal axis of the beam ellipse [m]'</span>);
0044 xlabel(<span class="string">'s - position [m]'</span>);
0045 grid on
0046 ylabel(<span class="string">'Sigma (um)'</span>)
0047 <span class="comment">%%</span>
0048 [TD, tune] = twissring(THERING,0,1:length(THERING)+1,<span class="string">'chroma'</span>);
0049 ETA        = cat(2,TD.Dispersion);
0050 BETA       = cat(1,TD.beta)';
0051 
0052 emittancex = (power(sigmas(1,:),2)-power(DP*ETA(1,:),2))./BETA(1,:);
0053 emittancez = (power(sigmas(2,:),2)-power(DP*ETA(3,:),2))./BETA(2,:);
0054 <span class="comment">%%</span>
0055 figure
0056 [A, H1, H2] = plotyy(spos,emittancex,spos,emittancez);
0057 grid on
0058 set(A,<span class="string">'XLim'</span>,[0 spos(end)])
0059 
0060 <span class="comment">%% couplying end emittance at lattice entrance</span>
0061 fprintf(<span class="string">'Ex = %4.2g m.rad \n'</span>,emittancex(1));
0062 fprintf(<span class="string">'Ez = %4.2g m.rad \n'</span>,emittancez(2));
0063 fprintf(<span class="string">'Coupling = %4.2g %% \n'</span>,emittancez(1)/emittancex(2)*100)</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>