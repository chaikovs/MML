<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of monmags</title>
  <meta name="keywords" content="monmags">
  <meta name="description" content="MONMAGS - Monitors all magnet power supplies and plots various statistics">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; monmags.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>monmags
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>MONMAGS - Monitors all magnet power supplies and plots various statistics</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [MagnetSetpoints, MagnetMonitors, BPMMonitors, MagnetSetpointsEnd, FileName] = monmags(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">MONMAGS - Monitors all magnet power supplies and plots various statistics

  [MagnetSetpoints, MagnetMonitors, BPMMonitors, MagnetSetpointsEnd] = monmags(FileName, PlotDataFlag, UnitsFlag)
  [MagnetSetpoints, MagnetMonitors, BPMMonitors, MagnetSetpointsEnd] = monmags(FileName, t, UnitsFlag)

  INPUTS
  1. FileName - file to load or save data  {Default or []: prompt for a filename}
  2. PlotDataFlag - 0 -&gt; get, save and plot data {Default: prompt for input}
                    1 -&gt; plot all families (data coming from a file)
                    2 -&gt; plot one family   (data coming from a file)
     t - time vector (see help getpv for more details)  {Default: prompt for input}
  3. UnitsFlag ('Hardware' or 'Physics') - Just for plotting.  {Default: default units when the data was taken}
  4. 'NoDisplay' - read or save the data file without plotting the result (just for getting data).
  5. 'Raw2Real' - if in hardware units, a raw2real conversion is make before plotting (no change is made to the measured data).
                  
  OUTPUTS
  1. MagnetSetpoints - Cell array of magnet setpoints at the start of the test
  2. MagnetMonitors  - Cell array of magnets monitors sampled according to the vector t
  3. BPMMonitors     - Cell array of BPMs
  4. MagnetSetpointsEnd - Cell array of magnet setpoints at the end of the test

  NOTE
  1. Input order does not matter.  All inputs are optional.
  2. Make sure the sample period is long enough to acquirer the data.  It's
     best to test on a few samples first (3 is points in the minimum).
  3. Orbits are also monitored.  Use monbpm to just monitor the orbit.

  EXAMPLES
  1. To plot data in physics units (prompt for the file):
     monmags('physics', 1);
  2. To get data for 3 minutes at 1 sample/second, save to filename=magdata101.mat (in 
     the current directory), and plot in default units:
     monmags('magdata101',0:1:180);

  Written by Greg Portmann</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="dev2elem.html" class="code" title="function Output = dev2elem(Family, DevList)">dev2elem</a>	DEV2ELEM - Converts an element list to a device list</li><li><a href="family2status.html" class="code" title="function [S, IndexList] = family2status(Family, DeviceList)">family2status</a>	FAMILY2STATUS - Returns the device status</li><li><a href="field2cell.html" class="code" title="function OutputCell = field2cell(InputStruct)">field2cell</a>	FIELD2CELL - Converts a structure of MML data structures into a cell array</li><li><a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>	FINDMEMBEROF - Finds all family members</li><li><a href="getam.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getam(varargin)">getam</a>	GETAM - Gets monitor channels</li><li><a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>	GETFAMILYDATA - Gets data associated with the accelerator control</li><li><a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>	GETSP - Gets setpoint channels</li><li><a href="getunits.html" class="code" title="function [Units, UnitsString] = getunits(Family, Field)">getunits</a>	GETUNITS - Return the present family units and units string</li><li><a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>	HW2PHYSICS - Converts from 'Hardware' units to 'Physics' units</li><li><a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>	PHYSICS2HW - Converts from 'Physics' units to 'Hardware' units</li><li><a href="raw2real.html" class="code" title="function DataOut = raw2real(varargin)">raw2real</a>	RAW2REAL - Converts raw control system data to calibrated values</li><li><a href="sectorticks.html" class="code" title="function [Sector, Nsectors, Ndevices] = sectorticks(List)">sectorticks</a>	SECTORTICKS - Returns sector tick number for plotting purpose</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [MagnetSetpoints, MagnetMonitors, BPMMonitors, MagnetSetpointsEnd, FileName] = monmags(varargin)</a>
0002 <span class="comment">%MONMAGS - Monitors all magnet power supplies and plots various statistics</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  [MagnetSetpoints, MagnetMonitors, BPMMonitors, MagnetSetpointsEnd] = monmags(FileName, PlotDataFlag, UnitsFlag)</span>
0005 <span class="comment">%  [MagnetSetpoints, MagnetMonitors, BPMMonitors, MagnetSetpointsEnd] = monmags(FileName, t, UnitsFlag)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%  INPUTS</span>
0008 <span class="comment">%  1. FileName - file to load or save data  {Default or []: prompt for a filename}</span>
0009 <span class="comment">%  2. PlotDataFlag - 0 -&gt; get, save and plot data {Default: prompt for input}</span>
0010 <span class="comment">%                    1 -&gt; plot all families (data coming from a file)</span>
0011 <span class="comment">%                    2 -&gt; plot one family   (data coming from a file)</span>
0012 <span class="comment">%     t - time vector (see help getpv for more details)  {Default: prompt for input}</span>
0013 <span class="comment">%  3. UnitsFlag ('Hardware' or 'Physics') - Just for plotting.  {Default: default units when the data was taken}</span>
0014 <span class="comment">%  4. 'NoDisplay' - read or save the data file without plotting the result (just for getting data).</span>
0015 <span class="comment">%  5. 'Raw2Real' - if in hardware units, a raw2real conversion is make before plotting (no change is made to the measured data).</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%  OUTPUTS</span>
0018 <span class="comment">%  1. MagnetSetpoints - Cell array of magnet setpoints at the start of the test</span>
0019 <span class="comment">%  2. MagnetMonitors  - Cell array of magnets monitors sampled according to the vector t</span>
0020 <span class="comment">%  3. BPMMonitors     - Cell array of BPMs</span>
0021 <span class="comment">%  4. MagnetSetpointsEnd - Cell array of magnet setpoints at the end of the test</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%  NOTE</span>
0024 <span class="comment">%  1. Input order does not matter.  All inputs are optional.</span>
0025 <span class="comment">%  2. Make sure the sample period is long enough to acquirer the data.  It's</span>
0026 <span class="comment">%     best to test on a few samples first (3 is points in the minimum).</span>
0027 <span class="comment">%  3. Orbits are also monitored.  Use monbpm to just monitor the orbit.</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%  EXAMPLES</span>
0030 <span class="comment">%  1. To plot data in physics units (prompt for the file):</span>
0031 <span class="comment">%     monmags('physics', 1);</span>
0032 <span class="comment">%  2. To get data for 3 minutes at 1 sample/second, save to filename=magdata101.mat (in</span>
0033 <span class="comment">%     the current directory), and plot in default units:</span>
0034 <span class="comment">%     monmags('magdata101',0:1:180);</span>
0035 <span class="comment">%</span>
0036 <span class="comment">%  Written by Greg Portmann</span>
0037 
0038 
0039 DisplayFlag = 1;
0040 FileName = -1;
0041 ArchiveFlag = -1;
0042 UnitsFlag  = <span class="string">''</span>; 
0043 PlotDataFlag = [];
0044 t = [];
0045 DirectoryName = <span class="string">''</span>;
0046 MagnetSetpoints =[];
0047 MagnetMonitors = [];
0048 BPMMonitors = []; 
0049 MagnetSetpointsEnd = [];
0050 Raw2RealFlag = 0;
0051 
0052 <span class="keyword">for</span> i = length(varargin):-1:1
0053     <span class="keyword">if</span> isstruct(varargin{i})
0054         <span class="comment">% Remove</span>
0055         varargin(i) = [];
0056     <span class="keyword">elseif</span> iscell(varargin{i})
0057         <span class="comment">% Remove</span>
0058         varargin(i) = [];
0059     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'struct'</span>)
0060         <span class="comment">% Remove</span>
0061         varargin(i) = [];
0062     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'numeric'</span>)
0063         <span class="comment">% Remove</span>
0064         varargin(i) = [];
0065     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Display'</span>)
0066         DisplayFlag = 1;
0067         varargin(i) = [];
0068     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'NoDisplay'</span>)
0069         DisplayFlag = 0;
0070         varargin(i) = [];
0071     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Physics'</span>)
0072         UnitsFlag = varargin{i};
0073         varargin(i) = [];
0074     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Raw2Real'</span>)
0075         Raw2RealFlag = 1;
0076         varargin(i) = [];
0077     <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'Hardware'</span>)
0078         UnitsFlag = varargin{i};
0079         varargin(i) = [];
0080     <span class="keyword">end</span>
0081 <span class="keyword">end</span>
0082 
0083 <span class="keyword">for</span> i = length(varargin):-1:1
0084     <span class="keyword">if</span> ischar(varargin{i})
0085         FileName = varargin{i};
0086         <span class="keyword">if</span> strcmpi(FileName,<span class="string">'Archive'</span>)
0087             PlotDataFlag = 0;
0088             ArchiveFlag = 1;
0089             <span class="keyword">if</span> length(varargin) &gt; i
0090                 <span class="comment">% Look for a filename as the next input</span>
0091                 <span class="keyword">if</span> ischar(varargin{i+1})
0092                     FileName = varargin{i+1};
0093                     varargin(i+1) = [];
0094                 <span class="keyword">end</span>
0095             <span class="keyword">end</span>
0096             varargin(i) = [];
0097         <span class="keyword">elseif</span> strcmpi(varargin{i},<span class="string">'NoArchive'</span>)
0098             ArchiveFlag = 0;
0099             varargin(i) = [];
0100         <span class="keyword">end</span>
0101     <span class="keyword">elseif</span> isnumeric(varargin{i})
0102         <span class="keyword">if</span> length(varargin{i}) == 1
0103             PlotDataFlag = varargin{i};
0104         <span class="keyword">else</span>
0105             PlotDataFlag = 0;
0106             t = varargin{i};
0107         <span class="keyword">end</span>
0108         varargin(i) = [];        
0109     <span class="keyword">end</span>
0110 <span class="keyword">end</span>
0111 
0112 
0113 <span class="keyword">if</span> isempty(PlotDataFlag)
0114     <span class="keyword">if</span> FileName == -1
0115         ButtonNumber = menu(<span class="string">'What would you like to do?'</span>, <span class="string">'Get New Data'</span>,<span class="string">'Plot Data From a File'</span>,<span class="string">'Plot 1 Family From a File'</span>,<span class="string">'Cancel'</span>);  
0116         <span class="keyword">switch</span> ButtonNumber
0117             <span class="keyword">case</span> 1
0118                 PlotDataFlag = 0;
0119             <span class="keyword">case</span> 2
0120                 PlotDataFlag = 1;
0121             <span class="keyword">case</span> 3
0122                 PlotDataFlag = 2;
0123             <span class="keyword">otherwise</span>
0124                 fprintf(<span class="string">'   monmags cancelled\n'</span>);
0125                 <span class="keyword">return</span>
0126         <span class="keyword">end</span>
0127     <span class="keyword">else</span>
0128         <span class="keyword">if</span> exist(FileName) || exist([FileName,<span class="string">'.mat'</span>])
0129             PlotDataFlag = 1;
0130         <span class="keyword">else</span>
0131             PlotDataFlag = 0;
0132         <span class="keyword">end</span>
0133     <span class="keyword">end</span>
0134 <span class="keyword">end</span>
0135 
0136 
0137 <span class="comment">% Get file for plotting</span>
0138 <span class="keyword">if</span> (isempty(FileName) || isequal(FileName,-1)) &amp;&amp; PlotDataFlag &gt; 0
0139     DirectoryName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'DataRoot'</span>);
0140     DirectoryName = [DirectoryName, <span class="string">'Magnets\'</span>];
0141     [FileName, DirectoryName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a magnet file'</span>, DirectoryName);
0142     <span class="keyword">if</span> isnumeric(FileName)
0143         fprintf(<span class="string">'   monmags cancelled'</span>);
0144         <span class="keyword">return</span>
0145     <span class="keyword">end</span>
0146 <span class="keyword">end</span>
0147 
0148 
0149 <span class="keyword">if</span> PlotDataFlag == 0
0150     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0151     <span class="comment">% Get Data From The Control System %</span>
0152     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0153         
0154     <span class="keyword">if</span> ArchiveFlag
0155         <span class="keyword">if</span> isempty(FileName)
0156             FileName = appendtimestamp(<span class="string">'magnetdata'</span>);
0157             DirectoryName = [<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'DataRoot'</span>), <span class="string">'Magnets'</span>, filesep];
0158             
0159             <span class="comment">% Make sure default directory exists</span>
0160             DirStart = pwd;
0161             [DirectoryName, ErrorFlag] = gotodirectory(DirectoryName);
0162             cd(DirStart);
0163             
0164             [FileName, DirectoryName] = uiputfile(<span class="string">'*.mat'</span>, <span class="string">'Select a Magnet Monitor File'</span>, [DirectoryName FileName]);
0165             <span class="keyword">if</span> isequal(FileName,0) || isequal(DirectoryName,0)
0166                 disp(<span class="string">'   Magnet power supply monitoring canceled.'</span>);
0167                 FileName = <span class="string">''</span>;
0168                 <span class="keyword">return</span>
0169             <span class="keyword">end</span>
0170             FileName = [DirectoryName, FileName];
0171         <span class="keyword">elseif</span> FileName == -1
0172             FileName = appendtimestamp(<span class="string">'magnetdata'</span>);
0173             DirectoryName = [<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'DataRoot'</span>), <span class="string">'Magnets'</span>, filesep];
0174             FileName = [DirectoryName, FileName];
0175         <span class="keyword">end</span>
0176     <span class="keyword">else</span>
0177         <span class="keyword">if</span> nargout == 0
0178             fprintf(<span class="string">'   No output or filename input, so there is no reason to monitor the power supplies\n'</span>);
0179         <span class="keyword">end</span>
0180     <span class="keyword">end</span>
0181     
0182     
0183     <span class="comment">% Setup the family cell array</span>
0184     MagnetFamilies = <a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>(<span class="string">'Magnet'</span>);
0185     MagnetFamilies = MagnetFamilies(:);
0186     
0187     <span class="comment">% If a family has all zero status remove it</span>
0188     <span class="keyword">for</span> i = length(MagnetFamilies):-1:1
0189         Status = <a href="family2status.html" class="code" title="function [S, IndexList] = family2status(Family, DeviceList)">family2status</a>(MagnetFamilies{i});
0190         <span class="keyword">if</span> all(Status==0)
0191             MagnetFamilies(i) = [];
0192         <span class="keyword">end</span>
0193     <span class="keyword">end</span>
0194 
0195     MagnetFamilies = editlist(MagnetFamilies);
0196     MagnetFamilies = MagnetFamilies(:);
0197     iMagnets = length(MagnetFamilies);
0198     MagnetDeviceLists = cell(iMagnets,1);
0199 
0200     
0201     <span class="comment">% BPM families</span>
0202     BPMFamilies = <a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>(<span class="string">'BPM'</span>);
0203     BPMFamilies = BPMFamilies(:);
0204     
0205     <span class="comment">% If a family has all zero status remove it</span>
0206     <span class="keyword">for</span> i = length(BPMFamilies):-1:1
0207         Status = <a href="family2status.html" class="code" title="function [S, IndexList] = family2status(Family, DeviceList)">family2status</a>(BPMFamilies{i});
0208         <span class="keyword">if</span> all(Status==0)
0209             BPMFamilies(i) = [];
0210         <span class="keyword">end</span>
0211     <span class="keyword">end</span>
0212 
0213     BPMFamilies = editlist(BPMFamilies(:));
0214     BPMFamilies = BPMFamilies(:);
0215     iBPMs = length(BPMFamilies);
0216     BPMDeviceLists = cell(iBPMs,1);
0217  
0218     <span class="keyword">if</span> isempty(MagnetFamilies) &amp;&amp; isempty(BPMFamilies)
0219         fprintf(<span class="string">'   Nothing to monitor.\n'</span>);
0220         <span class="keyword">return</span>;
0221     <span class="keyword">end</span>
0222     
0223         
0224     
0225     disp(<span class="string">'  '</span>);
0226     disp(<span class="string">'   This function monitors the storage ring magnets and BPMs then computes various'</span>);
0227     disp(<span class="string">'   accuracy statistics.  The sample period should be long enough to acquire '</span>);
0228     disp(<span class="string">'   all the magnets and BPMs in the storage ring.  The storage ring must be static'</span>);
0229     disp(<span class="string">'   during this measurement (no magnet or insertion device changes, etc).  This '</span>);
0230     disp(<span class="string">'   function open a lot of windows, &quot;&gt;&gt; close all&quot; closes all figure windows.'</span>);
0231     disp(<span class="string">'  '</span>);
0232     <span class="keyword">if</span> isempty(t)
0233         prompt = {<span class="string">'Input the sample period (seconds)'</span>, <span class="string">'Input the total data collection time (seconds)'</span>};
0234         answer = inputdlg(prompt,<span class="string">'monmags'</span>,1,{<span class="string">'1'</span>,<span class="string">'180'</span>});
0235         <span class="keyword">if</span> isempty(answer)
0236             fprintf(<span class="string">'   monmags cancelled\n'</span>);
0237             <span class="keyword">return</span>
0238         <span class="keyword">end</span>
0239         T       = str2num(answer{1});
0240         EndTime = str2num(answer{2});
0241         t = 0:T:EndTime;
0242     <span class="keyword">end</span>
0243     <span class="keyword">if</span> length(t) &lt; 3
0244         fprintf(<span class="string">'\n   The input time vector only has %d sample points.\n'</span>, length(t));
0245         fprintf(<span class="string">'   The function will run with 3 but you should have a lot (like 100 or more).\n'</span>);
0246         fprintf(<span class="string">'   monmags cancelled'</span>);
0247         <span class="keyword">return</span>
0248     <span class="keyword">end</span>
0249     
0250     fprintf(<span class="string">'   Taking data for about %.1f seconds  . . .  '</span>, t(end));
0251     TimeStart = gettime;
0252     
0253         
0254     <span class="comment">% Get the setpoints at the start</span>
0255     MagnetSetpoints = <a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>(MagnetFamilies, MagnetDeviceLists, <span class="string">'Struct'</span>);
0256 
0257     <span class="comment">% Get the monitors (first connect to the channels so that the first sample time is not longer than the rest)</span>
0258     <span class="comment">% Forcing units to hardware is necessary to speedup the data taking</span>
0259     tmp       = <a href="getam.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getam(varargin)">getam</a>([MagnetFamilies; BPMFamilies], [MagnetDeviceLists; BPMDeviceLists], <span class="string">'Hardware'</span>);
0260     Monitors  = <a href="getam.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getam(varargin)">getam</a>([MagnetFamilies; BPMFamilies], [MagnetDeviceLists; BPMDeviceLists], t, <span class="string">'Struct'</span>, <span class="string">'Hardware'</span>);
0261 
0262     <span class="comment">% Get the setpoints at the end (hopefully it's the same as the start)</span>
0263     MagnetSetpointsEnd = <a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>(MagnetFamilies, MagnetDeviceLists, <span class="string">'Struct'</span>);
0264 
0265     <span class="comment">% Split the monitors into magnets and BPMs</span>
0266     MagnetMonitors = Monitors(1:iMagnets);
0267     BPMMonitors    = Monitors(iMagnets+1:iMagnets+iBPMs);
0268 
0269     fprintf(<span class="string">'finished in %.1f seconds\n'</span>, Monitors{1}.tout(end));
0270     fprintf(<span class="string">'   Average Sampling Period = %.3f seconds (Max= %.3f, Min=%.3f seconds)\n'</span>, mean(diff(Monitors{1}.tout)), max(diff(Monitors{1}.tout)), min(diff(Monitors{1}.tout)));
0271 
0272 
0273     <span class="comment">% Convert to the default units</span>
0274     <span class="keyword">for</span> i = 1:length(Monitors)
0275         ActualUnits = <a href="getunits.html" class="code" title="function [Units, UnitsString] = getunits(Family, Field)">getunits</a>(Monitors{i}.FamilyName);
0276         <span class="keyword">if</span> strcmpi(ActualUnits, <span class="string">'Physics'</span>)
0277             Monitors{i} = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(Monitors{i});
0278         <span class="keyword">end</span>
0279     <span class="keyword">end</span>
0280 
0281     
0282     <span class="comment">% Convert to fields (more readable)</span>
0283     MagnetMonitors     = cell2field(MagnetMonitors);
0284     MagnetSetpoints    = cell2field(MagnetSetpoints);
0285     BPMMonitors        = cell2field(BPMMonitors);
0286     MagnetSetpointsEnd = cell2field(MagnetSetpointsEnd);
0287     
0288     
0289     <span class="comment">% Save data in the proper directory</span>
0290     <span class="keyword">if</span> ArchiveFlag || ischar(FileName)
0291         [DirectoryName, FileName, Ext] = fileparts(FileName);
0292         DirStart = pwd;
0293         [DirectoryName, ErrorFlag] = gotodirectory(DirectoryName);
0294         <span class="keyword">if</span> ErrorFlag
0295             fprintf(<span class="string">'\n   There was a problem getting to the proper directory!\n\n'</span>);
0296         <span class="keyword">end</span>
0297         save(FileName, <span class="string">'MagnetMonitors'</span>, <span class="string">'MagnetSetpoints'</span>, <span class="string">'BPMMonitors'</span>, <span class="string">'MagnetSetpointsEnd'</span>);
0298         cd(DirStart);
0299         FileName = [DirectoryName FileName];
0300         
0301         <span class="keyword">if</span> DisplayFlag
0302             fprintf(<span class="string">'   Magnet power supply data saved to %s\n'</span>, FileName);
0303             fprintf(<span class="string">'   The total measurement time was %.2f minutes.\n'</span>, (gettime-TimeStart)/60);
0304         <span class="keyword">else</span>
0305             <span class="keyword">return</span>;
0306         <span class="keyword">end</span>
0307     <span class="keyword">else</span>
0308         FileName = <span class="string">''</span>;
0309     <span class="keyword">end</span>
0310     
0311 <span class="keyword">else</span>
0312     
0313     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0314     <span class="comment">% Get data from file and plot it %</span>
0315     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0316     load([DirectoryName, FileName]);
0317     
0318 <span class="keyword">end</span>
0319 
0320 
0321 <span class="keyword">if</span> ~DisplayFlag
0322     <span class="keyword">return</span>
0323 <span class="keyword">end</span>
0324 
0325 
0326 
0327 <span class="comment">%%%%%%%%%%%%</span>
0328 <span class="comment">% Plotting %</span>
0329 <span class="comment">%%%%%%%%%%%%</span>
0330 
0331 <span class="comment">% Convert to cell arrays</span>
0332 <span class="keyword">if</span> ~iscell(MagnetMonitors)
0333     <span class="keyword">if</span> isempty(MagnetMonitors)
0334         MagnetMonitors = {};
0335         MagnetSetpoints = {};
0336         MagnetSetpointsEnd = {};
0337     <span class="keyword">else</span>
0338         MagnetMonitors     = <a href="field2cell.html" class="code" title="function OutputCell = field2cell(InputStruct)">field2cell</a>(MagnetMonitors);
0339         MagnetSetpoints    = <a href="field2cell.html" class="code" title="function OutputCell = field2cell(InputStruct)">field2cell</a>(MagnetSetpoints);
0340         MagnetSetpointsEnd = <a href="field2cell.html" class="code" title="function OutputCell = field2cell(InputStruct)">field2cell</a>(MagnetSetpointsEnd);
0341     <span class="keyword">end</span>
0342 <span class="keyword">end</span>
0343 <span class="keyword">if</span> ~iscell(BPMMonitors)
0344     <span class="keyword">if</span> isempty(BPMMonitors)
0345         BPMMonitors = {};
0346     <span class="keyword">else</span>
0347         BPMMonitors = <a href="field2cell.html" class="code" title="function OutputCell = field2cell(InputStruct)">field2cell</a>(BPMMonitors);
0348     <span class="keyword">end</span>
0349 <span class="keyword">end</span>
0350 
0351 <span class="keyword">if</span> ~isempty(MagnetMonitors)
0352     tout = MagnetMonitors{1}.tout;
0353 <span class="keyword">elseif</span> ~isempty(BPMMonitors)
0354     tout = BPMMonitors{1}.tout;
0355 <span class="keyword">else</span>
0356     fprintf(<span class="string">'   There is not data in this file to plot.\n'</span>);
0357     <span class="keyword">return</span>
0358 <span class="keyword">end</span>
0359 
0360 
0361 <span class="keyword">if</span> PlotDataFlag == 2
0362     <span class="comment">% Plot one family</span>
0363     <span class="keyword">for</span> i = 1:length(MagnetMonitors)
0364         FamilyList{i} = MagnetMonitors{i}.FamilyName;    
0365     <span class="keyword">end</span> 
0366     <span class="keyword">for</span> i = 1:length(BPMMonitors)
0367         FamilyList{i+length(MagnetMonitors)} = BPMMonitors{i}.FamilyName;    
0368     <span class="keyword">end</span> 
0369     
0370     FamilyNumber = menu(<span class="string">'Choose a family'</span>, FamilyList);
0371     
0372     <span class="keyword">if</span> FamilyNumber &lt;= length(MagnetMonitors)
0373         MagnetMonitors  = MagnetMonitors(FamilyNumber);
0374         MagnetSetpoints = MagnetSetpoints(FamilyNumber);
0375         BPMMonitors = [];
0376     <span class="keyword">else</span>
0377         BPMMonitors = BPMMonitors(FamilyNumber-length(MagnetMonitors));
0378         MagnetMonitors  = [];
0379         MagnetSetpoints = [];
0380     <span class="keyword">end</span>
0381 <span class="keyword">end</span>
0382 
0383 
0384 <span class="comment">% Plot all families</span>
0385 <span class="keyword">for</span> i = 1:length(MagnetMonitors)
0386     <span class="keyword">if</span> strcmpi(UnitsFlag, <span class="string">'Physics'</span>)
0387         MagnetMonitors{i}  = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(MagnetMonitors{i});
0388         MagnetSetpoints{i} = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(MagnetSetpoints{i});
0389     <span class="keyword">elseif</span> strcmpi(UnitsFlag, <span class="string">'Hardware'</span>)
0390         MagnetMonitors{i}  = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(MagnetMonitors{i});
0391         MagnetSetpoints{i} = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(MagnetSetpoints{i});
0392     <span class="keyword">end</span>
0393     
0394     <span class="keyword">if</span> Raw2RealFlag &amp;&amp; strcmpi(MagnetMonitors{i}.Units, <span class="string">'Hardware'</span>)
0395         MagnetMonitors{i}  = <a href="raw2real.html" class="code" title="function DataOut = raw2real(varargin)">raw2real</a>(MagnetMonitors{i});
0396         MagnetSetpoints{i} = <a href="raw2real.html" class="code" title="function DataOut = raw2real(varargin)">raw2real</a>(MagnetSetpoints{i});
0397     <span class="keyword">end</span>
0398 
0399 
0400     a = unique(MagnetMonitors{i}.Data, <span class="string">'rows'</span>);
0401     <span class="keyword">if</span> size(a,1) == 1
0402         <span class="comment">% Single power supply or ganged power supply</span>
0403         figure;
0404         subplot(2,1,1);
0405         hist(MagnetMonitors{i}.Data(1,:),200);
0406         
0407         title(sprintf(<span class="string">'%s: SP=%g, mean(AM)=%g, SP-mean(AM)=%g'</span>, <span class="keyword">...</span>
0408             MagnetSetpoints{i}.FamilyName, <span class="keyword">...</span>
0409             MagnetSetpoints{i}.Data(1,1), <span class="keyword">...</span>
0410             mean(MagnetMonitors{i}.Data(1,:)), <span class="keyword">...</span>
0411             MagnetSetpoints{i}.Data(1,1) - mean(MagnetMonitors{i}.Data(1,:))), <span class="string">'FontSize'</span>,8);
0412         xlabel(MagnetMonitors{i}.UnitsString,<span class="string">'FontSize'</span>,8); 
0413         
0414         subplot(2,1,2);
0415         plot(MagnetMonitors{i}.tout, MagnetMonitors{i}.Data(1,:));
0416         title(sprintf(<span class="string">'std(AM)=%.3g, max(AM-mean(AM))=%.3g'</span>, <span class="keyword">...</span>
0417             std(MagnetMonitors{i}.Data(1,:)), <span class="keyword">...</span><span class="comment"> </span>
0418             max(abs(MagnetMonitors{i}.Data(1,:) - mean(MagnetMonitors{i}.Data(1,:))))), <span class="string">'FontSize'</span>,8);        
0419         ylabel(MagnetMonitors{i}.UnitsString,<span class="string">'FontSize'</span>,8); 
0420         xlabel(<span class="string">'Time [Seconds]'</span>,<span class="string">'FontSize'</span>,8); 
0421         
0422         addlabel(1,0,sprintf(<span class="string">'%s'</span>, datestr(MagnetMonitors{i}.TimeStamp)));
0423         orient tall
0424         
0425     <span class="keyword">else</span>
0426         
0427         <span class="comment">% Independent power supplies</span>
0428         PlotBySector = 1;
0429         
0430         ElementList = <a href="dev2elem.html" class="code" title="function Output = dev2elem(Family, DevList)">dev2elem</a>(MagnetMonitors{i}.FamilyName, MagnetMonitors{i}.DeviceList);
0431  
0432         [Sector, Nsectors, Ndevices] = <a href="sectorticks.html" class="code" title="function [Sector, Nsectors, Ndevices] = sectorticks(List)">sectorticks</a>(MagnetMonitors{i}.DeviceList);
0433         
0434         AMmean = mean(MagnetMonitors{i}.Data,2);
0435         AMstd = std(MagnetMonitors{i}.Data,0,2);
0436         
0437         <span class="comment">%fprintf('   %s:  mean(AM)=%7.3f Amps,  SP-mean(AM)=%6.3f,  std(AM)=%5.3f Amps\n', MagnetMonitors{i}.FamilyName, AMmean, MagnetSetpoints{i}.Data-AMmean, AMstd);</span>
0438         
0439         figure;
0440         subplot(4,1,1);
0441         <span class="keyword">if</span> PlotBySector
0442             bar(Sector, AMmean);
0443             xaxis([1 Nsectors+1])
0444             set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0445         <span class="keyword">else</span>
0446             bar(ElementList, AMmean);
0447         <span class="keyword">end</span>
0448         title(sprintf(<span class="string">'%s Family (Units are in %s)'</span>, MagnetMonitors{i}.FamilyName, MagnetMonitors{i}.UnitsString));
0449         ylabel(<span class="string">'mean(AM)'</span>,<span class="string">'FontSize'</span>,8);
0450         <span class="comment">%ylabel(sprintf('mean(AM) [%s]',MagnetMonitors{i}.UnitsString),'FontSize',8);</span>
0451         grid on;
0452         
0453         ymax = max(AMmean);
0454         ymin = min(AMmean);
0455         extra = .05*(ymax-ymin);
0456         <span class="keyword">if</span> extra &lt; 1e6*eps
0457             extra = 1e6*eps;
0458         <span class="keyword">end</span>
0459         <span class="keyword">if</span> ~isnan(extra)
0460             yaxis([ymin-extra ymax+extra]);
0461         <span class="keyword">end</span>
0462         
0463         subplot(4,1,2);
0464         <span class="keyword">if</span> PlotBySector
0465             bar(Sector, MagnetSetpoints{i}.Data-AMmean);
0466             xaxis([1 Nsectors+1])
0467             set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0468         <span class="keyword">else</span>
0469             bar(ElementList, MagnetSetpoints{i}.Data-AMmean);
0470         <span class="keyword">end</span>
0471         ylabel(<span class="string">'SP-mean(AM)'</span>,<span class="string">'FontSize'</span>,8);
0472         <span class="comment">%ylabel(sprintf('SP-mean(AM) [%s]',MagnetMonitors{i}.UnitsString),'FontSize',8);</span>
0473         grid on;
0474         
0475         subplot(4,1,3);
0476         <span class="keyword">if</span> PlotBySector
0477             bar(Sector, AMstd);
0478             xaxis([1 Nsectors+1])
0479             set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0480         <span class="keyword">else</span>
0481             bar(ElementList, AMstd);
0482         <span class="keyword">end</span>
0483         ylabel(<span class="string">'std(AM)'</span>,<span class="string">'FontSize'</span>,8);
0484         <span class="comment">%ylabel(sprintf('std(AM) [%s]',MagnetMonitors{i}.UnitsString),'FontSize',8);</span>
0485         grid on;
0486         
0487         subplot(4,1,4);
0488         <span class="comment">% Outlier test</span>
0489         clear AM_AMmeanMax
0490         <span class="keyword">for</span> n = 1:size(AMmean,1)
0491             [tmp,j] = max(abs(MagnetMonitors{i}.Data(n,:)-AMmean(n)));
0492             AM_AMmeanMax(n,1) = MagnetMonitors{i}.Data(n,j)-AMmean(n);
0493         <span class="keyword">end</span>
0494         <span class="keyword">if</span> PlotBySector
0495             bar(Sector, AM_AMmeanMax);
0496             xaxis([1 Nsectors+1])
0497             set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0498         <span class="keyword">else</span>
0499             bar(ElementList, AM_AMmeanMax);
0500         <span class="keyword">end</span>
0501         ylabel(<span class="string">'max(AM-mean(AM))'</span>,<span class="string">'FontSize'</span>,8);
0502         <span class="comment">% ylabel(sprintf('max(AM-mean(AM)) [%s]',MagnetMonitors{i}.UnitsString),'FontSize',8);</span>
0503         <span class="keyword">if</span> PlotBySector
0504             xlabel(<span class="string">'Sector Number'</span>);
0505         <span class="keyword">else</span>
0506             xlabel(<span class="string">'Element Number'</span>,<span class="string">'FontSize'</span>,8);
0507         <span class="keyword">end</span>
0508         grid on;
0509         
0510         addlabel(1,0,sprintf(<span class="string">'%s'</span>, datestr(MagnetMonitors{i}.TimeStamp)));
0511         orient tall
0512         
0513         <span class="keyword">if</span> PlotDataFlag == 2
0514             <span class="comment">% Plot more stuff</span>
0515             figure;
0516             
0517             <span class="comment">% Worst SP-AMmean</span>
0518             subplot(3,1,1);
0519             [tmp, k] = max(abs(MagnetSetpoints{i}.Data-AMmean));
0520             hist(MagnetMonitors{i}.Data(k,:), 200);
0521             title(sprintf(<span class="string">'Worst SP-mean(AM): %s(%d,%d)  SP=%g, mean(AM)=%g, SP-mean(AM)=%g'</span>, <span class="keyword">...</span>
0522                 MagnetSetpoints{i}.FamilyName, <span class="keyword">...</span>
0523                 MagnetSetpoints{i}.DeviceList(k,1), MagnetSetpoints{i}.DeviceList(k,2), <span class="keyword">...</span>
0524                 MagnetSetpoints{i}.Data(k,1), <span class="keyword">...</span>
0525                 AMmean(k), <span class="keyword">...</span>
0526                 MagnetSetpoints{i}.Data(k,1) - AMmean(k)), <span class="keyword">...</span>
0527                 <span class="string">'FontSize'</span>,8);
0528             xlabel(MagnetMonitors{i}.UnitsString,<span class="string">'FontSize'</span>,8); 
0529             a1 = axis;
0530             
0531             <span class="comment">% Worst std(AM)</span>
0532             subplot(3,1,2);
0533             [tmp, k] = max(AMstd);
0534             hist(MagnetMonitors{i}.Data(k,:), 200);
0535             title(sprintf(<span class="string">'Worst std(AM): %s(%d,%d)  SP=%g, mean(AM)=%g, std(AM)=%g'</span>, <span class="keyword">...</span>
0536                 MagnetSetpoints{i}.FamilyName, <span class="keyword">...</span>
0537                 MagnetSetpoints{i}.DeviceList(k,1), MagnetSetpoints{i}.DeviceList(k,2), <span class="keyword">...</span>
0538                 MagnetSetpoints{i}.Data(k,1), <span class="keyword">...</span>
0539                 AMmean(k), <span class="keyword">...</span>
0540                 AMstd(k)), <span class="keyword">...</span>
0541                 <span class="string">'FontSize'</span>,8);
0542             xlabel(MagnetMonitors{i}.UnitsString,<span class="string">'FontSize'</span>,8); 
0543             a2 = axis;
0544             
0545             <span class="comment">% Worst max(AM-mean(AM))</span>
0546             subplot(3,1,3);
0547             [tmp, k] = max(abs(AM_AMmeanMax));
0548             hist(MagnetMonitors{i}.Data(k,:), 200);
0549             title(sprintf(<span class="string">'Worst max(AM-mean(AM)): %s(%d,%d)  SP=%g, mean(AM)=%g, max(AM-mean(AM))=%g'</span>, <span class="keyword">...</span>
0550                 MagnetSetpoints{i}.FamilyName, <span class="keyword">...</span>
0551                 MagnetSetpoints{i}.DeviceList(k,1), MagnetSetpoints{i}.DeviceList(k,2), <span class="keyword">...</span>
0552                 MagnetSetpoints{i}.Data(k,1), <span class="keyword">...</span>
0553                 AMmean(k), <span class="keyword">...</span>
0554                 AM_AMmeanMax(k)), <span class="keyword">...</span>
0555                 <span class="string">'FontSize'</span>,8);
0556             xlabel(MagnetMonitors{i}.UnitsString,<span class="string">'FontSize'</span>,8); 
0557             a3 = axis;
0558             
0559             <span class="comment">% Force all the x-axis to be the same</span>
0560             <span class="comment">%xaxis([min([a1(1) a2(1) a3(1)]) max([a1(2) a2(2) a3(2)])]);</span>
0561             <span class="comment">%subplot(3,1,1);</span>
0562             <span class="comment">%xaxis([min([a1(1) a2(1) a3(1)]) max([a1(2) a2(2) a3(2)])]);</span>
0563             <span class="comment">%subplot(3,1,2);</span>
0564             <span class="comment">%xaxis([min([a1(1) a2(1) a3(1)]) max([a1(2) a2(2) a3(2)])]);</span>
0565             <span class="comment">%addlabel(1,0,sprintf('%s', datestr(MagnetMonitors{i}.TimeStamp)));</span>
0566             orient tall
0567         <span class="keyword">end</span>
0568     <span class="keyword">end</span>
0569 <span class="keyword">end</span>
0570 
0571 
0572 <span class="keyword">for</span> i = 1:length(BPMMonitors)
0573     <span class="keyword">if</span> ~all(isnan(BPMMonitors{i}.Data))
0574         
0575         <span class="keyword">if</span> strcmpi(UnitsFlag, <span class="string">'physics'</span>)
0576             BPMMonitors{i}  = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(BPMMonitors{i});
0577         <span class="keyword">elseif</span> strcmpi(UnitsFlag, <span class="string">'hardware'</span>)
0578             BPMMonitors{i}  = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(BPMMonitors{i});
0579         <span class="keyword">end</span>
0580 
0581         <span class="keyword">if</span> Raw2RealFlag &amp;&amp; strcmpi(BPMMonitors{i}.Units, <span class="string">'Hardware'</span>)
0582             BPMMonitors{i}  = <a href="raw2real.html" class="code" title="function DataOut = raw2real(varargin)">raw2real</a>(BPMMonitors{i});
0583         <span class="keyword">end</span>
0584 
0585         ElementList = <a href="dev2elem.html" class="code" title="function Output = dev2elem(Family, DevList)">dev2elem</a>(BPMMonitors{i}.FamilyName, BPMMonitors{i}.DeviceList);
0586         
0587         <span class="keyword">if</span> PlotDataFlag == 2
0588             <span class="comment">% Plot more stuff</span>
0589             figure;        
0590             subplot(2,1,1);
0591             plot(BPMMonitors{i}.tout, BPMMonitors{i}.Data);
0592             title(sprintf(<span class="string">'%s Family (Raw Orbit Data)'</span>, BPMMonitors{i}.FamilyName));
0593             ylabel(sprintf(<span class="string">'%s [%s]'</span>, BPMMonitors{i}.FamilyName, BPMMonitors{i}.UnitsString));
0594             axis tight;
0595             grid on;
0596         <span class="keyword">end</span>        
0597         
0598         <span class="comment">% Plot difference orbits</span>
0599         Orbit0 = BPMMonitors{i}.Data(:,1);
0600         <span class="keyword">for</span> j = size(BPMMonitors{i}.Data,2):-1:1
0601             BPMMonitors{i}.Data(:,j) = BPMMonitors{i}.Data(:,j) - Orbit0;
0602         <span class="keyword">end</span>
0603         
0604         <span class="keyword">if</span> PlotDataFlag == 2
0605             subplot(2,1,2);
0606             plot(BPMMonitors{i}.tout, BPMMonitors{i}.Data);
0607             title(sprintf(<span class="string">'%s Family Difference Orbits from %s'</span>, BPMMonitors{i}.FamilyName, datestr(BPMMonitors{i}.TimeStamp,13)));
0608             ylabel(sprintf(<span class="string">'%s [%s]'</span>, BPMMonitors{i}.FamilyName, BPMMonitors{i}.UnitsString));
0609             axis tight;
0610             grid on;
0611             
0612             addlabel(1,0,sprintf(<span class="string">'%s'</span>, datestr(BPMMonitors{i}.TimeStamp)));
0613             orient tall
0614         <span class="keyword">end</span>
0615         
0616         <span class="comment">% Difference orbits</span>
0617         DiffOrbits = diff(BPMMonitors{i}.Data, 1, 2);    
0618         <span class="comment">%fprintf('   %s:  mean(AM)=%7.3f Amps,  SP-mean(AM)=%6.3f,  std(AM)=%5.3f Amps\n', BPMMonitors{i}.FamilyName, AMmean, BPMSetpoints{i}.Data-AMmean, AMstd);</span>
0619         
0620         AMmean = mean(BPMMonitors{i}.Data,2);
0621         AMmax = max(BPMMonitors{i}.Data,[],2);
0622         AMmin = min(BPMMonitors{i}.Data,[],2);
0623         AMstd = std(BPMMonitors{i}.Data,0,2);
0624         AMstddetrend = std(detrend(BPMMonitors{i}.Data'))';
0625         
0626         figure;
0627         subplot(2,1,1);
0628         stairs(ElementList-.5, AMmean, <span class="string">'b'</span>);
0629         hold on
0630         stairs(ElementList-.5, AMmax, <span class="string">'r'</span>);
0631         stairs(ElementList-.5, AMmin, <span class="string">'g'</span>);
0632         hold off
0633         title(sprintf(<span class="string">'%s Family  (Deviation from the Starting Orbit)'</span>, BPMMonitors{i}.FamilyName));
0634         ylabel(sprintf(<span class="string">'Max/Mean/Min [%s]'</span>, BPMMonitors{i}.UnitsString));
0635         grid on;
0636         
0637         
0638         subplot(2,1,2);
0639         stairs(ElementList-.5, AMstd, <span class="string">'b'</span>);
0640         hold on;
0641         stairs(ElementList-.5, AMstddetrend, <span class="string">'r'</span>);
0642         stairs(ElementList-.5, std(DiffOrbits,0,2)/sqrt(2), <span class="string">'g'</span>);
0643         hold off
0644         ylabel(sprintf(<span class="string">'STD [%s]'</span>, BPMMonitors{i}.UnitsString));
0645         xlabel(<span class="string">'Element Number'</span>);
0646         legend(<span class="string">'Raw data'</span>,<span class="string">'Linear trend removed'</span>,<span class="string">'Difference Orbits/sqrt(2)'</span>, 0);
0647         grid on;
0648         
0649         addlabel(1,0,sprintf(<span class="string">'%s'</span>, datestr(BPMMonitors{i}.TimeStamp)));
0650         orient tall
0651     <span class="keyword">end</span>
0652 <span class="keyword">end</span>
0653 
0654 
0655 <span class="comment">% Convert back to structures</span>
0656 <span class="keyword">if</span> ~isstruct(MagnetMonitors)
0657     MagnetMonitors     = cell2field(MagnetMonitors);
0658     MagnetSetpoints    = cell2field(MagnetSetpoints);
0659     MagnetSetpointsEnd = cell2field(MagnetSetpointsEnd);
0660 <span class="keyword">end</span>
0661 <span class="keyword">if</span> ~isempty(BPMMonitors)
0662     <span class="keyword">if</span> ~isstruct(BPMMonitors)
0663         BPMMonitors = cell2field(BPMMonitors);
0664     <span class="keyword">end</span>
0665 <span class="keyword">end</span>
0666</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>