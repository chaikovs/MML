<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of plotorbitdata</title>
  <meta name="keywords" content="plotorbitdata">
  <meta name="description" content="PLOTORBITDATA - Plots BPM statistics">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; plotorbitdata.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>plotorbitdata
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>PLOTORBITDATA - Plots BPM statistics</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [BPMx, BPMy] = plotorbitdata(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">PLOTORBITDATA - Plots BPM statistics
  [BPMx, BPMy] = plotorbitdata(FileName)

  INPUTS
  1.  FileName = Filename (w/ or w/o directory) where the data was saved
      If empty then search for a file in the default BPM directory.
      If '.' then search for a file in the present directory.

  OUTPUTS
  For numeric output:
  1. BPMx - Horizontal data structure
  2. BPMy - Vertical data structure</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="getbpmresp.html" class="code" title="function [S, FileName] = getbpmresp(varargin)">getbpmresp</a>	GETBPMRESP - Returns the BPM response matrix in the horizontal and vertical planes</li><li><a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>	GETDATA - Searches through a file (or group of files) for a data structure which matches the family name</li><li><a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>	GETFAMILYDATA - Gets data associated with the accelerator control</li><li><a href="gethbpmfamily.html" class="code" title="function Family = gethbpmfamily">gethbpmfamily</a>	GETHBPMFAMILY - Return the default horizontal BPM family</li><li><a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>	GETRESPMAT - Get response matrix data from a file</li><li><a href="getvbpmfamily.html" class="code" title="function Family = getvbpmfamily">getvbpmfamily</a>	GETVBPMFAMILY - Return the default vertical BPM family</li><li><a href="plotchro.html" class="code" title="function [c, FileName] = plotchro(varargin)">plotchro</a>	PLOTCHRO - Plot the chromaticity function</li><li><a href="plotdisp.html" class="code" title="function [DxOut, DyOut, FileName] = plotdisp(varargin)">plotdisp</a>	PLOTDISP - Plots the dispersion function</li><li><a href="quadplot.html" class="code" title="function [QMS, WarningString] = quadplot(Input1, FigureHandle, sigmaBPM)">quadplot</a>	QUADPLOT - Plots quadrupole centering data</li><li><a href="sectorticks.html" class="code" title="function [Sector, Nsectors, Ndevices] = sectorticks(List)">sectorticks</a>	SECTORTICKS - Returns sector tick number for plotting purpose</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [BPMx, BPMy] = plotorbitdata(varargin)</a>
0002 <span class="comment">%PLOTORBITDATA - Plots BPM statistics</span>
0003 <span class="comment">%  [BPMx, BPMy] = plotorbitdata(FileName)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  INPUTS</span>
0006 <span class="comment">%  1.  FileName = Filename (w/ or w/o directory) where the data was saved</span>
0007 <span class="comment">%      If empty then search for a file in the default BPM directory.</span>
0008 <span class="comment">%      If '.' then search for a file in the present directory.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%  OUTPUTS</span>
0011 <span class="comment">%  For numeric output:</span>
0012 <span class="comment">%  1. BPMx - Horizontal data structure</span>
0013 <span class="comment">%  2. BPMy - Vertical data structure</span>
0014 
0015 <span class="comment">%</span>
0016 <span class="comment">%  Written by Gregory J. Portmann</span>
0017 <span class="comment">%  Modified by Laurent S. Nadolski</span>
0018 
0019 BPMxFamily = <a href="gethbpmfamily.html" class="code" title="function Family = gethbpmfamily">gethbpmfamily</a>;
0020 BPMyFamily = <a href="getvbpmfamily.html" class="code" title="function Family = getvbpmfamily">getvbpmfamily</a>;
0021 
0022 FileName = [];
0023 <span class="keyword">if</span> nargin &gt;= 1
0024     FileName = varargin{1};
0025 <span class="keyword">end</span>
0026 
0027 
0028 <span class="keyword">if</span> isstruct(FileName)
0029     BPMx = FileName;
0030     <span class="keyword">if</span> nargin &gt;= 2
0031         BPMy = varargin{2};
0032     <span class="keyword">else</span>
0033         BPMy = BPMx;
0034     <span class="keyword">end</span>
0035     <span class="comment">% BPM response matrix cludge</span>
0036     <span class="keyword">if</span> all(size(BPMx) == [2 2])
0037         BPMx = BPMx(1,1);
0038     <span class="keyword">end</span>
0039 <span class="keyword">else</span>
0040     DirFlag = 0;
0041     <span class="keyword">if</span> isdir(FileName)
0042         DirFlag = 1;
0043     <span class="keyword">else</span>
0044         <span class="keyword">if</span> length(FileName)&gt;=1
0045             <span class="keyword">if</span> strcmp(FileName(end),filesep)
0046                 DirFlag = 1;
0047             <span class="keyword">end</span>
0048         <span class="keyword">end</span>
0049     <span class="keyword">end</span>
0050     <span class="keyword">if</span> strcmp(FileName,<span class="string">'.'</span>) || isempty(FileName) || DirFlag
0051         <span class="comment">% Data root</span>
0052         <span class="keyword">if</span> strcmp(FileName,<span class="string">'.'</span>)
0053             [FileName, DirectoryName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a file to analyze'</span>);
0054         <span class="keyword">elseif</span> DirFlag
0055             [FileName, DirectoryName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a file to analyze'</span>, FileName);
0056         <span class="keyword">else</span>
0057             DirectoryName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'DataRoot'</span>);
0058             [FileName, DirectoryName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a file to analyze'</span>, DirectoryName);
0059         <span class="keyword">end</span>
0060         <span class="keyword">if</span> FileName == 0
0061             <span class="keyword">return</span>
0062         <span class="keyword">end</span>
0063         FileName = [DirectoryName FileName];
0064     <span class="keyword">end</span>
0065     
0066     
0067     <span class="comment">% Get data from file</span>
0068     <span class="keyword">try</span>
0069         BPMx = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(BPMxFamily, FileName, <span class="string">'Struct'</span>);
0070         BPMy = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(BPMyFamily, FileName, <span class="string">'Struct'</span>);
0071     <span class="keyword">catch</span>
0072         <span class="keyword">try</span>
0073             <span class="comment">% BPM response</span>
0074             BPMy = <a href="getbpmresp.html" class="code" title="function [S, FileName] = getbpmresp(varargin)">getbpmresp</a>(<span class="string">'Filename'</span>, FileName, <span class="string">'Struct'</span>);
0075             BPMx = BPMy(1,1);
0076         <span class="keyword">catch</span>
0077             <span class="keyword">try</span>
0078                 <span class="comment">% Dispersion</span>
0079                 BPMx = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(BPMxFamily, <span class="string">'RF'</span>, FileName, <span class="string">'Struct'</span>);
0080                 BPMy = <a href="getrespmat.html" class="code" title="function [S, FileName] = getrespmat(varargin)">getrespmat</a>(BPMyFamily, <span class="string">'RF'</span>, FileName, <span class="string">'Struct'</span>);
0081             <span class="keyword">catch</span>
0082                 <span class="keyword">try</span>
0083                     <span class="comment">% Chromaticity</span>
0084                     BPMx = load(FileName);
0085                 <span class="keyword">catch</span>
0086                     disp(<span class="string">'Not sure what type of file this is'</span>);
0087                     <span class="keyword">return</span>
0088                 <span class="keyword">end</span>
0089             <span class="keyword">end</span>
0090         <span class="keyword">end</span>
0091     <span class="keyword">end</span>
0092 <span class="keyword">end</span>
0093 
0094 
0095 
0096 <span class="keyword">if</span> isfield(BPMx, <span class="string">'CreatedBy'</span>) &amp;&amp; (strcmpi(BPMx.CreatedBy, <span class="string">'monbpm'</span>) || <span class="keyword">...</span>
0097         strcmpi(BPMx.CreatedBy, <span class="string">'measbpmsigma'</span>))
0098     
0099     <span class="keyword">if</span> strcmpi(BPMx.CreatedBy, <span class="string">'monbpm'</span>) 
0100         <span class="comment">% Definition of standard deviations</span>
0101         BPMxStd = std(BPMx.Data, 0, 2);
0102         BPMyStd = std(BPMy.Data, 0, 2);
0103         
0104         <span class="comment">% Difference orbit sigma</span>
0105         BPMxSigma = BPMx.Sigma;
0106         BPMySigma = BPMy.Sigma;
0107         
0108         Mx = BPMx.Data;
0109         My = BPMy.Data;
0110         
0111         tout = BPMx.tout;
0112     <span class="keyword">elseif</span> strcmpi(BPMx.CreatedBy, <span class="string">'measbpmsigma'</span>)
0113         <span class="comment">% Definition of standard deviations</span>
0114         BPMxStd = std(BPMx.RawData, 0, 2);
0115         BPMyStd = std(BPMy.RawData, 0, 2);
0116         
0117         <span class="comment">% Difference orbit sigma</span>
0118         BPMxSigma = BPMx.Data;
0119         BPMySigma = BPMy.Data;
0120         
0121         Mx = BPMx.RawData;
0122         My = BPMy.RawData;
0123         
0124         tout = BPMx.DCCT.tout;
0125     <span class="keyword">else</span>
0126         error(<span class="string">'Not sure how to analyze this file'</span>);
0127     <span class="keyword">end</span>
0128     
0129     
0130     Mx0 = Mx(:,1);
0131     <span class="keyword">for</span> i = 1:size(Mx,2)
0132         Mx(:,i) = Mx(:,i) - Mx0;
0133     <span class="keyword">end</span>      
0134     
0135     <span class="comment">%tout = BPMy.tout;</span>
0136     My0 = My(:,1);
0137     <span class="keyword">for</span> i = 1:size(My,2)
0138         My(:,i) = My(:,i) - My0;
0139     <span class="keyword">end</span>
0140     
0141     BPMxMax = max(Mx, [], 2);
0142     BPMyMax = max(My, [], 2);
0143     
0144     BPMxMin = min(Mx, [], 2);
0145     BPMyMin = min(My, [], 2);
0146         
0147     [Sector, Nsectors, Ndevices] = <a href="sectorticks.html" class="code" title="function [Sector, Nsectors, Ndevices] = sectorticks(List)">sectorticks</a>(BPMx.DeviceList);
0148     
0149     h = gcf;
0150     figure(h);
0151     clf reset
0152     subplot(2,2,1);
0153     plot(tout, Mx);
0154     grid on;
0155     xaxis([0 max(tout)]);
0156     xlabel(<span class="string">'Time [Seconds]'</span>);
0157     ylabel(sprintf(<span class="string">'Horizontal Data [%s]'</span>, BPMx.UnitsString));
0158     
0159     subplot(2,2,3);
0160     plot(tout, My);
0161     grid on;
0162     xaxis([0 max(tout)]);
0163     xlabel(<span class="string">'Time [Seconds]'</span>);
0164     ylabel(sprintf(<span class="string">'Vertical Data [%s]'</span>, BPMx.UnitsString));
0165     
0166     subplot(2,2,2);
0167     plot(Sector, abs(BPMxMax),<span class="string">'k'</span>);
0168     hold on
0169     plot(Sector, abs(BPMxMin),<span class="string">'r'</span>);
0170     plot(Sector, BPMxStd,<span class="string">'g'</span>);
0171     plot(Sector, BPMxSigma,<span class="string">'b'</span>);
0172     hold off
0173     grid on;
0174     xaxis([1 Nsectors+1])
0175     set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0176     xlabel(<span class="string">'Sector Number'</span>);
0177     ylabel(sprintf(<span class="string">'Horizontal [%s]'</span>, BPMx.UnitsString));
0178     legend(<span class="string">'abs(Max)'</span>,<span class="string">'abs(Min)'</span>,<span class="string">'std(Data)'</span>, <span class="string">'std(Difference Orbits)'</span>,0)
0179     
0180     subplot(2,2,4);
0181     plot(Sector, abs(BPMyMax),<span class="string">'k'</span>);
0182     hold on
0183     plot(Sector, abs(BPMyMin),<span class="string">'r'</span>);
0184     plot(Sector, BPMyStd,<span class="string">'g'</span>);
0185     plot(Sector, BPMySigma,<span class="string">'b'</span>);
0186     hold off
0187     grid on;
0188     xaxis([1 Nsectors+1])
0189     set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0190     xlabel(<span class="string">'Sector Number'</span>);
0191     ylabel(sprintf(<span class="string">'Vertical [%s]'</span>, BPMx.UnitsString));
0192     legend(<span class="string">'abs(Max)'</span>,<span class="string">'abs(Min)'</span>,<span class="string">'std(Data)'</span>, <span class="string">'std(Difference Orbits)'</span>,0)
0193     
0194     addlabel(.5,1,sprintf(<span class="string">'BPM Data'</span>), 10);
0195     addlabel(1,0,sprintf(<span class="string">'%s'</span>, datestr(BPMx.TimeStamp)));
0196     orient landscape  
0197     
0198     h = h + 1;
0199     
0200     figure(h);
0201     clf reset
0202     subplot(2,1,1);
0203     bar(Sector, BPMxSigma);
0204     grid on;
0205     xaxis([1 Nsectors+1])
0206     set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0207     xlabel(<span class="string">'Sector Number'</span>);
0208     ylabel(sprintf(<span class="string">'Horizontal STD [%s]'</span>, BPMx.UnitsString));
0209     title(sprintf(<span class="string">'BPM Standard Deviation of Difference Orbits / sqrt(2)'</span>));
0210     
0211     subplot(2,1,2);
0212     bar(Sector, BPMySigma);
0213     grid on;
0214     grid on;
0215     xaxis([1 Nsectors+1])
0216     set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0217     xlabel(<span class="string">'Sector Number'</span>);
0218     ylabel(sprintf(<span class="string">'Vertical STD [%s]'</span>, BPMx.UnitsString));
0219     addlabel(1,0,sprintf(<span class="string">'%s'</span>, datestr(BPMx.TimeStamp)));
0220     orient tall
0221     
0222 <span class="keyword">elseif</span> isfield(BPMx, <span class="string">'DataDescriptor'</span>) &amp;&amp; strcmpi(BPMx.DataDescriptor, <span class="string">'Dispersion'</span>)
0223     <a href="plotdisp.html" class="code" title="function [DxOut, DyOut, FileName] = plotdisp(varargin)">plotdisp</a>(BPMx, BPMy);
0224     
0225 <span class="keyword">elseif</span> isfield(BPMx, <span class="string">'DataDescriptor'</span>) &amp;&amp; strcmpi(BPMx.DataDescriptor, <span class="string">'Chromaticity'</span>)
0226     <a href="plotchro.html" class="code" title="function [c, FileName] = plotchro(varargin)">plotchro</a>(BPMx);
0227     
0228 <span class="keyword">elseif</span> isfield(BPMx, <span class="string">'DataDescriptor'</span>) &amp;&amp; strcmpi(BPMx.DataDescriptor, <span class="string">'Response Matrix'</span>)  <span class="comment">% strcmpi(BPMx.CreatedBy, 'measbpmresp')</span>
0229     <span class="comment">%if exist('plotbpmresp','file')</span>
0230     <span class="comment">%    plotbpmresp(BPMy);</span>
0231     <span class="comment">%end</span>
0232     figure;
0233     clf reset
0234     surf([BPMy(1,1).Data BPMy(1,2).Data; BPMy(2,1).Data BPMy(2,2).Data]);
0235     view(-70, 65);
0236     title(<span class="string">'Orbit Response Matrix'</span>);
0237     xlabel(<span class="string">'CM Number'</span>);
0238     ylabel(<span class="string">'BPM Number'</span>);
0239     addlabel(1,0,sprintf(<span class="string">'%s'</span>, datestr(BPMy(1,1).TimeStamp)));
0240     
0241 <span class="keyword">elseif</span> isfield(BPMx, <span class="string">'QMS'</span>)
0242     <a href="quadplot.html" class="code" title="function [QMS, WarningString] = quadplot(Input1, FigureHandle, sigmaBPM)">quadplot</a>(BPMx.QMS);
0243     
0244 <span class="keyword">elseif</span> isfield(BPMx, <span class="string">'Data'</span>) &amp;&amp; isfield(BPMx, <span class="string">'DataDescriptor'</span>) &amp;&amp; isfield(BPMx, <span class="string">'TimeStamp'</span>)    
0245     h = gcf;
0246     figure(h);
0247     clf reset
0248     subplot(2,1,1);
0249     <span class="keyword">if</span> size(BPMx.Data,2) &gt; 1
0250         plot(tout, BPMx.Data);
0251         xlabel(<span class="string">'Time [Seconds]'</span>);
0252     <span class="keyword">else</span>
0253         [Sector, Nsectors, Ndevices] = <a href="sectorticks.html" class="code" title="function [Sector, Nsectors, Ndevices] = sectorticks(List)">sectorticks</a>(BPMx.DeviceList);
0254         plot(Sector, BPMx.Data);
0255         xaxis([1 Nsectors+1])
0256         set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0257         xlabel(<span class="string">'Sector Number'</span>);
0258     <span class="keyword">end</span>
0259     grid on;
0260     ylabel(sprintf(<span class="string">'Horizontal [%s]'</span>, BPMx.UnitsString));
0261     title(sprintf(<span class="string">'%s'</span>, BPMx.DataDescriptor));
0262     
0263     subplot(2,1,2);
0264     <span class="keyword">if</span> size(BPMx.Data,2) &gt; 1
0265         plot(tout, BPMy.Data);
0266         xlabel(<span class="string">'Time [Seconds]'</span>);
0267     <span class="keyword">else</span>
0268         [Sector, Nsectors, Ndevices] = <a href="sectorticks.html" class="code" title="function [Sector, Nsectors, Ndevices] = sectorticks(List)">sectorticks</a>(BPMy.DeviceList);
0269         plot(Sector, BPMy.Data);
0270         xaxis([1 Nsectors+1])
0271         set(gca,<span class="string">'XTick'</span>,1:Nsectors);
0272         xlabel(<span class="string">'Sector Number'</span>);
0273     <span class="keyword">end</span>
0274     grid on;
0275     ylabel(sprintf(<span class="string">'Vertical [%s]'</span>, BPMx.UnitsString));
0276     title(sprintf(<span class="string">'%s'</span>, BPMy.DataDescriptor));
0277     addlabel(1,0,sprintf(<span class="string">'%s'</span>, datestr(BPMx.TimeStamp)));
0278     orient tall
0279     
0280 <span class="keyword">else</span>
0281     fprintf(<span class="string">'   Not sure how to plot data file %s.\n'</span>, FileName);
0282 <span class="keyword">end</span>
0283</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>