<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setoffset</title>
  <meta name="keywords" content="setoffset">
  <meta name="description" content="SETOFFSET - Set the offset">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; setoffset.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>setoffset
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>SETOFFSET - Set the offset</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = setoffset(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">SETOFFSET - Set the offset
  [DataStruct, ...] = setoffset(FamilyName, Data, DeviceList)
  [DataStruct, ...] = setoffset(FamilyName, FileName, DeviceList)
  [DataStruct, ...] = setoffset(FileName)
  [DataStruct, ...] = setoffset(DataStruct)
  [DataStruct, ...] = setoffset(DataStruct1, DataStruct2, ...)

  INPUTS
  1. FamilyName - Family to set the offset field {Default: BPM families}
                  (can be a cell array of families)
     DataStruct - Data structure input (.FamilyName, .Data, and .DeviceList fields are used)
     FileName - Data structure input can be in a file
  2. Data - Data vector to set
  3. DeviceList - Device list to change of the offset

  OUTPUTS
  1. DataStruct - The data structure with the new offset in the .Data field

  NOTES
  1. The offset values are changed for the present Matlab session.  They are
     not saved for future sessions.  The offset orbit is usually set in the 
     one of the initialization files (like setoperationalmode).
  2. This function calls setfamilydata.

  See Also <a href="getoffset.html" class="code" title="function Data = getoffset(varargin)">getoffset</a>, <a href="saveoffsetorbit.html" class="code" title="function saveoffsetorbit(FileName)">saveoffsetorbit</a>, <a href="plotoffsetorbit.html" class="code" title="function plotoffsetorbit(varargin)">plotoffsetorbit</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>	FINDMEMBEROF - Finds all family members</li><li><a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>	GETDATA - Searches through a file (or group of files) for a data structure which matches the family name</li><li><a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>	GETFAMILYDATA - Gets data associated with the accelerator control</li><li><a href="gethbpmfamily.html" class="code" title="function Family = gethbpmfamily">gethbpmfamily</a>	GETHBPMFAMILY - Return the default horizontal BPM family</li><li><a href="getvbpmfamily.html" class="code" title="function Family = getvbpmfamily">getvbpmfamily</a>	GETVBPMFAMILY - Return the default vertical BPM family</li><li><a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>	ISFAMILY - True for family names</li><li><a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>	SETFAMILYDATA - Sets data associated with accelerator control</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = setoffset(varargin)</a>
0002 <span class="comment">%SETOFFSET - Set the offset</span>
0003 <span class="comment">%  [DataStruct, ...] = setoffset(FamilyName, Data, DeviceList)</span>
0004 <span class="comment">%  [DataStruct, ...] = setoffset(FamilyName, FileName, DeviceList)</span>
0005 <span class="comment">%  [DataStruct, ...] = setoffset(FileName)</span>
0006 <span class="comment">%  [DataStruct, ...] = setoffset(DataStruct)</span>
0007 <span class="comment">%  [DataStruct, ...] = setoffset(DataStruct1, DataStruct2, ...)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%  INPUTS</span>
0010 <span class="comment">%  1. FamilyName - Family to set the offset field {Default: BPM families}</span>
0011 <span class="comment">%                  (can be a cell array of families)</span>
0012 <span class="comment">%     DataStruct - Data structure input (.FamilyName, .Data, and .DeviceList fields are used)</span>
0013 <span class="comment">%     FileName - Data structure input can be in a file</span>
0014 <span class="comment">%  2. Data - Data vector to set</span>
0015 <span class="comment">%  3. DeviceList - Device list to change of the offset</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%  OUTPUTS</span>
0018 <span class="comment">%  1. DataStruct - The data structure with the new offset in the .Data field</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%  NOTES</span>
0021 <span class="comment">%  1. The offset values are changed for the present Matlab session.  They are</span>
0022 <span class="comment">%     not saved for future sessions.  The offset orbit is usually set in the</span>
0023 <span class="comment">%     one of the initialization files (like setoperationalmode).</span>
0024 <span class="comment">%  2. This function calls setfamilydata.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%  See Also getoffset, saveoffsetorbit, plotoffsetorbit</span>
0027 
0028 <span class="comment">%</span>
0029 <span class="comment">%  Written by Gregory J. Portmann</span>
0030 <span class="comment">%  Modified by Laurent S. Nadolski</span>
0031 
0032 BPMFamily = {<a href="gethbpmfamily.html" class="code" title="function Family = gethbpmfamily">gethbpmfamily</a>; <a href="getvbpmfamily.html" class="code" title="function Family = getvbpmfamily">getvbpmfamily</a>};
0033 
0034 Family = <span class="string">''</span>;
0035 FileName = <span class="string">''</span>;
0036 
0037 <span class="keyword">if</span> nargin == 0
0038     DirName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'BPMData'</span>);
0039     [FileName, DirName] = uigetfile([DirName,filesep,<span class="string">'BPMOffset*.mat'</span>], <span class="string">'Select a data file:'</span>);
0040 
0041     <span class="keyword">if</span> FileName == 0
0042         <span class="keyword">return</span>;
0043     <span class="keyword">end</span>
0044 
0045     FileName = [DirName, FileName];
0046 <span class="keyword">end</span>
0047 
0048 
0049 <span class="keyword">if</span> nargin &gt;= 1
0050     <span class="keyword">if</span> iscell(varargin{1})
0051         Family = varargin{1};
0052     <span class="keyword">elseif</span> isstruct(varargin{1})
0053         Family = {varargin{1}.FamilyName};
0054         varargout{1} = varargin{1};
0055     <span class="keyword">elseif</span> <a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>(varargin{1})
0056         Family{1} = {varargin{1}};
0057         varargout{1}.FamilyName = varargin{1};
0058     <span class="keyword">elseif</span> isstr(varargin{1})
0059         FileName = varargin{1};
0060     <span class="keyword">else</span>
0061         error(<span class="string">'Input #1 unknown type: Family or Filename expected.'</span>);
0062     <span class="keyword">end</span>
0063 <span class="keyword">end</span>
0064 
0065 <span class="keyword">if</span> nargin &gt;= 2
0066     <span class="keyword">if</span> isstruct(varargin{2})
0067         Family = [Family; {varargin{2}.FamilyName}];
0068         varargout{2} = varargin{2};
0069     <span class="keyword">elseif</span> isstr(varargin{2})
0070         FileName = varargin{2};
0071     <span class="keyword">elseif</span> isnumeric(varargin{2})
0072         varargout{1}.Data = varargin{2};
0073     <span class="keyword">elseif</span> isempty(varargin{2})
0074         <span class="comment">%DirName = getfamilydata('Directory','BPMData');</span>
0075         DirName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'DataRoot'</span>);
0076         [FileName, DirName] = uigetfile([DirName,filesep,<span class="string">'*.mat'</span>], <span class="string">'Select data file:'</span>);
0077         <span class="keyword">if</span> FileName == 0
0078             <span class="keyword">return</span>;
0079         <span class="keyword">end</span>
0080         FileName = [DirName, FileName];
0081     <span class="keyword">else</span>
0082         error(<span class="string">'Input #2 unknown type: Data or Filename expected.'</span>);
0083     <span class="keyword">end</span>
0084 <span class="keyword">end</span>
0085 
0086 
0087 DeviceListFlag = 0;
0088 <span class="keyword">if</span> nargin &gt;= 3
0089     <span class="keyword">if</span> isstruct(varargin{3})
0090         Family = [Family; {varargin{3}.FamilyName}];
0091         varargout{3} = varargin{3};
0092     <span class="keyword">elseif</span> isnumeric(varargin{3})
0093         DeviceList = varargin{3};
0094         <span class="keyword">if</span> ~isfield(varargin{1}, <span class="string">'DeviceList'</span>)
0095             varargout{1}.DeviceList = varargin{3};
0096         <span class="keyword">end</span>
0097         DeviceListFlag = 1;
0098     <span class="keyword">else</span>
0099         error(<span class="string">'Input #3 unknown type: DeviceList expected.'</span>);
0100     <span class="keyword">end</span>
0101 <span class="keyword">end</span>
0102 
0103 
0104 <span class="comment">% Extra structures can be passed on</span>
0105 <span class="keyword">for</span> i = 4:nargin
0106     <span class="keyword">if</span> isstruct(varargin{i})
0107         Family = [Family; {varargin{i}.FamilyName}];
0108         varargout{i} = varargin{i};
0109     <span class="keyword">end</span>
0110 <span class="keyword">end</span>
0111 
0112     
0113 <span class="keyword">if</span> ~isempty(FileName)
0114     <span class="keyword">if</span> isempty(Family)
0115         Family = <a href="findmemberof.html" class="code" title="function  FamilyName = findmemberof(MemberString, Field)">findmemberof</a>(<span class="string">'BPM'</span>);
0116         <span class="keyword">if</span> isempty(Family)
0117             Family = BPMFamily;
0118         <span class="keyword">end</span>
0119     <span class="keyword">end</span>
0120 <span class="keyword">end</span>
0121 
0122 
0123 <span class="keyword">for</span> i = 1:length(Family)
0124     <span class="keyword">if</span> ~isempty(FileName)
0125         <span class="keyword">if</span> DeviceListFlag
0126             varargout{i} = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(Family{i}, DeviceList, <span class="string">'Struct'</span>, FileName);
0127         <span class="keyword">else</span>
0128             varargout{i} = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(Family{i}, <span class="string">'Struct'</span>, FileName);
0129         <span class="keyword">end</span>
0130     <span class="keyword">end</span>
0131 
0132     <span class="keyword">if</span> DeviceListFlag
0133         [iFound, iNotFound] = findrowindex(DeviceList, varargout{i}.DeviceList);
0134         <span class="keyword">if</span> ~isempty(iNotFound)
0135             error(<span class="string">'Not all the devices are in the data set.'</span>);
0136         <span class="keyword">end</span>
0137         varargout{i}.Data = varargout{i}.Data(iFound,:);
0138         varargout{i}.DeviceList = varargout{i}.DeviceList(iFound,:);
0139     <span class="keyword">end</span>
0140 
0141     <span class="keyword">if</span> size(varargout{i}.Data,1) ~= size(varargout{i}.DeviceList,1)
0142         error(<span class="string">'The size of the data does not equal the number of devices.'</span>);
0143     <span class="keyword">end</span>
0144     
0145     <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(varargout{i}.Data, varargout{i}.FamilyName, <span class="string">'Offset'</span>, varargout{i}.DeviceList);
0146 <span class="keyword">end</span>
0147 
0148</pre></div>
<hr><address>Generated on Mon 21-May-2007 15:29:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>